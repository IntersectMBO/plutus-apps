<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE GADTs              #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE NumericUnderscores #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell    #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TupleSections      #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns       #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-comment">-- | Transaction validation using 'cardano-ledger-specs'</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node.Validation</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-13"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatorBlock"><span class="hs-identifier">EmulatorBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-14"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier">EmulatedLedgerState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-15"></span><span>  </span><span class="annot"><span class="hs-identifier">Coin</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier">EmulatorEra</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#CardanoLedgerError"><span class="hs-identifier">CardanoLedgerError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#initialState"><span class="hs-identifier">initialState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#hasValidationErrors"><span class="hs-identifier">hasValidationErrors</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeTransactionBody"><span class="hs-identifier">makeTransactionBody</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#validateCardanoTx"><span class="hs-identifier">validateCardanoTx</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#unsafeMakeValid"><span class="hs-identifier">unsafeMakeValid</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Modifying the state</span></span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeBlock"><span class="hs-identifier">makeBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setSlot"><span class="hs-identifier">setSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#nextSlot"><span class="hs-identifier">nextSlot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setUtxo"><span class="hs-identifier">setUtxo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Lenses</span></span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#ledgerEnv"><span class="hs-identifier">ledgerEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#memPoolState"><span class="hs-identifier">memPoolState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#currentBlock"><span class="hs-identifier">currentBlock</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#previousBlocks"><span class="hs-identifier">previousBlocks</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Etc.</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorGlobals"><span class="hs-identifier">emulatorGlobals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.PlutusScriptApi</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">collectTwoPhaseScriptInputs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalScripts</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Rules.Utxos</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UtxosPredicateFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CollectErrors</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CostModels</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unCostModels</span></span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Tools</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C.Ledger</span></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsValid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">IsValid</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidatedTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ValidatedTx</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ExtendedUTxO</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ScriptResult</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fails</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Passes</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Alonzo.TxWitness</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Alonzo</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Babbage.PParams</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PParams'</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_costmdls</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_maxTxExUnits</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_protocolVersion</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.BaseTypes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Globals</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">systemStart</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ProtVer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">epochInfo</span></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Core</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Core</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Era</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Crypto</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidateScript</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.API</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Coin</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Coin</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LedgerEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LedgerEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ledgerSlotNo</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>                                   </span><span class="annot"><span class="hs-identifier">LedgerState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">lsDPState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lsUTxOState</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MempoolEnv</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MempoolState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UTxO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UTxO</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>                                   </span><span class="annot"><span class="hs-identifier">Validated</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unsafeMakeValidated</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.API</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C.Ledger</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.LedgerState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LedgerState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LedgerState</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UTxOState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_utxo</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">smartUTxOState</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.Rules.Utxo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UtxoEnv</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UtxoEnv</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.Shelley.TxBody</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DCert</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Wdrl</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Ledger.ShelleyMA.Timelocks</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ValidityInterval</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeLenses</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">over</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&amp;)</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.~)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(^.)</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/array-0.5.4.0/src"><span class="hs-identifier">Data.Array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">array</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">bimap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Default</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">def</span></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">StrictSeq</span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Records</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">HasField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">getField</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Index</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">genesisTxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getCollateral</span></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Index.Internal</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Slot</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoEmulatorEraTx</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V1</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxOut</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">P</span></span><span>
</span><span id="line-77"></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node.Params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier">EmulatorEra</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier">Params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier">emulatorPParams</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorGlobals"><span class="hs-identifier">emulatorGlobals</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>                                                   </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier">emulatorPParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Blockchain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OnChainTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OnChainTx</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">type</span><span> </span><span id="CardanoLedgerError"><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#CardanoLedgerError"><span class="hs-identifier hs-var">CardanoLedgerError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ValidationErrorInPhase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ToCardanoError</span></span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="hs-keyword">type</span><span> </span><span id="EmulatorBlock"><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatorBlock"><span class="hs-identifier hs-var">EmulatorBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Validated</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.Tx</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-comment">{- Note [Emulated ledger]

In the real cardano node, there two types of validation: Transaction validation
(performed when a transaction is first added to the mempool) and block
validation (performed when a block is created by the local node or received
from a peer).

Transaction validation runs the Plutus scripts, checks cryptographic
signatures, balances, existence of transaction inputs and so forth. This is
where the ledger state is updated. Block validation performs other checks
related to the consensus algorithm.

Networking and consensus issues are not part of the emulator's scope. We only
care about transaction validation here, so we don't have to worry about block
validation.

The decision to leave out block validation and consensus-related concerns has
the following implications:

1. We can represent blocks as simple lists-of-transactions
2. We can modify time (the slot number) and ledger parameters as we wish,
   without having to post transactions that modify them.

There are also some limitations of the emulator's functionality that could be
addressed by extending the emulator, without having to bring in the full block
validating machinery.

* We cannot represent different eras - everything is 'BabbageEra'.
* There is no handling of epoch boundaries, rewards, etc.
* The block size is unlimited - we simply take all transactions from the
  mempool when we make a block. There is however a limit on the size of
  individual transactions.
* We use the standard ledger cryptography everywhere ('StandardCrypto').
  This could be replaced by &quot;NoCrypto&quot; for faster validation.

-}</span><span>
</span><span id="line-122"></span><span>
</span><span id="line-123"></span><span class="hs-comment">{-| State of the ledger with configuration, mempool, and the blockchain.
-}</span><span>
</span><span id="line-125"></span><span class="hs-keyword">data</span><span> </span><span id="EmulatedLedgerState"><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-var">EmulatedLedgerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-126"></span><span>  </span><span id="EmulatedLedgerState"><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-var">EmulatedLedgerState</span></a></span></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="_ledgerEnv"><span class="annot"><span class="annottext">EmulatedLedgerState -&gt; MempoolEnv EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_ledgerEnv"><span class="hs-identifier hs-var hs-var">_ledgerEnv</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MempoolEnv</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_memPoolState"><span class="annot"><span class="annottext">EmulatedLedgerState -&gt; MempoolState EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_memPoolState"><span class="hs-identifier hs-var hs-var">_memPoolState</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MempoolState</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_currentBlock"><span class="annot"><span class="annottext">EmulatedLedgerState -&gt; EmulatorBlock
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_currentBlock"><span class="hs-identifier hs-var hs-var">_currentBlock</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatorBlock"><span class="hs-identifier hs-type">EmulatorBlock</span></a></span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="_previousBlocks"><span class="annot"><span class="annottext">EmulatedLedgerState -&gt; [EmulatorBlock]
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_previousBlocks"><span class="hs-identifier hs-var hs-var">_previousBlocks</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">[</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatorBlock"><span class="hs-identifier hs-type">EmulatorBlock</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621679390953"><span id="local-6989586621679390955"><span id="local-6989586621679390957"><span class="annot"><span class="annottext">Int -&gt; EmulatedLedgerState -&gt; ShowS
[EmulatedLedgerState] -&gt; ShowS
EmulatedLedgerState -&gt; String
(Int -&gt; EmulatedLedgerState -&gt; ShowS)
-&gt; (EmulatedLedgerState -&gt; String)
-&gt; ([EmulatedLedgerState] -&gt; ShowS)
-&gt; Show EmulatedLedgerState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EmulatedLedgerState] -&gt; ShowS
$cshowList :: [EmulatedLedgerState] -&gt; ShowS
show :: EmulatedLedgerState -&gt; String
$cshow :: EmulatedLedgerState -&gt; String
showsPrec :: Int -&gt; EmulatedLedgerState -&gt; ShowS
$cshowsPrec :: Int -&gt; EmulatedLedgerState -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span id="previousBlocks"><span id="currentBlock"><span id="memPoolState"><span id="ledgerEnv"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">EmulatedLedgerState</span></span></span></span></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">{-| Increase the slot number by one
-}</span><span>
</span><span id="line-138"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#nextSlot"><span class="hs-identifier hs-type">nextSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-139"></span><span id="nextSlot"><span class="annot"><span class="annottext">nextSlot :: EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#nextSlot"><span class="hs-identifier hs-var hs-var">nextSlot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  (MempoolEnv EmulatorEra)
  (MempoolEnv EmulatorEra)
-&gt; (MempoolEnv EmulatorEra -&gt; MempoolEnv EmulatorEra)
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  (MempoolEnv EmulatorEra)
  (MempoolEnv EmulatorEra)
Lens' EmulatedLedgerState (MempoolEnv EmulatorEra)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#ledgerEnv"><span class="hs-identifier hs-var">ledgerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolEnv EmulatorEra -&gt; MempoolEnv EmulatorEra
forall era. LedgerEnv era -&gt; LedgerEnv era
</span><a href="#local-6989586621679390951"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>  </span><span id="local-6989586621679390951"><span class="annot"><span class="annottext">f :: LedgerEnv era -&gt; LedgerEnv era
</span><a href="#local-6989586621679390951"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621679390950"><span class="annot"><span class="annottext">l :: LedgerEnv era
</span><a href="#local-6989586621679390950"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">LedgerEnv</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ledgerSlotNo :: forall era. LedgerEnv era -&gt; SlotNo
</span><span class="hs-identifier hs-var">ledgerSlotNo</span></span><span class="hs-glyph">=</span><span id="local-6989586621679390949"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390949"><span class="hs-identifier hs-var">oldSlot</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerEnv era
</span><a href="#local-6989586621679390950"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ledgerSlotNo :: SlotNo
</span><span class="hs-identifier hs-var">ledgerSlotNo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; SlotNo
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390949"><span class="hs-identifier hs-var">oldSlot</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-141"></span><span>
</span><span id="line-142"></span><span class="hs-comment">{-| Set the slot number
-}</span><span>
</span><span id="line-144"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setSlot"><span class="hs-identifier hs-type">setSlot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-145"></span><span id="setSlot"><span class="annot"><span class="annottext">setSlot :: SlotNo -&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setSlot"><span class="hs-identifier hs-var hs-var">setSlot</span></a></span></span><span> </span><span id="local-6989586621679390947"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390947"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  (MempoolEnv EmulatorEra)
  (MempoolEnv EmulatorEra)
-&gt; (MempoolEnv EmulatorEra -&gt; MempoolEnv EmulatorEra)
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  (MempoolEnv EmulatorEra)
  (MempoolEnv EmulatorEra)
Lens' EmulatedLedgerState (MempoolEnv EmulatorEra)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#ledgerEnv"><span class="hs-identifier hs-var">ledgerEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679390946"><span class="annot"><span class="annottext">MempoolEnv EmulatorEra
</span><a href="#local-6989586621679390946"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MempoolEnv EmulatorEra
</span><a href="#local-6989586621679390946"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">ledgerSlotNo :: SlotNo
</span><span class="hs-identifier hs-var">ledgerSlotNo</span></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390947"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span class="hs-comment">{-| Set the utxo
-}</span><span>
</span><span id="line-149"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setUtxo"><span class="hs-identifier hs-type">setUtxo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-150"></span><span id="setUtxo"><span class="annot"><span class="annottext">setUtxo :: UTxO EmulatorEra -&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setUtxo"><span class="hs-identifier hs-var hs-var">setUtxo</span></a></span></span><span> </span><span id="local-6989586621679390945"><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390945"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679390944"><span class="annot"><span class="annottext">els :: EmulatedLedgerState
</span><a href="#local-6989586621679390944"><span class="hs-identifier hs-var">els</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679390943"><span class="annot"><span class="annottext">MempoolState EmulatorEra
_memPoolState :: MempoolState EmulatorEra
_memPoolState :: EmulatedLedgerState -&gt; MempoolState EmulatorEra
</span><a href="#local-6989586621679390943"><span class="hs-identifier hs-var hs-var">_memPoolState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390944"><span class="hs-identifier hs-var">els</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_memPoolState :: MempoolState EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_memPoolState"><span class="hs-identifier hs-var">_memPoolState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolState EmulatorEra
</span><a href="#local-6989586621679390942"><span class="hs-identifier hs-var">newPoolState</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-152"></span><span>    </span><span id="local-6989586621679390942"><span class="annot"><span class="annottext">newPoolState :: MempoolState EmulatorEra
</span><a href="#local-6989586621679390942"><span class="hs-identifier hs-var hs-var">newPoolState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MempoolState EmulatorEra
</span><a href="#local-6989586621679390943"><span class="hs-identifier hs-var">_memPoolState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lsUTxOState :: UTxOState EmulatorEra
</span><span class="hs-identifier hs-var">lsUTxOState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
-&gt; Coin
-&gt; Coin
-&gt; State (EraRule &quot;PPUP&quot; EmulatorEra)
-&gt; UTxOState EmulatorEra
forall era.
Era era =&gt;
UTxO era
-&gt; Coin -&gt; Coin -&gt; State (EraRule &quot;PPUP&quot; era) -&gt; UTxOState era
</span><span class="hs-identifier hs-var">smartUTxOState</span></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390945"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;PPUP&quot; EmulatorEra)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">{-| Make a block with all transactions that have been validated in the
current block, add the block to the blockchain, and empty the current block.
-}</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeBlock"><span class="hs-identifier hs-type">makeBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-158"></span><span id="makeBlock"><span class="annot"><span class="annottext">makeBlock :: EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeBlock"><span class="hs-identifier hs-var hs-var">makeBlock</span></a></span></span><span> </span><span id="local-6989586621679390941"><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390941"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>  </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390941"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="annot"><span class="annottext">EmulatedLedgerState
-&gt; (EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">([Validated (ValidatedTx EmulatorEra)]
 -&gt; Identity [Validated (ValidatedTx EmulatorEra)])
-&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState
Lens' EmulatedLedgerState EmulatorBlock
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#currentBlock"><span class="hs-identifier hs-var">currentBlock</span></a></span><span> </span><span class="annot"><span class="annottext">(([Validated (ValidatedTx EmulatorEra)]
  -&gt; Identity [Validated (ValidatedTx EmulatorEra)])
 -&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState)
-&gt; [Validated (ValidatedTx EmulatorEra)]
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-161"></span><span>    </span><span class="annot"><span class="annottext">EmulatedLedgerState
-&gt; (EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  [[Validated (ValidatedTx EmulatorEra)]]
  [[Validated (ValidatedTx EmulatorEra)]]
-&gt; ([[Validated (ValidatedTx EmulatorEra)]]
    -&gt; [[Validated (ValidatedTx EmulatorEra)]])
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">ASetter
  EmulatedLedgerState
  EmulatedLedgerState
  [[Validated (ValidatedTx EmulatorEra)]]
  [[Validated (ValidatedTx EmulatorEra)]]
Lens' EmulatedLedgerState [EmulatorBlock]
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#previousBlocks"><span class="hs-identifier hs-var">previousBlocks</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Validated (ValidatedTx EmulatorEra)]
-&gt; [Validated (ValidatedTx EmulatorEra)]
forall a. [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([Validated (ValidatedTx EmulatorEra)]
 -&gt; [Validated (ValidatedTx EmulatorEra)])
-&gt; [Validated (ValidatedTx EmulatorEra)]
-&gt; [Validated (ValidatedTx EmulatorEra)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390941"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
-&gt; Getting
     [Validated (ValidatedTx EmulatorEra)]
     EmulatedLedgerState
     [Validated (ValidatedTx EmulatorEra)]
-&gt; [Validated (ValidatedTx EmulatorEra)]
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  [Validated (ValidatedTx EmulatorEra)]
  EmulatedLedgerState
  [Validated (ValidatedTx EmulatorEra)]
Lens' EmulatedLedgerState EmulatorBlock
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#currentBlock"><span class="hs-identifier hs-var">currentBlock</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-comment">{-| Initial ledger state for a distribution
-}</span><span>
</span><span id="line-165"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-166"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: Params -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span id="local-6989586621679390939"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390939"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState :: MempoolEnv EmulatorEra
-&gt; MempoolState EmulatorEra
-&gt; EmulatorBlock
-&gt; [EmulatorBlock]
-&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_ledgerEnv :: MempoolEnv EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_ledgerEnv"><span class="hs-identifier hs-var">_ledgerEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerEnv :: forall era.
SlotNo -&gt; TxIx -&gt; PParams era -&gt; AccountState -&gt; LedgerEnv era
</span><span class="hs-identifier hs-type">C.Ledger.LedgerEnv</span></span><span>
</span><span id="line-168"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ledgerSlotNo :: SlotNo
</span><span class="hs-identifier hs-var">C.Ledger.ledgerSlotNo</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-number">0</span></span><span>
</span><span id="line-169"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerIx :: TxIx
</span><span class="hs-identifier hs-var">C.Ledger.ledgerIx</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxIx
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span>
</span><span id="line-170"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerPp :: PParams EmulatorEra
</span><span class="hs-identifier hs-var">C.Ledger.ledgerPp</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390939"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-171"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ledgerAccount :: AccountState
</span><span class="hs-identifier hs-var">C.Ledger.ledgerAccount</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coin -&gt; Coin -&gt; AccountState
</span><span class="hs-identifier hs-var">C.Ledger.AccountState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-173"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_memPoolState :: MempoolState EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_memPoolState"><span class="hs-identifier hs-var">_memPoolState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LedgerState :: forall era.
UTxOState era -&gt; DPState (Crypto era) -&gt; LedgerState era
</span><span class="hs-identifier hs-type">LedgerState</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">lsUTxOState :: UTxOState EmulatorEra
</span><span class="hs-identifier hs-var">lsUTxOState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
-&gt; Coin
-&gt; Coin
-&gt; State (EraRule &quot;PPUP&quot; EmulatorEra)
-&gt; UTxOState EmulatorEra
forall era.
Era era =&gt;
UTxO era
-&gt; Coin -&gt; Coin -&gt; State (EraRule &quot;PPUP&quot; era) -&gt; UTxOState era
</span><span class="hs-identifier hs-var">smartUTxOState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (TxIn (Crypto EmulatorEra)) (TxOut EmulatorEra)
-&gt; UTxO EmulatorEra
forall era. Map (TxIn (Crypto era)) (TxOut era) -&gt; UTxO era
</span><span class="hs-identifier hs-var">UTxO</span></span><span> </span><span class="annot"><span class="annottext">Map (TxIn (Crypto EmulatorEra)) (TxOut EmulatorEra)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Coin
</span><span class="hs-identifier hs-var">Coin</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">State (EraRule &quot;PPUP&quot; EmulatorEra)
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">lsDPState :: DPState (Crypto EmulatorEra)
</span><span class="hs-identifier hs-var">lsDPState</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DState StandardCrypto
-&gt; PState StandardCrypto -&gt; DPState StandardCrypto
forall crypto. DState crypto -&gt; PState crypto -&gt; DPState crypto
</span><span class="hs-identifier hs-var">C.Ledger.DPState</span></span><span> </span><span class="annot"><span class="annottext">DState StandardCrypto
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span> </span><span class="annot"><span class="annottext">PState StandardCrypto
forall a. Default a =&gt; a
</span><span class="hs-identifier hs-var">def</span></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_currentBlock :: EmulatorBlock
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_currentBlock"><span class="hs-identifier hs-var">_currentBlock</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-178"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_previousBlocks :: [EmulatorBlock]
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_previousBlocks"><span class="hs-identifier hs-var">_previousBlocks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#utxoEnv"><span class="hs-identifier hs-type">utxoEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Ledger.UtxoEnv</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span>
</span><span id="line-183"></span><span id="utxoEnv"><span class="annot"><span class="annottext">utxoEnv :: Params -&gt; SlotNo -&gt; UtxoEnv EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#utxoEnv"><span class="hs-identifier hs-var hs-var">utxoEnv</span></a></span></span><span> </span><span id="local-6989586621679390931"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390931"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390930"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390930"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo
-&gt; PParams EmulatorEra
-&gt; Map
     (KeyHash 'StakePool (Crypto EmulatorEra))
     (PoolParams (Crypto EmulatorEra))
-&gt; GenDelegs (Crypto EmulatorEra)
-&gt; UtxoEnv EmulatorEra
forall era.
SlotNo
-&gt; PParams era
-&gt; Map (KeyHash 'StakePool (Crypto era)) (PoolParams (Crypto era))
-&gt; GenDelegs (Crypto era)
-&gt; UtxoEnv era
</span><span class="hs-identifier hs-var">C.Ledger.UtxoEnv</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390930"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390931"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  (KeyHash 'StakePool (Crypto EmulatorEra))
  (PoolParams (Crypto EmulatorEra))
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map (KeyHash 'Genesis StandardCrypto) (GenDelegPair StandardCrypto)
-&gt; GenDelegs StandardCrypto
forall crypto.
Map (KeyHash 'Genesis crypto) (GenDelegPair crypto)
-&gt; GenDelegs crypto
</span><span class="hs-identifier hs-var">C.Ledger.GenDelegs</span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'Genesis StandardCrypto) (GenDelegPair StandardCrypto)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#applyTx"><span class="hs-identifier hs-type">applyTx</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-186"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>  </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-188"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Core.Tx</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-189"></span><span>  </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ValidationError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validated</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.Tx</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span id="applyTx"><span class="annot"><span class="annottext">applyTx :: Params
-&gt; EmulatedLedgerState
-&gt; Tx EmulatorEra
-&gt; Either
     ValidationError (EmulatedLedgerState, Validated (Tx EmulatorEra))
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#applyTx"><span class="hs-identifier hs-var hs-var">applyTx</span></a></span></span><span> </span><span id="local-6989586621679390927"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390927"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390926"><span class="annot"><span class="annottext">oldState :: EmulatedLedgerState
</span><a href="#local-6989586621679390926"><span class="hs-identifier hs-var">oldState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#EmulatedLedgerState"><span class="hs-identifier hs-type">EmulatedLedgerState</span></a></span><span class="hs-special">{</span><span id="local-6989586621679390925"><span class="annot"><span class="annottext">MempoolEnv EmulatorEra
_ledgerEnv :: MempoolEnv EmulatorEra
_ledgerEnv :: EmulatedLedgerState -&gt; MempoolEnv EmulatorEra
</span><a href="#local-6989586621679390925"><span class="hs-identifier hs-var hs-var">_ledgerEnv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679390924"><span class="annot"><span class="annottext">MempoolState EmulatorEra
_memPoolState :: MempoolState EmulatorEra
_memPoolState :: EmulatedLedgerState -&gt; MempoolState EmulatorEra
</span><a href="#local-6989586621679390924"><span class="hs-identifier hs-var hs-var">_memPoolState</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679390923"><span class="annot"><span class="annottext">Tx EmulatorEra
</span><a href="#local-6989586621679390923"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-191"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679390922"><span class="annot"><span class="annottext">MempoolState EmulatorEra
</span><a href="#local-6989586621679390922"><span class="hs-identifier hs-var">newMempool</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679390921"><span class="annot"><span class="annottext">Validated (ValidatedTx EmulatorEra)
</span><a href="#local-6989586621679390921"><span class="hs-identifier hs-var">vtx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ApplyTxError EmulatorEra -&gt; ValidationError)
-&gt; Either
     (ApplyTxError EmulatorEra)
     (MempoolState EmulatorEra, Validated (ValidatedTx EmulatorEra))
-&gt; Either
     ValidationError
     (MempoolState EmulatorEra, Validated (ValidatedTx EmulatorEra))
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.CardanoLedgerValidationError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ValidationError)
-&gt; (ApplyTxError EmulatorEra -&gt; Text)
-&gt; ApplyTxError EmulatorEra
-&gt; ValidationError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; (ApplyTxError EmulatorEra -&gt; String)
-&gt; ApplyTxError EmulatorEra
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ApplyTxError EmulatorEra -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Globals
-&gt; MempoolEnv EmulatorEra
-&gt; MempoolState EmulatorEra
-&gt; Tx EmulatorEra
-&gt; Either
     (ApplyTxError EmulatorEra)
     (MempoolState EmulatorEra, Validated (Tx EmulatorEra))
forall era (m :: * -&gt; *).
(ApplyTx era, MonadError (ApplyTxError era) m) =&gt;
Globals
-&gt; MempoolEnv era
-&gt; MempoolState era
-&gt; Tx era
-&gt; m (MempoolState era, Validated (Tx era))
</span><span class="hs-identifier hs-var">C.Ledger.applyTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; Globals
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorGlobals"><span class="hs-identifier hs-var">emulatorGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390927"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MempoolEnv EmulatorEra
</span><a href="#local-6989586621679390925"><span class="hs-identifier hs-var">_ledgerEnv</span></a></span><span> </span><span class="annot"><span class="annottext">MempoolState EmulatorEra
</span><a href="#local-6989586621679390924"><span class="hs-identifier hs-var">_memPoolState</span></a></span><span> </span><span class="annot"><span class="annottext">Tx EmulatorEra
</span><a href="#local-6989586621679390923"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>  </span><span class="annot"><span class="annottext">(EmulatedLedgerState, Validated (ValidatedTx EmulatorEra))
-&gt; Either
     ValidationError
     (EmulatedLedgerState, Validated (ValidatedTx EmulatorEra))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390926"><span class="hs-identifier hs-var">oldState</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
-&gt; (EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(MempoolState EmulatorEra -&gt; Identity (MempoolState EmulatorEra))
-&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState
Lens' EmulatedLedgerState (MempoolState EmulatorEra)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#memPoolState"><span class="hs-identifier hs-var">memPoolState</span></a></span><span> </span><span class="annot"><span class="annottext">((MempoolState EmulatorEra -&gt; Identity (MempoolState EmulatorEra))
 -&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState)
-&gt; MempoolState EmulatorEra
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">MempoolState EmulatorEra
</span><a href="#local-6989586621679390922"><span class="hs-identifier hs-var">newMempool</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
-&gt; (EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(([Validated (ValidatedTx EmulatorEra)]
  -&gt; Identity [Validated (ValidatedTx EmulatorEra)])
 -&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState)
-&gt; ([Validated (ValidatedTx EmulatorEra)]
    -&gt; [Validated (ValidatedTx EmulatorEra)])
-&gt; EmulatedLedgerState
-&gt; EmulatedLedgerState
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="annot"><span class="annottext">([Validated (ValidatedTx EmulatorEra)]
 -&gt; Identity [Validated (ValidatedTx EmulatorEra)])
-&gt; EmulatedLedgerState -&gt; Identity EmulatedLedgerState
Lens' EmulatedLedgerState EmulatorBlock
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#currentBlock"><span class="hs-identifier hs-var">currentBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Validated (ValidatedTx EmulatorEra)
</span><a href="#local-6989586621679390921"><span class="hs-identifier hs-var">vtx</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Validated (ValidatedTx EmulatorEra)
</span><a href="#local-6989586621679390921"><span class="hs-identifier hs-var">vtx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#hasValidationErrors"><span class="hs-identifier hs-type">hasValidationErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.UtxoIndex</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ValidationResult</span></span><span>
</span><span id="line-196"></span><span id="hasValidationErrors"><span class="annot"><span class="annottext">hasValidationErrors :: Params -&gt; SlotNo -&gt; UtxoIndex -&gt; Tx BabbageEra -&gt; ValidationResult
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#hasValidationErrors"><span class="hs-identifier hs-var hs-var">hasValidationErrors</span></a></span></span><span> </span><span id="local-6989586621679390915"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390914"><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390914"><span class="hs-identifier hs-var">slotNo</span></a></span></span><span> </span><span id="local-6989586621679390913"><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679390913"><span class="hs-identifier hs-var">utxoIndex</span></a></span></span><span> </span><span id="local-6989586621679390912"><span class="annot"><span class="annottext">tx' :: Tx BabbageEra
</span><a href="#local-6989586621679390912"><span class="hs-identifier hs-var">tx'</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ShelleyTx</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679390910"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra BabbageEra)
</span><a href="#local-6989586621679390910"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ValidationError (EmulatedLedgerState, OnChainTx)
</span><a href="#local-6989586621679390909"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679390908"><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390908"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; ValidationError -&gt; ValidationResult
</span><span class="hs-identifier hs-var">P.FailPhase1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx BabbageEra -&gt; CardanoTx
</span><span class="hs-identifier hs-var">CardanoEmulatorEraTx</span></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390912"><span class="hs-identifier hs-var">tx'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390908"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679390906"><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621679390906"><span class="hs-identifier hs-var">vtx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Params
-&gt; UTxO EmulatorEra
-&gt; Tx BabbageEra
-&gt; Either ValidationErrorInPhase RedeemerReport
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#getTxExUnitsWithLogs"><span class="hs-identifier hs-var">getTxExUnitsWithLogs</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390904"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390912"><span class="hs-identifier hs-var">tx'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-200"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase1</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679390902"><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390902"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; ValidationError -&gt; ValidationResult
</span><span class="hs-identifier hs-var">P.FailPhase1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx BabbageEra -&gt; CardanoTx
</span><span class="hs-identifier hs-var">CardanoEmulatorEraTx</span></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390912"><span class="hs-identifier hs-var">tx'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390902"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-201"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase2</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679390900"><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390900"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; ValidationError -&gt; Value -&gt; ValidationResult
</span><span class="hs-identifier hs-var">P.FailPhase2</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621679390906"><span class="hs-identifier hs-var">vtx</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621679390900"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ValidationResult) -&gt; Value -&gt; ValidationResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UtxoIndex -&gt; CardanoTx -&gt; Value
</span><span class="hs-identifier hs-var">getCollateral</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679390913"><span class="hs-identifier hs-var">utxoIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx BabbageEra -&gt; CardanoTx
</span><span class="hs-identifier hs-var">CardanoEmulatorEraTx</span></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390912"><span class="hs-identifier hs-var">tx'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>      </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679390898"><span class="annot"><span class="annottext">RedeemerReport
</span><a href="#local-6989586621679390898"><span class="hs-identifier hs-var">report</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; RedeemerReport -&gt; ValidationResult
</span><span class="hs-identifier hs-var">P.Success</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621679390906"><span class="hs-identifier hs-var">vtx</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerReport
</span><a href="#local-6989586621679390898"><span class="hs-identifier hs-var">report</span></a></span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679390904"><span class="annot"><span class="annottext">utxo :: UTxO EmulatorEra
</span><a href="#local-6989586621679390904"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UtxoIndex -&gt; UTxO EmulatorEra
</span><span class="hs-identifier hs-var">P.fromPlutusIndex</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679390913"><span class="hs-identifier hs-var">utxoIndex</span></a></span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621679390895"><span class="annot"><span class="annottext">state :: EmulatedLedgerState
</span><a href="#local-6989586621679390895"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotNo -&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setSlot"><span class="hs-identifier hs-var">setSlot</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390914"><span class="hs-identifier hs-var">slotNo</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra -&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#setUtxo"><span class="hs-identifier hs-var">setUtxo</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390904"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatedLedgerState -&gt; EmulatedLedgerState)
-&gt; EmulatedLedgerState -&gt; EmulatedLedgerState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; EmulatedLedgerState
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span id="local-6989586621679390909"><span class="annot"><span class="annottext">res :: Either ValidationError (EmulatedLedgerState, OnChainTx)
</span><a href="#local-6989586621679390909"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>      </span><span id="local-6989586621679390894"><span class="annot"><span class="annottext">ValidatedTx EmulatorEra
</span><a href="#local-6989586621679390894"><span class="hs-identifier hs-var">vtx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([UtxosPredicateFailure EmulatorEra] -&gt; ValidationError)
-&gt; Either
     [UtxosPredicateFailure EmulatorEra] (ValidatedTx EmulatorEra)
-&gt; Either ValidationError (ValidatedTx EmulatorEra)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.CardanoLedgerValidationError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ValidationError)
-&gt; ([UtxosPredicateFailure EmulatorEra] -&gt; Text)
-&gt; [UtxosPredicateFailure EmulatorEra]
-&gt; ValidationError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; ([UtxosPredicateFailure EmulatorEra] -&gt; String)
-&gt; [UtxosPredicateFailure EmulatorEra]
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[UtxosPredicateFailure EmulatorEra] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Globals
-&gt; UtxoEnv EmulatorEra
-&gt; UTxOState EmulatorEra
-&gt; Tx EmulatorEra
-&gt; Either
     [UtxosPredicateFailure EmulatorEra] (ValidatedTx EmulatorEra)
forall era (m :: * -&gt; *).
(MonadError [UtxosPredicateFailure era] m, Script era ~ Script era,
 Witnesses era ~ TxWitness era, ValidateScript era,
 HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era))),
 HasField &quot;_costmdls&quot; (PParams era) CostModels,
 HasField &quot;_protocolVersion&quot; (PParams era) ProtVer,
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;vldt&quot; (TxBody era) ValidityInterval, ExtendedUTxO era) =&gt;
Globals
-&gt; UtxoEnv era -&gt; UTxOState era -&gt; Tx era -&gt; m (ValidatedTx era)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#constructValidated"><span class="hs-identifier hs-var">constructValidated</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; Globals
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorGlobals"><span class="hs-identifier hs-var">emulatorGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; SlotNo -&gt; UtxoEnv EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#utxoEnv"><span class="hs-identifier hs-var">utxoEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><a href="#local-6989586621679390914"><span class="hs-identifier hs-var">slotNo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MempoolState EmulatorEra -&gt; UTxOState EmulatorEra
forall era. LedgerState era -&gt; UTxOState era
</span><span class="hs-identifier hs-var hs-var">lsUTxOState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmulatedLedgerState -&gt; MempoolState EmulatorEra
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#_memPoolState"><span class="hs-identifier hs-var hs-var">_memPoolState</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390895"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra BabbageEra)
Tx EmulatorEra
</span><a href="#local-6989586621679390910"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>      </span><span class="annot"><span class="annottext">(Validated (ValidatedTx EmulatorEra) -&gt; OnChainTx)
-&gt; (EmulatedLedgerState, Validated (ValidatedTx EmulatorEra))
-&gt; (EmulatedLedgerState, OnChainTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Validated (Tx EmulatorEra) -&gt; OnChainTx
Validated (ValidatedTx EmulatorEra) -&gt; OnChainTx
</span><span class="hs-identifier hs-var">OnChainTx</span></span><span> </span><span class="annot"><span class="annottext">((EmulatedLedgerState, Validated (ValidatedTx EmulatorEra))
 -&gt; (EmulatedLedgerState, OnChainTx))
-&gt; Either
     ValidationError
     (EmulatedLedgerState, Validated (ValidatedTx EmulatorEra))
-&gt; Either ValidationError (EmulatedLedgerState, OnChainTx)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Params
-&gt; EmulatedLedgerState
-&gt; Tx EmulatorEra
-&gt; Either
     ValidationError (EmulatedLedgerState, Validated (Tx EmulatorEra))
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#applyTx"><span class="hs-identifier hs-var">applyTx</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390915"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatedLedgerState
</span><a href="#local-6989586621679390895"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">Tx EmulatorEra
ValidatedTx EmulatorEra
</span><a href="#local-6989586621679390894"><span class="hs-identifier hs-var">vtx</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- | Construct a 'ValidatedTx' from a 'Core.Tx' by setting the `IsValid`</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- flag.</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- Note that this simply constructs the transaction; it does not validate</span><span>
</span><span id="line-214"></span><span class="hs-comment">-- anything other than the scripts. Thus the resulting transaction may be</span><span>
</span><span id="line-215"></span><span class="hs-comment">-- completely invalid.</span><span>
</span><span id="line-216"></span><span class="hs-comment">--</span><span>
</span><span id="line-217"></span><span class="hs-comment">-- Copied from cardano-ledger as it was removed there</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- in https://github.com/input-output-hk/cardano-ledger/commit/721adb55b39885847562437a6fe7e998f8e48c03</span><span>
</span><span id="line-219"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#constructValidated"><span class="hs-identifier hs-type">constructValidated</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-220"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679391143"><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span></span><span> </span><span id="local-6989586621679391142"><span class="annot"><a href="#local-6989586621679391142"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UtxosPredicateFailure</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><a href="#local-6989586621679391142"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Core.Script</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Core.Witnesses</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Alonzo.TxWitness</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ValidateScript</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;inputs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.TxBody</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxIn</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-226"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;certs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.TxBody</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StrictSeq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DCert</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;_costmdls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.PParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CostModels</span></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;_protocolVersion&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.PParams</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ProtVer</span></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;wdrls&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.TxBody</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Wdrl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Crypto</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">HasField</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;vldt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Core.TxBody</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidityInterval</span></span><span class="hs-special">,</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">ExtendedUTxO</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-233"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Globals</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-234"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UtxoEnv</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-235"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">UTxOState</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Core.Tx</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="#local-6989586621679391142"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ValidatedTx</span></span><span> </span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-238"></span><span id="constructValidated"><span class="annot"><span class="annottext">constructValidated :: Globals
-&gt; UtxoEnv era -&gt; UTxOState era -&gt; Tx era -&gt; m (ValidatedTx era)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#constructValidated"><span class="hs-identifier hs-var hs-var">constructValidated</span></a></span></span><span> </span><span id="local-6989586621679390891"><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679390891"><span class="hs-identifier hs-var">globals</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">UtxoEnv</span></span><span> </span><span class="annot"><span class="annottext">SlotNo
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679390890"><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679390890"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span class="annot"><span class="annottext">Map (KeyHash 'StakePool (Crypto era)) (PoolParams (Crypto era))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenDelegs (Crypto era)
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679390889"><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679390889"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679390888"><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-239"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
-&gt; SystemStart
-&gt; PParams era
-&gt; Tx era
-&gt; UTxO era
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
forall era.
(Era era, ExtendedUTxO era, Script era ~ Script era,
 HasField &quot;_costmdls&quot; (PParams era) CostModels,
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era))),
 HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;wits&quot; (Tx era) (TxWitness era)) =&gt;
EpochInfo (Either Text)
-&gt; SystemStart
-&gt; PParams era
-&gt; Tx era
-&gt; UTxO era
-&gt; Either
     [CollectError (Crypto era)]
     [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><span class="hs-identifier hs-var">collectTwoPhaseScriptInputs</span></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621679390887"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679390886"><span class="hs-identifier hs-var">sysS</span></a></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679390890"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO era
</span><a href="#local-6989586621679390885"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679390884"><span class="annot"><span class="annottext">[CollectError (Crypto era)]
</span><a href="#local-6989586621679390884"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[UtxosPredicateFailure era] -&gt; m (ValidatedTx era)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[CollectError (Crypto era)] -&gt; UtxosPredicateFailure era
forall era.
[CollectError (Crypto era)] -&gt; UtxosPredicateFailure era
</span><span class="hs-identifier hs-var">CollectErrors</span></span><span> </span><span class="annot"><span class="annottext">[CollectError (Crypto era)]
</span><a href="#local-6989586621679390884"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679390883"><span class="annot"><span class="annottext">[(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><a href="#local-6989586621679390883"><span class="hs-identifier hs-var">sLst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-242"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679390882"><span class="annot"><span class="annottext">scriptEvalResult :: ScriptResult
</span><a href="#local-6989586621679390882"><span class="hs-identifier hs-var hs-var">scriptEvalResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ProtVer
-&gt; Tx era
-&gt; [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; ScriptResult
forall era tx.
(Era era, Show (Script era), HasField &quot;body&quot; tx (TxBody era),
 HasField &quot;wits&quot; tx (TxWitness era),
 HasField &quot;vldt&quot; (TxBody era) ValidityInterval) =&gt;
ProtVer
-&gt; tx
-&gt; [(ShortByteString, Language, [Data era], ExUnits, CostModel)]
-&gt; ScriptResult
</span><span class="hs-identifier hs-var">evalScripts</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621679391143"><span class="hs-identifier hs-type">era</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams era -&gt; ProtVer
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_protocolVersion&quot;</span></span><span> </span><span class="annot"><span class="annottext">PParams era
</span><a href="#local-6989586621679390890"><span class="hs-identifier hs-var">pp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">[(ShortByteString, Language, [Data era], ExUnits, CostModel)]
</span><a href="#local-6989586621679390883"><span class="hs-identifier hs-var">sLst</span></a></span><span>
</span><span id="line-243"></span><span>          </span><span id="local-6989586621679390881"><span class="annot"><span class="annottext">vTx :: ValidatedTx era
</span><a href="#local-6989586621679390881"><span class="hs-identifier hs-var hs-var">vTx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>            </span><span class="annot"><span class="annottext">TxBody era
-&gt; TxWitness era
-&gt; IsValid
-&gt; StrictMaybe (AuxiliaryData era)
-&gt; ValidatedTx era
forall era.
TxBody era
-&gt; TxWitness era
-&gt; IsValid
-&gt; StrictMaybe (AuxiliaryData era)
-&gt; ValidatedTx era
</span><span class="hs-identifier hs-var">ValidatedTx</span></span><span>
</span><span id="line-245"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; TxBody era
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;body&quot;</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; TxWitness era
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;wits&quot;</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IsValid
</span><span class="hs-identifier hs-var">IsValid</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptResult -&gt; Bool
</span><a href="#local-6989586621679390880"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptResult
</span><a href="#local-6989586621679390882"><span class="hs-identifier hs-var">scriptEvalResult</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tx era -&gt; StrictMaybe (AuxiliaryData era)
forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;auxiliaryData&quot;</span></span><span> </span><span class="annot"><span class="annottext">Tx era
</span><a href="#local-6989586621679390888"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ValidatedTx era -&gt; m (ValidatedTx era)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatedTx era
</span><a href="#local-6989586621679390881"><span class="hs-identifier hs-var">vTx</span></a></span><span>
</span><span id="line-250"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-251"></span><span>    </span><span id="local-6989586621679390885"><span class="annot"><span class="annottext">utxo :: UTxO era
</span><a href="#local-6989586621679390885"><span class="hs-identifier hs-var hs-var">utxo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTxOState era -&gt; UTxO era
forall era. UTxOState era -&gt; UTxO era
</span><span class="hs-identifier hs-var hs-var">_utxo</span></span><span> </span><span class="annot"><span class="annottext">UTxOState era
</span><a href="#local-6989586621679390889"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span id="local-6989586621679390886"><span class="annot"><span class="annottext">sysS :: SystemStart
</span><a href="#local-6989586621679390886"><span class="hs-identifier hs-var hs-var">sysS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; SystemStart
</span><span class="hs-identifier hs-var hs-var">systemStart</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679390891"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679390887"><span class="annot"><span class="annottext">ei :: EpochInfo (Either Text)
</span><a href="#local-6989586621679390887"><span class="hs-identifier hs-var hs-var">ei</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; EpochInfo (Either Text)
</span><span class="hs-identifier hs-var hs-var">epochInfo</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679390891"><span class="hs-identifier hs-var">globals</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span id="local-6989586621679390880"><span class="annot"><span class="annottext">lift :: ScriptResult -&gt; Bool
</span><a href="#local-6989586621679390880"><span class="hs-identifier hs-var hs-var">lift</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Passes</span></span><span> </span><span class="annot"><span class="annottext">[PlutusDebug]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><a href="#local-6989586621679390880"><span class="hs-identifier hs-var">lift</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fails</span></span><span> </span><span class="annot"><span class="annottext">[PlutusDebug]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ScriptFailure
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#unsafeMakeValid"><span class="hs-identifier hs-type">unsafeMakeValid</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoTx</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OnChainTx</span></span><span>
</span><span id="line-258"></span><span id="unsafeMakeValid"><span class="annot"><span class="annottext">unsafeMakeValid :: CardanoTx -&gt; OnChainTx
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#unsafeMakeValid"><span class="hs-identifier hs-var hs-var">unsafeMakeValid</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CardanoEmulatorEraTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span id="local-6989586621679390878"><span class="annot"><span class="annottext">TxBody BabbageEra
</span><a href="#local-6989586621679390878"><span class="hs-identifier hs-var">txBody</span></a></span></span><span> </span><span class="annot"><span class="annottext">[KeyWitness BabbageEra]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-259"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ShelleyTxBody</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679390876"><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra BabbageEra)
</span><a href="#local-6989586621679390876"><span class="hs-identifier hs-var">txBody'</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Script (ShelleyLedgerEra BabbageEra)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxBodyScriptData BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (AuxiliaryData (ShelleyLedgerEra BabbageEra))
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxScriptValidity BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody BabbageEra
</span><a href="#local-6989586621679390878"><span class="hs-identifier hs-var">txBody</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span id="local-6989586621679390875"><span class="annot"><span class="annottext">Tx EmulatorEra
</span><a href="#local-6989586621679390875"><span class="hs-identifier hs-var">vtx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Core.Tx</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBody EmulatorEra
-&gt; TxWitness EmulatorEra
-&gt; IsValid
-&gt; StrictMaybe (AuxiliaryData EmulatorEra)
-&gt; ValidatedTx EmulatorEra
forall era.
TxBody era
-&gt; TxWitness era
-&gt; IsValid
-&gt; StrictMaybe (AuxiliaryData era)
-&gt; ValidatedTx era
</span><span class="hs-identifier hs-var">ValidatedTx</span></span><span> </span><span class="annot"><span class="annottext">TxBody (ShelleyLedgerEra BabbageEra)
TxBody EmulatorEra
</span><a href="#local-6989586621679390876"><span class="hs-identifier hs-var">txBody'</span></a></span><span> </span><span class="annot"><span class="annottext">TxWitness EmulatorEra
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IsValid
</span><span class="hs-identifier hs-var">IsValid</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StrictMaybe (AuxiliaryData EmulatorEra)
forall a. StrictMaybe a
</span><span class="hs-identifier hs-var">C.Ledger.SNothing</span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Validated (Tx EmulatorEra) -&gt; OnChainTx
</span><span class="hs-identifier hs-var">OnChainTx</span></span><span> </span><span class="annot"><span class="annottext">(Validated (Tx EmulatorEra) -&gt; OnChainTx)
-&gt; Validated (Tx EmulatorEra) -&gt; OnChainTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatedTx EmulatorEra -&gt; Validated (ValidatedTx EmulatorEra)
forall tx. tx -&gt; Validated tx
</span><span class="hs-identifier hs-var">unsafeMakeValidated</span></span><span> </span><span class="annot"><span class="annottext">Tx EmulatorEra
ValidatedTx EmulatorEra
</span><a href="#local-6989586621679390875"><span class="hs-identifier hs-var">vtx</span></a></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#validateCardanoTx"><span class="hs-identifier hs-type">validateCardanoTx</span></a></span><span>
</span><span id="line-264"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Slot</span></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.UtxoIndex</span></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoTx</span></span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ValidationResult</span></span><span>
</span><span id="line-269"></span><span id="validateCardanoTx"><span class="annot"><span class="annottext">validateCardanoTx :: Params -&gt; Slot -&gt; UtxoIndex -&gt; CardanoTx -&gt; ValidationResult
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#validateCardanoTx"><span class="hs-identifier hs-var hs-var">validateCardanoTx</span></a></span></span><span> </span><span id="local-6989586621679390873"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390873"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390872"><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679390872"><span class="hs-identifier hs-var">slot</span></a></span></span><span> </span><span id="local-6989586621679390871"><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679390871"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679390870"><span class="annot"><span class="annottext">ctx :: CardanoTx
</span><a href="#local-6989586621679390870"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CardanoEmulatorEraTx</span></span><span> </span><span id="local-6989586621679390869"><span class="annot"><span class="annottext">tx :: Tx BabbageEra
</span><a href="#local-6989586621679390869"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxBody</span></span><span> </span><span id="local-6989586621679390867"><span class="annot"><span class="annottext">TxBodyContent ViewTx BabbageEra
</span><a href="#local-6989586621679390867"><span class="hs-identifier hs-var">bodyContent</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[KeyWitness BabbageEra]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">((TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn BabbageEra))
 -&gt; TxIn)
-&gt; [(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn BabbageEra))]
-&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn BabbageEra)) -&gt; TxIn
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxBodyContent ViewTx BabbageEra
-&gt; [(TxIn, BuildTxWith ViewTx (Witness WitCtxTxIn BabbageEra))]
forall build era. TxBodyContent build era -&gt; TxIns build era
</span><span class="hs-identifier hs-var hs-var">C.txIns</span></span><span> </span><span class="annot"><span class="annottext">TxBodyContent ViewTx BabbageEra
</span><a href="#local-6989586621679390867"><span class="hs-identifier hs-var">bodyContent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; [TxIn] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><span class="hs-identifier hs-var">genesisTxIn</span></span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; RedeemerReport -&gt; ValidationResult
</span><span class="hs-identifier hs-var">P.Success</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoTx -&gt; OnChainTx
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#unsafeMakeValid"><span class="hs-identifier hs-var">unsafeMakeValid</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621679390870"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RedeemerReport
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Params -&gt; SlotNo -&gt; UtxoIndex -&gt; Tx BabbageEra -&gt; ValidationResult
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#hasValidationErrors"><span class="hs-identifier hs-var">hasValidationErrors</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390873"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Slot -&gt; SlotNo
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Slot
</span><a href="#local-6989586621679390872"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679390871"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390869"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#getTxExUnitsWithLogs"><span class="hs-identifier hs-type">getTxExUnitsWithLogs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Tx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.ValidationErrorInPhase</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.RedeemerReport</span></span><span>
</span><span id="line-275"></span><span id="getTxExUnitsWithLogs"><span class="annot"><span class="annottext">getTxExUnitsWithLogs :: Params
-&gt; UTxO EmulatorEra
-&gt; Tx BabbageEra
-&gt; Either ValidationErrorInPhase RedeemerReport
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#getTxExUnitsWithLogs"><span class="hs-identifier hs-var hs-var">getTxExUnitsWithLogs</span></a></span></span><span> </span><span id="local-6989586621679390864"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390864"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390863"><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390863"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ShelleyTx</span></span><span> </span><span class="annot"><span class="annottext">ShelleyBasedEra BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679390862"><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra BabbageEra)
</span><a href="#local-6989586621679390862"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PParams EmulatorEra
-&gt; Tx EmulatorEra
-&gt; UTxO EmulatorEra
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; Array Language CostModel
-&gt; Either
     (TranslationError (Crypto EmulatorEra))
     (RedeemerReportWithLogs (Crypto EmulatorEra))
forall era.
(Era era, ExtendedUTxO era,
 HasField &quot;inputs&quot; (TxBody era) (Set (TxIn (Crypto era))),
 HasField &quot;certs&quot; (TxBody era) (StrictSeq (DCert (Crypto era))),
 HasField &quot;wdrls&quot; (TxBody era) (Wdrl (Crypto era)),
 HasField &quot;txdats&quot; (Witnesses era) (TxDats era),
 HasField &quot;txrdmrs&quot; (Witnesses era) (Redeemers era),
 HasField &quot;_maxTxExUnits&quot; (PParams era) ExUnits,
 HasField &quot;_protocolVersion&quot; (PParams era) ProtVer,
 Script era ~ Script era) =&gt;
PParams era
-&gt; Tx era
-&gt; UTxO era
-&gt; EpochInfo (Either Text)
-&gt; SystemStart
-&gt; Array Language CostModel
-&gt; Either
     (TranslationError (Crypto era))
     (RedeemerReportWithLogs (Crypto era))
</span><span class="hs-identifier hs-var">C.Ledger.evaluateTransactionExecutionUnitsWithLogs</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390864"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Tx (ShelleyLedgerEra BabbageEra)
Tx EmulatorEra
</span><a href="#local-6989586621679390862"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390863"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">EpochInfo (Either Text)
</span><a href="#local-6989586621679390860"><span class="hs-identifier hs-var">ei</span></a></span><span> </span><span class="annot"><span class="annottext">SystemStart
</span><a href="#local-6989586621679390859"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">Array Language CostModel
</span><a href="#local-6989586621679390858"><span class="hs-identifier hs-var">costmdls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679390857"><span class="annot"><span class="annottext">TranslationError (Crypto EmulatorEra)
</span><a href="#local-6989586621679390857"><span class="hs-identifier hs-var">e</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ValidationErrorInPhase
-&gt; Either ValidationErrorInPhase RedeemerReport
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidationErrorInPhase
 -&gt; Either ValidationErrorInPhase RedeemerReport)
-&gt; (TranslationError StandardCrypto -&gt; ValidationErrorInPhase)
-&gt; TranslationError StandardCrypto
-&gt; Either ValidationErrorInPhase RedeemerReport
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase1</span></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ValidationError -&gt; ValidationErrorInPhase)
-&gt; (TranslationError StandardCrypto -&gt; ValidationError)
-&gt; TranslationError StandardCrypto
-&gt; ValidationErrorInPhase
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.CardanoLedgerValidationError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ValidationError)
-&gt; (TranslationError StandardCrypto -&gt; Text)
-&gt; TranslationError StandardCrypto
-&gt; ValidationError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text)
-&gt; (TranslationError StandardCrypto -&gt; String)
-&gt; TranslationError StandardCrypto
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError StandardCrypto -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(TranslationError StandardCrypto
 -&gt; Either ValidationErrorInPhase RedeemerReport)
-&gt; TranslationError StandardCrypto
-&gt; Either ValidationErrorInPhase RedeemerReport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TranslationError StandardCrypto
TranslationError (Crypto EmulatorEra)
</span><a href="#local-6989586621679390857"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679390856"><span class="annot"><span class="annottext">RedeemerReportWithLogs (Crypto EmulatorEra)
</span><a href="#local-6989586621679390856"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Either (TransactionScriptFailure StandardCrypto) ([Text], ExUnits)
 -&gt; Either ValidationErrorInPhase ([Text], ExUnits))
-&gt; Map
     RdmrPtr
     (Either
        (TransactionScriptFailure StandardCrypto) ([Text], ExUnits))
-&gt; Either ValidationErrorInPhase RedeemerReport
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TransactionScriptFailure StandardCrypto
 -&gt; Either ValidationErrorInPhase ([Text], ExUnits))
-&gt; (([Text], ExUnits)
    -&gt; Either ValidationErrorInPhase ([Text], ExUnits))
-&gt; Either
     (TransactionScriptFailure StandardCrypto) ([Text], ExUnits)
-&gt; Either ValidationErrorInPhase ([Text], ExUnits)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionScriptFailure StandardCrypto
-&gt; Either ValidationErrorInPhase ([Text], ExUnits)
forall c b.
TransactionScriptFailure c -&gt; Either ValidationErrorInPhase b
</span><a href="#local-6989586621679390853"><span class="hs-identifier hs-var">toCardanoLedgerError</span></a></span><span> </span><span class="annot"><span class="annottext">([Text], ExUnits)
-&gt; Either ValidationErrorInPhase ([Text], ExUnits)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map
  RdmrPtr
  (Either
     (TransactionScriptFailure StandardCrypto) ([Text], ExUnits))
RedeemerReportWithLogs (Crypto EmulatorEra)
</span><a href="#local-6989586621679390856"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-280"></span><span>    </span><span id="local-6989586621679390852"><span class="annot"><span class="annottext">eg :: Globals
</span><a href="#local-6989586621679390852"><span class="hs-identifier hs-var hs-var">eg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params -&gt; Globals
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorGlobals"><span class="hs-identifier hs-var">emulatorGlobals</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390864"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621679390859"><span class="annot"><span class="annottext">ss :: SystemStart
</span><a href="#local-6989586621679390859"><span class="hs-identifier hs-var hs-var">ss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; SystemStart
</span><span class="hs-identifier hs-var hs-var">systemStart</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679390852"><span class="hs-identifier hs-var">eg</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621679390860"><span class="annot"><span class="annottext">ei :: EpochInfo (Either Text)
</span><a href="#local-6989586621679390860"><span class="hs-identifier hs-var hs-var">ei</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Globals -&gt; EpochInfo (Either Text)
</span><span class="hs-identifier hs-var hs-var">epochInfo</span></span><span> </span><span class="annot"><span class="annottext">Globals
</span><a href="#local-6989586621679390852"><span class="hs-identifier hs-var">eg</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621679390858"><span class="annot"><span class="annottext">costmdls :: Array Language CostModel
</span><a href="#local-6989586621679390858"><span class="hs-identifier hs-var hs-var">costmdls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Language, Language)
-&gt; [(Language, CostModel)] -&gt; Array Language CostModel
forall i e. Ix i =&gt; (i, i) -&gt; [(i, e)] -&gt; Array i e
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">array</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Language
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">minBound</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Language
forall a. Bounded a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maxBound</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(Language, CostModel)] -&gt; Array Language CostModel)
-&gt; (Map Language CostModel -&gt; [(Language, CostModel)])
-&gt; Map Language CostModel
-&gt; Array Language CostModel
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Map Language CostModel -&gt; [(Language, CostModel)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map Language CostModel -&gt; Array Language CostModel)
-&gt; Map Language CostModel -&gt; Array Language CostModel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CostModels -&gt; Map Language CostModel
</span><span class="hs-identifier hs-var hs-var">unCostModels</span></span><span> </span><span class="annot"><span class="annottext">(CostModels -&gt; Map Language CostModel)
-&gt; CostModels -&gt; Map Language CostModel
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall k (x :: k) r a. HasField x r a =&gt; r -&gt; a
forall r a. HasField &quot;_costmdls&quot; r a =&gt; r -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">getField</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;_costmdls&quot;</span></span><span> </span><span class="annot"><span class="annottext">(PParams -&gt; CostModels) -&gt; PParams -&gt; CostModels
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390864"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span id="local-6989586621679390853"><span class="annot"><span class="annottext">toCardanoLedgerError :: TransactionScriptFailure c -&gt; Either ValidationErrorInPhase b
</span><a href="#local-6989586621679390853"><span class="hs-identifier hs-var hs-var">toCardanoLedgerError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Ledger.ValidationFailedV1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V1.CekError</span></span><span> </span><span id="local-6989586621679390847"><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679390847"><span class="hs-identifier hs-var">ce</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679390846"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679390846"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-285"></span><span>      </span><span class="annot"><span class="annottext">ValidationErrorInPhase -&gt; Either ValidationErrorInPhase b
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptError -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.ScriptFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; String -&gt; ScriptError
</span><span class="hs-identifier hs-var">P.EvaluationError</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679390846"><span class="hs-identifier hs-var">logs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CekEvaluationFailure: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679390847"><span class="hs-identifier hs-var">ce</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>    </span><span class="annot"><a href="#local-6989586621679390853"><span class="hs-identifier hs-var">toCardanoLedgerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Ledger.ValidationFailedV2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">V1.CekError</span></span><span> </span><span id="local-6989586621679390842"><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679390842"><span class="hs-identifier hs-var">ce</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679390841"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679390841"><span class="hs-identifier hs-var">logs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>      </span><span class="annot"><span class="annottext">ValidationErrorInPhase -&gt; Either ValidationErrorInPhase b
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ScriptError -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.ScriptFailure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; String -&gt; ScriptError
</span><span class="hs-identifier hs-var">P.EvaluationError</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679390841"><span class="hs-identifier hs-var">logs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CekEvaluationFailure: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
-&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">CekEvaluationException NamedDeBruijn DefaultUni DefaultFun
</span><a href="#local-6989586621679390842"><span class="hs-identifier hs-var">ce</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="annot"><a href="#local-6989586621679390853"><span class="hs-identifier hs-var">toCardanoLedgerError</span></a></span><span> </span><span id="local-6989586621679390840"><span class="annot"><span class="annottext">TransactionScriptFailure c
</span><a href="#local-6989586621679390840"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidationErrorInPhase -&gt; Either ValidationErrorInPhase b
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">P.Phase2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; ValidationError
</span><span class="hs-identifier hs-var">P.CardanoLedgerValidationError</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; ValidationError) -&gt; Text -&gt; ValidationError
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">Text.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionScriptFailure c -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">TransactionScriptFailure c
</span><a href="#local-6989586621679390840"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeTransactionBody"><span class="hs-identifier hs-type">makeTransactionBody</span></a></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#Params"><span class="hs-identifier hs-type">Params</span></a></span><span>
</span><span id="line-292"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UTxO</span></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Params.html#EmulatorEra"><span class="hs-identifier hs-type">EmulatorEra</span></a></span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">P.CardanoBuildTx</span></span><span>
</span><span id="line-294"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#CardanoLedgerError"><span class="hs-identifier hs-type">CardanoLedgerError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxBody</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span id="makeTransactionBody"><span class="annot"><span class="annottext">makeTransactionBody :: Params
-&gt; UTxO EmulatorEra
-&gt; CardanoBuildTx
-&gt; Either CardanoLedgerError (TxBody BabbageEra)
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#makeTransactionBody"><span class="hs-identifier hs-var hs-var">makeTransactionBody</span></a></span></span><span> </span><span id="local-6989586621679390839"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390839"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679390838"><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390838"><span class="hs-identifier hs-var">utxo</span></a></span></span><span> </span><span id="local-6989586621679390837"><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679390837"><span class="hs-identifier hs-var">txBodyContent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>  </span><span id="local-6989586621679390836"><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390836"><span class="hs-identifier hs-var">txTmp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; CardanoLedgerError)
-&gt; (TxBody BabbageEra -&gt; Tx BabbageEra)
-&gt; Either ToCardanoError (TxBody BabbageEra)
-&gt; Either CardanoLedgerError (Tx BabbageEra)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; CardanoLedgerError
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[KeyWitness BabbageEra] -&gt; TxBody BabbageEra -&gt; Tx BabbageEra
forall era. [KeyWitness era] -&gt; TxBody era -&gt; Tx era
</span><span class="hs-identifier hs-var">C.makeSignedTransaction</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (TxBody BabbageEra)
 -&gt; Either CardanoLedgerError (Tx BabbageEra))
-&gt; Either ToCardanoError (TxBody BabbageEra)
-&gt; Either CardanoLedgerError (Tx BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PParams
-&gt; Map RdmrPtr ExUnits
-&gt; CardanoBuildTx
-&gt; Either ToCardanoError (TxBody BabbageEra)
</span><span class="hs-identifier hs-var">P.makeTransactionBody</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams -&gt; Maybe PParams
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams -&gt; Maybe PParams) -&gt; PParams -&gt; Maybe PParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390839"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map RdmrPtr ExUnits
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679390837"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621679390833"><span class="annot"><span class="annottext">Map RdmrPtr ExUnits
</span><a href="#local-6989586621679390833"><span class="hs-identifier hs-var">exUnits</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ValidationErrorInPhase -&gt; CardanoLedgerError)
-&gt; (RedeemerReport -&gt; Map RdmrPtr ExUnits)
-&gt; Either ValidationErrorInPhase RedeemerReport
-&gt; Either CardanoLedgerError (Map RdmrPtr ExUnits)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">bimap</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationErrorInPhase -&gt; CardanoLedgerError
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(([Text], ExUnits) -&gt; ExUnits)
-&gt; RedeemerReport -&gt; Map RdmrPtr ExUnits
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span><span class="hs-identifier hs-var">Map.map</span></span><span> </span><span class="annot"><span class="annottext">([Text], ExUnits) -&gt; ExUnits
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either ValidationErrorInPhase RedeemerReport
 -&gt; Either CardanoLedgerError (Map RdmrPtr ExUnits))
-&gt; Either ValidationErrorInPhase RedeemerReport
-&gt; Either CardanoLedgerError (Map RdmrPtr ExUnits)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params
-&gt; UTxO EmulatorEra
-&gt; Tx BabbageEra
-&gt; Either ValidationErrorInPhase RedeemerReport
</span><a href="Cardano.Node.Emulator.Internal.Node.Validation.html#getTxExUnitsWithLogs"><span class="hs-identifier hs-var">getTxExUnitsWithLogs</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390839"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="annot"><span class="annottext">UTxO EmulatorEra
</span><a href="#local-6989586621679390838"><span class="hs-identifier hs-var">utxo</span></a></span><span> </span><span class="annot"><span class="annottext">Tx BabbageEra
</span><a href="#local-6989586621679390836"><span class="hs-identifier hs-var">txTmp</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; CardanoLedgerError)
-&gt; Either ToCardanoError (TxBody BabbageEra)
-&gt; Either CardanoLedgerError (TxBody BabbageEra)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; CardanoLedgerError
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (TxBody BabbageEra)
 -&gt; Either CardanoLedgerError (TxBody BabbageEra))
-&gt; Either ToCardanoError (TxBody BabbageEra)
-&gt; Either CardanoLedgerError (TxBody BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PParams
-&gt; Map RdmrPtr ExUnits
-&gt; CardanoBuildTx
-&gt; Either ToCardanoError (TxBody BabbageEra)
</span><span class="hs-identifier hs-var">P.makeTransactionBody</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PParams -&gt; Maybe PParams
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(PParams -&gt; Maybe PParams) -&gt; PParams -&gt; Maybe PParams
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; PParams
</span><a href="Cardano.Node.Emulator.Internal.Node.Params.html#emulatorPParams"><span class="hs-identifier hs-var hs-var">emulatorPParams</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679390839"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map RdmrPtr ExUnits
</span><a href="#local-6989586621679390833"><span class="hs-identifier hs-var">exUnits</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679390837"><span class="hs-identifier hs-var">txBodyContent</span></a></span><span>
</span><span id="line-299"></span></pre></body></html>