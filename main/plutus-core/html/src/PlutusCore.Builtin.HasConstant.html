<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds       #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies          #-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusCore.Builtin.HasConstant</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#throwNotAConstant"><span class="hs-identifier">throwNotAConstant</span></a></span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier">HasConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstantIn"><span class="hs-identifier">HasConstantIn</span></a></span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Core.html"><span class="hs-identifier">PlutusCore.Core</span></a></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html"><span class="hs-identifier">PlutusCore.Evaluation.Machine.Exception</span></a></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Name.html"><span class="hs-identifier">PlutusCore.Name</span></a></span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Universe.html"><span class="hs-identifier">Universe</span></a></span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span class="hs-comment">-- | Throw an 'UnliftingError' saying that the received argument is not a constant.</span><span>
</span><span id="line-21"></span><span id="local-6989586621680938480"><span id="local-6989586621680938481"><span id="local-6989586621680938482"><span id="local-6989586621680938483"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#throwNotAConstant"><span class="hs-identifier hs-type">throwNotAConstant</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#ErrorWithCause"><span class="hs-identifier hs-type">ErrorWithCause</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938483"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938482"><span class="hs-identifier hs-type">cause</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680938481"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#AsUnliftingError"><span class="hs-identifier hs-type">AsUnliftingError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938483"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938482"><span class="hs-identifier hs-type">cause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680938481"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938480"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-24"></span><span id="throwNotAConstant"><span class="annot"><span class="annottext">throwNotAConstant :: Maybe cause -&gt; m r
</span><a href="PlutusCore.Builtin.HasConstant.html#throwNotAConstant"><span class="hs-identifier hs-var hs-var">throwNotAConstant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AReview err UnliftingError -&gt; UnliftingError -&gt; Maybe cause -&gt; m r
forall exc e t term (m :: * -&gt; *) x.
(exc ~ ErrorWithCause e term, MonadError exc m) =&gt;
AReview e t -&gt; t -&gt; Maybe term -&gt; m x
</span><a href="PlutusCore.Evaluation.Machine.Exception.html#throwingWithCause"><span class="hs-identifier hs-var">throwingWithCause</span></a></span><span> </span><span class="annot"><span class="annottext">AReview err UnliftingError
forall r. AsUnliftingError r =&gt; Prism' r UnliftingError
</span><a href="PlutusCore.Evaluation.Machine.Exception.html#_UnliftingError"><span class="hs-identifier hs-var">_UnliftingError</span></a></span><span> </span><span class="annot"><span class="annottext">UnliftingError
</span><span class="hs-string">&quot;Not a constant&quot;</span></span><span>
</span><span id="line-25"></span><span>
</span><span id="line-26"></span><span class="hs-comment">-- | Ensures that @term@ has a 'Constant'-like constructor to lift values to and unlift values from.</span><span>
</span><span id="line-27"></span><span class="hs-keyword">class</span><span> </span><span id="HasConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-var">HasConstant</span></a></span></span><span> </span><span id="local-6989586621680938488"><span class="annot"><a href="#local-6989586621680938488"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-comment">-- Switching from 'MonadError' to 'Either' here gave us a speedup of 2-4%.</span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-comment">-- | Unlift from the 'Constant' constructor throwing an 'UnliftingError' if the provided @term@</span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-comment">-- is not a 'Constant'.</span><span>
</span><span id="line-31"></span><span>    </span><span id="local-6989586621680938490"><span id="local-6989586621680938491"><span id="asConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#asConstant"><span class="hs-identifier hs-type">asConstant</span></a></span></span><span>
</span><span id="line-32"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#AsUnliftingError"><span class="hs-identifier hs-type">AsUnliftingError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938491"><span class="hs-identifier hs-type">err</span></a></span><span>
</span><span id="line-33"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938490"><span class="hs-identifier hs-type">cause</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680938488"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Evaluation.Machine.Exception.html#ErrorWithCause"><span class="hs-identifier hs-type">ErrorWithCause</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938491"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938490"><span class="hs-identifier hs-type">cause</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938488"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-comment">-- | Wrap a Haskell value as a @term@.</span><span>
</span><span id="line-36"></span><span>    </span><span id="fromConstant"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#fromConstant"><span class="hs-identifier hs-type">fromConstant</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938488"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680938488"><span class="hs-identifier hs-type">term</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-comment">-- | Ensures that @term@ has a 'Constant'-like constructor to lift values to and unlift values from</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- and connects @term@ and its @uni@.</span><span>
</span><span id="line-40"></span><span class="hs-keyword">type</span><span> </span><span id="HasConstantIn"><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstantIn"><span class="hs-identifier hs-var">HasConstantIn</span></a></span></span><span> </span><span id="local-6989586621680938468"><span class="annot"><a href="#local-6989586621680938468"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680938467"><span class="annot"><a href="#local-6989586621680938467"><span class="hs-identifier hs-type">term</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#UniOf"><span class="hs-identifier hs-type">UniOf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938467"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">~</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938468"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-type">HasConstant</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938467"><span class="hs-identifier hs-type">term</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span id="local-6989586621680938465"><span id="local-6989586621680938466"><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#HasConstant"><span class="hs-identifier hs-type">HasConstant</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938466"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680938465"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>    </span><span id="local-6989586621680938461"><span class="annot"><span class="annottext">asConstant :: Maybe cause
-&gt; Term TyName Name uni fun ()
-&gt; Either
     (ErrorWithCause err cause)
     (Some (ValueOf (UniOf (Term TyName Name uni fun ()))))
</span><a href="#local-6989586621680938461"><span class="hs-identifier hs-var hs-var hs-var hs-var">asConstant</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe cause
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680938459"><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621680938459"><span class="hs-identifier hs-var">val</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni)
-&gt; Either (ErrorWithCause err cause) (Some (ValueOf uni))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Some (ValueOf uni)
</span><a href="#local-6989586621680938459"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><a href="PlutusCore.Builtin.HasConstant.html#asConstant"><span class="hs-identifier hs-var">asConstant</span></a></span><span> </span><span id="local-6989586621680938458"><span class="annot"><span class="annottext">Maybe cause
</span><a href="#local-6989586621680938458"><span class="hs-identifier hs-var">mayCause</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ()
</span><span class="hs-identifier">_</span></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe cause
-&gt; Either (ErrorWithCause err cause) (Some (ValueOf uni))
forall err cause (m :: * -&gt; *) r.
(MonadError (ErrorWithCause err cause) m, AsUnliftingError err) =&gt;
Maybe cause -&gt; m r
</span><a href="PlutusCore.Builtin.HasConstant.html#throwNotAConstant"><span class="hs-identifier hs-var">throwNotAConstant</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe cause
</span><a href="#local-6989586621680938458"><span class="hs-identifier hs-var">mayCause</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span id="local-6989586621680938457"><span class="annot"><span class="annottext">fromConstant :: Some (ValueOf (UniOf (Term TyName Name uni fun ())))
-&gt; Term TyName Name uni fun ()
</span><a href="#local-6989586621680938457"><span class="hs-identifier hs-var hs-var hs-var hs-var">fromConstant</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Some (ValueOf uni) -&gt; Term TyName Name uni fun ()
forall tyname name (uni :: * -&gt; *) fun ann.
ann -&gt; Some (ValueOf uni) -&gt; Term tyname name uni fun ann
</span><a href="PlutusCore.Core.Type.html#Constant"><span class="hs-identifier hs-var">Constant</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-47"></span></pre></body></html>