<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | The internal module of the type checker that defines the actual algorithms,</span><span>
</span><span id="line-2"></span><span class="hs-comment">-- but not the user-facing API.</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes         #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators      #-}</span><span>
</span><span id="line-9"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">PlutusIR.TypeCheck.Internal</span><span>
</span><span id="line-10"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#BuiltinTypes"><span class="hs-identifier">BuiltinTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckConfig"><span class="hs-identifier">TypeCheckConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier">TypeCheckM</span></a></span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#tccBuiltinTypes"><span class="hs-identifier">tccBuiltinTypes</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier">PirTCConfig</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#AllowEscape"><span class="hs-identifier">AllowEscape</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier">inferTypeM</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier">checkTypeM</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Error.Lens</span></span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span>
</span><span id="line-26"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Ix</span></a></span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.html"><span class="hs-identifier">PlutusCore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier">ToKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#typeAnn"><span class="hs-identifier">typeAnn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Error.html"><span class="hs-identifier">PlutusCore.Error</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html"><span class="hs-identifier">PlutusCore.Quote</span></a></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.Rename.html"><span class="hs-identifier">PlutusCore.Rename</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PLC</span></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.html"><span class="hs-identifier">PlutusIR</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Datatype.html"><span class="hs-identifier">PlutusIR.Compiler.Datatype</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Provenance.html"><span class="hs-identifier">PlutusIR.Compiler.Provenance</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html"><span class="hs-identifier">PlutusIR.Compiler.Types</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Error.html"><span class="hs-identifier">PlutusIR.Error</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.Transform.Rename.html"><span class="hs-identifier">PlutusIR.Transform.Rename</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusPrelude.html"><span class="hs-identifier">PlutusPrelude</span></a></span><span>
</span><span id="line-38"></span><span>
</span><span id="line-39"></span><span class="hs-comment">-- we mirror inferTypeM, checkTypeM of plc-tc and extend it for plutus-ir terms</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html"><span class="hs-identifier">PlutusCore.TypeCheck.Internal</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier">checkTypeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier">inferTypeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier">runTypeCheckM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="PlutusIR.MkPir.html"><span class="hs-identifier">PlutusIR.MkPir</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PIR</span></span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Universe.html"><span class="hs-identifier">Universe</span></a></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span class="hs-comment">{- Note [PLC Typechecker code reuse]
For PIR kind-checking, we reuse `checkKindM`, `inferKindM` directly from the PLC typechecker.
For PIR type-checking, we port the `checkTypeM` and `inferTypeM` from PLC typechecker.
The port is a direct copy, except for the modifications of `Term` to `PIR.Term`
and error type signatures and `throwError` to accomodate for the new pir type-errors.
These modifications are currently necesessary since PIR.Term ADT /= PLC.Term ADT.
We then extend this ported `PIR.inferTypeM` with cases for inferring type of LetRec and LetNonRec.

See Note [Notation] of PlutusCore.TypeCheck.Internal for the notation of inference rules, which appear in the comments.
-}</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span class="hs-comment">{- Note [PIR vs Paper Syntax Difference]
Link to the paper: &lt;https://hydra.iohk.io/job/Cardano/plutus/linux.papers.unraveling-recursion/latest/download-by-type/doc-pdf/unraveling-recursion&gt;
FIR's syntax requires that the data-constructor is annotated with a *list of its argument types* (domain),
instead of requiring a single valid type T (usually in the form `dataconstr : arg1 -&gt; arg2 -&gt;... argn`)
The codomain is also left out of the syntax and implied to be of the type `[TypeCons tyarg1 tyarg2 ... tyargn]`
(what would be expected for a non-GADT). Finally, the leading &quot;forall type-parameters&quot; are implicit (since they are consider in scope).

PIR's syntax requires that a full (valid) type is written for the data-constructor, using the syntax for types
(the forall type-parameters remains implicit). This means that the codomain has to be be explicitly given in PIR.
To make sure that the PIR-user has written down the expected non-GADT type we do an extra codomainCheck.
This codomainCheck will have to be relaxed if/when PIR introduces GADTs.
More importantly, since the type for the PIR data-constructor can be any syntax-valid type,
the PIR user may have placed inside there a non-normalized type there. Currently, the PIR typechecker will
assume the types of all data-constructors are prior normalized *before* type-checking, otherwise
the PIR typechecking and PIR compilation will fail.
See NOTE [Normalization of data-constructors' types] at PlutusIR.Compiler.Datatype
-}</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">{- Note [PIR vs Paper Escaping Types Difference]
Link to the paper: &lt;https://hydra.iohk.io/job/Cardano/plutus/linux.papers.unraveling-recursion/latest/download-by-type/doc-pdf/unraveling-recursion&gt;
In FIR paper's Fig.6, T-Let and T-LetRec rules dictate that: Gamma !- inTerm :: * for two reasons:
1. check (locally) that the kind of the in-term's inferred type is indeed *
2. ensure that the inferred type does not escaping its scope (hence Gamma)

This is in general true for the PIR implementation as well, except in the special
case when a Type is inferred for the top-level expression (`program`-level).
In contrast to (2), we allow such a &quot;top-level&quot; type to escape its scope;
the reasoning is that PIR programs with toplevel escaping types would behave correctly when they are translated down to PLC.
Even in the case where we let the type variables escape, (1) must still hold:
the kind of the escaping type should still be star. Unfortunately, in order to check that we'd have to use the variables
which are no longer in scope. So we skip the rule (Gamma !- inTermTopLevel :: *) in case of top-level inferred types.

The implementation has a user-configurable flag to let the typechecker know if the current term under examination
is at the program's &quot;top-level&quot; position, and thus allow its type to escape. The flag is automatically set to no-type-escape
when typechecking inside a let termbind's rhs term.
-}</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | a shorthand for our pir-specialized tc functions</span><span>
</span><span id="line-94"></span><span class="hs-keyword">type</span><span> </span><span id="PirTCEnv"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-var">PirTCEnv</span></a></span></span><span> </span><span id="local-6989586621680957783"><span class="annot"><a href="#local-6989586621680957783"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680957782"><span class="annot"><a href="#local-6989586621680957782"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680957781"><span class="annot"><a href="#local-6989586621680957781"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680957780"><span class="annot"><a href="#local-6989586621680957780"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957783"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957782"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957783"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957782"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680957781"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957780"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- ###########################</span><span>
</span><span id="line-97"></span><span class="hs-comment">-- ## Port of Type checking ##</span><span>
</span><span id="line-98"></span><span class="hs-comment">-- ##########################</span><span>
</span><span id="line-99"></span><span class="hs-comment">--  Taken from `PlutusCore.Typecheck.Internal`</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-comment">-- See the [Global uniqueness] and [Type rules] notes.</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | Check a 'Term' against a 'NormalizedType'.</span><span>
</span><span id="line-103"></span><span id="local-6989586621680958035"><span id="local-6989586621680958036"><span id="local-6989586621680958037"><span id="local-6989586621680958038"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-type">checkTypeM</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958037"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Error.html#AsTypeErrorExt"><span class="hs-identifier hs-type">AsTypeErrorExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958036"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958035"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958036"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958037"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958037"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958035"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier hs-type">ToKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680958035"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958037"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958035"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958038"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958037"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958036"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span><span>
</span><span id="line-106"></span><span class="hs-comment">-- [infer| G !- term : vTermTy]    vTermTy ~ vTy</span><span>
</span><span id="line-107"></span><span class="hs-comment">-- ---------------------------------------------</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- [check| G !- term : vTy]</span><span>
</span><span id="line-109"></span><span id="checkTypeM"><span class="annot"><span class="annottext">checkTypeM :: ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var hs-var">checkTypeM</span></a></span></span><span> </span><span id="local-6989586621680957779"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957779"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957778"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957778"><span class="hs-identifier hs-var">term</span></a></span></span><span> </span><span id="local-6989586621680957777"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957777"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span id="local-6989586621680957776"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957776"><span class="hs-identifier hs-var">vTermTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957778"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957776"><span class="hs-identifier hs-var">vTermTy</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ()) -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957777"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
-&gt; PirTCEnv uni fun e ()
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ()
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957779"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann -&gt; Term TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957778"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Normalized (Type TyName uni ()) -&gt; Type TyName uni ()
forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957776"><span class="hs-identifier hs-var">vTermTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957777"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span class="hs-comment">-- See the [Global uniqueness] and [Type rules] notes.</span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Synthesize the type of a term, returning a normalized type.</span><span>
</span><span id="line-115"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-type">inferTypeM</span></a></span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680958136"><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680958134"><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680958132"><span class="annot"><a href="#local-6989586621680958132"><span class="hs-identifier hs-type">ann</span></a></span></span><span> </span><span id="local-6989586621680958133"><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958132"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier hs-type">ToKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Error.html#AsTypeErrorExt"><span class="hs-identifier hs-type">AsTypeErrorExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958132"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958132"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- c : vTy</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- -------------------------</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- [infer| G !- con c : vTy]</span><span>
</span><span id="line-121"></span><span id="inferTypeM"><span class="annot"><span class="annottext">inferTypeM :: Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var hs-var">inferTypeM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Constant"><span class="hs-identifier hs-type">Constant</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Some</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Universe.Core.html#ValueOf"><span class="hs-identifier hs-type">ValueOf</span></a></span><span> </span><span id="local-6989586621680957765"><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621680957765"><span class="hs-identifier hs-var">uni</span></a></span></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-comment">-- See Note [Normalization of built-in types].</span><span>
</span><span id="line-123"></span><span>    </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; uni (Esc a) -&gt; Type TyName uni ()
forall k (a :: k) (uni :: * -&gt; *) tyname ann.
ann -&gt; uni (Esc a) -&gt; Type tyname uni ann
</span><a href="PlutusCore.MkPlc.html#mkTyBuiltinOf"><span class="hs-identifier hs-var">PIR.mkTyBuiltinOf</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">uni (Esc a)
</span><a href="#local-6989586621680957765"><span class="hs-identifier hs-var">uni</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-comment">-- [infer| G !- bi : vTy]</span><span>
</span><span id="line-126"></span><span class="hs-comment">-- ------------------------------</span><span>
</span><span id="line-127"></span><span class="hs-comment">-- [infer| G !- builtin bi : vTy]</span><span>
</span><span id="line-128"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Builtin"><span class="hs-identifier hs-type">Builtin</span></a></span><span> </span><span id="local-6989586621680957761"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957761"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957760"><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621680957760"><span class="hs-identifier hs-var">bn</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><span class="annottext">ann -&gt; fun -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, HasTypeCheckConfig cfg uni fun,
 Ix fun) =&gt;
ann
-&gt; fun
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#lookupBuiltinM"><span class="hs-identifier hs-var">lookupBuiltinM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957761"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">fun
</span><a href="#local-6989586621680957760"><span class="hs-identifier hs-var">bn</span></a></span><span>
</span><span id="line-130"></span><span>
</span><span id="line-131"></span><span class="hs-comment">-- [infer| G !- v : ty]    ty ~&gt; vTy</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- ---------------------------------</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- [infer| G !- var v : vTy]</span><span>
</span><span id="line-134"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span id="local-6989586621680957757"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957757"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957756"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680957756"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span>
</span><span id="line-135"></span><span>    </span><span class="annot"><span class="annottext">ann -&gt; Name -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall err term (uni :: * -&gt; *) fun ann cfg.
AsTypeError err term uni fun ann =&gt;
ann
-&gt; Name
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#lookupVarM"><span class="hs-identifier hs-var">lookupVarM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957757"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680957756"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="hs-comment">-- [check| G !- dom :: *]    dom ~&gt; vDom    [infer| G , n : dom !- body : vCod]</span><span>
</span><span id="line-138"></span><span class="hs-comment">-- ----------------------------------------------------------------------------</span><span>
</span><span id="line-139"></span><span class="hs-comment">-- [infer| G !- lam n dom body : vDom -&gt; vCod]</span><span>
</span><span id="line-140"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#LamAbs"><span class="hs-identifier hs-type">LamAbs</span></a></span><span> </span><span id="local-6989586621680957753"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957753"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957752"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680957752"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680957751"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957751"><span class="hs-identifier hs-var">dom</span></a></span></span><span> </span><span id="local-6989586621680957750"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957750"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Type TyName uni ann
-&gt; Kind ()
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957753"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957751"><span class="hs-identifier hs-var">dom</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; Kind () -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621680957747"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957747"><span class="hs-identifier hs-var">vDom</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957751"><span class="hs-identifier hs-var">dom</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><span class="annottext">()
-&gt; Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     (Normalized (Type TyName uni () -&gt; Type TyName uni ()))
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957747"><span class="hs-identifier hs-var">vDom</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (TypeCheckEnv uni fun (PirTCConfig uni fun))
  (ExceptT e Quote)
  (Normalized (Type TyName uni () -&gt; Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Applicative f1, Applicative f2) =&gt;
f1 (f2 (a -&gt; b)) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%2A%3E%3E"><span class="hs-operator hs-var">&lt;&lt;*&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun cfg err a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun cfg err a
-&gt; TypeCheckM uni fun cfg err a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621680957752"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957747"><span class="hs-identifier hs-var">vDom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957750"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>
</span><span id="line-145"></span><span class="hs-comment">-- [infer| G , n :: nK !- body : vBodyTy]</span><span>
</span><span id="line-146"></span><span class="hs-comment">-- ---------------------------------------------------</span><span>
</span><span id="line-147"></span><span class="hs-comment">-- [infer| G !- abs n nK body : all (n :: nK) vBodyTy]</span><span>
</span><span id="line-148"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyAbs"><span class="hs-identifier hs-type">TyAbs</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957741"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957741"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680957740"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957740"><span class="hs-identifier hs-var">nK</span></a></span></span><span> </span><span id="local-6989586621680957739"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957739"><span class="hs-identifier hs-var">body</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680957738"><span class="annot"><span class="annottext">nK_ :: Kind ()
</span><a href="#local-6989586621680957738"><span class="hs-identifier hs-var hs-var">nK_</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Kind ann -&gt; Kind ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957740"><span class="hs-identifier hs-var">nK</span></a></span><span>
</span><span id="line-150"></span><span>    </span><span class="annot"><span class="annottext">() -&gt; TyName -&gt; Kind () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957741"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957738"><span class="hs-identifier hs-var">nK_</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni () -&gt; Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f1 :: * -&gt; *) (f2 :: * -&gt; *) a b.
(Functor f1, Functor f2) =&gt;
(a -&gt; b) -&gt; f1 (f2 a) -&gt; f1 (f2 b)
</span><a href="PlutusPrelude.html#%3C%3C%24%3E%3E"><span class="hs-operator hs-var">&lt;&lt;$&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
-&gt; Kind ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun cfg err a.
TyName
-&gt; Kind ()
-&gt; TypeCheckM uni fun cfg err a
-&gt; TypeCheckM uni fun cfg err a
</span><a href="PlutusCore.TypeCheck.Internal.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957741"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957738"><span class="hs-identifier hs-var">nK_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957739"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- [infer| G !- fun : vDom -&gt; vCod]    [check| G !- arg : vDom]</span><span>
</span><span id="line-153"></span><span class="hs-comment">-- ------------------------------------------------------------</span><span>
</span><span id="line-154"></span><span class="hs-comment">-- [infer| G !- fun arg : vCod]</span><span>
</span><span id="line-155"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Apply"><span class="hs-identifier hs-type">Apply</span></a></span><span> </span><span id="local-6989586621680957734"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957734"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957733"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957733"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621680957732"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957732"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-156"></span><span>    </span><span id="local-6989586621680957731"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957731"><span class="hs-identifier hs-var">vFunTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957733"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ()) -&gt; Type TyName uni ()
forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957731"><span class="hs-identifier hs-var">vFunTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-158"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-type">TyFun</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957730"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957730"><span class="hs-identifier hs-var">vDom</span></a></span></span><span> </span><span id="local-6989586621680957729"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957729"><span class="hs-identifier hs-var">vCod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-comment">-- Subparts of a normalized type, so normalized.</span><span>
</span><span id="line-160"></span><span>            </span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall (uni :: * -&gt; *) fun e ann.
(GEq uni, Ix fun, AsTypeErrorExt e uni ann,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni) =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957734"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957732"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni ())
 -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni () -&gt; Normalized (Type TyName uni ())
forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957730"><span class="hs-identifier hs-var">vDom</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni ())
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni () -&gt; Normalized (Type TyName uni ())
forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957729"><span class="hs-identifier hs-var">vCod</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ()
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957734"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann -&gt; Term TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957733"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyFun"><span class="hs-identifier hs-var">TyFun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957731"><span class="hs-identifier hs-var">vFunTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-comment">-- [infer| G !- body : all (n :: nK) vCod]    [check| G !- ty :: tyK]    ty ~&gt; vTy</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- -------------------------------------------------------------------------------</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- [infer| G !- body {ty} : NORM ([vTy / n] vCod)]</span><span>
</span><span id="line-167"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TyInst"><span class="hs-identifier hs-type">TyInst</span></a></span><span> </span><span id="local-6989586621680957725"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957725"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957724"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957724"><span class="hs-identifier hs-var">body</span></a></span></span><span> </span><span id="local-6989586621680957723"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957723"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621680957722"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957722"><span class="hs-identifier hs-var">vBodyTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957724"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ()) -&gt; Type TyName uni ()
forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957722"><span class="hs-identifier hs-var">vBodyTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-170"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-type">TyForall</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957721"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957721"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680957720"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957720"><span class="hs-identifier hs-var">nK</span></a></span></span><span> </span><span id="local-6989586621680957719"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957719"><span class="hs-identifier hs-var">vCod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-171"></span><span>            </span><span class="annot"><span class="annottext">ann
-&gt; Type TyName uni ann
-&gt; Kind ()
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957725"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957723"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957720"><span class="hs-identifier hs-var">nK</span></a></span><span>
</span><span id="line-172"></span><span>            </span><span id="local-6989586621680957718"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957718"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957723"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; TyName
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun cfg err.
HasUniApply uni =&gt;
Normalized (Type TyName uni ())
-&gt; TyName
-&gt; Type TyName uni ()
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#substNormalizeTypeM"><span class="hs-identifier hs-var">substNormalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957718"><span class="hs-identifier hs-var">vTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957721"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957719"><span class="hs-identifier hs-var">vCod</span></a></span><span>
</span><span id="line-174"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ()
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957725"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann -&gt; Term TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957724"><span class="hs-identifier hs-var">body</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TyName -&gt; Kind () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; tyname -&gt; Kind ann -&gt; Type tyname uni ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyForall"><span class="hs-identifier hs-var">TyForall</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyTyName"><span class="hs-identifier hs-var">dummyTyName</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyKind"><span class="hs-identifier hs-var">dummyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957722"><span class="hs-identifier hs-var">vBodyTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>
</span><span id="line-176"></span><span class="hs-comment">-- [infer| G !- arg :: k]    [check| G !- pat :: (k -&gt; *) -&gt; k -&gt; *]    pat ~&gt; vPat    arg ~&gt; vArg</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- [check| G !- term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><span id="line-178"></span><span class="hs-comment">-- -----------------------------------------------------------------------------------------------</span><span>
</span><span id="line-179"></span><span class="hs-comment">-- [infer| G !- iwrap pat arg term : ifix vPat vArg]</span><span>
</span><span id="line-180"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#IWrap"><span class="hs-identifier hs-type">IWrap</span></a></span><span> </span><span id="local-6989586621680957713"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957713"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957712"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957712"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621680957711"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957711"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span id="local-6989586621680957710"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957710"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621680957709"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957709"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e (Kind ())
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
Type TyName uni ann -&gt; TypeCheckM uni fun cfg err (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957711"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Type TyName uni ann
-&gt; Kind ()
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindOfPatternFunctorM"><span class="hs-identifier hs-var">checkKindOfPatternFunctorM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957713"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957712"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957709"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621680957706"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957706"><span class="hs-identifier hs-var">vPat</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957712"><span class="hs-identifier hs-var">pat</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621680957705"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957705"><span class="hs-identifier hs-var">vArg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957711"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall (uni :: * -&gt; *) fun e ann.
(GEq uni, Ix fun, AsTypeErrorExt e uni ann,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni) =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957713"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957710"><span class="hs-identifier hs-var">term</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni ())
 -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun cfg err.
HasUniApply uni =&gt;
Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#unfoldIFixOf"><span class="hs-identifier hs-var">unfoldIFixOf</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957706"><span class="hs-identifier hs-var">vPat</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957705"><span class="hs-identifier hs-var">vArg</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957709"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni ())
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">()
-&gt; Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni () -&gt; Type TyName uni ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957706"><span class="hs-identifier hs-var">vPat</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni () -&gt; Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957705"><span class="hs-identifier hs-var">vArg</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span class="hs-comment">-- [infer| G !- term : ifix vPat vArg]    [infer| G !- vArg :: k]</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- -----------------------------------------------------------------------</span><span>
</span><span id="line-190"></span><span class="hs-comment">-- [infer| G !- unwrap term : NORM (vPat (\(a :: k) -&gt; ifix vPat a) vArg)]</span><span>
</span><span id="line-191"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Unwrap"><span class="hs-identifier hs-type">Unwrap</span></a></span><span> </span><span id="local-6989586621680957699"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957699"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957698"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957698"><span class="hs-identifier hs-var">term</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>    </span><span id="local-6989586621680957697"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957697"><span class="hs-identifier hs-var">vTermTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957698"><span class="hs-identifier hs-var">term</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ()) -&gt; Type TyName uni ()
forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957697"><span class="hs-identifier hs-var">vTermTy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-194"></span><span>        </span><span class="annot"><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-type">TyIFix</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957696"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957696"><span class="hs-identifier hs-var">vPat</span></a></span></span><span> </span><span id="local-6989586621680957695"><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957695"><span class="hs-identifier hs-var">vArg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-195"></span><span>            </span><span id="local-6989586621680957694"><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957694"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e (Kind ())
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
Type TyName uni ann -&gt; TypeCheckM uni fun cfg err (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ann
 -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e (Kind ()))
-&gt; Type TyName uni ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e (Kind ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957699"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni () -&gt; Type TyName uni ann
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957695"><span class="hs-identifier hs-var">vArg</span></a></span><span>
</span><span id="line-196"></span><span>            </span><span class="hs-comment">-- Subparts of a normalized type, so normalized.</span><span>
</span><span id="line-197"></span><span>            </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun cfg err.
HasUniApply uni =&gt;
Normalized (Type TyName uni ())
-&gt; Normalized (Type TyName uni ())
-&gt; Kind ()
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ()))
</span><a href="PlutusCore.TypeCheck.Internal.html#unfoldIFixOf"><span class="hs-identifier hs-var">unfoldIFixOf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni () -&gt; Normalized (Type TyName uni ())
forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957696"><span class="hs-identifier hs-var">vPat</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni () -&gt; Normalized (Type TyName uni ())
forall a. a -&gt; Normalized a
</span><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-var">Normalized</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><a href="#local-6989586621680957695"><span class="hs-identifier hs-var">vArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Kind ()
</span><a href="#local-6989586621680957694"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="annot"><span class="annottext">Type TyName uni ()
</span><span class="hs-identifier">_</span></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeError (Term TyName Name uni fun ()) uni fun ann)
forall r term (uni :: * -&gt; *) fun ann.
AsTypeError r term uni fun ann =&gt;
Prism' r (TypeError term uni fun ann)
</span><a href="PlutusCore.Error.html#_TypeError"><span class="hs-identifier hs-var">_TypeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
-&gt; Term TyName Name uni fun ()
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError (Term TyName Name uni fun ()) uni fun ann
forall term (uni :: * -&gt; *) fun ann.
ann
-&gt; term
-&gt; Type TyName uni ()
-&gt; Normalized (Type TyName uni ())
-&gt; TypeError term uni fun ann
</span><a href="PlutusCore.Error.html#TypeMismatch"><span class="hs-identifier hs-var">TypeMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957699"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann -&gt; Term TyName Name uni fun ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957698"><span class="hs-identifier hs-var">term</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; Type TyName uni () -&gt; Type TyName uni () -&gt; Type TyName uni ()
forall tyname (uni :: * -&gt; *) ann.
ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
-&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#TyIFix"><span class="hs-identifier hs-var">TyIFix</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ()
forall (uni :: * -&gt; *). Type TyName uni ()
</span><a href="PlutusCore.TypeCheck.Internal.html#dummyType"><span class="hs-identifier hs-var">dummyType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957697"><span class="hs-identifier hs-var">vTermTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- [check| G !- ty :: *]    ty ~&gt; vTy</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- ----------------------------------</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- [infer| G !- error ty : vTy]</span><span>
</span><span id="line-203"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Error"><span class="hs-identifier hs-type">Error</span></a></span><span> </span><span id="local-6989586621680957691"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957691"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957690"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957690"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Type TyName uni ann
-&gt; Kind ()
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957691"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957690"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; Kind () -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="annot"><span class="annottext">Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ()
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; Type TyName uni ()
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957690"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- ##############</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- ## Port end ##</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- ##############</span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="hs-comment">-- Note on symbols:  '=&gt;' means implies</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">{-
checkKindFromBinding(G,b) checkTypeFromBinding(G,b)
!null(bs) =&gt; [infer| G,withVarsOfBinding(b),withTyVarsOfBinding(b) !- (let nonrec {bs} in inT) : ty]
null(bs) =&gt; [infer| G,withVarsOfBinding(b),withTyVarsOfBinding(b) !- inT : ty]
ty ~&gt; vTy
-------------------------------------------------
[infer| G !- (let nonrec {b ; bs} in inT) : vTy]
-}</span><span>
</span><span id="line-220"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621680957688"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957688"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957687"><span class="annot"><span class="annottext">r :: Recursivity
</span><a href="#local-6989586621680957687"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span id="local-6989586621680957685"><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957685"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680957684"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957684"><span class="hs-identifier hs-var">inTerm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-comment">-- Check each binding individually, then if ok, introduce its new type/vars to the (linearly) next let or inTerm</span><span>
</span><span id="line-222"></span><span>    </span><span id="local-6989586621680957683"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957683"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Binding TyName Name uni fun ann
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; NonEmpty (Binding TyName Name uni fun ann)
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall res.
Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun e res -&gt; PirTCEnv uni fun e res
</span><a href="#local-6989586621680957681"><span class="hs-identifier hs-var">checkBindingThenScope</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957684"><span class="hs-identifier hs-var">inTerm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957685"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-comment">-- check the in-term's inferred type has kind * (except at toplevel)</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e term (uni :: * -&gt; *) fun ann b.
(AsTypeError e term uni fun ann, ToKind uni) =&gt;
ann -&gt; Normalized (Type TyName uni b) -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var">checkStarInferred</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957688"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957683"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957683"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-226"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-227"></span><span>   </span><span id="local-6989586621680958002"><span class="annot"><a href="#local-6989586621680957681"><span class="hs-identifier hs-type">checkBindingThenScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958132"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958002"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958136"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958134"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958133"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958002"><span class="hs-identifier hs-type">res</span></a></span></span><span>
</span><span id="line-228"></span><span>   </span><span id="local-6989586621680957681"><span class="annot"><span class="annottext">checkBindingThenScope :: Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun e res -&gt; PirTCEnv uni fun e res
</span><a href="#local-6989586621680957681"><span class="hs-identifier hs-var hs-var">checkBindingThenScope</span></a></span></span><span> </span><span id="local-6989586621680957679"><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621680957679"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621680957678"><span class="annot"><span class="annottext">PirTCEnv uni fun e res
</span><a href="#local-6989586621680957678"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-229"></span><span>       </span><span class="hs-comment">-- check that the kinds of the declared types are correct</span><span>
</span><span id="line-230"></span><span>       </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e (uni :: * -&gt; *) fun ann.
(AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni) =&gt;
Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var">checkKindFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621680957679"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-231"></span><span>       </span><span class="hs-comment">-- check that the types of declared terms are correct</span><span>
</span><span id="line-232"></span><span>       </span><span class="annot"><span class="annottext">Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e (uni :: * -&gt; *) fun a.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun a, ToKind uni,
 HasUniApply uni, AsTypeErrorExt e uni a) =&gt;
Recursivity
-&gt; Binding TyName Name uni fun a -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var">checkTypeFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957687"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621680957679"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-233"></span><span>       </span><span class="hs-comment">-- add new *normalized* termvariables to env</span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-comment">-- Note that the order of adding typesVSkinds here does not matter</span><span>
</span><span id="line-235"></span><span>       </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun e res -&gt; PirTCEnv uni fun e res
forall name (uni :: * -&gt; *) fun ann c e res.
Binding TyName name uni fun ann
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var">withTyVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621680957679"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e res -&gt; PirTCEnv uni fun e res)
-&gt; PirTCEnv uni fun e res -&gt; PirTCEnv uni fun e res
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-236"></span><span>           </span><span class="annot"><span class="annottext">Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; PirTCEnv uni fun e res
-&gt; PirTCEnv uni fun e res
forall (uni :: * -&gt; *) fun c e a res.
HasUniApply uni =&gt;
Recursivity
-&gt; Binding TyName Name uni fun a
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957687"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
</span><a href="#local-6989586621680957679"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun e res
</span><a href="#local-6989586621680957678"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-237"></span><span>
</span><span id="line-238"></span><span class="hs-comment">{-
G'=G,withTyVarsOfBindings(bs)
forall b in bs. checkKindFromBinding(G', b)
G''=G',withVarsOfBindings(bs)
forall b in bs. checkTypeFromBinding(G'', b)
[infer| G'' !- inT : ty] ty ~&gt; vTy
-------------------------------------------------
[infer| G !- (let rec bs in inT) : vTy]
-}</span><span>
</span><span id="line-247"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Let"><span class="hs-identifier hs-type">Let</span></a></span><span> </span><span id="local-6989586621680957673"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957673"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957672"><span class="annot"><span class="annottext">r :: Recursivity
</span><a href="#local-6989586621680957672"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span id="local-6989586621680957670"><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957670"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680957669"><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957669"><span class="hs-identifier hs-var">inTerm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span id="local-6989586621680957668"><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957668"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) name (uni :: * -&gt; *) fun ann c e res.
Foldable f =&gt;
f (Binding TyName name uni fun ann)
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-var">withTyVarsOfBindings</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957670"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e (Normalized (Type TyName uni ()))
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-249"></span><span>       </span><span class="hs-comment">-- check that the kinds of the declared types *over all bindings* are correct</span><span>
</span><span id="line-250"></span><span>       </span><span class="hs-comment">-- Note that, compared to NonRec, we need the newtyvars in scope to do kindchecking</span><span>
</span><span id="line-251"></span><span>       </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
-&gt; (Binding TyName Name uni fun ann
    -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957670"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName Name uni fun ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e (uni :: * -&gt; *) fun ann.
(AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni) =&gt;
Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var">checkKindFromBinding</span></a></span><span>
</span><span id="line-252"></span><span>       </span><span class="annot"><span class="annottext">Recursivity
-&gt; NonEmpty (Binding TyName Name uni fun ann)
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (t :: * -&gt; *) (uni :: * -&gt; *) fun a c e res.
(Foldable t, HasUniApply uni) =&gt;
Recursivity
-&gt; t (Binding TyName Name uni fun a)
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-var">withVarsOfBindings</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957672"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957670"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e (Normalized (Type TyName uni ()))
 -&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ())))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-253"></span><span>              </span><span class="hs-comment">-- check that the types of declared terms are correct</span><span>
</span><span id="line-254"></span><span>              </span><span class="hs-comment">-- Note that, compared to NonRec, we need the newtyvars+newvars in scope to do typechecking</span><span>
</span><span id="line-255"></span><span>              </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
-&gt; (Binding TyName Name uni fun ann
    -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (Binding TyName Name uni fun ann)
</span><a href="#local-6989586621680957670"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">((Binding TyName Name uni fun ann
  -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
 -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; (Binding TyName Name uni fun ann
    -&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
-&gt; Binding TyName Name uni fun ann
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e (uni :: * -&gt; *) fun a.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun a, ToKind uni,
 HasUniApply uni, AsTypeErrorExt e uni a) =&gt;
Recursivity
-&gt; Binding TyName Name uni fun a -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var">checkTypeFromBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957672"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-256"></span><span>              </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (uni :: * -&gt; *) fun ann e.
(GEq uni, Ix fun,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni, AsTypeErrorExt e uni ann) =&gt;
Term TyName Name uni fun ann
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
</span><a href="PlutusIR.TypeCheck.Internal.html#inferTypeM"><span class="hs-identifier hs-var">inferTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><a href="#local-6989586621680957669"><span class="hs-identifier hs-var">inTerm</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="hs-comment">-- check the in-term's inferred type has kind * (except at toplevel)</span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">ann
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun (PirTCConfig uni fun) e ()
forall e term (uni :: * -&gt; *) fun ann b.
(AsTypeError e term uni fun ann, ToKind uni) =&gt;
ann -&gt; Normalized (Type TyName uni b) -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var">checkStarInferred</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957673"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957668"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e (Normalized (Type TyName uni ()))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni ())
</span><a href="#local-6989586621680957668"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-260"></span><span>
</span><span id="line-261"></span><span class="hs-comment">{-| This checks that a newly-introduced type variable is correctly kinded.

(b is ty::K = rhs) =&gt; [check| G !- rhs :: K]
(b is term (X::T) =&gt; [check| G !- T :: *])
(b is data (X::K) tyarg1::K1 ... tyargN::KN  = _) =&gt; [check| G, X::K, tyarg1::K1...tyargN::KN !- [X tyarg1 ... tyargN] :: *]
--------------------------------------------------------------------------------------
checkKindFromBinding(G,b)
-}</span><span>
</span><span id="line-269"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-type">checkKindFromBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680957994"><span class="annot"><a href="#local-6989586621680957994"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680957993"><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680957992"><span class="annot"><a href="#local-6989586621680957992"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680957991"><span class="annot"><a href="#local-6989586621680957991"><span class="hs-identifier hs-type">ann</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-270"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957994"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957992"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957992"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957991"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier hs-type">ToKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957992"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957991"><span class="hs-identifier hs-type">ann</span></a></span><span>
</span><span id="line-272"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957992"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957994"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span id="checkKindFromBinding"><span class="annot"><span class="annottext">checkKindFromBinding :: Binding TyName Name uni fun ann -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkKindFromBinding"><span class="hs-identifier hs-var hs-var">checkKindFromBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-comment">-- For a type binding, correct means that the the RHS is indeed kinded by the declared kind.</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span id="local-6989586621680957662"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957662"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyName
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957661"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957661"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680957660"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957660"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957662"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957660"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; PirTCEnv uni fun e ())
-&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann -&gt; Kind ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957661"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-comment">-- For a term binding, correct means that the declared type has kind *.</span><span>
</span><span id="line-278"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957657"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957657"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-279"></span><span>        </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni ann -&gt; ann
forall tyname (uni :: * -&gt; *) ann. Type tyname uni ann -&gt; ann
</span><a href="PlutusCore.Core.Type.html#typeAnn"><span class="hs-identifier hs-var">typeAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957657"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957657"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; PirTCEnv uni fun e ())
-&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-comment">-- For a datatype binding, correct means that the type constructor has kind * when fully-applied to its type arguments.</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957655"><span class="annot"><span class="annottext">dt :: Datatype TyName Name uni fun ann
</span><a href="#local-6989586621680957655"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621680957653"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957653"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957652"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957652"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621680957651"><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621680957651"><span class="hs-identifier hs-var">tyargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957650"><span class="annot"><span class="annottext">[VarDecl TyName Name uni fun ann]
</span><a href="#local-6989586621680957650"><span class="hs-identifier hs-var">vdecls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-282"></span><span>        </span><span class="hs-comment">-- tycon+tyargs must be in scope during kindchecking</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall ann (uni :: * -&gt; *) fun c e a.
[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957652"><span class="hs-identifier hs-var">tycon</span></a></span><span class="annot"><span class="annottext">TyVarDecl TyName ann
-&gt; [TyVarDecl TyName ann] -&gt; [TyVarDecl TyName ann]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><a href="#local-6989586621680957651"><span class="hs-identifier hs-var">tyargs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-284"></span><span>          </span><span class="hs-comment">-- the fully-applied type-constructor must be *-kinded</span><span>
</span><span id="line-285"></span><span>          </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957653"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957648"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; PirTCEnv uni fun e ())
-&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>          </span><span class="hs-comment">-- the types of all the data-constructors must be *-kinded</span><span>
</span><span id="line-287"></span><span>          </span><span class="annot"><span class="annottext">[Type TyName uni ann]
-&gt; (Type TyName uni ann -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun ann -&gt; Type TyName uni ann
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">(VarDecl TyName Name uni fun ann -&gt; Type TyName uni ann)
-&gt; [VarDecl TyName Name uni fun ann] -&gt; [Type TyName uni ann]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni fun ann]
</span><a href="#local-6989586621680957650"><span class="hs-identifier hs-var">vdecls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Type TyName uni ann -&gt; PirTCEnv uni fun e ())
 -&gt; PirTCEnv uni fun e ())
-&gt; (Type TyName uni ann -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-288"></span><span>               </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957653"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ())
-&gt; Kind () -&gt; Type TyName uni ann -&gt; PirTCEnv uni fun e ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">`flip`</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-290"></span><span>       </span><span id="local-6989586621680957648"><span class="annot"><span class="annottext">Type TyName uni ann
</span><a href="#local-6989586621680957648"><span class="hs-identifier hs-var">appliedTyCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957993"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957991"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ann -&gt; Datatype TyName Name uni fun ann -&gt; Type TyName uni ann
forall a (uni :: * -&gt; *) fun.
a -&gt; Datatype TyName Name uni fun a -&gt; Type TyName uni a
</span><a href="PlutusIR.Compiler.Datatype.html#mkDatatypeValueType"><span class="hs-identifier hs-var">mkDatatypeValueType</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957653"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni fun ann
</span><a href="#local-6989586621680957655"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">{- | This checks that a newly-introduced variable has declared the *right type* for its term
(rhs term in case of termbind or implicit constructor term in case of dataconstructor).

(b is t:ty = _) =&gt; [check| G !- t : nTy]  ty ~&gt; vTy
---------------------------------------------------
checkTypeFromBinding(G,b)
-}</span><span>
</span><span id="line-300"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-type">checkTypeFromBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680957988"><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680957990"><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680957989"><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680957987"><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">GEq</span></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Ix</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Term"><span class="hs-identifier hs-type">Term</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier hs-type">ToKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusIR.Error.html#AsTypeErrorExt"><span class="hs-identifier hs-type">AsTypeErrorExt</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-301"></span><span>                 </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-302"></span><span id="checkTypeFromBinding"><span class="annot"><span class="annottext">checkTypeFromBinding :: Recursivity
-&gt; Binding TyName Name uni fun a -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeFromBinding"><span class="hs-identifier hs-var hs-var">checkTypeFromBinding</span></a></span></span><span> </span><span id="local-6989586621680957644"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957644"><span class="hs-identifier hs-var">recurs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- no types to check</span><span>
</span><span id="line-304"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span id="local-6989586621680957643"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680957643"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957642"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957642"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680957641"><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680957641"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-305"></span><span>        </span><span class="hs-comment">-- See Note [PIR vs Paper Escaping Types Difference]</span><span>
</span><span id="line-306"></span><span>        </span><span class="annot"><span class="annottext">PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall (uni :: * -&gt; *) fun e a.
PirTCEnv uni fun e a -&gt; PirTCEnv uni fun e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-var">withNoEscapingTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
-&gt; Term TyName Name uni fun a
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e ()
forall (uni :: * -&gt; *) fun e ann.
(GEq uni, Ix fun, AsTypeErrorExt e uni ann,
 AsTypeError e (Term TyName Name uni fun ()) uni fun ann,
 ToKind uni, HasUniApply uni) =&gt;
ann
-&gt; Term TyName Name uni fun ann
-&gt; Normalized (Type TyName uni ())
-&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkTypeM"><span class="hs-identifier hs-var">checkTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680957643"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><a href="#local-6989586621680957641"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni ()) -&gt; PirTCEnv uni fun e ())
-&gt; (Normalized (Type TyName uni a)
    -&gt; Normalized (Type TyName uni ()))
-&gt; Normalized (Type TyName uni a)
-&gt; PirTCEnv uni fun e ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni a -&gt; Type TyName uni ())
-&gt; Normalized (Type TyName uni a)
-&gt; Normalized (Type TyName uni ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni a) -&gt; PirTCEnv uni fun e ())
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     (Normalized (Type TyName uni a))
-&gt; PirTCEnv uni fun e ()
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     (Normalized (Type TyName uni a))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957642"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>    </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957638"><span class="annot"><span class="annottext">dt :: Datatype TyName Name uni fun a
</span><a href="#local-6989586621680957638"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span id="local-6989586621680957637"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680957637"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyVarDecl TyName a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957636"><span class="annot"><span class="annottext">[TyVarDecl TyName a]
</span><a href="#local-6989586621680957636"><span class="hs-identifier hs-var">tyargs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957635"><span class="annot"><span class="annottext">[VarDecl TyName Name uni fun a]
</span><a href="#local-6989586621680957635"><span class="hs-identifier hs-var">constrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-308"></span><span>        </span><span class="annot"><span class="annottext">[Type TyName uni a]
-&gt; (Type TyName uni a -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a -&gt; Type TyName uni a
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">(VarDecl TyName Name uni fun a -&gt; Type TyName uni a)
-&gt; [VarDecl TyName Name uni fun a] -&gt; [Type TyName uni a]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni fun a]
</span><a href="#local-6989586621680957635"><span class="hs-identifier hs-var">constrs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Type TyName uni a -&gt; PirTCEnv uni fun e ())
 -&gt; PirTCEnv uni fun e ())
-&gt; (Type TyName uni a -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-309"></span><span>            </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621680957634"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957634"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type TyName uni a -&gt; PirTCEnv uni fun e ()
</span><a href="#local-6989586621680957633"><span class="hs-identifier hs-var">checkConRes</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957634"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun e ()
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a -&gt; PirTCEnv uni fun e ()
</span><a href="#local-6989586621680957632"><span class="hs-identifier hs-var">checkNonRecScope</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957634"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-310"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-311"></span><span>       </span><span id="local-6989586621680957631"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957631"><span class="hs-identifier hs-var">appliedTyCon</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Datatype TyName Name uni fun a -&gt; Type TyName uni a
forall a (uni :: * -&gt; *) fun.
a -&gt; Datatype TyName Name uni fun a -&gt; Type TyName uni a
</span><a href="PlutusIR.Compiler.Datatype.html#mkDatatypeValueType"><span class="hs-identifier hs-var">mkDatatypeValueType</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680957637"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni fun a
</span><a href="#local-6989586621680957638"><span class="hs-identifier hs-var">dt</span></a></span><span>
</span><span id="line-312"></span><span>       </span><span class="annot"><a href="#local-6989586621680957633"><span class="hs-identifier hs-type">checkConRes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>       </span><span id="local-6989586621680957633"><span class="annot"><span class="annottext">checkConRes :: Type TyName uni a -&gt; PirTCEnv uni fun e ()
</span><a href="#local-6989586621680957633"><span class="hs-identifier hs-var hs-var">checkConRes</span></a></span></span><span> </span><span id="local-6989586621680957630"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957630"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-314"></span><span>           </span><span class="hs-comment">-- We earlier checked that datacons' type is *-kinded (using checkKindBinding), but this is not enough:</span><span>
</span><span id="line-315"></span><span>           </span><span class="hs-comment">-- we must also check that its result type is EXACTLY `[[TypeCon tyarg1] ... tyargn]` (ignoring annotations)</span><span>
</span><span id="line-316"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni a -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni a -&gt; Type TyName uni a
forall tyname (uni :: * -&gt; *) a.
Type tyname uni a -&gt; Type tyname uni a
</span><a href="PlutusIR.Compiler.Datatype.html#funResultType"><span class="hs-identifier hs-var">funResultType</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957630"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni () -&gt; Type TyName uni () -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957631"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ())
-&gt; (TypeErrorExt uni a -&gt; PirTCEnv uni fun e ())
-&gt; TypeErrorExt uni a
-&gt; PirTCEnv uni fun e ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-317"></span><span>               </span><span class="annot"><span class="annottext">AReview e (TypeErrorExt uni a)
-&gt; TypeErrorExt uni a -&gt; PirTCEnv uni fun e ()
forall e (m :: * -&gt; *) t x.
MonadError e m =&gt;
AReview e t -&gt; t -&gt; m x
</span><span class="hs-identifier hs-var">throwing</span></span><span> </span><span class="annot"><span class="annottext">AReview e (TypeErrorExt uni a)
forall r (uni :: * -&gt; *) ann.
AsTypeErrorExt r uni ann =&gt;
Prism' r (TypeErrorExt uni ann)
</span><a href="PlutusIR.Error.html#_TypeErrorExt"><span class="hs-identifier hs-var">_TypeErrorExt</span></a></span><span> </span><span class="annot"><span class="annottext">(TypeErrorExt uni a -&gt; PirTCEnv uni fun e ())
-&gt; TypeErrorExt uni a -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Type TyName uni a -&gt; TypeErrorExt uni a
forall (uni :: * -&gt; *) ann.
ann -&gt; Type TyName uni ann -&gt; TypeErrorExt uni ann
</span><a href="PlutusIR.Error.html#MalformedDataConstrResType"><span class="hs-identifier hs-var">MalformedDataConstrResType</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680957637"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957631"><span class="hs-identifier hs-var">appliedTyCon</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>       </span><span class="hs-comment">-- if nonrec binding, make sure that type-constructor is not part of the data-constructor's argument types.</span><span>
</span><span id="line-320"></span><span>       </span><span class="annot"><a href="#local-6989586621680957632"><span class="hs-identifier hs-type">checkNonRecScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957987"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957990"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957989"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957988"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>       </span><span id="local-6989586621680957632"><span class="annot"><span class="annottext">checkNonRecScope :: Type TyName uni a -&gt; PirTCEnv uni fun e ()
</span><a href="#local-6989586621680957632"><span class="hs-identifier hs-var hs-var">checkNonRecScope</span></a></span></span><span> </span><span id="local-6989586621680957626"><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957626"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957644"><span class="hs-identifier hs-var">recurs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-322"></span><span>           </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#Rec"><span class="hs-identifier hs-var">Rec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>           </span><span class="annot"><span class="annottext">Recursivity
</span><a href="PlutusIR.Core.Type.html#NonRec"><span class="hs-identifier hs-var">NonRec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-324"></span><span>               </span><span class="hs-comment">-- now we make sure that dataconstructor is not self-recursive, i.e. funargs don't contain tycon</span><span>
</span><span id="line-325"></span><span>               </span><span class="annot"><span class="annottext">[TyVarDecl TyName a]
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall ann (uni :: * -&gt; *) fun c e a.
[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName a]
</span><a href="#local-6989586621680957636"><span class="hs-identifier hs-var">tyargs</span></a></span><span> </span><span class="annot"><span class="annottext">(PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ())
-&gt; PirTCEnv uni fun e () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- tycon not in scope here</span><span>
</span><span id="line-326"></span><span>                      </span><span class="hs-comment">-- OPTIMIZE: we use inferKind for scope-checking, but a simple ADT-traversal would suffice</span><span>
</span><span id="line-327"></span><span>                      </span><span class="annot"><span class="annottext">[Type TyName uni a]
-&gt; (Type TyName uni a
    -&gt; ReaderT
         (TypeCheckEnv uni fun (PirTCConfig uni fun))
         (ExceptT e Quote)
         (Kind ()))
-&gt; PirTCEnv uni fun e ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
t a -&gt; (a -&gt; f b) -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">for_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni a -&gt; [Type TyName uni a]
forall tyname (uni :: * -&gt; *) a.
Type tyname uni a -&gt; [Type tyname uni a]
</span><a href="PlutusIR.Compiler.Datatype.html#funTyArgs"><span class="hs-identifier hs-var">funTyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
</span><a href="#local-6989586621680957626"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     (Kind ())
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
Type TyName uni ann -&gt; TypeCheckM uni fun cfg err (Kind ())
</span><a href="PlutusCore.TypeCheck.Internal.html#inferKindM"><span class="hs-identifier hs-var">inferKindM</span></a></span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-comment">-- | Check that the in-Term's inferred type of a Let has kind *.</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- Skip this check at the top-level, to allow top-level types to escape; see Note [PIR vs Paper Escaping Types Difference].</span><span>
</span><span id="line-331"></span><span id="local-6989586621680957996"><span id="local-6989586621680957997"><span id="local-6989586621680957998"><span id="local-6989586621680957999"><span id="local-6989586621680958000"><span id="local-6989586621680958001"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-type">checkStarInferred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Error.html#AsTypeError"><span class="hs-identifier hs-type">AsTypeError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958001"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958000"><span class="hs-identifier hs-type">term</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957999"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957998"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957997"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Builtin.KnownKind.html#ToKind"><span class="hs-identifier hs-type">ToKind</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957999"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>                  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680957997"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#Normalized"><span class="hs-identifier hs-type">Normalized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957999"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957996"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957999"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957998"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680958001"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span></span></span></span><span>
</span><span id="line-333"></span><span id="checkStarInferred"><span class="annot"><span class="annottext">checkStarInferred :: ann -&gt; Normalized (Type TyName uni b) -&gt; PirTCEnv uni fun e ()
</span><a href="PlutusIR.TypeCheck.Internal.html#checkStarInferred"><span class="hs-identifier hs-var hs-var">checkStarInferred</span></a></span></span><span> </span><span id="local-6989586621680957624"><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957624"><span class="hs-identifier hs-var">ann</span></a></span></span><span> </span><span id="local-6989586621680957623"><span class="annot"><span class="annottext">Normalized (Type TyName uni b)
</span><a href="#local-6989586621680957623"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-334"></span><span>    </span><span id="local-6989586621680957622"><span class="annot"><span class="annottext">AllowEscape
</span><a href="#local-6989586621680957622"><span class="hs-identifier hs-var">allowEscape</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting
  AllowEscape
  (TypeCheckEnv uni fun (PirTCConfig uni fun))
  AllowEscape
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     AllowEscape
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting
   AllowEscape
   (TypeCheckEnv uni fun (PirTCConfig uni fun))
   AllowEscape
 -&gt; ReaderT
      (TypeCheckEnv uni fun (PirTCConfig uni fun))
      (ExceptT e Quote)
      AllowEscape)
-&gt; Getting
     AllowEscape
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     AllowEscape
-&gt; ReaderT
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (ExceptT e Quote)
     AllowEscape
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PirTCConfig uni fun -&gt; Const AllowEscape (PirTCConfig uni fun))
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
-&gt; Const AllowEscape (TypeCheckEnv uni fun (PirTCConfig uni fun))
forall (uni :: * -&gt; *) fun cfg fun2 cfg2.
Lens
  (TypeCheckEnv uni fun cfg) (TypeCheckEnv uni fun2 cfg2) cfg cfg2
</span><a href="PlutusCore.TypeCheck.Internal.html#tceTypeCheckConfig"><span class="hs-identifier hs-var">tceTypeCheckConfig</span></a></span><span> </span><span class="annot"><span class="annottext">((PirTCConfig uni fun -&gt; Const AllowEscape (PirTCConfig uni fun))
 -&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
 -&gt; Const AllowEscape (TypeCheckEnv uni fun (PirTCConfig uni fun)))
-&gt; ((AllowEscape -&gt; Const AllowEscape AllowEscape)
    -&gt; PirTCConfig uni fun -&gt; Const AllowEscape (PirTCConfig uni fun))
-&gt; Getting
     AllowEscape
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     AllowEscape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(AllowEscape -&gt; Const AllowEscape AllowEscape)
-&gt; PirTCConfig uni fun -&gt; Const AllowEscape (PirTCConfig uni fun)
forall (uni :: * -&gt; *) fun. Lens' (PirTCConfig uni fun) AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#pirConfigAllowEscape"><span class="hs-identifier hs-var">pirConfigAllowEscape</span></a></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="#local-6989586621680957622"><span class="hs-identifier hs-var">allowEscape</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-336"></span><span>        </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#NoEscape"><span class="hs-identifier hs-var">NoEscape</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni ann -&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall err term (uni :: * -&gt; *) fun ann cfg.
(AsTypeError err term uni fun ann, ToKind uni) =&gt;
ann
-&gt; Type TyName uni ann -&gt; Kind () -&gt; TypeCheckM uni fun cfg err ()
</span><a href="PlutusCore.TypeCheck.Internal.html#checkKindM"><span class="hs-identifier hs-var">checkKindM</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957624"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ann
</span><a href="#local-6989586621680957624"><span class="hs-identifier hs-var">ann</span></a></span><span> </span><span class="annot"><span class="annottext">ann -&gt; Type TyName uni b -&gt; Type TyName uni ann
forall (f :: * -&gt; *) a b. Functor f =&gt; a -&gt; f b -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni b) -&gt; Type TyName uni b
forall a. Normalized a -&gt; a
</span><a href="PlutusCore.Core.Type.html#unNormalized"><span class="hs-identifier hs-var hs-var">unNormalized</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni b)
</span><a href="#local-6989586621680957623"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; PirTCEnv uni fun e ())
-&gt; Kind () -&gt; PirTCEnv uni fun e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Kind ()
forall ann. ann -&gt; Kind ann
</span><a href="PlutusCore.Core.Type.html#Type"><span class="hs-identifier hs-var">Type</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-comment">-- NOTE: we completely skip the check in case of toplevel because we would need an *final, extended Gamma environment*</span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- to run the kind-check in, but we cannot easily get that since we are using a Reader for environments and not State</span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#YesEscape"><span class="hs-identifier hs-var">YesEscape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; PirTCEnv uni fun e ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span class="hs-comment">-- | Changes the flag in nested-lets so to disallow returning a type outside of the type's scope</span><span>
</span><span id="line-343"></span><span id="local-6989586621680957917"><span id="local-6989586621680957918"><span id="local-6989586621680957919"><span id="local-6989586621680957920"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-type">withNoEscapingTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957920"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957919"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957918"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957917"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957920"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957919"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957918"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957917"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-344"></span><span id="withNoEscapingTypes"><span class="annot"><span class="annottext">withNoEscapingTypes :: PirTCEnv uni fun e a -&gt; PirTCEnv uni fun e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withNoEscapingTypes"><span class="hs-identifier hs-var hs-var">withNoEscapingTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeCheckEnv uni fun (PirTCConfig uni fun)
 -&gt; TypeCheckEnv uni fun (PirTCConfig uni fun))
-&gt; PirTCEnv uni fun e a -&gt; PirTCEnv uni fun e a
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; r) -&gt; m a -&gt; m a
</span><span class="hs-identifier hs-var">local</span></span><span> </span><span class="annot"><span class="annottext">((TypeCheckEnv uni fun (PirTCConfig uni fun)
  -&gt; TypeCheckEnv uni fun (PirTCConfig uni fun))
 -&gt; PirTCEnv uni fun e a -&gt; PirTCEnv uni fun e a)
-&gt; (TypeCheckEnv uni fun (PirTCConfig uni fun)
    -&gt; TypeCheckEnv uni fun (PirTCConfig uni fun))
-&gt; PirTCEnv uni fun e a
-&gt; PirTCEnv uni fun e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ASetter
  (TypeCheckEnv uni fun (PirTCConfig uni fun))
  (TypeCheckEnv uni fun (PirTCConfig uni fun))
  AllowEscape
  AllowEscape
-&gt; AllowEscape
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PirTCConfig uni fun -&gt; Identity (PirTCConfig uni fun))
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
-&gt; Identity (TypeCheckEnv uni fun (PirTCConfig uni fun))
forall (uni :: * -&gt; *) fun cfg fun2 cfg2.
Lens
  (TypeCheckEnv uni fun cfg) (TypeCheckEnv uni fun2 cfg2) cfg cfg2
</span><a href="PlutusCore.TypeCheck.Internal.html#tceTypeCheckConfig"><span class="hs-identifier hs-var">tceTypeCheckConfig</span></a></span><span class="annot"><span class="annottext">((PirTCConfig uni fun -&gt; Identity (PirTCConfig uni fun))
 -&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
 -&gt; Identity (TypeCheckEnv uni fun (PirTCConfig uni fun)))
-&gt; ((AllowEscape -&gt; Identity AllowEscape)
    -&gt; PirTCConfig uni fun -&gt; Identity (PirTCConfig uni fun))
-&gt; ASetter
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     (TypeCheckEnv uni fun (PirTCConfig uni fun))
     AllowEscape
     AllowEscape
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">(AllowEscape -&gt; Identity AllowEscape)
-&gt; PirTCConfig uni fun -&gt; Identity (PirTCConfig uni fun)
forall (uni :: * -&gt; *) fun. Lens' (PirTCConfig uni fun) AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#pirConfigAllowEscape"><span class="hs-identifier hs-var">pirConfigAllowEscape</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AllowEscape
</span><a href="PlutusIR.Compiler.Types.html#NoEscape"><span class="hs-identifier hs-var">NoEscape</span></a></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Run a 'TypeCheckM' computation by supplying a 'TypeCheckConfig' to it.</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- Differs from its PLC version in that is passes an extra env flag 'YesEscape'.</span><span>
</span><span id="line-348"></span><span id="local-6989586621680957610"><span id="local-6989586621680957611"><span id="local-6989586621680957612"><span id="local-6989586621680957613"><span id="local-6989586621680957614"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-type">runTypeCheckM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621680957614"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957613"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="PlutusCore.Quote.html#MonadQuote"><span class="hs-identifier hs-type">MonadQuote</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957613"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Compiler.Types.html#PirTCConfig"><span class="hs-identifier hs-type">PirTCConfig</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957612"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957611"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#PirTCEnv"><span class="hs-identifier hs-type">PirTCEnv</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957612"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957611"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957614"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957610"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680957613"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957610"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-350"></span><span id="runTypeCheckM"><span class="annot"><span class="annottext">runTypeCheckM :: PirTCConfig uni fun -&gt; PirTCEnv uni fun e a -&gt; m a
</span><a href="PlutusIR.TypeCheck.Internal.html#runTypeCheckM"><span class="hs-identifier hs-var hs-var">runTypeCheckM</span></a></span></span><span> </span><span id="local-6989586621680957609"><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621680957609"><span class="hs-identifier hs-var">config</span></a></span></span><span> </span><span id="local-6989586621680957608"><span class="annot"><span class="annottext">PirTCEnv uni fun e a
</span><a href="#local-6989586621680957608"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-351"></span><span>    </span><span class="annot"><span class="annottext">Either e a -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; Either e a -&gt; m a
</span><span class="hs-identifier hs-var">liftEither</span></span><span> </span><span class="annot"><span class="annottext">(Either e a -&gt; m a) -&gt; m (Either e a) -&gt; m a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Quote (Either e a) -&gt; m (Either e a)
forall (m :: * -&gt; *) a. MonadQuote m =&gt; Quote a -&gt; m a
</span><a href="PlutusCore.Quote.html#liftQuote"><span class="hs-identifier hs-var">liftQuote</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExceptT e Quote a -&gt; Quote (Either e a)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><span class="hs-identifier hs-var">runExceptT</span></span><span> </span><span class="annot"><span class="annottext">(ExceptT e Quote a -&gt; Quote (Either e a))
-&gt; ExceptT e Quote a -&gt; Quote (Either e a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun e a
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun) -&gt; ExceptT e Quote a
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">PirTCEnv uni fun e a
</span><a href="#local-6989586621680957608"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TypeCheckEnv uni fun (PirTCConfig uni fun)
forall (uni :: * -&gt; *) fun.
TypeCheckEnv uni fun (PirTCConfig uni fun)
</span><a href="#local-6989586621680957603"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621680957603"><span class="annot"><span class="annottext">env :: TypeCheckEnv uni fun (PirTCConfig uni fun)
</span><a href="#local-6989586621680957603"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
-&gt; TyVarKinds
-&gt; VarTypes uni
-&gt; TypeCheckEnv uni fun (PirTCConfig uni fun)
forall (uni :: * -&gt; *) fun cfg.
cfg -&gt; TyVarKinds -&gt; VarTypes uni -&gt; TypeCheckEnv uni fun cfg
</span><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckEnv"><span class="hs-identifier hs-var">TypeCheckEnv</span></a></span><span> </span><span class="annot"><span class="annottext">PirTCConfig uni fun
</span><a href="#local-6989586621680957609"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarKinds
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">VarTypes uni
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- Helpers</span><span>
</span><span id="line-355"></span><span class="hs-comment">----------</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span class="hs-comment">-- | For a single binding, generate the newly-introduce term-variables' types,</span><span>
</span><span id="line-358"></span><span class="hs-comment">-- normalize them, rename them and add them into scope.</span><span>
</span><span id="line-359"></span><span class="hs-comment">-- Newly-declared term variables are: variables of termbinds, constructors, destructor</span><span>
</span><span id="line-360"></span><span class="hs-comment">-- Note: Assumes that the input is globally-unique and preserves global-uniqueness</span><span>
</span><span id="line-361"></span><span class="hs-comment">-- Note to self: actually passing here recursivity is unnecessary, but we do it for sake of compiler/datatype.hs api</span><span>
</span><span id="line-362"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-type">withVarsOfBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680957979"><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span></span><span> </span><span id="local-6989586621680957978"><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span></span><span> </span><span id="local-6989586621680957976"><span class="annot"><a href="#local-6989586621680957976"><span class="hs-identifier hs-type">c</span></a></span></span><span> </span><span id="local-6989586621680957975"><span class="annot"><a href="#local-6989586621680957975"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680957977"><span class="annot"><a href="#local-6989586621680957977"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680957974"><span class="annot"><a href="#local-6989586621680957974"><span class="hs-identifier hs-type">res</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-363"></span><span>                    </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957977"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-364"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957976"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957975"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957974"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957976"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957975"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957974"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-365"></span><span id="withVarsOfBinding"><span class="annot"><span class="annottext">withVarsOfBinding :: Recursivity
-&gt; Binding TyName Name uni fun a
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var hs-var">withVarsOfBinding</span></a></span></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span id="local-6989586621680957601"><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957601"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957601"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-366"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Strictness
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957600"><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a
</span><a href="#local-6989586621680957600"><span class="hs-identifier hs-var">vdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Term TyName Name uni fun a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680957599"><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957599"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>    </span><span id="local-6989586621680957598"><span class="annot"><span class="annottext">Normalized (Type TyName uni a)
</span><a href="#local-6989586621680957598"><span class="hs-identifier hs-var">vTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type TyName uni a
-&gt; TypeCheckM uni fun c e (Normalized (Type TyName uni a))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni a
 -&gt; TypeCheckM uni fun c e (Normalized (Type TyName uni a)))
-&gt; Type TyName uni a
-&gt; TypeCheckM uni fun c e (Normalized (Type TyName uni a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a -&gt; Type TyName uni a
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a
</span><a href="#local-6989586621680957600"><span class="hs-identifier hs-var">vdecl</span></a></span><span>
</span><span id="line-368"></span><span>    </span><span class="hs-comment">-- no need to rename here</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
forall (uni :: * -&gt; *) fun cfg err a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun cfg err a
-&gt; TypeCheckM uni fun cfg err a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a -&gt; Name
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; name
</span><a href="PlutusCore.Core.Type.html#_varDeclName"><span class="hs-identifier hs-var hs-var">_varDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun a
</span><a href="#local-6989586621680957600"><span class="hs-identifier hs-var">vdecl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni a -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni a -&gt; Type TyName uni ())
-&gt; Normalized (Type TyName uni a)
-&gt; Normalized (Type TyName uni ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni a)
</span><a href="#local-6989586621680957598"><span class="hs-identifier hs-var">vTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957599"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-370"></span><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span id="local-6989586621680957596"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957596"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957595"><span class="annot"><span class="annottext">Datatype TyName Name uni fun a
</span><a href="#local-6989586621680957595"><span class="hs-identifier hs-var">dt</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680957594"><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957594"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-comment">-- generate all the definitions</span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680957593"><span class="annot"><span class="annottext">Def (TyVarDecl TyName (Provenance a)) (PLCRecType uni fun a)
</span><a href="#local-6989586621680957593"><span class="hs-identifier hs-var">_tyconstrDef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680957592"><span class="annot"><span class="annottext">[Def
   (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)]
</span><a href="#local-6989586621680957592"><span class="hs-identifier hs-var">constrDefs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680957591"><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)
</span><a href="#local-6989586621680957591"><span class="hs-identifier hs-var">destrDef</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Recursivity
-&gt; Datatype TyName Name uni fun (Provenance a)
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Def (TyVarDecl TyName (Provenance a)) (PLCRecType uni fun a),
      [Def
         (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)],
      Def
        (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a))
forall (m :: * -&gt; *) (uni :: * -&gt; *) fun a.
MonadQuote m =&gt;
Recursivity
-&gt; Datatype TyName Name uni fun (Provenance a)
-&gt; m (Def (TyVarDecl TyName (Provenance a)) (PLCRecType uni fun a),
      [Def
         (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)],
      Def
        (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a))
</span><a href="PlutusIR.Compiler.Datatype.html#compileDatatypeDefs"><span class="hs-identifier hs-var">compileDatatypeDefs</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957596"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datatype TyName Name uni fun a
-&gt; Datatype TyName Name uni fun (Provenance a)
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f (Provenance a)
</span><a href="PlutusIR.Compiler.Provenance.html#original"><span class="hs-identifier hs-var">original</span></a></span><span> </span><span class="annot"><span class="annottext">Datatype TyName Name uni fun a
</span><a href="#local-6989586621680957595"><span class="hs-identifier hs-var">dt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-comment">-- ignore the generated rhs terms of constructors/destructor</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680957588"><span class="annot"><span class="annottext">structorDecls :: [VarDecl TyName Name uni fun (Provenance a)]
</span><a href="#local-6989586621680957588"><span class="hs-identifier hs-var hs-var">structorDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)
-&gt; VarDecl TyName Name uni fun (Provenance a)
forall var val. Def var val -&gt; var
</span><a href="PlutusCore.MkPlc.html#defVar"><span class="hs-identifier hs-var hs-var">PIR.defVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Def
   (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)
 -&gt; VarDecl TyName Name uni fun (Provenance a))
-&gt; [Def
      (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)]
-&gt; [VarDecl TyName Name uni fun (Provenance a)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)
</span><a href="#local-6989586621680957591"><span class="hs-identifier hs-var">destrDef</span></a></span><span class="annot"><span class="annottext">Def
  (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)
-&gt; [Def
      (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)]
-&gt; [Def
      (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[Def
   (VarDecl TyName Name uni fun (Provenance a)) (PIRTerm uni fun a)]
</span><a href="#local-6989586621680957592"><span class="hs-identifier hs-var">constrDefs</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-comment">-- normalize, then rename, then only introduce the vardecl to scope</span><span>
</span><span id="line-376"></span><span>    </span><span class="annot"><span class="annottext">(VarDecl TyName Name uni fun (Provenance a)
 -&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res)
-&gt; TypeCheckM uni fun c e res
-&gt; [VarDecl TyName Name uni fun (Provenance a)]
-&gt; TypeCheckM uni fun c e res
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a)
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957586"><span class="hs-identifier hs-var">normRenameScope</span></a></span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957594"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName Name uni fun (Provenance a)]
</span><a href="#local-6989586621680957588"><span class="hs-identifier hs-var">structorDecls</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-378"></span><span>      </span><span class="annot"><a href="#local-6989586621680957586"><span class="hs-identifier hs-type">normRenameScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusCore.Core.Type.html#VarDecl"><span class="hs-identifier hs-type">VarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Compiler.Provenance.html#Provenance"><span class="hs-identifier hs-type">Provenance</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957977"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957976"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957975"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957974"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957979"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957978"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957976"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957975"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957974"><span class="hs-identifier hs-type">res</span></a></span><span>
</span><span id="line-380"></span><span>      </span><span id="local-6989586621680957586"><span class="annot"><span class="annottext">normRenameScope :: VarDecl TyName Name uni fun (Provenance a)
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957586"><span class="hs-identifier hs-var hs-var">normRenameScope</span></a></span></span><span> </span><span id="local-6989586621680957585"><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a)
</span><a href="#local-6989586621680957585"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621680957584"><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957584"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-381"></span><span>          </span><span id="local-6989586621680957583"><span class="annot"><span class="annottext">Normalized (Type TyName uni (Provenance a))
</span><a href="#local-6989586621680957583"><span class="hs-identifier hs-var">normRenamedTy</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni (Provenance a))
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Normalized (Type TyName uni (Provenance a)))
forall a (m :: * -&gt; *). (Rename a, MonadQuote m) =&gt; a -&gt; m a
</span><a href="PlutusCore.Rename.html#rename"><span class="hs-identifier hs-var">rename</span></a></span><span> </span><span class="annot"><span class="annottext">(Normalized (Type TyName uni (Provenance a))
 -&gt; ReaderT
      (TypeCheckEnv uni fun c)
      (ExceptT e Quote)
      (Normalized (Type TyName uni (Provenance a))))
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Normalized (Type TyName uni (Provenance a)))
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Normalized (Type TyName uni (Provenance a)))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni (Provenance a)
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Normalized (Type TyName uni (Provenance a)))
forall (uni :: * -&gt; *) ann fun cfg err.
HasUniApply uni =&gt;
Type TyName uni ann
-&gt; TypeCheckM uni fun cfg err (Normalized (Type TyName uni ann))
</span><a href="PlutusCore.TypeCheck.Internal.html#normalizeTypeM"><span class="hs-identifier hs-var">normalizeTypeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni (Provenance a)
 -&gt; ReaderT
      (TypeCheckEnv uni fun c)
      (ExceptT e Quote)
      (Normalized (Type TyName uni (Provenance a))))
-&gt; Type TyName uni (Provenance a)
-&gt; ReaderT
     (TypeCheckEnv uni fun c)
     (ExceptT e Quote)
     (Normalized (Type TyName uni (Provenance a)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a)
-&gt; Type TyName uni (Provenance a)
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; Type tyname uni ann
</span><a href="PlutusCore.Core.Type.html#_varDeclType"><span class="hs-identifier hs-var hs-var">_varDeclType</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a)
</span><a href="#local-6989586621680957585"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>          </span><span class="annot"><span class="annottext">Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
forall (uni :: * -&gt; *) fun cfg err a.
Name
-&gt; Normalized (Type TyName uni ())
-&gt; TypeCheckM uni fun cfg err a
-&gt; TypeCheckM uni fun cfg err a
</span><a href="PlutusCore.TypeCheck.Internal.html#withVar"><span class="hs-identifier hs-var">withVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a) -&gt; Name
forall tyname name (uni :: * -&gt; *) k (fun :: k) ann.
VarDecl tyname name uni fun ann -&gt; name
</span><a href="PlutusCore.Core.Type.html#_varDeclName"><span class="hs-identifier hs-var hs-var">_varDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">VarDecl TyName Name uni fun (Provenance a)
</span><a href="#local-6989586621680957585"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type TyName uni (Provenance a) -&gt; Type TyName uni ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Type TyName uni (Provenance a) -&gt; Type TyName uni ())
-&gt; Normalized (Type TyName uni (Provenance a))
-&gt; Normalized (Type TyName uni ())
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Normalized (Type TyName uni (Provenance a))
</span><a href="#local-6989586621680957583"><span class="hs-identifier hs-var">normRenamedTy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957584"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span id="local-6989586621680957955"><span id="local-6989586621680957956"><span id="local-6989586621680957957"><span id="local-6989586621680957958"><span id="local-6989586621680957959"><span id="local-6989586621680957960"><span id="local-6989586621680957961"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-type">withVarsOfBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957961"><span class="hs-identifier hs-type">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Universe.Core.html#HasUniApply"><span class="hs-identifier hs-type">HasUniApply</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957960"><span class="hs-identifier hs-type">uni</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Recursivity"><span class="hs-identifier hs-type">Recursivity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680957961"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957960"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957959"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957958"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-386"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957960"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957959"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957957"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957956"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957955"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957960"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957959"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957957"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957956"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957955"><span class="hs-identifier hs-type">res</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-387"></span><span id="withVarsOfBindings"><span class="annot"><span class="annottext">withVarsOfBindings :: Recursivity
-&gt; t (Binding TyName Name uni fun a)
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBindings"><span class="hs-identifier hs-var hs-var">withVarsOfBindings</span></a></span></span><span> </span><span id="local-6989586621680957581"><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957581"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span id="local-6989586621680957580"><span class="annot"><span class="annottext">t (Binding TyName Name uni fun a)
</span><a href="#local-6989586621680957580"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680957579"><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957579"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Binding TyName Name uni fun a
 -&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res)
-&gt; TypeCheckM uni fun c e res
-&gt; t (Binding TyName Name uni fun a)
-&gt; TypeCheckM uni fun c e res
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Recursivity
-&gt; Binding TyName Name uni fun a
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
forall (uni :: * -&gt; *) fun c e a res.
HasUniApply uni =&gt;
Recursivity
-&gt; Binding TyName Name uni fun a
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withVarsOfBinding"><span class="hs-identifier hs-var">withVarsOfBinding</span></a></span><span> </span><span class="annot"><span class="annottext">Recursivity
</span><a href="#local-6989586621680957581"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res
</span><a href="#local-6989586621680957579"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">t (Binding TyName Name uni fun a)
</span><a href="#local-6989586621680957580"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span class="hs-comment">-- | Scope a typechecking computation with the given binding's newly-introducing type (if there is one)</span><span>
</span><span id="line-390"></span><span id="local-6989586621680957980"><span id="local-6989586621680957981"><span id="local-6989586621680957982"><span id="local-6989586621680957983"><span id="local-6989586621680957984"><span id="local-6989586621680957985"><span id="local-6989586621680957986"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-type">withTyVarsOfBinding</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957986"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957985"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957984"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957983"><span class="hs-identifier hs-type">ann</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957985"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957984"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957982"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957981"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957980"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957985"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957984"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957982"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957981"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957980"><span class="hs-identifier hs-type">res</span></a></span></span></span></span></span></span></span></span><span>
</span><span id="line-391"></span><span id="withTyVarsOfBinding"><span class="annot"><span class="annottext">withTyVarsOfBinding :: Binding TyName name uni fun ann
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var hs-var">withTyVarsOfBinding</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-392"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#TypeBind"><span class="hs-identifier hs-type">TypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957578"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957578"><span class="hs-identifier hs-var">tvdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type TyName uni ann
</span><span class="hs-identifier">_</span></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
forall ann (uni :: * -&gt; *) fun c e a.
[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957578"><span class="hs-identifier hs-var">tvdecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-393"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#DatatypeBind"><span class="hs-identifier hs-type">DatatypeBind</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Datatype"><span class="hs-identifier hs-type">Datatype</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957577"><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957577"><span class="hs-identifier hs-var">tvdecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[VarDecl TyName name uni fun ann]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
forall ann (uni :: * -&gt; *) fun c e a.
[TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var">withTyVarDecls</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyVarDecl TyName ann
</span><a href="#local-6989586621680957577"><span class="hs-identifier hs-var">tvdecl</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>       </span><span class="annot"><a href="PlutusIR.Core.Type.html#TermBind"><span class="hs-identifier hs-type">TermBind</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>                               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-comment">-- no type to introduce</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- | Extend the typecheck reader environment with the kinds of the newly-introduced type variables of a binding.</span><span>
</span><span id="line-397"></span><span id="local-6989586621680957966"><span id="local-6989586621680957967"><span id="local-6989586621680957968"><span id="local-6989586621680957969"><span id="local-6989586621680957970"><span id="local-6989586621680957971"><span id="local-6989586621680957972"><span id="local-6989586621680957973"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-type">withTyVarsOfBindings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Foldable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957973"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680957973"><span class="hs-identifier hs-type">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="PlutusIR.Core.Type.html#Binding"><span class="hs-identifier hs-type">Binding</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957972"><span class="hs-identifier hs-type">name</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957971"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957970"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957969"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957971"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957970"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957968"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957967"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957966"><span class="hs-identifier hs-type">res</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957971"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957970"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957968"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957967"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957966"><span class="hs-identifier hs-type">res</span></a></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-398"></span><span id="withTyVarsOfBindings"><span class="annot"><span class="annottext">withTyVarsOfBindings :: f (Binding TyName name uni fun ann)
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBindings"><span class="hs-identifier hs-var hs-var">withTyVarsOfBindings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeCheckM uni fun c e res
 -&gt; f (Binding TyName name uni fun ann)
 -&gt; TypeCheckM uni fun c e res)
-&gt; f (Binding TyName name uni fun ann)
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">((TypeCheckM uni fun c e res
  -&gt; f (Binding TyName name uni fun ann)
  -&gt; TypeCheckM uni fun c e res)
 -&gt; f (Binding TyName name uni fun ann)
 -&gt; TypeCheckM uni fun c e res
 -&gt; TypeCheckM uni fun c e res)
-&gt; (TypeCheckM uni fun c e res
    -&gt; f (Binding TyName name uni fun ann)
    -&gt; TypeCheckM uni fun c e res)
-&gt; f (Binding TyName name uni fun ann)
-&gt; TypeCheckM uni fun c e res
-&gt; TypeCheckM uni fun c e res
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Binding TyName name uni fun ann
 -&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res)
-&gt; TypeCheckM uni fun c e res
-&gt; f (Binding TyName name uni fun ann)
-&gt; TypeCheckM uni fun c e res
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">Binding TyName name uni fun ann
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
forall name (uni :: * -&gt; *) fun ann c e res.
Binding TyName name uni fun ann
-&gt; TypeCheckM uni fun c e res -&gt; TypeCheckM uni fun c e res
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarsOfBinding"><span class="hs-identifier hs-var">withTyVarsOfBinding</span></a></span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span class="hs-comment">-- | Helper to add type variables into a computation's environment.</span><span>
</span><span id="line-401"></span><span id="local-6989586621680957938"><span id="local-6989586621680957939"><span id="local-6989586621680957940"><span id="local-6989586621680957941"><span id="local-6989586621680957942"><span id="local-6989586621680957943"><span class="annot"><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-type">withTyVarDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><a href="PlutusCore.Name.html#TyName"><span class="hs-identifier hs-type">TyName</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957943"><span class="hs-identifier hs-type">ann</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957942"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957941"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957940"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957939"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957938"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="PlutusCore.TypeCheck.Internal.html#TypeCheckM"><span class="hs-identifier hs-type">TypeCheckM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957942"><span class="hs-identifier hs-type">uni</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957941"><span class="hs-identifier hs-type">fun</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957940"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957939"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680957938"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span></span><span>
</span><span id="line-402"></span><span id="withTyVarDecls"><span class="annot"><span class="annottext">withTyVarDecls :: [TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
</span><a href="PlutusIR.TypeCheck.Internal.html#withTyVarDecls"><span class="hs-identifier hs-var hs-var">withTyVarDecls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypeCheckM uni fun c e a
 -&gt; [TyVarDecl TyName ann] -&gt; TypeCheckM uni fun c e a)
-&gt; [TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a
-&gt; TypeCheckM uni fun c e a
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">((TypeCheckM uni fun c e a
  -&gt; [TyVarDecl TyName ann] -&gt; TypeCheckM uni fun c e a)
 -&gt; [TyVarDecl TyName ann]
 -&gt; TypeCheckM uni fun c e a
 -&gt; TypeCheckM uni fun c e a)
-&gt; ((TyVarDecl TyName ann
     -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
    -&gt; TypeCheckM uni fun c e a
    -&gt; [TyVarDecl TyName ann]
    -&gt; TypeCheckM uni fun c e a)
-&gt; (TyVarDecl TyName ann
    -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
-&gt; [TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a
-&gt; TypeCheckM uni fun c e a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TyVarDecl TyName ann
 -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
-&gt; TypeCheckM uni fun c e a
-&gt; [TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">((TyVarDecl TyName ann
  -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
 -&gt; [TyVarDecl TyName ann]
 -&gt; TypeCheckM uni fun c e a
 -&gt; TypeCheckM uni fun c e a)
-&gt; (TyVarDecl TyName ann
    -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
-&gt; [TyVarDecl TyName ann]
-&gt; TypeCheckM uni fun c e a
-&gt; TypeCheckM uni fun c e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="PlutusCore.Core.Type.html#TyVarDecl"><span class="hs-identifier hs-type">TyVarDecl</span></a></span><span> </span><span class="annot"><span class="annottext">ann
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680957575"><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957575"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621680957574"><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957574"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyName
-&gt; Kind () -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
forall (uni :: * -&gt; *) fun cfg err a.
TyName
-&gt; Kind ()
-&gt; TypeCheckM uni fun cfg err a
-&gt; TypeCheckM uni fun cfg err a
</span><a href="PlutusCore.TypeCheck.Internal.html#withTyVar"><span class="hs-identifier hs-var">withTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyName
</span><a href="#local-6989586621680957575"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">(Kind () -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a)
-&gt; Kind () -&gt; TypeCheckM uni fun c e a -&gt; TypeCheckM uni fun c e a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann -&gt; Kind ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">Kind ann
</span><a href="#local-6989586621680957574"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-403"></span></pre></body></html>