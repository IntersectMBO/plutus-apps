<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds          #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts   #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-8"></span><span class="hs-comment">{-
This module provides a list of folds over the emulator event stream. To apply
the folds in this module to a stream of events, use
'Wallet.Emulator.Stream.foldEmulatorStreamM'. See note [Emulator event stream].

-}</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Wallet.Emulator.Folds</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier">EmulatorEventFold</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier">EmulatorEventFoldM</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier">EmulatorFoldErr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#describeError"><span class="hs-identifier">describeError</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Folds for contract instances</span></span><span>
</span><span id="line-20"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier">instanceState</span></a></span><span>
</span><span id="line-21"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceRequests"><span class="hs-identifier">instanceRequests</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceResponses"><span class="hs-identifier">instanceResponses</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceOutcome"><span class="hs-identifier">instanceOutcome</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceTransactions"><span class="hs-identifier">instanceTransactions</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#Outcome"><span class="hs-identifier">Outcome</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceLog"><span class="hs-identifier">instanceLog</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceAccumState"><span class="hs-identifier">instanceAccumState</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Folds for transactions and the UTXO set</span></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#chainEvents"><span class="hs-identifier">chainEvents</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#failedTransactions"><span class="hs-identifier">failedTransactions</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#validatedTransactions"><span class="hs-identifier">validatedTransactions</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#utxoAtAddress"><span class="hs-identifier">utxoAtAddress</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#valueAtAddress"><span class="hs-identifier">valueAtAddress</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Folds for individual wallets (emulated agents)</span></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletFunds"><span class="hs-identifier">walletFunds</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletFees"><span class="hs-identifier">walletFees</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletTxBalanceEvents"><span class="hs-identifier">walletTxBalanceEvents</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletsAdjustedTxEvents"><span class="hs-identifier">walletsAdjustedTxEvents</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Folds that are used in the Playground</span></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#annotatedBlockchain"><span class="hs-identifier">annotatedBlockchain</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#blockchain"><span class="hs-identifier">blockchain</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#emulatorLog"><span class="hs-identifier">emulatorLog</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#userLog"><span class="hs-identifier">userLog</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Etc.</span></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#renderLines"><span class="hs-identifier">renderLines</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#preMapMaybeM"><span class="hs-identifier">preMapMaybeM</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier">preMapMaybe</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#postMapM"><span class="hs-identifier">postMapM</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#mkTxLogs"><span class="hs-identifier">mkTxLogs</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-51"></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainEvent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotAdd</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxnValidation</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_TxnValidation</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">chainEventOnChainTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Applicative</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&lt;|&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Foldl</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Fold</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">FoldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FoldM</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Foldl</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Fold</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&gt;=&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Eff</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Member</span></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Error</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JSON</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Endo</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Block</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">CardanoAddress</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OnChainTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unOnChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.AddressMap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UtxoMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.AddressMap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AM</span></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Index</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">RedeemerReport</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidationError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidationPhase</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Phase1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Phase2</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_FailPhase1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_FailPhase2</span></span><span class="hs-special">,</span><span>
</span><span id="line-72"></span><span>                     </span><span class="annot"><span class="hs-identifier">_Success</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toOnChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getCardanoTxFee</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getCardanoTxId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txOutValue</span></span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints.OffChain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnbalancedTx</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.html"><span class="hs-identifier">Plutus.Contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier">Contract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html"><span class="hs-identifier">Plutus.Contract.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier">PABReq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier">PABResp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#_BalanceTxReq"><span class="hs-identifier">_BalanceTxReq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Request.html"><span class="hs-identifier">Plutus.Contract.Request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Request.html#MkTxLog"><span class="hs-identifier">MkTxLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html"><span class="hs-identifier">Plutus.Contract.Resumable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier">Response</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html"><span class="hs-identifier">Plutus.Contract.Resumable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html"><span class="hs-identifier">Plutus.Contract.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier">ResumableResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#_finalState"><span class="hs-identifier">_finalState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#_observableState"><span class="hs-identifier">_observableState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#_requests"><span class="hs-identifier">_requests</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html"><span class="hs-identifier">Plutus.Trace.Emulator.ContractInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier">ContractInstanceState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#addEventInstanceState"><span class="hs-identifier">addEventInstanceState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#emptyInstanceState"><span class="hs-identifier">emptyInstanceState</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>                                               </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instContractState"><span class="hs-identifier">instContractState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instEvents"><span class="hs-identifier">instEvents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instHandlersHistory"><span class="hs-identifier">instHandlersHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html"><span class="hs-identifier">Plutus.Trace.Emulator.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier">ContractInstanceLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier">ContractInstanceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractLog"><span class="hs-identifier">ContractLog</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier">ContractInstanceTag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#UserThreadMsg"><span class="hs-identifier">UserThreadMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#_HandledRequest"><span class="hs-identifier">_HandledRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#cilMessage"><span class="hs-identifier">cilMessage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#cilTag"><span class="hs-identifier">cilTag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#toInstanceState"><span class="hs-identifier">toInstanceState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">defaultLayoutOptions</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">layoutPretty</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vsep</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter.Render.Text</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">renderStrict</span></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Emulator.LogMessages.html"><span class="hs-identifier">Wallet.Emulator.LogMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.LogMessages.html#_AdjustingUnbalancedTx"><span class="hs-identifier">_AdjustingUnbalancedTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_BalancingUnbalancedTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">_ValidationFailed</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html"><span class="hs-identifier">Wallet.Emulator.MultiAgent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier">EmulatorEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorTimeEvent"><span class="hs-identifier">EmulatorTimeEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier">chainEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier">eteEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#instanceEvent"><span class="hs-identifier">instanceEvent</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>                                   </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#userThreadEvent"><span class="hs-identifier">userThreadEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#walletClientEvent"><span class="hs-identifier">walletClientEvent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#walletEvent%27"><span class="hs-identifier">walletEvent'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Emulator.NodeClient.html"><span class="hs-identifier">Wallet.Emulator.NodeClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.NodeClient.html#_TxSubmit"><span class="hs-identifier">_TxSubmit</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html"><span class="hs-identifier">Wallet.Emulator.Wallet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.Wallet.html#Wallet"><span class="hs-identifier">Wallet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html#_RequestHandlerLog"><span class="hs-identifier">_RequestHandlerLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html#_TxBalanceLog"><span class="hs-identifier">_TxBalanceLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html#mockWalletAddress"><span class="hs-identifier">mockWalletAddress</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Rollup.html"><span class="hs-identifier">Wallet.Rollup</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Rollup</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Rollup.Types.html"><span class="hs-identifier">Wallet.Rollup.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Rollup.Types.html#AnnotatedTx"><span class="hs-identifier">AnnotatedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span class="hs-keyword">type</span><span> </span><span id="EmulatorEventFold"><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-var">EmulatorEventFold</span></a></span></span><span> </span><span id="local-6989586621680565883"><span class="annot"><a href="#local-6989586621680565883"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fold</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565883"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="hs-comment">-- | A fold over emulator events that can fail with 'EmulatorFoldErr'</span><span>
</span><span id="line-98"></span><span class="hs-keyword">type</span><span> </span><span id="EmulatorEventFoldM"><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-var">EmulatorEventFoldM</span></a></span></span><span> </span><span id="local-6989586621680565882"><span class="annot"><a href="#local-6989586621680565882"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680565881"><span class="annot"><a href="#local-6989586621680565881"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565882"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565881"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | Transactions that failed to validate, in the given validation phase (if specified).</span><span>
</span><span id="line-101"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#failedTransactions"><span class="hs-identifier hs-type">failedTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidationPhase</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">CardanoTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidationError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-102"></span><span id="failedTransactions"><span class="annot"><span class="annottext">failedTransactions :: Maybe ValidationPhase
-&gt; EmulatorEventFold [(CardanoTx, ValidationError, Value)]
</span><a href="Wallet.Emulator.Folds.html#failedTransactions"><span class="hs-identifier hs-var hs-var">failedTransactions</span></a></span></span><span> </span><span id="local-6989586621680565880"><span class="annot"><span class="annottext">Maybe ValidationPhase
</span><a href="#local-6989586621680565880"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (CardanoTx, ValidationError, Value))
-&gt; Fold
     (CardanoTx, ValidationError, Value)
     [(CardanoTx, ValidationError, Value)]
-&gt; EmulatorEventFold [(CardanoTx, ValidationError, Value)]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
</span><a href="#local-6989586621680565879"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Maybe (CardanoTx, ValidationError, Value))
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (CardanoTx, ValidationError, Value)
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ValidationPhase
-&gt; (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; Maybe (CardanoTx, ValidationError, Value)
forall a a b c. Eq a =&gt; Maybe a -&gt; (a, a, b, c) -&gt; Maybe (a, b, c)
</span><a href="#local-6989586621680565878"><span class="hs-identifier hs-var">filterPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ValidationPhase
</span><a href="#local-6989586621680565880"><span class="hs-identifier hs-var">phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold
  (CardanoTx, ValidationError, Value)
  [(CardanoTx, ValidationError, Value)]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-104"></span><span>        </span><span id="local-6989586621680565879"><span class="annot"><span class="annottext">f :: EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
</span><a href="#local-6989586621680565879"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621680565876"><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565876"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting
  (First (ValidationPhase, CardanoTx, ValidationError, Value))
  (EmulatorTimeEvent EmulatorEvent')
  (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent'
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; EmulatorEvent'
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         EmulatorEvent')
-&gt; Getting
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
     (ValidationPhase, CardanoTx, ValidationError, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ChainEvent)
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((ChainEvent
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       ChainEvent)
 -&gt; EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; ChainEvent
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         ChainEvent)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidationResult
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ValidationResult)
-&gt; ChainEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ChainEvent
Prism' ChainEvent ValidationResult
</span><span class="hs-identifier hs-var">_TxnValidation</span></span><span> </span><span class="annot"><span class="annottext">((ValidationResult
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       ValidationResult)
 -&gt; ChainEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ChainEvent)
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; ValidationResult
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         ValidationResult)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ChainEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoTx, ValidationError)
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (CardanoTx, ValidationError))
-&gt; ValidationResult
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ValidationResult
Prism' ValidationResult (CardanoTx, ValidationError)
</span><span class="hs-identifier hs-var">_FailPhase1</span></span><span> </span><span class="annot"><span class="annottext">(((CardanoTx, ValidationError)
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       (CardanoTx, ValidationError))
 -&gt; ValidationResult
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ValidationResult)
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; (CardanoTx, ValidationError)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (CardanoTx, ValidationError))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ValidationResult
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ValidationResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoTx, ValidationError)
 -&gt; (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; (CardanoTx, ValidationError)
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (CardanoTx, ValidationError)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680565872"><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680565872"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565871"><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621680565871"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">Phase1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680565872"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621680565871"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565876"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-105"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (ValidationPhase, CardanoTx, ValidationError, Value))
  (EmulatorTimeEvent EmulatorEvent')
  (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent'
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; EmulatorEvent'
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         EmulatorEvent')
-&gt; Getting
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
     (ValidationPhase, CardanoTx, ValidationError, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ChainEvent)
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((ChainEvent
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       ChainEvent)
 -&gt; EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; ChainEvent
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         ChainEvent)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidationResult
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ValidationResult)
-&gt; ChainEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ChainEvent
Prism' ChainEvent ValidationResult
</span><span class="hs-identifier hs-var">_TxnValidation</span></span><span> </span><span class="annot"><span class="annottext">((ValidationResult
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       ValidationResult)
 -&gt; ChainEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ChainEvent)
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; ValidationResult
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         ValidationResult)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ChainEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((OnChainTx, ValidationError, Value)
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (OnChainTx, ValidationError, Value))
-&gt; ValidationResult
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ValidationResult
Prism' ValidationResult (OnChainTx, ValidationError, Value)
</span><span class="hs-identifier hs-var">_FailPhase2</span></span><span class="annot"><span class="annottext">(((OnChainTx, ValidationError, Value)
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       (OnChainTx, ValidationError, Value))
 -&gt; ValidationResult
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      ValidationResult)
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; (OnChainTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (OnChainTx, ValidationError, Value))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ValidationResult
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     ValidationResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((OnChainTx, ValidationError, Value)
 -&gt; (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; (OnChainTx, ValidationError, Value)
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (OnChainTx, ValidationError, Value)
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) s a.
(Profunctor p, Contravariant f) =&gt;
(s -&gt; a) -&gt; Optic' p f s a
</span><span class="hs-identifier hs-var">to</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680565870"><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565870"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565869"><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621680565869"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565868"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565868"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">Phase2</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; CardanoTx
</span><span class="hs-identifier hs-var">unOnChain</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565870"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValidationError
</span><a href="#local-6989586621680565869"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565868"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565876"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-106"></span><span>          </span><span class="annot"><span class="annottext">Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
forall (f :: * -&gt; *) a. Alternative f =&gt; f a -&gt; f a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;|&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (ValidationPhase, CardanoTx, ValidationError, Value))
  (EmulatorTimeEvent EmulatorEvent')
  (ValidationPhase, CardanoTx, ValidationError, Value)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (ValidationPhase, CardanoTx, ValidationError, Value)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent'
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; EmulatorEvent'
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         EmulatorEvent')
-&gt; Getting
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (EmulatorTimeEvent EmulatorEvent')
     (ValidationPhase, CardanoTx, ValidationError, Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Wallet, WalletEvent)
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (Wallet, WalletEvent))
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
Prism' EmulatorEvent' (Wallet, WalletEvent)
</span><a href="Wallet.Emulator.MultiAgent.html#walletEvent%27"><span class="hs-identifier hs-var">walletEvent'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Wallet, WalletEvent)
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       (Wallet, WalletEvent))
 -&gt; EmulatorEvent'
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      EmulatorEvent')
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; (Wallet, WalletEvent)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (Wallet, WalletEvent))
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; EmulatorEvent'
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      WalletEvent)
-&gt; (Wallet, WalletEvent)
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (Wallet, WalletEvent)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((WalletEvent
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       WalletEvent)
 -&gt; (Wallet, WalletEvent)
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (Wallet, WalletEvent))
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; WalletEvent
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         WalletEvent)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; (Wallet, WalletEvent)
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     (Wallet, WalletEvent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBalanceMsg
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      TxBalanceMsg)
-&gt; WalletEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     WalletEvent
Prism' WalletEvent TxBalanceMsg
</span><a href="Wallet.Emulator.Wallet.html#_TxBalanceLog"><span class="hs-identifier hs-var">_TxBalanceLog</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBalanceMsg
  -&gt; Const
       (First (ValidationPhase, CardanoTx, ValidationError, Value))
       TxBalanceMsg)
 -&gt; WalletEvent
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      WalletEvent)
-&gt; (((ValidationPhase, CardanoTx, ValidationError, Value)
     -&gt; Const
          (First (ValidationPhase, CardanoTx, ValidationError, Value))
          (ValidationPhase, CardanoTx, ValidationError, Value))
    -&gt; TxBalanceMsg
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         TxBalanceMsg)
-&gt; ((ValidationPhase, CardanoTx, ValidationError, Value)
    -&gt; Const
         (First (ValidationPhase, CardanoTx, ValidationError, Value))
         (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; WalletEvent
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     WalletEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((ValidationPhase, CardanoTx, ValidationError, Value)
 -&gt; Const
      (First (ValidationPhase, CardanoTx, ValidationError, Value))
      (ValidationPhase, CardanoTx, ValidationError, Value))
-&gt; TxBalanceMsg
-&gt; Const
     (First (ValidationPhase, CardanoTx, ValidationError, Value))
     TxBalanceMsg
Prism'
  TxBalanceMsg (ValidationPhase, CardanoTx, ValidationError, Value)
</span><span class="hs-identifier hs-var">_ValidationFailed</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565876"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-107"></span><span>        </span><span id="local-6989586621680565878"><span class="annot"><span class="annottext">filterPhase :: Maybe a -&gt; (a, a, b, c) -&gt; Maybe (a, b, c)
</span><a href="#local-6989586621680565878"><span class="hs-identifier hs-var hs-var">filterPhase</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565866"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565866"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565865"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565865"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565864"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680565864"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, b, c) -&gt; Maybe (a, b, c)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565866"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565865"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680565864"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><a href="#local-6989586621680565878"><span class="hs-identifier hs-var">filterPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680565863"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565863"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680565862"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565862"><span class="hs-identifier hs-var">p'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565861"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565861"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565860"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565860"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565859"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680565859"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565863"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565862"><span class="hs-identifier hs-var">p'</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(a, b, c) -&gt; Maybe (a, b, c)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565861"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565860"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621680565859"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe (a, b, c)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- | Transactions that were validated</span><span>
</span><span id="line-111"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#validatedTransactions"><span class="hs-identifier hs-type">validatedTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OnChainTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RedeemerReport</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span id="validatedTransactions"><span class="annot"><span class="annottext">validatedTransactions :: EmulatorEventFold [(OnChainTx, RedeemerReport)]
</span><a href="Wallet.Emulator.Folds.html#validatedTransactions"><span class="hs-identifier hs-var hs-var">validatedTransactions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (OnChainTx, RedeemerReport))
-&gt; Fold (OnChainTx, RedeemerReport) [(OnChainTx, RedeemerReport)]
-&gt; EmulatorEventFold [(OnChainTx, RedeemerReport)]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First (OnChainTx, RedeemerReport))
  (EmulatorTimeEvent EmulatorEvent')
  (OnChainTx, RedeemerReport)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (OnChainTx, RedeemerReport)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent'
 -&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (OnChainTx, RedeemerReport))
     (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent'
  -&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (OnChainTx, RedeemerReport))
      (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((OnChainTx, RedeemerReport)
     -&gt; Const
          (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
    -&gt; EmulatorEvent'
    -&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent')
-&gt; Getting
     (First (OnChainTx, RedeemerReport))
     (EmulatorTimeEvent EmulatorEvent')
     (OnChainTx, RedeemerReport)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent
 -&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent)
-&gt; EmulatorEvent'
-&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((ChainEvent
  -&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent)
 -&gt; EmulatorEvent'
 -&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent')
-&gt; (((OnChainTx, RedeemerReport)
     -&gt; Const
          (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
    -&gt; ChainEvent
    -&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent)
-&gt; ((OnChainTx, RedeemerReport)
    -&gt; Const
         (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
-&gt; EmulatorEvent'
-&gt; Const (First (OnChainTx, RedeemerReport)) EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ValidationResult
 -&gt; Const (First (OnChainTx, RedeemerReport)) ValidationResult)
-&gt; ChainEvent
-&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent
Prism' ChainEvent ValidationResult
</span><span class="hs-identifier hs-var">_TxnValidation</span></span><span> </span><span class="annot"><span class="annottext">((ValidationResult
  -&gt; Const (First (OnChainTx, RedeemerReport)) ValidationResult)
 -&gt; ChainEvent
 -&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent)
-&gt; (((OnChainTx, RedeemerReport)
     -&gt; Const
          (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
    -&gt; ValidationResult
    -&gt; Const (First (OnChainTx, RedeemerReport)) ValidationResult)
-&gt; ((OnChainTx, RedeemerReport)
    -&gt; Const
         (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
-&gt; ChainEvent
-&gt; Const (First (OnChainTx, RedeemerReport)) ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((OnChainTx, RedeemerReport)
 -&gt; Const
      (First (OnChainTx, RedeemerReport)) (OnChainTx, RedeemerReport))
-&gt; ValidationResult
-&gt; Const (First (OnChainTx, RedeemerReport)) ValidationResult
Prism' ValidationResult (OnChainTx, RedeemerReport)
</span><span class="hs-identifier hs-var">_Success</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold (OnChainTx, RedeemerReport) [(OnChainTx, RedeemerReport)]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="hs-comment">-- | Unbalanced transactions that are sent to the wallet for balancing</span><span>
</span><span id="line-115"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletTxBalanceEvents"><span class="hs-identifier hs-type">walletTxBalanceEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UnbalancedTx</span></span><span class="hs-special">]</span><span>
</span><span id="line-116"></span><span id="walletTxBalanceEvents"><span class="annot"><span class="annottext">walletTxBalanceEvents :: EmulatorEventFold [UnbalancedTx]
</span><a href="Wallet.Emulator.Folds.html#walletTxBalanceEvents"><span class="hs-identifier hs-var hs-var">walletTxBalanceEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx, UtxoIndex) -&gt; UnbalancedTx)
-&gt; [(CardanoBuildTx, UtxoIndex)] -&gt; [UnbalancedTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; UtxoIndex -&gt; UnbalancedTx)
-&gt; (CardanoBuildTx, UtxoIndex) -&gt; UnbalancedTx
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx -&gt; UtxoIndex -&gt; UnbalancedTx
</span><span class="hs-identifier hs-var">UnbalancedCardanoTx</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(CardanoBuildTx, UtxoIndex)] -&gt; [UnbalancedTx])
-&gt; Fold
     (EmulatorTimeEvent EmulatorEvent') [(CardanoBuildTx, UtxoIndex)]
-&gt; EmulatorEventFold [UnbalancedTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (CardanoBuildTx, UtxoIndex))
-&gt; Fold (CardanoBuildTx, UtxoIndex) [(CardanoBuildTx, UtxoIndex)]
-&gt; Fold
     (EmulatorTimeEvent EmulatorEvent') [(CardanoBuildTx, UtxoIndex)]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First (CardanoBuildTx, UtxoIndex))
  (EmulatorTimeEvent EmulatorEvent')
  (CardanoBuildTx, UtxoIndex)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (CardanoBuildTx, UtxoIndex)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent'
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (CardanoBuildTx, UtxoIndex))
     (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent'
  -&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (CardanoBuildTx, UtxoIndex))
      (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((CardanoBuildTx, UtxoIndex)
     -&gt; Const
          (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
    -&gt; EmulatorEvent'
    -&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent')
-&gt; Getting
     (First (CardanoBuildTx, UtxoIndex))
     (EmulatorTimeEvent EmulatorEvent')
     (CardanoBuildTx, UtxoIndex)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Wallet, WalletEvent)
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent))
-&gt; EmulatorEvent'
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent'
Prism' EmulatorEvent' (Wallet, WalletEvent)
</span><a href="Wallet.Emulator.MultiAgent.html#walletEvent%27"><span class="hs-identifier hs-var">walletEvent'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Wallet, WalletEvent)
  -&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent))
 -&gt; EmulatorEvent'
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent')
-&gt; (((CardanoBuildTx, UtxoIndex)
     -&gt; Const
          (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
    -&gt; (Wallet, WalletEvent)
    -&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent))
-&gt; ((CardanoBuildTx, UtxoIndex)
    -&gt; Const
         (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
-&gt; EmulatorEvent'
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletEvent
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent)
-&gt; (Wallet, WalletEvent)
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((WalletEvent
  -&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent)
 -&gt; (Wallet, WalletEvent)
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent))
-&gt; (((CardanoBuildTx, UtxoIndex)
     -&gt; Const
          (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
    -&gt; WalletEvent
    -&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent)
-&gt; ((CardanoBuildTx, UtxoIndex)
    -&gt; Const
         (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
-&gt; (Wallet, WalletEvent)
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) (Wallet, WalletEvent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxBalanceMsg
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) TxBalanceMsg)
-&gt; WalletEvent
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent
Prism' WalletEvent TxBalanceMsg
</span><a href="Wallet.Emulator.Wallet.html#_TxBalanceLog"><span class="hs-identifier hs-var">_TxBalanceLog</span></a></span><span> </span><span class="annot"><span class="annottext">((TxBalanceMsg
  -&gt; Const (First (CardanoBuildTx, UtxoIndex)) TxBalanceMsg)
 -&gt; WalletEvent
 -&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent)
-&gt; (((CardanoBuildTx, UtxoIndex)
     -&gt; Const
          (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
    -&gt; TxBalanceMsg
    -&gt; Const (First (CardanoBuildTx, UtxoIndex)) TxBalanceMsg)
-&gt; ((CardanoBuildTx, UtxoIndex)
    -&gt; Const
         (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
-&gt; WalletEvent
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) WalletEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx, UtxoIndex)
 -&gt; Const
      (First (CardanoBuildTx, UtxoIndex)) (CardanoBuildTx, UtxoIndex))
-&gt; TxBalanceMsg
-&gt; Const (First (CardanoBuildTx, UtxoIndex)) TxBalanceMsg
Prism' TxBalanceMsg (CardanoBuildTx, UtxoIndex)
</span><span class="hs-identifier hs-var">_BalancingUnbalancedTx</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold (CardanoBuildTx, UtxoIndex) [(CardanoBuildTx, UtxoIndex)]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="hs-comment">-- | Min lovelace of 'txOut's from adjusted unbalanced transactions for all wallets</span><span>
</span><span id="line-119"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletsAdjustedTxEvents"><span class="hs-identifier hs-type">walletsAdjustedTxEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Lovelace</span></span><span class="hs-special">]</span><span>
</span><span id="line-120"></span><span id="walletsAdjustedTxEvents"><span class="annot"><span class="annottext">walletsAdjustedTxEvents :: EmulatorEventFold [Lovelace]
</span><a href="Wallet.Emulator.Folds.html#walletsAdjustedTxEvents"><span class="hs-identifier hs-var hs-var">walletsAdjustedTxEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Lovelace -&gt; [Lovelace]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">(Set Lovelace -&gt; [Lovelace])
-&gt; ([[Lovelace]] -&gt; Set Lovelace) -&gt; [[Lovelace]] -&gt; [Lovelace]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Lovelace] -&gt; Set Lovelace
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Lovelace] -&gt; Set Lovelace)
-&gt; ([[Lovelace]] -&gt; [Lovelace]) -&gt; [[Lovelace]] -&gt; Set Lovelace
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[Lovelace]] -&gt; [Lovelace]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[Lovelace]] -&gt; [Lovelace])
-&gt; Fold (EmulatorTimeEvent EmulatorEvent') [[Lovelace]]
-&gt; EmulatorEventFold [Lovelace]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe [Lovelace])
-&gt; Fold [Lovelace] [[Lovelace]]
-&gt; Fold (EmulatorTimeEvent EmulatorEvent') [[Lovelace]]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First [Lovelace]) (EmulatorTimeEvent EmulatorEvent') [Lovelace]
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe [Lovelace]
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First [Lovelace]) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (First [Lovelace]) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First [Lovelace]) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (First [Lovelace]) (EmulatorTimeEvent EmulatorEvent'))
-&gt; (([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
    -&gt; EmulatorEvent' -&gt; Const (First [Lovelace]) EmulatorEvent')
-&gt; Getting
     (First [Lovelace]) (EmulatorTimeEvent EmulatorEvent') [Lovelace]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Wallet, WalletEvent)
 -&gt; Const (First [Lovelace]) (Wallet, WalletEvent))
-&gt; EmulatorEvent' -&gt; Const (First [Lovelace]) EmulatorEvent'
Prism' EmulatorEvent' (Wallet, WalletEvent)
</span><a href="Wallet.Emulator.MultiAgent.html#walletEvent%27"><span class="hs-identifier hs-var">walletEvent'</span></a></span><span> </span><span class="annot"><span class="annottext">(((Wallet, WalletEvent)
  -&gt; Const (First [Lovelace]) (Wallet, WalletEvent))
 -&gt; EmulatorEvent' -&gt; Const (First [Lovelace]) EmulatorEvent')
-&gt; (([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
    -&gt; (Wallet, WalletEvent)
    -&gt; Const (First [Lovelace]) (Wallet, WalletEvent))
-&gt; ([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
-&gt; EmulatorEvent'
-&gt; Const (First [Lovelace]) EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(WalletEvent -&gt; Const (First [Lovelace]) WalletEvent)
-&gt; (Wallet, WalletEvent)
-&gt; Const (First [Lovelace]) (Wallet, WalletEvent)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((WalletEvent -&gt; Const (First [Lovelace]) WalletEvent)
 -&gt; (Wallet, WalletEvent)
 -&gt; Const (First [Lovelace]) (Wallet, WalletEvent))
-&gt; (([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
    -&gt; WalletEvent -&gt; Const (First [Lovelace]) WalletEvent)
-&gt; ([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
-&gt; (Wallet, WalletEvent)
-&gt; Const (First [Lovelace]) (Wallet, WalletEvent)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(RequestHandlerLogMsg
 -&gt; Const (First [Lovelace]) RequestHandlerLogMsg)
-&gt; WalletEvent -&gt; Const (First [Lovelace]) WalletEvent
Prism' WalletEvent RequestHandlerLogMsg
</span><a href="Wallet.Emulator.Wallet.html#_RequestHandlerLog"><span class="hs-identifier hs-var">_RequestHandlerLog</span></a></span><span> </span><span class="annot"><span class="annottext">((RequestHandlerLogMsg
  -&gt; Const (First [Lovelace]) RequestHandlerLogMsg)
 -&gt; WalletEvent -&gt; Const (First [Lovelace]) WalletEvent)
-&gt; (([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
    -&gt; RequestHandlerLogMsg
    -&gt; Const (First [Lovelace]) RequestHandlerLogMsg)
-&gt; ([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
-&gt; WalletEvent
-&gt; Const (First [Lovelace]) WalletEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([Lovelace] -&gt; Const (First [Lovelace]) [Lovelace])
-&gt; RequestHandlerLogMsg
-&gt; Const (First [Lovelace]) RequestHandlerLogMsg
Prism' RequestHandlerLogMsg [Lovelace]
</span><a href="Wallet.Emulator.LogMessages.html#_AdjustingUnbalancedTx"><span class="hs-identifier hs-var">_AdjustingUnbalancedTx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold [Lovelace] [[Lovelace]]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#mkTxLogs"><span class="hs-identifier hs-type">mkTxLogs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contract.Request.html#MkTxLog"><span class="hs-identifier hs-type">MkTxLog</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span id="mkTxLogs"><span class="annot"><span class="annottext">mkTxLogs :: EmulatorEventFold [MkTxLog]
</span><a href="Wallet.Emulator.Folds.html#mkTxLogs"><span class="hs-identifier hs-var hs-var">mkTxLogs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680565852"><span class="hs-identifier hs-type">getTxLogEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Request.html#MkTxLog"><span class="hs-identifier hs-type">MkTxLog</span></a></span><span>
</span><span id="line-125"></span><span>        </span><span id="local-6989586621680565852"><span class="annot"><span class="annottext">getTxLogEvent :: ContractInstanceMsg -&gt; Maybe MkTxLog
</span><a href="#local-6989586621680565852"><span class="hs-identifier hs-var hs-var">getTxLogEvent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractLog"><span class="hs-identifier hs-type">ContractLog</span></a></span><span> </span><span id="local-6989586621680565851"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565851"><span class="hs-identifier hs-var">vl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Result MkTxLog
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><span class="hs-identifier hs-var">JSON.fromJSON</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565851"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-126"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">JSON.Error</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe MkTxLog
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-127"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">JSON.Success</span></span><span> </span><span id="local-6989586621680565847"><span class="annot"><span class="annottext">MkTxLog
</span><a href="#local-6989586621680565847"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxLog -&gt; Maybe MkTxLog
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">MkTxLog
</span><a href="#local-6989586621680565847"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><a href="#local-6989586621680565852"><span class="hs-identifier hs-var">getTxLogEvent</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe MkTxLog
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><a href="#local-6989586621680565846"><span class="hs-identifier hs-type">flt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Request.html#MkTxLog"><span class="hs-identifier hs-type">MkTxLog</span></a></span><span>
</span><span id="line-131"></span><span>        </span><span id="local-6989586621680565846"><span class="annot"><span class="annottext">flt :: EmulatorTimeEvent EmulatorEvent' -&gt; Maybe MkTxLog
</span><a href="#local-6989586621680565846"><span class="hs-identifier hs-var hs-var">flt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent ContractInstanceLog -&gt; ContractInstanceMsg)
-&gt; Maybe (EmulatorTimeEvent ContractInstanceLog)
-&gt; Maybe ContractInstanceMsg
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  ContractInstanceMsg
  (EmulatorTimeEvent ContractInstanceLog)
  ContractInstanceMsg
-&gt; EmulatorTimeEvent ContractInstanceLog -&gt; ContractInstanceMsg
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ContractInstanceLog
 -&gt; Const ContractInstanceMsg ContractInstanceLog)
-&gt; EmulatorTimeEvent ContractInstanceLog
-&gt; Const
     ContractInstanceMsg (EmulatorTimeEvent ContractInstanceLog)
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((ContractInstanceLog
  -&gt; Const ContractInstanceMsg ContractInstanceLog)
 -&gt; EmulatorTimeEvent ContractInstanceLog
 -&gt; Const
      ContractInstanceMsg (EmulatorTimeEvent ContractInstanceLog))
-&gt; ((ContractInstanceMsg
     -&gt; Const ContractInstanceMsg ContractInstanceMsg)
    -&gt; ContractInstanceLog
    -&gt; Const ContractInstanceMsg ContractInstanceLog)
-&gt; Getting
     ContractInstanceMsg
     (EmulatorTimeEvent ContractInstanceLog)
     ContractInstanceMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg
 -&gt; Const ContractInstanceMsg ContractInstanceMsg)
-&gt; ContractInstanceLog
-&gt; Const ContractInstanceMsg ContractInstanceLog
Lens' ContractInstanceLog ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#cilMessage"><span class="hs-identifier hs-var">cilMessage</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe (EmulatorTimeEvent ContractInstanceLog)
 -&gt; Maybe ContractInstanceMsg)
-&gt; (EmulatorTimeEvent EmulatorEvent'
    -&gt; Maybe (EmulatorTimeEvent ContractInstanceLog))
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe ContractInstanceMsg
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Maybe ContractInstanceLog)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent ContractInstanceLog)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
-&gt; EmulatorEvent' -&gt; Maybe ContractInstanceLog
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
Prism' EmulatorEvent' ContractInstanceLog
</span><a href="Wallet.Emulator.MultiAgent.html#instanceEvent"><span class="hs-identifier hs-var">instanceEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ContractInstanceMsg)
-&gt; (ContractInstanceMsg -&gt; Maybe MkTxLog)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe MkTxLog
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Maybe MkTxLog
</span><a href="#local-6989586621680565852"><span class="hs-identifier hs-var">getTxLogEvent</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe MkTxLog)
-&gt; Fold MkTxLog [MkTxLog] -&gt; EmulatorEventFold [MkTxLog]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent' -&gt; Maybe MkTxLog
</span><a href="#local-6989586621680565846"><span class="hs-identifier hs-var">flt</span></a></span><span> </span><span class="annot"><span class="annottext">Fold MkTxLog [MkTxLog]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span class="hs-comment">-- | The state of a contract instance, recovered from the emulator log.</span><span>
</span><span id="line-135"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-type">instanceState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-136"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680566121"><span class="annot"><a href="#local-6989586621680566121"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680566120"><span class="annot"><a href="#local-6989586621680566120"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680566119"><span class="annot"><a href="#local-6989586621680566119"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680566118"><span class="annot"><a href="#local-6989586621680566118"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680566122"><span class="annot"><a href="#local-6989586621680566122"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-137"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680566122"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566121"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566121"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566120"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566119"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566118"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566122"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier hs-type">ContractInstanceState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566121"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566120"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566119"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566118"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span id="instanceState"><span class="annot"><span class="annottext">instanceState :: Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var hs-var">instanceState</span></a></span></span><span> </span><span id="local-6989586621680565843"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565843"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621680565842"><span class="annot"><span class="annottext">ContractInstanceTag
</span><a href="#local-6989586621680565842"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680565841"><span class="hs-identifier hs-type">flt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621680565841"><span class="annot"><span class="annottext">flt :: EmulatorTimeEvent EmulatorEvent' -&gt; Maybe (Response Value)
</span><a href="#local-6989586621680565841"><span class="hs-identifier hs-var hs-var">flt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting
  (First (Response Value))
  (EmulatorTimeEvent EmulatorEvent')
  (Response Value)
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe (Response Value)
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First (Response Value)) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const
     (First (Response Value)) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First (Response Value)) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const
      (First (Response Value)) (EmulatorTimeEvent EmulatorEvent'))
-&gt; ((Response Value
     -&gt; Const (First (Response Value)) (Response Value))
    -&gt; EmulatorEvent' -&gt; Const (First (Response Value)) EmulatorEvent')
-&gt; Getting
     (First (Response Value))
     (EmulatorTimeEvent EmulatorEvent')
     (Response Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceLog
 -&gt; Const (First (Response Value)) ContractInstanceLog)
-&gt; EmulatorEvent' -&gt; Const (First (Response Value)) EmulatorEvent'
Prism' EmulatorEvent' ContractInstanceLog
</span><a href="Wallet.Emulator.MultiAgent.html#instanceEvent"><span class="hs-identifier hs-var">instanceEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((ContractInstanceLog
  -&gt; Const (First (Response Value)) ContractInstanceLog)
 -&gt; EmulatorEvent' -&gt; Const (First (Response Value)) EmulatorEvent')
-&gt; ((Response Value
     -&gt; Const (First (Response Value)) (Response Value))
    -&gt; ContractInstanceLog
    -&gt; Const (First (Response Value)) ContractInstanceLog)
-&gt; (Response Value
    -&gt; Const (First (Response Value)) (Response Value))
-&gt; EmulatorEvent'
-&gt; Const (First (Response Value)) EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceLog -&gt; Bool)
-&gt; Optic'
     (-&gt;)
     (Const (First (Response Value)))
     ContractInstanceLog
     ContractInstanceLog
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) a.
(Choice p, Applicative f) =&gt;
(a -&gt; Bool) -&gt; Optic' p f a a
</span><span class="hs-identifier hs-var">filtered</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceTag -&gt; ContractInstanceTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(==)</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceTag
</span><a href="#local-6989586621680565842"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceTag -&gt; Bool)
-&gt; (ContractInstanceLog -&gt; ContractInstanceTag)
-&gt; ContractInstanceLog
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContractInstanceTag ContractInstanceLog ContractInstanceTag
-&gt; ContractInstanceLog -&gt; ContractInstanceTag
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting ContractInstanceTag ContractInstanceLog ContractInstanceTag
Lens' ContractInstanceLog ContractInstanceTag
</span><a href="Plutus.Trace.Emulator.Types.html#cilTag"><span class="hs-identifier hs-var">cilTag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Optic'
  (-&gt;)
  (Const (First (Response Value)))
  ContractInstanceLog
  ContractInstanceLog
-&gt; ((Response Value
     -&gt; Const (First (Response Value)) (Response Value))
    -&gt; ContractInstanceLog
    -&gt; Const (First (Response Value)) ContractInstanceLog)
-&gt; (Response Value
    -&gt; Const (First (Response Value)) (Response Value))
-&gt; ContractInstanceLog
-&gt; Const (First (Response Value)) ContractInstanceLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg
 -&gt; Const (First (Response Value)) ContractInstanceMsg)
-&gt; ContractInstanceLog
-&gt; Const (First (Response Value)) ContractInstanceLog
Lens' ContractInstanceLog ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#cilMessage"><span class="hs-identifier hs-var">cilMessage</span></a></span><span> </span><span class="annot"><span class="annottext">((ContractInstanceMsg
  -&gt; Const (First (Response Value)) ContractInstanceMsg)
 -&gt; ContractInstanceLog
 -&gt; Const (First (Response Value)) ContractInstanceLog)
-&gt; ((Response Value
     -&gt; Const (First (Response Value)) (Response Value))
    -&gt; ContractInstanceMsg
    -&gt; Const (First (Response Value)) ContractInstanceMsg)
-&gt; (Response Value
    -&gt; Const (First (Response Value)) (Response Value))
-&gt; ContractInstanceLog
-&gt; Const (First (Response Value)) ContractInstanceLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Response Value -&gt; Const (First (Response Value)) (Response Value))
-&gt; ContractInstanceMsg
-&gt; Const (First (Response Value)) ContractInstanceMsg
Prism' ContractInstanceMsg (Response Value)
</span><a href="Plutus.Trace.Emulator.Types.html#_HandledRequest"><span class="hs-identifier hs-var">_HandledRequest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>        </span><span class="annot"><a href="#local-6989586621680565839"><span class="hs-identifier hs-type">decode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680566157"><span class="annot"><a href="#local-6989586621680566157"><span class="hs-identifier hs-type">effs'</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680566157"><span class="hs-identifier hs-type">effs'</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680566157"><span class="hs-identifier hs-type">effs'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>        </span><span id="local-6989586621680565839"><span class="annot"><span class="annottext">decode :: EmulatorTimeEvent EmulatorEvent'
-&gt; Eff effs' (Maybe (Response PABResp))
</span><a href="#local-6989586621680565839"><span class="hs-identifier hs-var hs-var">decode</span></a></span></span><span> </span><span id="local-6989586621680565838"><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565838"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent' -&gt; Maybe (Response Value)
</span><a href="#local-6989586621680565841"><span class="hs-identifier hs-var">flt</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
</span><a href="#local-6989586621680565838"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-149"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Response Value)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp) -&gt; Eff effs' (Maybe (Response PABResp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-150"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680565837"><span class="annot"><span class="annottext">Response Value
</span><a href="#local-6989586621680565837"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Result PABResp)
-&gt; Response Value -&gt; Result (Response PABResp)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FromJSON PABResp =&gt; Value -&gt; Result PABResp
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><span class="hs-identifier hs-var">JSON.fromJSON</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Response Value
</span><a href="#local-6989586621680565837"><span class="hs-identifier hs-var">response</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-151"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">JSON.Error</span></span><span> </span><span id="local-6989586621680565836"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680565836"><span class="hs-identifier hs-var">e'</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmulatorFoldErr -&gt; Eff effs' (Maybe (Response PABResp))
forall e (effs :: [* -&gt; *]) a.
Member (Error e) effs =&gt;
e -&gt; Eff effs a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(EmulatorFoldErr -&gt; Eff effs' (Maybe (Response PABResp)))
-&gt; EmulatorFoldErr -&gt; Eff effs' (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Response Value -&gt; EmulatorFoldErr
</span><a href="Wallet.Emulator.Folds.html#InstanceStateJSONDecodingError"><span class="hs-identifier hs-var">InstanceStateJSONDecodingError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680565836"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Response Value
</span><a href="#local-6989586621680565837"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-152"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">JSON.Success</span></span><span> </span><span id="local-6989586621680565834"><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680565834"><span class="hs-identifier hs-var">e'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp) -&gt; Eff effs' (Maybe (Response PABResp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Response PABResp -&gt; Maybe (Response PABResp)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680565834"><span class="hs-identifier hs-var">e'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Eff effs (Maybe (Response PABResp)))
-&gt; FoldM
     (Eff effs)
     (Response PABResp)
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
forall (m :: * -&gt; *) a b r.
Monad m =&gt;
(a -&gt; m (Maybe b)) -&gt; FoldM m b r -&gt; FoldM m a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybeM"><span class="hs-identifier hs-var">preMapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
-&gt; Eff effs (Maybe (Response PABResp))
forall (effs' :: [* -&gt; *]).
Member (Error EmulatorFoldErr) effs' =&gt;
EmulatorTimeEvent EmulatorEvent'
-&gt; Eff effs' (Maybe (Response PABResp))
</span><a href="#local-6989586621680565839"><span class="hs-identifier hs-var">decode</span></a></span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (Response PABResp)
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a)))
-&gt; FoldM
     (Eff effs)
     (Response PABResp)
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Fold (Response PABResp) (Maybe (ContractInstanceState w s e a))
-&gt; FoldM
     (Eff effs)
     (Response PABResp)
     (Maybe (ContractInstanceState w s e a))
forall (m :: * -&gt; *) a b. Monad m =&gt; Fold a b -&gt; FoldM m a b
</span><span class="hs-identifier hs-var">L.generalize</span></span><span> </span><span class="annot"><span class="annottext">(Fold (Response PABResp) (Maybe (ContractInstanceState w s e a))
 -&gt; FoldM
      (Eff effs)
      (Response PABResp)
      (Maybe (ContractInstanceState w s e a)))
-&gt; Fold (Response PABResp) (Maybe (ContractInstanceState w s e a))
-&gt; FoldM
     (Eff effs)
     (Response PABResp)
     (Maybe (ContractInstanceState w s e a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceStateInternal w s e a)
 -&gt; Response PABResp
 -&gt; Maybe (ContractInstanceStateInternal w s e a))
-&gt; Maybe (ContractInstanceStateInternal w s e a)
-&gt; (Maybe (ContractInstanceStateInternal w s e a)
    -&gt; Maybe (ContractInstanceState w s e a))
-&gt; Fold (Response PABResp) (Maybe (ContractInstanceState w s e a))
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><span class="hs-identifier hs-var">Fold</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680565832"><span class="annot"><span class="annottext">Maybe (ContractInstanceStateInternal w s e a)
</span><a href="#local-6989586621680565832"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680565831"><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680565831"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ContractInstanceStateInternal w s e a)
</span><a href="#local-6989586621680565832"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ContractInstanceStateInternal w s e a)
-&gt; (ContractInstanceStateInternal w s e a
    -&gt; Maybe (ContractInstanceStateInternal w s e a))
-&gt; Maybe (ContractInstanceStateInternal w s e a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Response PABResp
-&gt; ContractInstanceStateInternal w s e a
-&gt; Maybe (ContractInstanceStateInternal w s e a)
forall w (s :: Row *) e a.
Monoid w =&gt;
Response PABResp
-&gt; ContractInstanceStateInternal w s e a
-&gt; Maybe (ContractInstanceStateInternal w s e a)
</span><a href="Plutus.Trace.Emulator.Types.html#addEventInstanceState"><span class="hs-identifier hs-var">addEventInstanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680565831"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e a
-&gt; Maybe (ContractInstanceStateInternal w s e a)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e a
 -&gt; Maybe (ContractInstanceStateInternal w s e a))
-&gt; ContractInstanceStateInternal w s e a
-&gt; Maybe (ContractInstanceStateInternal w s e a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a -&gt; ContractInstanceStateInternal w s e a
forall w (s :: Row *) e a.
Monoid w =&gt;
Contract w s e a -&gt; ContractInstanceStateInternal w s e a
</span><a href="Plutus.Trace.Emulator.Types.html#emptyInstanceState"><span class="hs-identifier hs-var">emptyInstanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565843"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e a
 -&gt; ContractInstanceState w s e a)
-&gt; Maybe (ContractInstanceStateInternal w s e a)
-&gt; Maybe (ContractInstanceState w s e a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e a
-&gt; ContractInstanceState w s e a
forall w (s :: Row *) e a.
ContractInstanceStateInternal w s e a
-&gt; ContractInstanceState w s e a
</span><a href="Plutus.Trace.Emulator.Types.html#toInstanceState"><span class="hs-identifier hs-var">toInstanceState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span class="hs-comment">-- | The list of open requests of the contract instance at its latest iteration</span><span>
</span><span id="line-157"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceRequests"><span class="hs-identifier hs-type">instanceRequests</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565830"><span class="annot"><a href="#local-6989586621680565830"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565829"><span class="annot"><a href="#local-6989586621680565829"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565828"><span class="annot"><a href="#local-6989586621680565828"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565827"><span class="annot"><a href="#local-6989586621680565827"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680565826"><span class="annot"><a href="#local-6989586621680565826"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565826"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565830"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565830"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565829"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565828"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565827"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-163"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565826"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier hs-type">PABReq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-165"></span><span id="instanceRequests"><span class="annot"><span class="annottext">instanceRequests :: Contract w s e a
-&gt; ContractInstanceTag -&gt; EmulatorEventFoldM effs [Request PABReq]
</span><a href="Wallet.Emulator.Folds.html#instanceRequests"><span class="hs-identifier hs-var hs-var">instanceRequests</span></a></span></span><span> </span><span id="local-6989586621680565825"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565825"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceState w s e a) -&gt; [Request PABReq])
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs [Request PABReq]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ContractInstanceState w s e a) -&gt; [Request PABReq]
forall w (s :: Row *) e a.
Maybe (ContractInstanceState w s e a) -&gt; [Request PABReq]
</span><a href="#local-6989586621680565824"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (EmulatorTimeEvent EmulatorEvent')
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs [Request PABReq])
-&gt; (ContractInstanceTag
    -&gt; FoldM
         (Eff effs)
         (EmulatorTimeEvent EmulatorEvent')
         (Maybe (ContractInstanceState w s e a)))
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs [Request PABReq]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
-&gt; ContractInstanceTag
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
forall w (s :: Row *) e a (effs :: [* -&gt; *]).
(Member (Error EmulatorFoldErr) effs, Monoid w) =&gt;
Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var">instanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565825"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-166"></span><span>    </span><span id="local-6989586621680565824"><span class="annot"><span class="annottext">g :: Maybe (ContractInstanceState w s e a) -&gt; [Request PABReq]
</span><a href="#local-6989586621680565824"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Request PABReq]
-&gt; (ContractInstanceState w s e a -&gt; [Request PABReq])
-&gt; Maybe (ContractInstanceState w s e a)
-&gt; [Request PABReq]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Requests PABReq -&gt; [Request PABReq]
forall o. Requests o -&gt; [Request o]
</span><a href="Plutus.Contract.Resumable.html#unRequests"><span class="hs-identifier hs-var hs-var">State.unRequests</span></a></span><span> </span><span class="annot"><span class="annottext">(Requests PABReq -&gt; [Request PABReq])
-&gt; (ContractInstanceState w s e a -&gt; Requests PABReq)
-&gt; ContractInstanceState w s e a
-&gt; [Request PABReq]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ResumableResult w e PABResp PABReq a -&gt; Requests PABReq
forall w e i o a. ResumableResult w e i o a -&gt; Requests o
</span><a href="Plutus.Contract.Types.html#_requests"><span class="hs-identifier hs-var hs-var">_requests</span></a></span><span> </span><span class="annot"><span class="annottext">(ResumableResult w e PABResp PABReq a -&gt; Requests PABReq)
-&gt; (ContractInstanceState w s e a
    -&gt; ResumableResult w e PABResp PABReq a)
-&gt; ContractInstanceState w s e a
-&gt; Requests PABReq
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
forall w (s :: Row *) e a.
ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#instContractState"><span class="hs-identifier hs-var hs-var">instContractState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-comment">-- | The unbalanced transactions generated by the contract instance.</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceTransactions"><span class="hs-identifier hs-type">instanceTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565821"><span class="annot"><a href="#local-6989586621680565821"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565820"><span class="annot"><a href="#local-6989586621680565820"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565819"><span class="annot"><a href="#local-6989586621680565819"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565818"><span class="annot"><a href="#local-6989586621680565818"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680565817"><span class="annot"><a href="#local-6989586621680565817"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565817"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565821"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565821"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565820"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565819"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565818"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565817"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UnbalancedTx</span></span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span id="instanceTransactions"><span class="annot"><span class="annottext">instanceTransactions :: Contract w s e a
-&gt; ContractInstanceTag -&gt; EmulatorEventFoldM effs [UnbalancedTx]
</span><a href="Wallet.Emulator.Folds.html#instanceTransactions"><span class="hs-identifier hs-var hs-var">instanceTransactions</span></a></span></span><span> </span><span id="local-6989586621680565816"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565816"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceState w s e a) -&gt; [UnbalancedTx])
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs [UnbalancedTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ContractInstanceState w s e a) -&gt; [UnbalancedTx]
</span><a href="#local-6989586621680565815"><span class="hs-identifier hs-var">g</span></a></span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (EmulatorTimeEvent EmulatorEvent')
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs [UnbalancedTx])
-&gt; (ContractInstanceTag
    -&gt; FoldM
         (Eff effs)
         (EmulatorTimeEvent EmulatorEvent')
         (Maybe (ContractInstanceState w s e a)))
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs [UnbalancedTx]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
-&gt; ContractInstanceTag
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
forall w (s :: Row *) e a (effs :: [* -&gt; *]).
(Member (Error EmulatorFoldErr) effs, Monoid w) =&gt;
Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var">instanceState</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565821"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565820"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565819"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565818"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565817"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565816"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="#local-6989586621680565815"><span class="hs-identifier hs-type">g</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier hs-type">ContractInstanceState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565821"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565820"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565819"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565818"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">UnbalancedTx</span></span><span class="hs-special">]</span><span>
</span><span id="line-179"></span><span>    </span><span id="local-6989586621680565815"><span class="annot"><span class="annottext">g :: Maybe (ContractInstanceState w s e a) -&gt; [UnbalancedTx]
</span><a href="#local-6989586621680565815"><span class="hs-identifier hs-var hs-var">g</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnbalancedTx]
-&gt; (ContractInstanceState w s e a -&gt; [UnbalancedTx])
-&gt; Maybe (ContractInstanceState w s e a)
-&gt; [UnbalancedTx]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Request PABReq -&gt; Maybe UnbalancedTx)
-&gt; [Request PABReq] -&gt; [UnbalancedTx]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First UnbalancedTx) PABReq UnbalancedTx
-&gt; PABReq -&gt; Maybe UnbalancedTx
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First UnbalancedTx) PABReq UnbalancedTx
Prism' PABReq UnbalancedTx
</span><a href="Plutus.Contract.Effects.html#_BalanceTxReq"><span class="hs-identifier hs-var">_BalanceTxReq</span></a></span><span> </span><span class="annot"><span class="annottext">(PABReq -&gt; Maybe UnbalancedTx)
-&gt; (Request PABReq -&gt; PABReq)
-&gt; Request PABReq
-&gt; Maybe UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Request PABReq -&gt; PABReq
forall o. Request o -&gt; o
</span><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier hs-var hs-var">State.rqRequest</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Request PABReq] -&gt; [UnbalancedTx])
-&gt; (ContractInstanceState w s e a -&gt; [Request PABReq])
-&gt; ContractInstanceState w s e a
-&gt; [UnbalancedTx]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[Request PABReq]] -&gt; [Request PABReq]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[Request PABReq]] -&gt; [Request PABReq])
-&gt; (ContractInstanceState w s e a -&gt; [[Request PABReq]])
-&gt; ContractInstanceState w s e a
-&gt; [Request PABReq]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Seq [Request PABReq] -&gt; [[Request PABReq]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq [Request PABReq] -&gt; [[Request PABReq]])
-&gt; (ContractInstanceState w s e a -&gt; Seq [Request PABReq])
-&gt; ContractInstanceState w s e a
-&gt; [[Request PABReq]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e a -&gt; Seq [Request PABReq]
forall w (s :: Row *) e a.
ContractInstanceState w s e a -&gt; Seq [Request PABReq]
</span><a href="Plutus.Trace.Emulator.Types.html#instHandlersHistory"><span class="hs-identifier hs-var hs-var">instHandlersHistory</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | The reponses received by the contract instance</span><span>
</span><span id="line-183"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceResponses"><span class="hs-identifier hs-type">instanceResponses</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565813"><span class="annot"><a href="#local-6989586621680565813"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565812"><span class="annot"><a href="#local-6989586621680565812"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565811"><span class="annot"><a href="#local-6989586621680565811"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565810"><span class="annot"><a href="#local-6989586621680565810"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680565809"><span class="annot"><a href="#local-6989586621680565809"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565809"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565813"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565813"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565812"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565811"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565810"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565809"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-191"></span><span id="instanceResponses"><span class="annot"><span class="annottext">instanceResponses :: Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs [Response PABResp]
</span><a href="Wallet.Emulator.Folds.html#instanceResponses"><span class="hs-identifier hs-var hs-var">instanceResponses</span></a></span></span><span> </span><span id="local-6989586621680565808"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565808"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceState w s e a) -&gt; [Response PABResp])
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs [Response PABResp]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Response PABResp]
-&gt; (ContractInstanceState w s e a -&gt; [Response PABResp])
-&gt; Maybe (ContractInstanceState w s e a)
-&gt; [Response PABResp]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (Response PABResp) -&gt; [Response PABResp]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (Response PABResp) -&gt; [Response PABResp])
-&gt; (ContractInstanceState w s e a -&gt; Seq (Response PABResp))
-&gt; ContractInstanceState w s e a
-&gt; [Response PABResp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e a -&gt; Seq (Response PABResp)
forall w (s :: Row *) e a.
ContractInstanceState w s e a -&gt; Seq (Response PABResp)
</span><a href="Plutus.Trace.Emulator.Types.html#instEvents"><span class="hs-identifier hs-var hs-var">instEvents</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (EmulatorTimeEvent EmulatorEvent')
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs [Response PABResp])
-&gt; (ContractInstanceTag
    -&gt; FoldM
         (Eff effs)
         (EmulatorTimeEvent EmulatorEvent')
         (Maybe (ContractInstanceState w s e a)))
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs [Response PABResp]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
-&gt; ContractInstanceTag
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
forall w (s :: Row *) e a (effs :: [* -&gt; *]).
(Member (Error EmulatorFoldErr) effs, Monoid w) =&gt;
Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var">instanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565808"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-comment">-- | Accumulated state of the contract instance</span><span>
</span><span id="line-194"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceAccumState"><span class="hs-identifier hs-type">instanceAccumState</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565807"><span class="annot"><a href="#local-6989586621680565807"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565806"><span class="annot"><a href="#local-6989586621680565806"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565805"><span class="annot"><a href="#local-6989586621680565805"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565804"><span class="annot"><a href="#local-6989586621680565804"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680565803"><span class="annot"><a href="#local-6989586621680565803"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565803"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565807"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565807"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565806"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565805"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565804"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565803"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565807"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-202"></span><span id="instanceAccumState"><span class="annot"><span class="annottext">instanceAccumState :: Contract w s e a
-&gt; ContractInstanceTag -&gt; EmulatorEventFoldM effs w
</span><a href="Wallet.Emulator.Folds.html#instanceAccumState"><span class="hs-identifier hs-var hs-var">instanceAccumState</span></a></span></span><span> </span><span id="local-6989586621680565802"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565802"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceState w s e a) -&gt; w)
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs w
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">w
-&gt; (ContractInstanceState w s e a -&gt; w)
-&gt; Maybe (ContractInstanceState w s e a)
-&gt; w
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">w
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResumableResult w e PABResp PABReq a -&gt; w
forall w e i o a. ResumableResult w e i o a -&gt; w
</span><a href="Plutus.Contract.Types.html#_observableState"><span class="hs-identifier hs-var hs-var">_observableState</span></a></span><span> </span><span class="annot"><span class="annottext">(ResumableResult w e PABResp PABReq a -&gt; w)
-&gt; (ContractInstanceState w s e a
    -&gt; ResumableResult w e PABResp PABReq a)
-&gt; ContractInstanceState w s e a
-&gt; w
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
forall w (s :: Row *) e a.
ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#instContractState"><span class="hs-identifier hs-var hs-var">instContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (EmulatorTimeEvent EmulatorEvent')
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs w)
-&gt; (ContractInstanceTag
    -&gt; FoldM
         (Eff effs)
         (EmulatorTimeEvent EmulatorEvent')
         (Maybe (ContractInstanceState w s e a)))
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs w
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
-&gt; ContractInstanceTag
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
forall w (s :: Row *) e a (effs :: [* -&gt; *]).
(Member (Error EmulatorFoldErr) effs, Monoid w) =&gt;
Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var">instanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565802"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | The log messages produced by the contract instance.</span><span>
</span><span id="line-205"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceLog"><span class="hs-identifier hs-type">instanceLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorTimeEvent"><span class="hs-identifier hs-type">EmulatorTimeEvent</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier hs-type">ContractInstanceLog</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-206"></span><span id="instanceLog"><span class="annot"><span class="annottext">instanceLog :: ContractInstanceTag
-&gt; EmulatorEventFold [EmulatorTimeEvent ContractInstanceLog]
</span><a href="Wallet.Emulator.Folds.html#instanceLog"><span class="hs-identifier hs-var hs-var">instanceLog</span></a></span></span><span> </span><span id="local-6989586621680565801"><span class="annot"><span class="annottext">ContractInstanceTag
</span><a href="#local-6989586621680565801"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680565800"><span class="hs-identifier hs-type">flt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorTimeEvent"><span class="hs-identifier hs-type">EmulatorTimeEvent</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier hs-type">ContractInstanceLog</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>        </span><span id="local-6989586621680565800"><span class="annot"><span class="annottext">flt :: EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent ContractInstanceLog)
</span><a href="#local-6989586621680565800"><span class="hs-identifier hs-var hs-var">flt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Maybe ContractInstanceLog)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent ContractInstanceLog)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
-&gt; EmulatorEvent' -&gt; Maybe ContractInstanceLog
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
Prism' EmulatorEvent' ContractInstanceLog
</span><a href="Wallet.Emulator.MultiAgent.html#instanceEvent"><span class="hs-identifier hs-var">instanceEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
-&gt; ((ContractInstanceLog
     -&gt; Const (First ContractInstanceLog) ContractInstanceLog)
    -&gt; ContractInstanceLog
    -&gt; Const (First ContractInstanceLog) ContractInstanceLog)
-&gt; Getting
     (First ContractInstanceLog) EmulatorEvent' ContractInstanceLog
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceLog -&gt; Bool)
-&gt; (ContractInstanceLog
    -&gt; Const (First ContractInstanceLog) ContractInstanceLog)
-&gt; ContractInstanceLog
-&gt; Const (First ContractInstanceLog) ContractInstanceLog
forall (p :: * -&gt; * -&gt; *) (f :: * -&gt; *) a.
(Choice p, Applicative f) =&gt;
(a -&gt; Bool) -&gt; Optic' p f a a
</span><span class="hs-identifier hs-var">filtered</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContractInstanceTag -&gt; ContractInstanceTag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">(==)</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceTag
</span><a href="#local-6989586621680565801"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceTag -&gt; Bool)
-&gt; (ContractInstanceLog -&gt; ContractInstanceTag)
-&gt; ContractInstanceLog
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting ContractInstanceTag ContractInstanceLog ContractInstanceTag
-&gt; ContractInstanceLog -&gt; ContractInstanceTag
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting ContractInstanceTag ContractInstanceLog ContractInstanceTag
Lens' ContractInstanceLog ContractInstanceTag
</span><a href="Plutus.Trace.Emulator.Types.html#cilTag"><span class="hs-identifier hs-var">cilTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (EmulatorTimeEvent ContractInstanceLog))
-&gt; Fold
     (EmulatorTimeEvent ContractInstanceLog)
     [EmulatorTimeEvent ContractInstanceLog]
-&gt; EmulatorEventFold [EmulatorTimeEvent ContractInstanceLog]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent ContractInstanceLog)
</span><a href="#local-6989586621680565800"><span class="hs-identifier hs-var">flt</span></a></span><span> </span><span class="annot"><span class="annottext">Fold
  (EmulatorTimeEvent ContractInstanceLog)
  [EmulatorTimeEvent ContractInstanceLog]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span class="hs-comment">-- | Log and error messages produced by the main (user) thread in the emulator</span><span>
</span><span id="line-212"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#userLog"><span class="hs-identifier hs-type">userLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorTimeEvent"><span class="hs-identifier hs-type">EmulatorTimeEvent</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#UserThreadMsg"><span class="hs-identifier hs-type">UserThreadMsg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-213"></span><span id="userLog"><span class="annot"><span class="annottext">userLog :: EmulatorEventFold [EmulatorTimeEvent UserThreadMsg]
</span><a href="Wallet.Emulator.Folds.html#userLog"><span class="hs-identifier hs-var hs-var">userLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621680565799"><span class="hs-identifier hs-type">flt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorTimeEvent"><span class="hs-identifier hs-type">EmulatorTimeEvent</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#UserThreadMsg"><span class="hs-identifier hs-type">UserThreadMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>        </span><span id="local-6989586621680565799"><span class="annot"><span class="annottext">flt :: EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent UserThreadMsg)
</span><a href="#local-6989586621680565799"><span class="hs-identifier hs-var hs-var">flt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Maybe UserThreadMsg)
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent UserThreadMsg)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First UserThreadMsg) EmulatorEvent' UserThreadMsg
-&gt; EmulatorEvent' -&gt; Maybe UserThreadMsg
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First UserThreadMsg) EmulatorEvent' UserThreadMsg
Prism' EmulatorEvent' UserThreadMsg
</span><a href="Wallet.Emulator.MultiAgent.html#userThreadEvent"><span class="hs-identifier hs-var">userThreadEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent'
 -&gt; Maybe (EmulatorTimeEvent UserThreadMsg))
-&gt; Fold
     (EmulatorTimeEvent UserThreadMsg) [EmulatorTimeEvent UserThreadMsg]
-&gt; EmulatorEventFold [EmulatorTimeEvent UserThreadMsg]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorTimeEvent EmulatorEvent'
-&gt; Maybe (EmulatorTimeEvent UserThreadMsg)
</span><a href="#local-6989586621680565799"><span class="hs-identifier hs-var">flt</span></a></span><span> </span><span class="annot"><span class="annottext">Fold
  (EmulatorTimeEvent UserThreadMsg) [EmulatorTimeEvent UserThreadMsg]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="hs-keyword">data</span><span> </span><span id="Outcome"><span class="annot"><a href="Wallet.Emulator.Folds.html#Outcome"><span class="hs-identifier hs-var">Outcome</span></a></span></span><span> </span><span id="local-6989586621680566066"><span class="annot"><a href="#local-6989586621680566066"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680566065"><span class="annot"><a href="#local-6989586621680566065"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-219"></span><span>    </span><span id="Done"><span class="annot"><a href="Wallet.Emulator.Folds.html#Done"><span class="hs-identifier hs-var">Done</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680566065"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-comment">-- ^ The contract finished without errors and produced a result</span><span>
</span><span id="line-221"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NotDone"><span class="annot"><a href="Wallet.Emulator.Folds.html#NotDone"><span class="hs-identifier hs-var">NotDone</span></a></span></span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-comment">-- ^ The contract is waiting for more input.</span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Failed"><span class="annot"><a href="Wallet.Emulator.Folds.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680566066"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="hs-comment">-- ^ The contract failed with an error.</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680565792"><span id="local-6989586621680565794"><span class="annot"><span class="annottext">Outcome e a -&gt; Outcome e a -&gt; Bool
(Outcome e a -&gt; Outcome e a -&gt; Bool)
-&gt; (Outcome e a -&gt; Outcome e a -&gt; Bool) -&gt; Eq (Outcome e a)
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
forall e a. (Eq a, Eq e) =&gt; Outcome e a -&gt; Outcome e a -&gt; Bool
/= :: Outcome e a -&gt; Outcome e a -&gt; Bool
$c/= :: forall e a. (Eq a, Eq e) =&gt; Outcome e a -&gt; Outcome e a -&gt; Bool
== :: Outcome e a -&gt; Outcome e a -&gt; Bool
$c== :: forall e a. (Eq a, Eq e) =&gt; Outcome e a -&gt; Outcome e a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565785"><span id="local-6989586621680565787"><span id="local-6989586621680565789"><span class="annot"><span class="annottext">Int -&gt; Outcome e a -&gt; ShowS
[Outcome e a] -&gt; ShowS
Outcome e a -&gt; String
(Int -&gt; Outcome e a -&gt; ShowS)
-&gt; (Outcome e a -&gt; String)
-&gt; ([Outcome e a] -&gt; ShowS)
-&gt; Show (Outcome e a)
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
forall e a. (Show a, Show e) =&gt; Int -&gt; Outcome e a -&gt; ShowS
forall e a. (Show a, Show e) =&gt; [Outcome e a] -&gt; ShowS
forall e a. (Show a, Show e) =&gt; Outcome e a -&gt; String
showList :: [Outcome e a] -&gt; ShowS
$cshowList :: forall e a. (Show a, Show e) =&gt; [Outcome e a] -&gt; ShowS
show :: Outcome e a -&gt; String
$cshow :: forall e a. (Show a, Show e) =&gt; Outcome e a -&gt; String
showsPrec :: Int -&gt; Outcome e a -&gt; ShowS
$cshowsPrec :: forall e a. (Show a, Show e) =&gt; Int -&gt; Outcome e a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span id="local-6989586621680566055"><span id="local-6989586621680566056"><span id="local-6989586621680566057"><span id="local-6989586621680566058"><span id="local-6989586621680566059"><span class="annot"><a href="Wallet.Emulator.Folds.html#fromResumableResult"><span class="hs-identifier hs-type">fromResumableResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier hs-type">ResumableResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566059"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566058"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566057"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566056"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566055"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#Outcome"><span class="hs-identifier hs-type">Outcome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566058"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566055"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-228"></span><span id="fromResumableResult"><span class="annot"><span class="annottext">fromResumableResult :: ResumableResult w e i o a -&gt; Outcome e a
</span><a href="Wallet.Emulator.Folds.html#fromResumableResult"><span class="hs-identifier hs-var hs-var">fromResumableResult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(e -&gt; Outcome e a)
-&gt; (Maybe a -&gt; Outcome e a) -&gt; Either e (Maybe a) -&gt; Outcome e a
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; Outcome e a
forall e a. e -&gt; Outcome e a
</span><a href="Wallet.Emulator.Folds.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Outcome e a -&gt; (a -&gt; Outcome e a) -&gt; Maybe a -&gt; Outcome e a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Outcome e a
forall e a. Outcome e a
</span><a href="Wallet.Emulator.Folds.html#NotDone"><span class="hs-identifier hs-var">NotDone</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Outcome e a
forall e a. a -&gt; Outcome e a
</span><a href="Wallet.Emulator.Folds.html#Done"><span class="hs-identifier hs-var">Done</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Either e (Maybe a) -&gt; Outcome e a)
-&gt; (ResumableResult w e i o a -&gt; Either e (Maybe a))
-&gt; ResumableResult w e i o a
-&gt; Outcome e a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ResumableResult w e i o a -&gt; Either e (Maybe a)
forall w e i o a. ResumableResult w e i o a -&gt; Either e (Maybe a)
</span><a href="Plutus.Contract.Types.html#_finalState"><span class="hs-identifier hs-var hs-var">_finalState</span></a></span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="hs-comment">-- | The final state of the instance</span><span>
</span><span id="line-231"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#instanceOutcome"><span class="hs-identifier hs-type">instanceOutcome</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565781"><span class="annot"><a href="#local-6989586621680565781"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565780"><span class="annot"><a href="#local-6989586621680565780"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565779"><span class="annot"><a href="#local-6989586621680565779"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565778"><span class="annot"><a href="#local-6989586621680565778"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680565777"><span class="annot"><a href="#local-6989586621680565777"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-233"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565777"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565781"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565781"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565780"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565779"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565778"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-237"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceTag"><span class="hs-identifier hs-type">ContractInstanceTag</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFoldM"><span class="hs-identifier hs-type">EmulatorEventFoldM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565777"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Emulator.Folds.html#Outcome"><span class="hs-identifier hs-type">Outcome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565779"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565778"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span id="instanceOutcome"><span class="annot"><span class="annottext">instanceOutcome :: Contract w s e a
-&gt; ContractInstanceTag -&gt; EmulatorEventFoldM effs (Outcome e a)
</span><a href="Wallet.Emulator.Folds.html#instanceOutcome"><span class="hs-identifier hs-var hs-var">instanceOutcome</span></a></span></span><span> </span><span id="local-6989586621680565776"><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565776"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><span class="annottext">(Maybe (ContractInstanceState w s e a) -&gt; Outcome e a)
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
-&gt; EmulatorEventFoldM effs (Outcome e a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Outcome e a
-&gt; (ContractInstanceState w s e a -&gt; Outcome e a)
-&gt; Maybe (ContractInstanceState w s e a)
-&gt; Outcome e a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Outcome e a
forall e a. Outcome e a
</span><a href="Wallet.Emulator.Folds.html#NotDone"><span class="hs-identifier hs-var">NotDone</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ResumableResult w e PABResp PABReq a -&gt; Outcome e a
forall w e i o a. ResumableResult w e i o a -&gt; Outcome e a
</span><a href="Wallet.Emulator.Folds.html#fromResumableResult"><span class="hs-identifier hs-var">fromResumableResult</span></a></span><span> </span><span class="annot"><span class="annottext">(ResumableResult w e PABResp PABReq a -&gt; Outcome e a)
-&gt; (ContractInstanceState w s e a
    -&gt; ResumableResult w e PABResp PABReq a)
-&gt; ContractInstanceState w s e a
-&gt; Outcome e a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
forall w (s :: Row *) e a.
ContractInstanceState w s e a
-&gt; ResumableResult w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#instContractState"><span class="hs-identifier hs-var hs-var">instContractState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FoldM
   (Eff effs)
   (EmulatorTimeEvent EmulatorEvent')
   (Maybe (ContractInstanceState w s e a))
 -&gt; EmulatorEventFoldM effs (Outcome e a))
-&gt; (ContractInstanceTag
    -&gt; FoldM
         (Eff effs)
         (EmulatorTimeEvent EmulatorEvent')
         (Maybe (ContractInstanceState w s e a)))
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Outcome e a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
-&gt; ContractInstanceTag
-&gt; FoldM
     (Eff effs)
     (EmulatorTimeEvent EmulatorEvent')
     (Maybe (ContractInstanceState w s e a))
forall w (s :: Row *) e a (effs :: [* -&gt; *]).
(Member (Error EmulatorFoldErr) effs, Monoid w) =&gt;
Contract w s e a
-&gt; ContractInstanceTag
-&gt; EmulatorEventFoldM effs (Maybe (ContractInstanceState w s e a))
</span><a href="Wallet.Emulator.Folds.html#instanceState"><span class="hs-identifier hs-var">instanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e a
</span><a href="#local-6989586621680565776"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span class="hs-comment">-- | Unspent outputs at an address</span><span>
</span><span id="line-243"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#utxoAtAddress"><span class="hs-identifier hs-type">utxoAtAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoAddress</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">UtxoMap</span></span><span>
</span><span id="line-244"></span><span id="utxoAtAddress"><span class="annot"><span class="annottext">utxoAtAddress :: CardanoAddress -&gt; EmulatorEventFold UtxoMap
</span><a href="Wallet.Emulator.Folds.html#utxoAtAddress"><span class="hs-identifier hs-var hs-var">utxoAtAddress</span></a></span></span><span> </span><span id="local-6989586621680565775"><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680565775"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent)
-&gt; Fold ChainEvent UtxoMap -&gt; EmulatorEventFold UtxoMap
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent'))
-&gt; ((ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
    -&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; Getting
     (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
-&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="annot"><span class="annottext">(Fold ChainEvent UtxoMap -&gt; EmulatorEventFold UtxoMap)
-&gt; Fold ChainEvent UtxoMap -&gt; EmulatorEventFold UtxoMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(AddressMap -&gt; ChainEvent -&gt; AddressMap)
-&gt; AddressMap -&gt; (AddressMap -&gt; UtxoMap) -&gt; Fold ChainEvent UtxoMap
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><span class="hs-identifier hs-var">Fold</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ChainEvent -&gt; AddressMap -&gt; AddressMap)
-&gt; AddressMap -&gt; ChainEvent -&gt; AddressMap
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; AddressMap -&gt; AddressMap
</span><a href="#local-6989586621680565773"><span class="hs-identifier hs-var">step</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoAddress -&gt; AddressMap -&gt; AddressMap
</span><span class="hs-identifier hs-var">AM.addAddress</span></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680565775"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">AddressMap
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting UtxoMap AddressMap UtxoMap -&gt; AddressMap -&gt; UtxoMap
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoAddress -&gt; Lens' AddressMap UtxoMap
</span><span class="hs-identifier hs-var">AM.fundsAt</span></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680565775"><span class="hs-identifier hs-var">addr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>        </span><span id="local-6989586621680565773"><span class="annot"><span class="annottext">step :: ChainEvent -&gt; AddressMap -&gt; AddressMap
</span><a href="#local-6989586621680565773"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unwrapped (Endo AddressMap) -&gt; Endo AddressMap)
-&gt; ((OnChainTx -&gt; Endo AddressMap)
    -&gt; Maybe OnChainTx -&gt; Endo AddressMap)
-&gt; (OnChainTx -&gt; Unwrapped (Endo AddressMap))
-&gt; Maybe OnChainTx
-&gt; Unwrapped (Endo AddressMap)
forall (f :: * -&gt; *) (g :: * -&gt; *) s t.
(Functor f, Functor g, Rewrapping s t) =&gt;
(Unwrapped s -&gt; s)
-&gt; (f t -&gt; g s) -&gt; f (Unwrapped t) -&gt; g (Unwrapped s)
</span><span class="hs-identifier hs-var">alaf</span></span><span> </span><span class="annot"><span class="annottext">Unwrapped (Endo AddressMap) -&gt; Endo AddressMap
forall a. (a -&gt; a) -&gt; Endo a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Endo</span></a></span><span> </span><span class="annot"><span class="annottext">(OnChainTx -&gt; Endo AddressMap)
-&gt; Maybe OnChainTx -&gt; Endo AddressMap
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; Unwrapped (Endo AddressMap)
OnChainTx -&gt; AddressMap -&gt; AddressMap
</span><span class="hs-identifier hs-var">AM.updateAddresses</span></span><span> </span><span class="annot"><span class="annottext">(Maybe OnChainTx -&gt; AddressMap -&gt; AddressMap)
-&gt; (ChainEvent -&gt; Maybe OnChainTx)
-&gt; ChainEvent
-&gt; AddressMap
-&gt; AddressMap
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ChainEvent -&gt; Maybe OnChainTx
</span><span class="hs-identifier hs-var">chainEventOnChainTx</span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span class="hs-comment">-- | The total value of unspent outputs at an address</span><span>
</span><span id="line-251"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#valueAtAddress"><span class="hs-identifier hs-type">valueAtAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoAddress</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span>
</span><span id="line-252"></span><span id="valueAtAddress"><span class="annot"><span class="annottext">valueAtAddress :: CardanoAddress -&gt; EmulatorEventFold Value
</span><a href="Wallet.Emulator.Folds.html#valueAtAddress"><span class="hs-identifier hs-var hs-var">valueAtAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UtxoMap -&gt; Value)
-&gt; EmulatorEventFold UtxoMap -&gt; EmulatorEventFold Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((CardanoTx, TxOut) -&gt; Value) -&gt; UtxoMap -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Value
</span><span class="hs-identifier hs-var">txOutValue</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Value)
-&gt; ((CardanoTx, TxOut) -&gt; TxOut) -&gt; (CardanoTx, TxOut) -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoTx, TxOut) -&gt; TxOut
forall a b. (a, b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(EmulatorEventFold UtxoMap -&gt; EmulatorEventFold Value)
-&gt; (CardanoAddress -&gt; EmulatorEventFold UtxoMap)
-&gt; CardanoAddress
-&gt; EmulatorEventFold Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; EmulatorEventFold UtxoMap
</span><a href="Wallet.Emulator.Folds.html#utxoAtAddress"><span class="hs-identifier hs-var">utxoAtAddress</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- | The funds belonging to a wallet</span><span>
</span><span id="line-255"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletFunds"><span class="hs-identifier hs-type">walletFunds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span>
</span><span id="line-256"></span><span id="walletFunds"><span class="annot"><span class="annottext">walletFunds :: Wallet -&gt; EmulatorEventFold Value
</span><a href="Wallet.Emulator.Folds.html#walletFunds"><span class="hs-identifier hs-var hs-var">walletFunds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoAddress -&gt; EmulatorEventFold Value
</span><a href="Wallet.Emulator.Folds.html#valueAtAddress"><span class="hs-identifier hs-var">valueAtAddress</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoAddress -&gt; EmulatorEventFold Value)
-&gt; (Wallet -&gt; CardanoAddress) -&gt; Wallet -&gt; EmulatorEventFold Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; CardanoAddress
</span><a href="Wallet.Emulator.Wallet.html#mockWalletAddress"><span class="hs-identifier hs-var">mockWalletAddress</span></a></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span class="hs-comment">-- | The fees paid by a wallet</span><span>
</span><span id="line-259"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#walletFees"><span class="hs-identifier hs-type">walletFees</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Wallet.html#Wallet"><span class="hs-identifier hs-type">Wallet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.Lovelace</span></span><span>
</span><span id="line-260"></span><span id="walletFees"><span class="annot"><span class="annottext">walletFees :: Wallet -&gt; EmulatorEventFold Lovelace
</span><a href="Wallet.Emulator.Folds.html#walletFees"><span class="hs-identifier hs-var hs-var">walletFees</span></a></span></span><span> </span><span id="local-6989586621680565766"><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621680565766"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxId Lovelace
-&gt; [(OnChainTx, RedeemerReport)]
-&gt; [(CardanoTx, ValidationError, Value)]
-&gt; Lovelace
forall (t :: * -&gt; *) (t :: * -&gt; *) a b b.
(Foldable t, Foldable t) =&gt;
Map TxId a
-&gt; t (OnChainTx, b) -&gt; t (CardanoTx, b, Value) -&gt; Lovelace
</span><a href="#local-6989586621680565765"><span class="hs-identifier hs-var">fees</span></a></span><span> </span><span class="annot"><span class="annottext">(Map TxId Lovelace
 -&gt; [(OnChainTx, RedeemerReport)]
 -&gt; [(CardanoTx, ValidationError, Value)]
 -&gt; Lovelace)
-&gt; Fold (EmulatorTimeEvent EmulatorEvent') (Map TxId Lovelace)
-&gt; Fold
     (EmulatorTimeEvent EmulatorEvent')
     ([(OnChainTx, RedeemerReport)]
      -&gt; [(CardanoTx, ValidationError, Value)] -&gt; Lovelace)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Fold (EmulatorTimeEvent EmulatorEvent') (Map TxId Lovelace)
</span><a href="#local-6989586621680565764"><span class="hs-identifier hs-var">walletSubmittedFees</span></a></span><span> </span><span class="annot"><span class="annottext">Fold
  (EmulatorTimeEvent EmulatorEvent')
  ([(OnChainTx, RedeemerReport)]
   -&gt; [(CardanoTx, ValidationError, Value)] -&gt; Lovelace)
-&gt; EmulatorEventFold [(OnChainTx, RedeemerReport)]
-&gt; Fold
     (EmulatorTimeEvent EmulatorEvent')
     ([(CardanoTx, ValidationError, Value)] -&gt; Lovelace)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorEventFold [(OnChainTx, RedeemerReport)]
</span><a href="Wallet.Emulator.Folds.html#validatedTransactions"><span class="hs-identifier hs-var">validatedTransactions</span></a></span><span> </span><span class="annot"><span class="annottext">Fold
  (EmulatorTimeEvent EmulatorEvent')
  ([(CardanoTx, ValidationError, Value)] -&gt; Lovelace)
-&gt; EmulatorEventFold [(CardanoTx, ValidationError, Value)]
-&gt; EmulatorEventFold Lovelace
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ValidationPhase
-&gt; EmulatorEventFold [(CardanoTx, ValidationError, Value)]
</span><a href="Wallet.Emulator.Folds.html#failedTransactions"><span class="hs-identifier hs-var">failedTransactions</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidationPhase -&gt; Maybe ValidationPhase
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationPhase
</span><span class="hs-identifier hs-var">Phase2</span></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621680565765"><span class="annot"><span class="annottext">fees :: Map TxId a
-&gt; t (OnChainTx, b) -&gt; t (CardanoTx, b, Value) -&gt; Lovelace
</span><a href="#local-6989586621680565765"><span class="hs-identifier hs-var hs-var">fees</span></a></span></span><span> </span><span id="local-6989586621680565763"><span class="annot"><span class="annottext">Map TxId a
</span><a href="#local-6989586621680565763"><span class="hs-identifier hs-var">submitted</span></a></span></span><span> </span><span id="local-6989586621680565762"><span class="annot"><span class="annottext">t (OnChainTx, b)
</span><a href="#local-6989586621680565762"><span class="hs-identifier hs-var">txsV</span></a></span></span><span> </span><span id="local-6989586621680565761"><span class="annot"><span class="annottext">t (CardanoTx, b, Value)
</span><a href="#local-6989586621680565761"><span class="hs-identifier hs-var">txsF</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-263"></span><span>            </span><span class="annot"><span class="annottext">((OnChainTx, b) -&gt; TxId)
-&gt; ((OnChainTx, b) -&gt; Lovelace)
-&gt; Map TxId a
-&gt; t (OnChainTx, b)
-&gt; Lovelace
forall (t :: * -&gt; *) m k t a.
(Foldable t, Monoid m, Ord k) =&gt;
(t -&gt; k) -&gt; (t -&gt; m) -&gt; Map k a -&gt; t t -&gt; m
</span><a href="#local-6989586621680565760"><span class="hs-identifier hs-var">findFees</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680565759"><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565759"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; TxId
</span><span class="hs-identifier hs-var">getCardanoTxId</span></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; TxId) -&gt; CardanoTx -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; CardanoTx
</span><span class="hs-identifier hs-var">unOnChain</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565759"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680565758"><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565758"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; Lovelace
</span><span class="hs-identifier hs-var">getCardanoTxFee</span></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; Lovelace) -&gt; CardanoTx -&gt; Lovelace
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; CardanoTx
</span><span class="hs-identifier hs-var">unOnChain</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680565758"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxId a
</span><a href="#local-6989586621680565763"><span class="hs-identifier hs-var">submitted</span></a></span><span> </span><span class="annot"><span class="annottext">t (OnChainTx, b)
</span><a href="#local-6989586621680565762"><span class="hs-identifier hs-var">txsV</span></a></span><span>
</span><span id="line-264"></span><span>            </span><span class="annot"><span class="annottext">Lovelace -&gt; Lovelace -&gt; Lovelace
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-265"></span><span>            </span><span class="annot"><span class="annottext">((CardanoTx, b, Value) -&gt; TxId)
-&gt; ((CardanoTx, b, Value) -&gt; Lovelace)
-&gt; Map TxId a
-&gt; t (CardanoTx, b, Value)
-&gt; Lovelace
forall (t :: * -&gt; *) m k t a.
(Foldable t, Monoid m, Ord k) =&gt;
(t -&gt; k) -&gt; (t -&gt; m) -&gt; Map k a -&gt; t t -&gt; m
</span><a href="#local-6989586621680565760"><span class="hs-identifier hs-var">findFees</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680565757"><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680565757"><span class="hs-identifier hs-var">tx</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">CardanoTx -&gt; TxId
</span><span class="hs-identifier hs-var">getCardanoTxId</span></span><span> </span><span class="annot"><span class="annottext">CardanoTx
</span><a href="#local-6989586621680565757"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoTx
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565756"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565756"><span class="hs-identifier hs-var">collateral</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Lovelace
</span><span class="hs-identifier hs-var">C.selectLovelace</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680565756"><span class="hs-identifier hs-var">collateral</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxId a
</span><a href="#local-6989586621680565763"><span class="hs-identifier hs-var">submitted</span></a></span><span> </span><span class="annot"><span class="annottext">t (CardanoTx, b, Value)
</span><a href="#local-6989586621680565761"><span class="hs-identifier hs-var">txsF</span></a></span><span>
</span><span id="line-266"></span><span>        </span><span id="local-6989586621680565760"><span class="annot"><span class="annottext">findFees :: (t -&gt; k) -&gt; (t -&gt; m) -&gt; Map k a -&gt; t t -&gt; m
</span><a href="#local-6989586621680565760"><span class="hs-identifier hs-var hs-var">findFees</span></a></span></span><span> </span><span id="local-6989586621680565754"><span class="annot"><span class="annottext">t -&gt; k
</span><a href="#local-6989586621680565754"><span class="hs-identifier hs-var">getId</span></a></span></span><span> </span><span id="local-6989586621680565753"><span class="annot"><span class="annottext">t -&gt; m
</span><a href="#local-6989586621680565753"><span class="hs-identifier hs-var">getFees</span></a></span></span><span> </span><span id="local-6989586621680565752"><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680565752"><span class="hs-identifier hs-var">submitted</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(t -&gt; m) -&gt; t t -&gt; m
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680565751"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680565751"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">k -&gt; Map k a -&gt; Bool
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Bool
</span><span class="hs-identifier hs-var">Map.member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; k
</span><a href="#local-6989586621680565754"><span class="hs-identifier hs-var">getId</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680565751"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map k a
</span><a href="#local-6989586621680565752"><span class="hs-identifier hs-var">submitted</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">t -&gt; m
</span><a href="#local-6989586621680565753"><span class="hs-identifier hs-var">getFees</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621680565751"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">m
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>        </span><span id="local-6989586621680565764"><span class="annot"><span class="annottext">walletSubmittedFees :: Fold (EmulatorTimeEvent EmulatorEvent') (Map TxId Lovelace)
</span><a href="#local-6989586621680565764"><span class="hs-identifier hs-var hs-var">walletSubmittedFees</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Handler (EmulatorTimeEvent EmulatorEvent') (TxId, Lovelace)
-&gt; Fold (TxId, Lovelace) (Map TxId Lovelace)
-&gt; Fold (EmulatorTimeEvent EmulatorEvent') (Map TxId Lovelace)
forall a b r. Handler a b -&gt; Fold b r -&gt; Fold a r
</span><span class="hs-identifier hs-var">L.handles</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (Dual (Endo x)) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (Dual (Endo x)) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (Dual (Endo x)) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (Dual (Endo x)) (EmulatorTimeEvent EmulatorEvent'))
-&gt; (((TxId, Lovelace) -&gt; Const (Dual (Endo x)) (TxId, Lovelace))
    -&gt; EmulatorEvent' -&gt; Const (Dual (Endo x)) EmulatorEvent')
-&gt; ((TxId, Lovelace) -&gt; Const (Dual (Endo x)) (TxId, Lovelace))
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (Dual (Endo x)) (EmulatorTimeEvent EmulatorEvent')
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet -&gt; Prism' EmulatorEvent' NodeClientEvent
</span><a href="Wallet.Emulator.MultiAgent.html#walletClientEvent"><span class="hs-identifier hs-var">walletClientEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Wallet
</span><a href="#local-6989586621680565766"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">((NodeClientEvent -&gt; Const (Dual (Endo x)) NodeClientEvent)
 -&gt; EmulatorEvent' -&gt; Const (Dual (Endo x)) EmulatorEvent')
-&gt; (((TxId, Lovelace) -&gt; Const (Dual (Endo x)) (TxId, Lovelace))
    -&gt; NodeClientEvent -&gt; Const (Dual (Endo x)) NodeClientEvent)
-&gt; ((TxId, Lovelace) -&gt; Const (Dual (Endo x)) (TxId, Lovelace))
-&gt; EmulatorEvent'
-&gt; Const (Dual (Endo x)) EmulatorEvent'
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxId, Lovelace) -&gt; Const (Dual (Endo x)) (TxId, Lovelace))
-&gt; NodeClientEvent -&gt; Const (Dual (Endo x)) NodeClientEvent
Iso' NodeClientEvent (TxId, Lovelace)
</span><a href="Wallet.Emulator.NodeClient.html#_TxSubmit"><span class="hs-identifier hs-var">_TxSubmit</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold (TxId, Lovelace) (Map TxId Lovelace)
forall a b. Ord a =&gt; Fold (a, b) (Map a b)
</span><span class="hs-identifier hs-var">L.map</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Annotate the transactions that were validated by the node</span><span>
</span><span id="line-270"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#annotatedBlockchain"><span class="hs-identifier hs-type">annotatedBlockchain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="Wallet.Rollup.Types.html#AnnotatedTx"><span class="hs-identifier hs-type">AnnotatedTx</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-271"></span><span id="annotatedBlockchain"><span class="annot"><span class="annottext">annotatedBlockchain :: EmulatorEventFold [[AnnotatedTx]]
</span><a href="Wallet.Emulator.Folds.html#annotatedBlockchain"><span class="hs-identifier hs-var hs-var">annotatedBlockchain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-272"></span><span>    </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent)
-&gt; Fold ChainEvent [[AnnotatedTx]]
-&gt; EmulatorEventFold [[AnnotatedTx]]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent'))
-&gt; ((ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
    -&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; Getting
     (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
-&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">(Fold ChainEvent [[AnnotatedTx]]
 -&gt; EmulatorEventFold [[AnnotatedTx]])
-&gt; Fold ChainEvent [[AnnotatedTx]]
-&gt; EmulatorEventFold [[AnnotatedTx]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(RollupState -&gt; ChainEvent -&gt; RollupState)
-&gt; RollupState
-&gt; (RollupState -&gt; [[AnnotatedTx]])
-&gt; Fold ChainEvent [[AnnotatedTx]]
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><span class="hs-identifier hs-var">Fold</span></span><span> </span><span class="annot"><span class="annottext">RollupState -&gt; ChainEvent -&gt; RollupState
</span><a href="Wallet.Rollup.html#handleChainEvent"><span class="hs-identifier hs-var">Rollup.handleChainEvent</span></a></span><span> </span><span class="annot"><span class="annottext">RollupState
</span><a href="Wallet.Rollup.html#initialState"><span class="hs-identifier hs-var">Rollup.initialState</span></a></span><span> </span><span class="annot"><span class="annottext">RollupState -&gt; [[AnnotatedTx]]
</span><a href="Wallet.Rollup.html#getAnnotatedTransactions"><span class="hs-identifier hs-var">Rollup.getAnnotatedTransactions</span></a></span><span>
</span><span id="line-274"></span><span>
</span><span id="line-275"></span><span class="hs-comment">-- | All chain events emitted by the node</span><span>
</span><span id="line-276"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#chainEvents"><span class="hs-identifier hs-type">chainEvents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ChainEvent</span></span><span class="hs-special">]</span><span>
</span><span id="line-277"></span><span id="chainEvents"><span class="annot"><span class="annottext">chainEvents :: EmulatorEventFold [ChainEvent]
</span><a href="Wallet.Emulator.Folds.html#chainEvents"><span class="hs-identifier hs-var hs-var">chainEvents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent)
-&gt; Fold ChainEvent [ChainEvent] -&gt; EmulatorEventFold [ChainEvent]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent'))
-&gt; ((ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
    -&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; Getting
     (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
-&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold ChainEvent [ChainEvent]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | All transactions that happened during the simulation</span><span>
</span><span id="line-280"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#blockchain"><span class="hs-identifier hs-type">blockchain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Block</span></span><span class="hs-special">]</span><span>
</span><span id="line-281"></span><span id="blockchain"><span class="annot"><span class="annottext">blockchain :: EmulatorEventFold [Block]
</span><a href="Wallet.Emulator.Folds.html#blockchain"><span class="hs-identifier hs-var hs-var">blockchain</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680565744"><span class="annot"><span class="annottext">step :: (Block, [Block]) -&gt; ChainEvent -&gt; (Block, [Block])
</span><a href="#local-6989586621680565744"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680565743"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680565743"><span class="hs-identifier hs-var">currentBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565742"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680565742"><span class="hs-identifier hs-var">otherBlocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-283"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">SlotAdd</span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680565743"><span class="hs-identifier hs-var">currentBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Block -&gt; [Block] -&gt; [Block]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680565742"><span class="hs-identifier hs-var">otherBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-284"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">TxnValidation</span></span><span> </span><span id="local-6989586621680565741"><span class="annot"><span class="annottext">ValidationResult
</span><a href="#local-6989586621680565741"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Block -&gt; (OnChainTx -&gt; Block) -&gt; Maybe OnChainTx -&gt; Block
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680565743"><span class="hs-identifier hs-var">currentBlock</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainTx -&gt; Block -&gt; Block
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680565743"><span class="hs-identifier hs-var">currentBlock</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe OnChainTx -&gt; Block) -&gt; Maybe OnChainTx -&gt; Block
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidationResult -&gt; Maybe OnChainTx
</span><span class="hs-identifier hs-var">toOnChain</span></span><span> </span><span class="annot"><span class="annottext">ValidationResult
</span><a href="#local-6989586621680565741"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680565742"><span class="hs-identifier hs-var">otherBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621680565740"><span class="annot"><span class="annottext">initial :: ([a], [a])
</span><a href="#local-6989586621680565740"><span class="hs-identifier hs-var hs-var">initial</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>        </span><span id="local-6989586621680565739"><span class="annot"><span class="annottext">extract :: (a, [a]) -&gt; [a]
</span><a href="#local-6989586621680565739"><span class="hs-identifier hs-var hs-var">extract</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680565738"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565738"><span class="hs-identifier hs-var">currentBlock</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565737"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680565737"><span class="hs-identifier hs-var">otherBlocks</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565738"><span class="hs-identifier hs-var">currentBlock</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621680565737"><span class="hs-identifier hs-var">otherBlocks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent)
-&gt; Fold ChainEvent [Block] -&gt; EmulatorEventFold [Block]
forall a b r. (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var">preMapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
-&gt; EmulatorTimeEvent EmulatorEvent' -&gt; Maybe ChainEvent
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; EmulatorTimeEvent EmulatorEvent'
-&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent')
forall e1 e2.
Lens (EmulatorTimeEvent e1) (EmulatorTimeEvent e2) e1 e2
</span><a href="Wallet.Emulator.MultiAgent.html#eteEvent"><span class="hs-identifier hs-var">eteEvent</span></a></span><span> </span><span class="annot"><span class="annottext">((EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
 -&gt; EmulatorTimeEvent EmulatorEvent'
 -&gt; Const (First ChainEvent) (EmulatorTimeEvent EmulatorEvent'))
-&gt; ((ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
    -&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent')
-&gt; Getting
     (First ChainEvent) (EmulatorTimeEvent EmulatorEvent') ChainEvent
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainEvent -&gt; Const (First ChainEvent) ChainEvent)
-&gt; EmulatorEvent' -&gt; Const (First ChainEvent) EmulatorEvent'
Prism' EmulatorEvent' ChainEvent
</span><a href="Wallet.Emulator.MultiAgent.html#chainEvent"><span class="hs-identifier hs-var">chainEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>        </span><span class="annot"><span class="annottext">(Fold ChainEvent [Block] -&gt; EmulatorEventFold [Block])
-&gt; Fold ChainEvent [Block] -&gt; EmulatorEventFold [Block]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Block, [Block]) -&gt; ChainEvent -&gt; (Block, [Block]))
-&gt; (Block, [Block])
-&gt; ((Block, [Block]) -&gt; [Block])
-&gt; Fold ChainEvent [Block]
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><span class="hs-identifier hs-var">Fold</span></span><span> </span><span class="annot"><span class="annottext">(Block, [Block]) -&gt; ChainEvent -&gt; (Block, [Block])
</span><a href="#local-6989586621680565744"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">(Block, [Block])
forall a a. ([a], [a])
</span><a href="#local-6989586621680565740"><span class="hs-identifier hs-var">initial</span></a></span><span> </span><span class="annot"><span class="annottext">(Block, [Block]) -&gt; [Block]
forall a. (a, [a]) -&gt; [a]
</span><a href="#local-6989586621680565739"><span class="hs-identifier hs-var">extract</span></a></span><span>
</span><span id="line-290"></span><span>
</span><span id="line-291"></span><span class="hs-comment">-- | The list of all emulator events</span><span>
</span><span id="line-292"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#emulatorLog"><span class="hs-identifier hs-type">emulatorLog</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorEventFold"><span class="hs-identifier hs-type">EmulatorEventFold</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Wallet.Emulator.MultiAgent.html#EmulatorEvent"><span class="hs-identifier hs-type">EmulatorEvent</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-293"></span><span id="emulatorLog"><span class="annot"><span class="annottext">emulatorLog :: EmulatorEventFold [EmulatorTimeEvent EmulatorEvent']
</span><a href="Wallet.Emulator.Folds.html#emulatorLog"><span class="hs-identifier hs-var hs-var">emulatorLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmulatorEventFold [EmulatorTimeEvent EmulatorEvent']
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="hs-comment">-- | Pretty-print each element into a new line.</span><span>
</span><span id="line-296"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#renderLines"><span class="hs-identifier hs-type">renderLines</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565736"><span class="annot"><a href="#local-6989586621680565736"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="#local-6989586621680565736"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fold</span></span><span> </span><span class="annot"><a href="#local-6989586621680565736"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Text</span></span><span>
</span><span id="line-297"></span><span id="renderLines"><span class="annot"><span class="annottext">renderLines :: Fold a Text
</span><a href="Wallet.Emulator.Folds.html#renderLines"><span class="hs-identifier hs-var hs-var">renderLines</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680565735"><span class="annot"><span class="annottext">rnd :: Doc ann -&gt; Text
</span><a href="#local-6989586621680565735"><span class="hs-identifier hs-var hs-var">rnd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SimpleDocStream ann -&gt; Text
forall ann. SimpleDocStream ann -&gt; Text
</span><span class="hs-identifier hs-var">renderStrict</span></span><span> </span><span class="annot"><span class="annottext">(SimpleDocStream ann -&gt; Text)
-&gt; (Doc ann -&gt; SimpleDocStream ann) -&gt; Doc ann -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LayoutOptions -&gt; Doc ann -&gt; SimpleDocStream ann
forall ann. LayoutOptions -&gt; Doc ann -&gt; SimpleDocStream ann
</span><span class="hs-identifier hs-var">layoutPretty</span></span><span> </span><span class="annot"><span class="annottext">LayoutOptions
</span><span class="hs-identifier hs-var">defaultLayoutOptions</span></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">(a -&gt; Doc Any)
-&gt; ([Doc Any] -&gt; Text) -&gt; Fold (Doc Any) [Doc Any] -&gt; Fold a Text
forall (p :: * -&gt; * -&gt; *) a b c d.
Profunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p b c -&gt; p a d
</span><span class="hs-identifier hs-var">dimap</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Doc Any
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Doc Any -&gt; Text
forall ann. Doc ann -&gt; Text
</span><a href="#local-6989586621680565735"><span class="hs-identifier hs-var">rnd</span></a></span><span> </span><span class="annot"><span class="annottext">(Doc Any -&gt; Text) -&gt; ([Doc Any] -&gt; Doc Any) -&gt; [Doc Any] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc Any] -&gt; Doc Any
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Fold (Doc Any) [Doc Any]
forall a. Fold a [a]
</span><span class="hs-identifier hs-var">L.list</span></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span class="hs-comment">-- | An effectful 'Data.Maybe.mapMaybe' for 'FoldM'.</span><span>
</span><span id="line-302"></span><span id="local-6989586621680566158"><span id="local-6989586621680566159"><span id="local-6989586621680566160"><span id="local-6989586621680566161"><span class="annot"><a href="Wallet.Emulator.Folds.html#preMapMaybeM"><span class="hs-identifier hs-type">preMapMaybeM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566161"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680566160"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680566161"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566159"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span class="annot"><a href="#local-6989586621680566161"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566159"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566158"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span class="annot"><a href="#local-6989586621680566161"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566160"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566158"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-307"></span><span id="preMapMaybeM"><span class="annot"><span class="annottext">preMapMaybeM :: (a -&gt; m (Maybe b)) -&gt; FoldM m b r -&gt; FoldM m a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybeM"><span class="hs-identifier hs-var hs-var">preMapMaybeM</span></a></span></span><span> </span><span id="local-6989586621680565732"><span class="annot"><span class="annottext">a -&gt; m (Maybe b)
</span><a href="#local-6989586621680565732"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span id="local-6989586621680565731"><span class="annot"><span class="annottext">x -&gt; b -&gt; m x
</span><a href="#local-6989586621680565731"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621680565730"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680565730"><span class="hs-identifier hs-var">begin</span></a></span></span><span> </span><span id="local-6989586621680565729"><span class="annot"><span class="annottext">x -&gt; m r
</span><a href="#local-6989586621680565729"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m r) -&gt; FoldM m a r
forall (m :: * -&gt; *) a b x.
(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b) -&gt; FoldM m a b
</span><span class="hs-identifier hs-var">FoldM</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; a -&gt; m x
</span><a href="#local-6989586621680565728"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680565730"><span class="hs-identifier hs-var">begin</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; m r
</span><a href="#local-6989586621680565729"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-308"></span><span>    </span><span id="local-6989586621680565728"><span class="annot"><span class="annottext">step' :: x -&gt; a -&gt; m x
</span><a href="#local-6989586621680565728"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span id="local-6989586621680565727"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565727"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680565726"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565726"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-309"></span><span>        </span><span id="local-6989586621680565725"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621680565725"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; m (Maybe b)
</span><a href="#local-6989586621680565732"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565726"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621680565725"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><span class="annottext">Maybe b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; m x
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565727"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680565724"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565724"><span class="hs-identifier hs-var">a'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; b -&gt; m x
</span><a href="#local-6989586621680565731"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565727"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565724"><span class="hs-identifier hs-var">a'</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="hs-comment">-- | 'Data.Maybe.mapMaybe' for 'Fold'.</span><span>
</span><span id="line-315"></span><span id="local-6989586621680566274"><span id="local-6989586621680566275"><span id="local-6989586621680566276"><span class="annot"><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-type">preMapMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680566276"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566275"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fold</span></span><span> </span><span class="annot"><a href="#local-6989586621680566275"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566274"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Fold</span></span><span> </span><span class="annot"><a href="#local-6989586621680566276"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680566274"><span class="hs-identifier hs-type">r</span></a></span></span></span></span><span>
</span><span id="line-316"></span><span id="preMapMaybe"><span class="annot"><span class="annottext">preMapMaybe :: (a -&gt; Maybe b) -&gt; Fold b r -&gt; Fold a r
</span><a href="Wallet.Emulator.Folds.html#preMapMaybe"><span class="hs-identifier hs-var hs-var">preMapMaybe</span></a></span></span><span> </span><span id="local-6989586621680565723"><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621680565723"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Fold</span></span><span> </span><span id="local-6989586621680565722"><span class="annot"><span class="annottext">x -&gt; b -&gt; x
</span><a href="#local-6989586621680565722"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621680565721"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565721"><span class="hs-identifier hs-var">begin</span></a></span></span><span> </span><span id="local-6989586621680565720"><span class="annot"><span class="annottext">x -&gt; r
</span><a href="#local-6989586621680565720"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; r) -&gt; Fold a r
forall a b x. (x -&gt; a -&gt; x) -&gt; x -&gt; (x -&gt; b) -&gt; Fold a b
</span><span class="hs-identifier hs-var">Fold</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; a -&gt; x
</span><a href="#local-6989586621680565719"><span class="hs-identifier hs-var">step'</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565721"><span class="hs-identifier hs-var">begin</span></a></span><span> </span><span class="annot"><span class="annottext">x -&gt; r
</span><a href="#local-6989586621680565720"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621680565719"><span class="annot"><span class="annottext">step' :: x -&gt; a -&gt; x
</span><a href="#local-6989586621680565719"><span class="hs-identifier hs-var hs-var">step'</span></a></span></span><span> </span><span id="local-6989586621680565718"><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565718"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621680565717"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565717"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe b
</span><a href="#local-6989586621680565723"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680565717"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-318"></span><span>        </span><span class="annot"><span class="annottext">Maybe b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565718"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-319"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680565716"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565716"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">x -&gt; b -&gt; x
</span><a href="#local-6989586621680565722"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">x
</span><a href="#local-6989586621680565718"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621680565716"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span class="hs-comment">-- | Effectfully map the result of a 'FoldM'</span><span>
</span><span id="line-322"></span><span id="local-6989586621680565712"><span id="local-6989586621680565713"><span id="local-6989586621680565714"><span id="local-6989586621680565715"><span class="annot"><a href="Wallet.Emulator.Folds.html#postMapM"><span class="hs-identifier hs-type">postMapM</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-323"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565715"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-324"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621680565714"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680565715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565713"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span class="annot"><a href="#local-6989586621680565715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565712"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565714"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span class="annot"><a href="#local-6989586621680565715"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565712"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565713"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-327"></span><span id="postMapM"><span class="annot"><span class="annottext">postMapM :: (b -&gt; m c) -&gt; FoldM m a b -&gt; FoldM m a c
</span><a href="Wallet.Emulator.Folds.html#postMapM"><span class="hs-identifier hs-var hs-var">postMapM</span></a></span></span><span> </span><span id="local-6989586621680565711"><span class="annot"><span class="annottext">b -&gt; m c
</span><a href="#local-6989586621680565711"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FoldM</span></span><span> </span><span id="local-6989586621680565710"><span class="annot"><span class="annottext">x -&gt; a -&gt; m x
</span><a href="#local-6989586621680565710"><span class="hs-identifier hs-var">step</span></a></span></span><span> </span><span id="local-6989586621680565709"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680565709"><span class="hs-identifier hs-var">begin</span></a></span></span><span> </span><span id="local-6989586621680565708"><span class="annot"><span class="annottext">x -&gt; m b
</span><a href="#local-6989586621680565708"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m c) -&gt; FoldM m a c
forall (m :: * -&gt; *) a b x.
(x -&gt; a -&gt; m x) -&gt; m x -&gt; (x -&gt; m b) -&gt; FoldM m a b
</span><span class="hs-identifier hs-var">FoldM</span></span><span> </span><span class="annot"><span class="annottext">x -&gt; a -&gt; m x
</span><a href="#local-6989586621680565710"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621680565709"><span class="hs-identifier hs-var">begin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">x -&gt; m b
</span><a href="#local-6989586621680565708"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">(x -&gt; m b) -&gt; (b -&gt; m c) -&gt; x -&gt; m c
forall (m :: * -&gt; *) a b c.
Monad m =&gt;
(a -&gt; m b) -&gt; (b -&gt; m c) -&gt; a -&gt; m c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;=&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; m c
</span><a href="#local-6989586621680565711"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="hs-keyword">data</span><span> </span><span id="EmulatorFoldErr"><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-var">EmulatorFoldErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>    </span><span id="InstanceStateJSONDecodingError"><span class="annot"><a href="Wallet.Emulator.Folds.html#InstanceStateJSONDecodingError"><span class="hs-identifier hs-var">InstanceStateJSONDecodingError</span></a></span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680565704"><span id="local-6989586621680565706"><span class="annot"><span class="annottext">EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
(EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; Eq EmulatorFoldErr
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c/= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
== :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c== :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565689"><span id="local-6989586621680565691"><span id="local-6989586621680565693"><span id="local-6989586621680565695"><span id="local-6989586621680565697"><span id="local-6989586621680565699"><span id="local-6989586621680565701"><span class="annot"><span class="annottext">Eq EmulatorFoldErr
Eq EmulatorFoldErr
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Ordering)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr)
-&gt; (EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr)
-&gt; Ord EmulatorFoldErr
EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Ordering
EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr
$cmin :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr
max :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr
$cmax :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; EmulatorFoldErr
&gt;= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c&gt;= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
&gt; :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c&gt; :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
&lt;= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c&lt;= :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
&lt; :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
$c&lt; :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Bool
compare :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Ordering
$ccompare :: EmulatorFoldErr -&gt; EmulatorFoldErr -&gt; Ordering
$cp1Ord :: Eq EmulatorFoldErr
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680565682"><span id="local-6989586621680565684"><span id="local-6989586621680565686"><span class="annot"><span class="annottext">Int -&gt; EmulatorFoldErr -&gt; ShowS
[EmulatorFoldErr] -&gt; ShowS
EmulatorFoldErr -&gt; String
(Int -&gt; EmulatorFoldErr -&gt; ShowS)
-&gt; (EmulatorFoldErr -&gt; String)
-&gt; ([EmulatorFoldErr] -&gt; ShowS)
-&gt; Show EmulatorFoldErr
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [EmulatorFoldErr] -&gt; ShowS
$cshowList :: [EmulatorFoldErr] -&gt; ShowS
show :: EmulatorFoldErr -&gt; String
$cshow :: EmulatorFoldErr -&gt; String
showsPrec :: Int -&gt; EmulatorFoldErr -&gt; ShowS
$cshowsPrec :: Int -&gt; EmulatorFoldErr -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span class="hs-comment">-- | A human-readable explanation of the error, to be included in the logs.</span><span>
</span><span id="line-334"></span><span class="annot"><a href="Wallet.Emulator.Folds.html#describeError"><span class="hs-identifier hs-type">describeError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Wallet.Emulator.Folds.html#EmulatorFoldErr"><span class="hs-identifier hs-type">EmulatorFoldErr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-335"></span><span id="describeError"><span class="annot"><span class="annottext">describeError :: EmulatorFoldErr -&gt; String
</span><a href="Wallet.Emulator.Folds.html#describeError"><span class="hs-identifier hs-var hs-var">describeError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="Wallet.Emulator.Folds.html#InstanceStateJSONDecodingError"><span class="hs-identifier hs-type">InstanceStateJSONDecodingError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Response Value
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unwords</span></a></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Failed to decode a 'Response JSON.Value'.&quot;</span></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The event is probably for a different 'Contract'.&quot;</span></span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This is often caused by having multiple contract instances share the same 'ContractInstanceTag' (for example, when  using 'activateContractWallet' repeatedly on the same wallet).&quot;</span></span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;To fix this, use 'activateContract' with a unique 'ContractInstanceTag' per instance.&quot;</span></span><span>
</span><span id="line-341"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-342"></span></pre></body></html>