<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ConstraintKinds     #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies  #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TupleSections       #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-15"></span><span class="hs-comment">{-

The scheduler thread that runs a contract instance.

-}</span><span>
</span><span id="line-20"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Trace.Emulator.ContractInstance</span><span class="hs-special">(</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#contractThread"><span class="hs-identifier">contractThread</span></a></span><span>
</span><span id="line-22"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#getThread"><span class="hs-identifier">getThread</span></a></span><span>
</span><span id="line-23"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier">EmulatorRuntimeError</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier">runInstance</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Instance state</span></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier">ContractInstanceState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#emptyInstanceState"><span class="hs-identifier">emptyInstanceState</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#addEventInstanceState"><span class="hs-identifier">addEventInstanceState</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Indexed block</span></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier">IndexedBlock</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#indexBlock"><span class="hs-identifier">indexBlock</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internals</span></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier">getHooks</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier">addResponse</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">at</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">preview</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">view</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(?~)</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">join</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Eff</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Member</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Members</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">interpret</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">send</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">subsume</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Error</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Error</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Extras.Log</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LogMessage</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LogMsg</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LMessage</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">LogObserve</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logDebug</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logInfo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logWarn</span></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>                                       </span><span class="annot"><span class="hs-identifier">mapLog</span></span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Extras.Modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">raiseEnd</span></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Reader</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runReader</span></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">State</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">evalState</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">modify</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">JSON</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">traverse_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(:|)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">listToMaybe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoAddress</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Blockchain</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OnChainTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">onChainTxIsValid</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unOnChain</span></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">getCardanoTxId</span></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">fromCardanoTxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toCardanoTxIn</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.ChainIndex</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainIndexQueryEffect</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChainIndexTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">_citxTxId</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>                          </span><span class="annot"><span class="hs-identifier">ChainIndexTxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ChainIndexTxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">citoAddress</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RollbackState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Committed</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>                          </span><span class="annot"><span class="hs-identifier">TxOutState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Spent</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Unspent</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxValidity</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxInvalid</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxValid</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">citxInputs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fromOnChainTx</span></span><span class="hs-special">,</span><span>
</span><span id="line-62"></span><span>                          </span><span class="annot"><span class="hs-identifier">txOutRefs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txOuts</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">validityFromChainIndex</span></span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.html"><span class="hs-identifier">Plutus.Contract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier">Contract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html"><span class="hs-identifier">Plutus.Contract.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier">PABReq</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier">PABResp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Effects.html#AwaitTxStatusChangeResp"><span class="hs-identifier">AwaitTxStatusChangeResp</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#matches"><span class="hs-identifier">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html"><span class="hs-identifier">Plutus.Contract.Effects</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">E</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html"><span class="hs-identifier">Plutus.Contract.Resumable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier">Request</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier">Request</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#rqID"><span class="hs-identifier">rqID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier">rqRequest</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>                                  </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier">Response</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier">Response</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#rspItID"><span class="hs-identifier">rspItID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#rspResponse"><span class="hs-identifier">rspResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#rspRqID"><span class="hs-identifier">rspRqID</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#itID"><span class="hs-identifier">itID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html"><span class="hs-identifier">Plutus.Contract.Resumable</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Trace.html"><span class="hs-identifier">Plutus.Contract.Trace</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">RequestHandler</span></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html"><span class="hs-identifier">Plutus.Contract.Trace.RequestHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#RequestHandler"><span class="hs-identifier">RequestHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#RequestHandler"><span class="hs-identifier">RequestHandler</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Emulator.LogMessages.html#RequestHandlerLogMsg"><span class="hs-identifier">RequestHandlerLogMsg</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#tryHandler"><span class="hs-identifier">tryHandler</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>                                             </span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#wrapHandler"><span class="hs-identifier">wrapHandler</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html"><span class="hs-identifier">Plutus.Contract.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier">ResumableResult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier">ResumableResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#_finalState"><span class="hs-identifier">_finalState</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#lastLogs"><span class="hs-identifier">lastLogs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#requests"><span class="hs-identifier">requests</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#resumableResult"><span class="hs-identifier">resumableResult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html"><span class="hs-identifier">Plutus.Trace.Emulator.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractConstraints"><span class="hs-identifier">ContractConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractHandle"><span class="hs-identifier">ContractHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier">ContractInstanceLog</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier">ContractInstanceLog</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier">ContractInstanceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractLog"><span class="hs-identifier">ContractLog</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#CurrentRequests"><span class="hs-identifier">CurrentRequests</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#Freezing"><span class="hs-identifier">Freezing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#HandledRequest"><span class="hs-identifier">HandledRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#InstErr"><span class="hs-identifier">InstErr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#NoRequestsHandled"><span class="hs-identifier">NoRequestsHandled</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ReceiveEndpointCall"><span class="hs-identifier">ReceiveEndpointCall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#SendingContractState"><span class="hs-identifier">SendingContractState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#Started"><span class="hs-identifier">Started</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#StoppedNoError"><span class="hs-identifier">StoppedNoError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#StoppedWithError"><span class="hs-identifier">StoppedWithError</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier">ContractInstanceState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceState"><span class="hs-identifier">ContractInstanceState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instContractState"><span class="hs-identifier">instContractState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instEvents"><span class="hs-identifier">instEvents</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instHandlersHistory"><span class="hs-identifier">instHandlersHistory</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier">ContractInstanceStateInternal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#cisiSuspState"><span class="hs-identifier">cisiSuspState</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier">EmulatedWalletEffects</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects%27"><span class="hs-identifier">EmulatedWalletEffects'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorAgentThreadEffs"><span class="hs-identifier">EmulatorAgentThreadEffs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorMessage"><span class="hs-identifier">EmulatorMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateRequest"><span class="hs-identifier">ContractInstanceStateRequest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateResponse"><span class="hs-identifier">ContractInstanceStateResponse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EndpointCall"><span class="hs-identifier">EndpointCall</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#Freeze"><span class="hs-identifier">Freeze</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#NewSlot"><span class="hs-identifier">NewSlot</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier">EmulatorRuntimeError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorJSONDecodingError"><span class="hs-identifier">EmulatorJSONDecodingError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ThreadIdNotFound"><span class="hs-identifier">ThreadIdNotFound</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorThreads"><span class="hs-identifier">EmulatorThreads</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>                                    </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#addEventInstanceState"><span class="hs-identifier">addEventInstanceState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#emptyInstanceState"><span class="hs-identifier">emptyInstanceState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#instanceIdThreads"><span class="hs-identifier">instanceIdThreads</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#toInstanceState"><span class="hs-identifier">toInstanceState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html"><span class="hs-identifier">Plutus.Trace.Scheduler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier">MessageCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Message"><span class="hs-identifier">Message</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier">WaitForMessage</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier">Priority</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Frozen"><span class="hs-identifier">Frozen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier">Normal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Sleeping"><span class="hs-identifier">Sleeping</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier">ThreadId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>                               </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier">mkAgentSysCall</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.API.html"><span class="hs-identifier">Wallet.API</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">WAPI</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Effects.html"><span class="hs-identifier">Wallet.Effects</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Effects.html#NodeClientEffect"><span class="hs-identifier">NodeClientEffect</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Wallet.Effects.html#WalletEffect"><span class="hs-identifier">WalletEffect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Emulator.LogMessages.html"><span class="hs-identifier">Wallet.Emulator.LogMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxBalanceMsg</span></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Wallet.Types.html"><span class="hs-identifier">Wallet.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier">ContractInstanceId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- | Effects available to threads that run in the context of specific</span><span>
</span><span id="line-89"></span><span class="hs-comment">--   agents (ie wallets)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">type</span><span> </span><span id="ContractInstanceThreadEffs"><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceThreadEffs"><span class="hs-identifier hs-var">ContractInstanceThreadEffs</span></a></span></span><span> </span><span id="local-6989586621680564847"><span class="annot"><a href="#local-6989586621680564847"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680564846"><span class="annot"><a href="#local-6989586621680564846"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680564845"><span class="annot"><a href="#local-6989586621680564845"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680564844"><span class="annot"><a href="#local-6989586621680564844"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564847"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564846"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564845"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorAgentThreadEffs"><span class="hs-identifier hs-type">EmulatorAgentThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564844"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-95"></span><span>
</span><span id="line-96"></span><span class="hs-comment">-- | Start a new thread for a contract. Most of the work happens in</span><span>
</span><span id="line-97"></span><span class="hs-comment">--   'runInstance'.</span><span>
</span><span id="line-98"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#contractThread"><span class="hs-identifier hs-type">contractThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680564843"><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680564842"><span class="annot"><a href="#local-6989586621680564842"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680564841"><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680564840"><span class="annot"><a href="#local-6989586621680564840"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-99"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorThreads"><span class="hs-identifier hs-type">EmulatorThreads</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564840"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier hs-type">EmulatorRuntimeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564840"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-101"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractConstraints"><span class="hs-identifier hs-type">ContractConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564842"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-102"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractHandle"><span class="hs-identifier hs-type">ContractHandle</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564842"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorAgentThreadEffs"><span class="hs-identifier hs-type">EmulatorAgentThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564840"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span id="contractThread"><span class="annot"><span class="annottext">contractThread :: ContractHandle w s e -&gt; Eff (EmulatorAgentThreadEffs effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#contractThread"><span class="hs-identifier hs-var hs-var">contractThread</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractHandle"><span class="hs-identifier hs-type">ContractHandle</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564838"><span class="annot"><span class="annottext">ContractInstanceId
chInstanceId :: forall w (s :: Row *) e. ContractHandle w s e -&gt; ContractInstanceId
chInstanceId :: ContractInstanceId
</span><a href="Plutus.Trace.Emulator.Types.html#chInstanceId"><span class="hs-identifier hs-var hs-var">chInstanceId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564836"><span class="annot"><span class="annottext">Contract w s e ()
chContract :: forall w (s :: Row *) e. ContractHandle w s e -&gt; Contract w s e ()
chContract :: Contract w s e ()
</span><a href="Plutus.Trace.Emulator.Types.html#chContract"><span class="hs-identifier hs-var hs-var">chContract</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564834"><span class="annot"><span class="annottext">ContractInstanceTag
chInstanceTag :: forall w (s :: Row *) e.
ContractHandle w s e -&gt; ContractInstanceTag
chInstanceTag :: ContractInstanceTag
</span><a href="Plutus.Trace.Emulator.Types.html#chInstanceTag"><span class="hs-identifier hs-var hs-var">chInstanceTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564832"><span class="annot"><span class="annottext">NetworkId
chNetworkId :: forall w (s :: Row *) e. ContractHandle w s e -&gt; NetworkId
chNetworkId :: NetworkId
</span><a href="Plutus.Trace.Emulator.Types.html#chNetworkId"><span class="hs-identifier hs-var hs-var">chNetworkId</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (Reader ThreadId) effs =&gt;
Eff effs ThreadId
forall r (effs :: [* -&gt; *]). Member (Reader r) effs =&gt; Eff effs r
</span><span class="hs-identifier hs-var">ask</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (EmulatorAgentThreadEffs effs) ThreadId
-&gt; (ThreadId -&gt; Eff (EmulatorAgentThreadEffs effs) ())
-&gt; Eff (EmulatorAgentThreadEffs effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
-&gt; ThreadId -&gt; Eff (EmulatorAgentThreadEffs effs) ()
forall (effs :: [* -&gt; *]).
Member (State EmulatorThreads) effs =&gt;
ContractInstanceId -&gt; ThreadId -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#registerInstance"><span class="hs-identifier hs-var">registerInstance</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564838"><span class="hs-identifier hs-var">chInstanceId</span></a></span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="annottext">(LogMsg ContractInstanceMsg ~&gt; Eff (EmulatorAgentThreadEffs effs))
-&gt; Eff (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
   ~&gt; Eff (EmulatorAgentThreadEffs effs)
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
(eff ~&gt; Eff effs) -&gt; Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">interpret</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ContractInstanceMsg -&gt; ContractInstanceLog)
-&gt; LogMsg ContractInstanceMsg ~&gt; Eff (EmulatorAgentThreadEffs effs)
forall a b (effs :: [* -&gt; *]).
Member (LogMsg b) effs =&gt;
(a -&gt; b) -&gt; LogMsg a ~&gt; Eff effs
</span><span class="hs-identifier hs-var">mapLog</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621680564829"><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="#local-6989586621680564829"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
-&gt; ContractInstanceId -&gt; ContractInstanceTag -&gt; ContractInstanceLog
</span><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceLog"><span class="hs-identifier hs-var">ContractInstanceLog</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="#local-6989586621680564829"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564838"><span class="hs-identifier hs-var">chInstanceId</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceTag
</span><a href="#local-6989586621680564834"><span class="hs-identifier hs-var">chInstanceTag</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-112"></span><span>        </span><span class="annot"><span class="annottext">(Eff (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs) ()
 -&gt; Eff (EmulatorAgentThreadEffs effs) ())
-&gt; Eff
     (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs) ()
-&gt; Eff (EmulatorAgentThreadEffs effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
-&gt; Eff
     (Reader ContractInstanceId
        : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
     ()
-&gt; Eff
     (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs) ()
forall r (effs :: [* -&gt; *]) a.
r -&gt; Eff (Reader r : effs) a -&gt; Eff effs a
</span><span class="hs-identifier hs-var">runReader</span></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564838"><span class="hs-identifier hs-var">chInstanceId</span></a></span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (Reader ContractInstanceId
      : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
   ()
 -&gt; Eff
      (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs) ())
-&gt; Eff
     (Reader ContractInstanceId
        : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
     ()
-&gt; Eff
     (LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     ()
-&gt; Eff
     (Reader ContractInstanceId
        : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
     ()
forall s (effs :: [* -&gt; *]) a.
s -&gt; Eff (State s : effs) a -&gt; Eff effs a
</span><span class="hs-identifier hs-var">evalState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Contract w s e () -&gt; ContractInstanceStateInternal w s e ()
forall w (s :: Row *) e a.
Monoid w =&gt;
Contract w s e a -&gt; ContractInstanceStateInternal w s e a
</span><a href="Plutus.Trace.Emulator.Types.html#emptyInstanceState"><span class="hs-identifier hs-var">emptyInstanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564836"><span class="hs-identifier hs-var">chContract</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>        </span><span class="annot"><span class="annottext">(Eff
   (State (ContractInstanceStateInternal w s e ())
      : Reader ContractInstanceId : LogMsg ContractInstanceMsg
      : EmulatorAgentThreadEffs effs)
   ()
 -&gt; Eff
      (Reader ContractInstanceId
         : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
      ())
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     ()
-&gt; Eff
     (Reader ContractInstanceId
        : LogMsg ContractInstanceMsg : EmulatorAgentThreadEffs effs)
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-115"></span><span>            </span><span class="annot"><span class="annottext">ContractInstanceMsg
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#Started"><span class="hs-identifier hs-var">Started</span></a></span><span>
</span><span id="line-116"></span><span>            </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logNewMessages"><span class="hs-identifier hs-var">logNewMessages</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564842"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-117"></span><span>            </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs) =&gt;
Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs) =&gt;
Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logCurrentRequests"><span class="hs-identifier hs-var">logCurrentRequests</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564843"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564842"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564841"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-118"></span><span>            </span><span id="local-6989586621680564826"><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564826"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorMessage"><span class="hs-identifier hs-type">EmulatorMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564832"><span class="hs-identifier hs-var">chNetworkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564836"><span class="hs-identifier hs-var">chContract</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564826"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-120"></span><span>            </span><span class="annot"><span class="annottext">Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff
     (State (ContractInstanceStateInternal w s e ())
        : Reader ContractInstanceId : LogMsg ContractInstanceMsg
        : EmulatorAgentThreadEffs effs)
     ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstanceObservableState"><span class="hs-identifier hs-var">runInstanceObservableState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564836"><span class="hs-identifier hs-var">chContract</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564826"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#registerInstance"><span class="hs-identifier hs-type">registerInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565319"><span class="annot"><a href="#local-6989586621680565319"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-123"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorThreads"><span class="hs-identifier hs-type">EmulatorThreads</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565319"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565319"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span id="registerInstance"><span class="annot"><span class="annottext">registerInstance :: ContractInstanceId -&gt; ThreadId -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#registerInstance"><span class="hs-identifier hs-var hs-var">registerInstance</span></a></span></span><span> </span><span id="local-6989586621680564824"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564824"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621680564823"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564823"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmulatorThreads -&gt; EmulatorThreads) -&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; s) -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">modify</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map ContractInstanceId ThreadId
 -&gt; Identity (Map ContractInstanceId ThreadId))
-&gt; EmulatorThreads -&gt; Identity EmulatorThreads
Iso' EmulatorThreads (Map ContractInstanceId ThreadId)
</span><a href="Plutus.Trace.Emulator.Types.html#instanceIdThreads"><span class="hs-identifier hs-var">instanceIdThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ContractInstanceId ThreadId
  -&gt; Identity (Map ContractInstanceId ThreadId))
 -&gt; EmulatorThreads -&gt; Identity EmulatorThreads)
-&gt; ((Maybe ThreadId -&gt; Identity (Maybe ThreadId))
    -&gt; Map ContractInstanceId ThreadId
    -&gt; Identity (Map ContractInstanceId ThreadId))
-&gt; (Maybe ThreadId -&gt; Identity (Maybe ThreadId))
-&gt; EmulatorThreads
-&gt; Identity EmulatorThreads
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (Map ContractInstanceId ThreadId)
-&gt; Lens'
     (Map ContractInstanceId ThreadId)
     (Maybe (IxValue (Map ContractInstanceId ThreadId)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map ContractInstanceId ThreadId)
ContractInstanceId
</span><a href="#local-6989586621680564824"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe ThreadId -&gt; Identity (Maybe ThreadId))
 -&gt; EmulatorThreads -&gt; Identity EmulatorThreads)
-&gt; ThreadId -&gt; EmulatorThreads -&gt; EmulatorThreads
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564823"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#getThread"><span class="hs-identifier hs-type">getThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680564821"><span class="annot"><a href="#local-6989586621680564821"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorThreads"><span class="hs-identifier hs-type">EmulatorThreads</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564821"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier hs-type">EmulatorRuntimeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564821"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680564821"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span>
</span><span id="line-135"></span><span id="getThread"><span class="annot"><span class="annottext">getThread :: ContractInstanceId -&gt; Eff effs ThreadId
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getThread"><span class="hs-identifier hs-var hs-var">getThread</span></a></span></span><span> </span><span id="local-6989586621680564820"><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564820"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>    </span><span id="local-6989586621680564819"><span class="annot"><span class="annottext">Maybe ThreadId
</span><a href="#local-6989586621680564819"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(EmulatorThreads -&gt; Maybe ThreadId) -&gt; Eff effs (Maybe ThreadId)
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (Maybe ThreadId) EmulatorThreads (Maybe ThreadId)
-&gt; EmulatorThreads -&gt; Maybe ThreadId
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">(Getting (Maybe ThreadId) EmulatorThreads (Maybe ThreadId)
 -&gt; EmulatorThreads -&gt; Maybe ThreadId)
-&gt; Getting (Maybe ThreadId) EmulatorThreads (Maybe ThreadId)
-&gt; EmulatorThreads
-&gt; Maybe ThreadId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Map ContractInstanceId ThreadId
 -&gt; Const (Maybe ThreadId) (Map ContractInstanceId ThreadId))
-&gt; EmulatorThreads -&gt; Const (Maybe ThreadId) EmulatorThreads
Iso' EmulatorThreads (Map ContractInstanceId ThreadId)
</span><a href="Plutus.Trace.Emulator.Types.html#instanceIdThreads"><span class="hs-identifier hs-var">instanceIdThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Map ContractInstanceId ThreadId
  -&gt; Const (Maybe ThreadId) (Map ContractInstanceId ThreadId))
 -&gt; EmulatorThreads -&gt; Const (Maybe ThreadId) EmulatorThreads)
-&gt; ((Maybe ThreadId -&gt; Const (Maybe ThreadId) (Maybe ThreadId))
    -&gt; Map ContractInstanceId ThreadId
    -&gt; Const (Maybe ThreadId) (Map ContractInstanceId ThreadId))
-&gt; Getting (Maybe ThreadId) EmulatorThreads (Maybe ThreadId)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (Map ContractInstanceId ThreadId)
-&gt; Lens'
     (Map ContractInstanceId ThreadId)
     (Maybe (IxValue (Map ContractInstanceId ThreadId)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map ContractInstanceId ThreadId)
ContractInstanceId
</span><a href="#local-6989586621680564820"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>    </span><span class="annot"><span class="annottext">Eff effs ThreadId
-&gt; (ThreadId -&gt; Eff effs ThreadId)
-&gt; Maybe ThreadId
-&gt; Eff effs ThreadId
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmulatorRuntimeError -&gt; Eff effs ThreadId
forall e (effs :: [* -&gt; *]) a.
Member (Error e) effs =&gt;
e -&gt; Eff effs a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(EmulatorRuntimeError -&gt; Eff effs ThreadId)
-&gt; EmulatorRuntimeError -&gt; Eff effs ThreadId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId -&gt; EmulatorRuntimeError
</span><a href="Plutus.Trace.Emulator.Types.html#ThreadIdNotFound"><span class="hs-identifier hs-var">ThreadIdNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceId
</span><a href="#local-6989586621680564820"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; Eff effs ThreadId
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ThreadId
</span><a href="#local-6989586621680564819"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#logStopped"><span class="hs-identifier hs-type">logStopped</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565190"><span class="annot"><a href="#local-6989586621680565190"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565191"><span class="annot"><a href="#local-6989586621680565191"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565192"><span class="annot"><a href="#local-6989586621680565192"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565192"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565191"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-142"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier hs-type">ResumableResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565190"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565191"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier hs-type">PABReq</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565192"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span id="logStopped"><span class="annot"><span class="annottext">logStopped :: ResumableResult w e PABResp PABReq () -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logStopped"><span class="hs-identifier hs-var hs-var">logStopped</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#ResumableResult"><span class="hs-identifier hs-type">ResumableResult</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564816"><span class="annot"><span class="annottext">Either e (Maybe ())
_finalState :: Either e (Maybe ())
_finalState :: forall w e i o1 a. ResumableResult w e i o1 a -&gt; Either e (Maybe a)
</span><a href="#local-6989586621680564816"><span class="hs-identifier hs-var hs-var">_finalState</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either e (Maybe ())
</span><a href="#local-6989586621680564816"><span class="hs-identifier hs-var">_finalState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-147"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680564815"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680564815"><span class="hs-identifier hs-var">e</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logWarn</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg -&gt; Eff effs ())
-&gt; ContractInstanceMsg -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#StoppedWithError"><span class="hs-identifier hs-var">StoppedWithError</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ContractInstanceMsg) -&gt; String -&gt; ContractInstanceMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621680564815"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-148"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#StoppedNoError"><span class="hs-identifier hs-var">StoppedNoError</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span class="hs-comment">-- | Run an instance of a contract</span><span>
</span><span id="line-151"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-type">runInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565269"><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565276"><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565271"><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565272"><span class="annot"><a href="#local-6989586621680565272"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractConstraints"><span class="hs-identifier hs-type">ContractConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier hs-type">EmulatorRuntimeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565272"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-157"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.NetworkId</span></span><span>
</span><span id="line-160"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorMessage"><span class="hs-identifier hs-type">EmulatorMessage</span></a></span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceThreadEffs"><span class="hs-identifier hs-type">ContractInstanceThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565272"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span id="runInstance"><span class="annot"><span class="annottext">runInstance :: NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var hs-var">runInstance</span></a></span></span><span> </span><span id="local-6989586621680564813"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span id="local-6989586621680564812"><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span></span><span> </span><span id="local-6989586621680564811"><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564811"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>    </span><span id="local-6989586621680564810"><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564810"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-165"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Request PABReq] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564810"><span class="hs-identifier hs-var">hks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff (ContractInstanceThreadEffs w s e effs) ()
 -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e ()
 -&gt; ResumableResult w e PABResp PABReq ())
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs)
     (ResumableResult w e PABResp PABReq ())
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (ResumableResult w e PABResp PABReq ())
  (SuspendedContract w e PABResp PABReq ())
  (ResumableResult w e PABResp PABReq ())
-&gt; SuspendedContract w e PABResp PABReq ()
-&gt; ResumableResult w e PABResp PABReq ()
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (ResumableResult w e PABResp PABReq ())
  (SuspendedContract w e PABResp PABReq ())
  (ResumableResult w e PABResp PABReq ())
forall w e i o a.
Lens' (SuspendedContract w e i o a) (ResumableResult w e i o a)
</span><a href="Plutus.Contract.Types.html#resumableResult"><span class="hs-identifier hs-var">resumableResult</span></a></span><span> </span><span class="annot"><span class="annottext">(SuspendedContract w e PABResp PABReq ()
 -&gt; ResumableResult w e PABResp PABReq ())
-&gt; (ContractInstanceStateInternal w s e ()
    -&gt; SuspendedContract w e PABResp PABReq ())
-&gt; ContractInstanceStateInternal w s e ()
-&gt; ResumableResult w e PABResp PABReq ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
-&gt; SuspendedContract w e PABResp PABReq ()
forall w (s :: Row *) e a.
ContractInstanceStateInternal w s e a
-&gt; SuspendedContract w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#cisiSuspState"><span class="hs-identifier hs-var hs-var">cisiSuspState</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff
  (ContractInstanceThreadEffs w s e effs)
  (ResumableResult w e PABResp PABReq ())
-&gt; (ResumableResult w e PABResp PABReq ()
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ResumableResult w e PABResp PABReq ()
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs, Show e) =&gt;
ResumableResult w e PABResp PABReq () -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logStopped"><span class="hs-identifier hs-var">logStopped</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Request PABReq] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564810"><span class="hs-identifier hs-var">hks</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Eff (ContractInstanceThreadEffs w s e effs) ()
 -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564811"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorMessage
</span><a href="Plutus.Trace.Emulator.Types.html#Freeze"><span class="hs-identifier hs-var">Freeze</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>                </span><span class="annot"><span class="annottext">ContractInstanceMsg
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#Freezing"><span class="hs-identifier hs-var">Freezing</span></a></span><span>
</span><span id="line-171"></span><span>                </span><span class="hs-comment">-- freeze ourselves, see note [Freeze and Thaw]</span><span>
</span><span id="line-172"></span><span>                </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Frozen"><span class="hs-identifier hs-var">Frozen</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-173"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EndpointCall"><span class="hs-identifier hs-type">EndpointCall</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680564808"><span class="annot"><span class="annottext">EndpointDescription
</span><a href="#local-6989586621680564808"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span id="local-6989586621680564807"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564807"><span class="hs-identifier hs-var">vl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><span class="annottext">ContractInstanceMsg
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg
 -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; ContractInstanceMsg
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointDescription -&gt; Value -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#ReceiveEndpointCall"><span class="hs-identifier hs-var">ReceiveEndpointCall</span></a></span><span> </span><span class="annot"><span class="annottext">EndpointDescription
</span><a href="#local-6989586621680564808"><span class="hs-identifier hs-var">desc</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564807"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-175"></span><span>                </span><span id="local-6989586621680564806"><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564806"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Eff (ContractInstanceThreadEffs w s e effs) PABResp
forall (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (Error EmulatorRuntimeError) effs) =&gt;
Value -&gt; Eff effs PABResp
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#decodeEvent"><span class="hs-identifier hs-var">decodeEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564807"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-176"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PABResp
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe (Response PABResp))
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Members EmulatedWalletEffects effs,
 Member (Reader ContractInstanceId) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
PABResp -&gt; Eff effs (Maybe (Response PABResp))
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToEvent"><span class="hs-identifier hs-var">respondToEvent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564806"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-177"></span><span>                </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-178"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateRequest"><span class="hs-identifier hs-type">ContractInstanceStateRequest</span></a></span><span> </span><span id="local-6989586621680564803"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564803"><span class="hs-identifier hs-var">sender</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>                </span><span class="annot"><span class="annottext">ThreadId -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ToJSON e, ToJSON w) =&gt;
ThreadId -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#handleObservableStateRequest"><span class="hs-identifier hs-var">handleObservableStateRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564803"><span class="hs-identifier hs-var">sender</span></a></span><span>
</span><span id="line-180"></span><span>                </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#NewSlot"><span class="hs-identifier hs-type">NewSlot</span></a></span><span> </span><span id="local-6989586621680564801"><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680564801"><span class="hs-identifier hs-var">block</span></a></span></span><span> </span><span class="annot"><span class="annottext">Slot
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-182"></span><span>                </span><span class="annot"><span class="annottext">Block -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Block -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#processNewTransactions"><span class="hs-identifier hs-var">processNewTransactions</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565269"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565276"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565271"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Block] -&gt; Block
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">join</span></a></span><span> </span><span class="annot"><span class="annottext">[Block]
</span><a href="#local-6989586621680564801"><span class="hs-identifier hs-var">block</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-184"></span><span>            </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Monoid w =&gt;
Bool
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#waitForNextMessage"><span class="hs-identifier hs-var">waitForNextMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
NetworkId
-&gt; Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstance"><span class="hs-identifier hs-var">runInstance</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680564813"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564812"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">-- | Run an instance to only answer to observable state requests even when the</span><span>
</span><span id="line-187"></span><span class="hs-comment">-- contract has stopped.</span><span>
</span><span id="line-188"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstanceObservableState"><span class="hs-identifier hs-type">runInstanceObservableState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565264"><span class="annot"><a href="#local-6989586621680565264"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565267"><span class="annot"><a href="#local-6989586621680565267"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565265"><span class="annot"><a href="#local-6989586621680565265"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565266"><span class="annot"><a href="#local-6989586621680565266"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractConstraints"><span class="hs-identifier hs-type">ContractConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565267"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier hs-type">EmulatorRuntimeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565266"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-191"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Show</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565265"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565265"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565264"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565264"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Types.html#Contract"><span class="hs-identifier hs-type">Contract</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565264"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565267"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565265"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorMessage"><span class="hs-identifier hs-type">EmulatorMessage</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceThreadEffs"><span class="hs-identifier hs-type">ContractInstanceThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565264"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565267"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565265"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565266"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span id="runInstanceObservableState"><span class="annot"><span class="annottext">runInstanceObservableState :: Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstanceObservableState"><span class="hs-identifier hs-var hs-var">runInstanceObservableState</span></a></span></span><span> </span><span id="local-6989586621680564798"><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564798"><span class="hs-identifier hs-var">contract</span></a></span></span><span> </span><span id="local-6989586621680564797"><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564797"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><a href="#local-6989586621680564797"><span class="hs-identifier hs-var">event</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-201"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateRequest"><span class="hs-identifier hs-type">ContractInstanceStateRequest</span></a></span><span> </span><span id="local-6989586621680564796"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564796"><span class="hs-identifier hs-var">sender</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><span class="annottext">ThreadId -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ToJSON e, ToJSON w) =&gt;
ThreadId -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#handleObservableStateRequest"><span class="hs-identifier hs-var">handleObservableStateRequest</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564796"><span class="hs-identifier hs-var">sender</span></a></span><span>
</span><span id="line-203"></span><span>            </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstanceObservableState"><span class="hs-identifier hs-var">runInstanceObservableState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564798"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="annot"><span class="annottext">Maybe EmulatorMessage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Monoid w =&gt;
Bool
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#waitForNextMessage"><span class="hs-identifier hs-var">waitForNextMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; (Maybe EmulatorMessage
    -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(ContractConstraints s, Member (Error EmulatorRuntimeError) effs,
 Show e, ToJSON e, ToJSON w, Monoid w) =&gt;
Contract w s e ()
-&gt; Maybe EmulatorMessage
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#runInstanceObservableState"><span class="hs-identifier hs-var">runInstanceObservableState</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s e ()
</span><a href="#local-6989586621680564798"><span class="hs-identifier hs-var">contract</span></a></span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="hs-comment">-- | Contract instance state request handler.</span><span>
</span><span id="line-207"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#handleObservableStateRequest"><span class="hs-identifier hs-type">handleObservableStateRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565178"><span class="annot"><a href="#local-6989586621680565178"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565177"><span class="annot"><a href="#local-6989586621680565177"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565179"><span class="annot"><a href="#local-6989586621680565179"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565176"><span class="annot"><a href="#local-6989586621680565176"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565179"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.ToJSON</span></span><span> </span><span class="annot"><a href="#local-6989586621680565178"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ Thread ID sending the request</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceThreadEffs"><span class="hs-identifier hs-type">ContractInstanceThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565178"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565177"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565179"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565176"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-213"></span><span id="handleObservableStateRequest"><span class="annot"><span class="annottext">handleObservableStateRequest :: ThreadId -&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#handleObservableStateRequest"><span class="hs-identifier hs-var hs-var">handleObservableStateRequest</span></a></span></span><span> </span><span id="local-6989586621680564795"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564795"><span class="hs-identifier hs-var">sender</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-214"></span><span>    </span><span id="local-6989586621680564794"><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
</span><a href="#local-6989586621680564794"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs (ContractInstanceStateInternal w s e ())
forall s (effs :: [* -&gt; *]). Member (State s) effs =&gt; Eff effs s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565178"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565177"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565179"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-comment">-- TODO: Maybe we should send it as a 'Dynamic' instead of</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-comment">-- JSON? It all stays in the same process, and it would save</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-comment">-- us having to convert to 'Value' and back.</span><span>
</span><span id="line-219"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564793"><span class="annot"><span class="annottext">stateJSON :: Value
</span><a href="#local-6989586621680564793"><span class="hs-identifier hs-var hs-var">stateJSON</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContractInstanceState w s e () -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">JSON.toJSON</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceState w s e () -&gt; Value)
-&gt; ContractInstanceState w s e () -&gt; Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
-&gt; ContractInstanceState w s e ()
forall w (s :: Row *) e a.
ContractInstanceStateInternal w s e a
-&gt; ContractInstanceState w s e a
</span><a href="Plutus.Trace.Emulator.Types.html#toInstanceState"><span class="hs-identifier hs-var">toInstanceState</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
</span><a href="#local-6989586621680564794"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><span class="annottext">ContractInstanceMsg
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg
 -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; ContractInstanceMsg
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#SendingContractState"><span class="hs-identifier hs-var">SendingContractState</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564795"><span class="hs-identifier hs-var">sender</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><span class="annottext">Eff (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff
   (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
 -&gt; Eff (ContractInstanceThreadEffs w s e effs) ())
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
-&gt; Eff (ContractInstanceThreadEffs w s e effs) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadId -&gt; EmulatorMessage -&gt; MessageCall EmulatorMessage
forall systemEvent.
ThreadId -&gt; systemEvent -&gt; MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#Message"><span class="hs-identifier hs-var">Message</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680564795"><span class="hs-identifier hs-var">sender</span></a></span><span> </span><span class="annot"><span class="annottext">(EmulatorMessage -&gt; MessageCall EmulatorMessage)
-&gt; EmulatorMessage -&gt; MessageCall EmulatorMessage
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; EmulatorMessage
</span><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateResponse"><span class="hs-identifier hs-var">ContractInstanceStateResponse</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564793"><span class="hs-identifier hs-var">stateJSON</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Wait for the next emulator message.</span><span>
</span><span id="line-224"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#waitForNextMessage"><span class="hs-identifier hs-type">waitForNextMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565166"><span class="annot"><a href="#local-6989586621680565166"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565165"><span class="annot"><a href="#local-6989586621680565165"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565164"><span class="annot"><a href="#local-6989586621680565164"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565163"><span class="annot"><a href="#local-6989586621680565163"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565166"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-comment">-- ^ Flag on whether to log 'NoRequestsHandled' messages</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceThreadEffs"><span class="hs-identifier hs-type">ContractInstanceThreadEffs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565166"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565165"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565164"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565163"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorMessage"><span class="hs-identifier hs-type">EmulatorMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span id="waitForNextMessage"><span class="annot"><span class="annottext">waitForNextMessage :: Bool
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#waitForNextMessage"><span class="hs-identifier hs-var hs-var">waitForNextMessage</span></a></span></span><span> </span><span id="local-6989586621680564791"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564791"><span class="hs-identifier hs-var">isLogShowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>    </span><span id="local-6989586621680564790"><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564790"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe (Response PABResp))
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (Reader ContractInstanceId) effs,
 Member (LogMsg ContractInstanceMsg) effs,
 Members EmulatedWalletEffects effs, Monoid w) =&gt;
Bool
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff effs (Maybe (Response PABResp))
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToRequest"><span class="hs-identifier hs-var">respondToRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565166"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565165"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565164"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564791"><span class="hs-identifier hs-var">isLogShowed</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#handleBlockchainQueries"><span class="hs-identifier hs-var">handleBlockchainQueries</span></a></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564787"><span class="annot"><span class="annottext">prio :: Priority
</span><a href="#local-6989586621680564787"><span class="hs-identifier hs-var hs-var">prio</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-232"></span><span>            </span><span class="annot"><span class="annottext">Priority
-&gt; (Response PABResp -&gt; Priority)
-&gt; Maybe (Response PABResp)
-&gt; Priority
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span>
</span><span id="line-233"></span><span>                </span><span class="hs-comment">-- If no events could be handled we go to sleep</span><span>
</span><span id="line-234"></span><span>                </span><span class="hs-comment">-- with the lowest priority, waking only after</span><span>
</span><span id="line-235"></span><span>                </span><span class="hs-comment">-- some external event has happened, for example</span><span>
</span><span id="line-236"></span><span>                </span><span class="hs-comment">-- when a new block was added.</span><span>
</span><span id="line-237"></span><span>                </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Sleeping"><span class="hs-identifier hs-var">Sleeping</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>                </span><span class="hs-comment">-- If an event was handled we go to sleep with</span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-comment">-- the 'Normal' priority, trying again after all</span><span>
</span><span id="line-241"></span><span>                </span><span class="hs-comment">-- other active threads have had their turn</span><span>
</span><span id="line-242"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Priority -&gt; Response PABResp -&gt; Priority
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564790"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="annottext">Priority
-&gt; MessageCall EmulatorMessage
-&gt; Eff
     (ContractInstanceThreadEffs w s e effs) (Maybe EmulatorMessage)
forall (effs :: [* -&gt; *]) systemEvent.
Member
  (Yield (AgentSystemCall systemEvent) (Maybe systemEvent)) effs =&gt;
Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var">mkAgentSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680564787"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall EmulatorMessage
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#handleBlockchainQueries"><span class="hs-identifier hs-type">handleBlockchainQueries</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#RequestHandler"><span class="hs-identifier hs-type">RequestHandler</span></a></span><span>
</span><span id="line-248"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier hs-type">EmulatedWalletEffects</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>        </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier hs-type">PABReq</span></a></span><span>
</span><span id="line-250"></span><span>        </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span>
</span><span id="line-251"></span><span id="handleBlockchainQueries"><span class="annot"><span class="annottext">handleBlockchainQueries :: RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#handleBlockchainQueries"><span class="hs-identifier hs-var hs-var">handleBlockchainQueries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (LogMsg RequestHandlerLogMsg) effs,
 Member WalletEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleUnbalancedTransactions"><span class="hs-identifier hs-var">RequestHandler.handleUnbalancedTransactions</span></a></span><span>
</span><span id="line-253"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (LogMsg RequestHandlerLogMsg) effs,
 Member WalletEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handlePendingTransactions"><span class="hs-identifier hs-var">RequestHandler.handlePendingTransactions</span></a></span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member ChainIndexQueryEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleChainIndexQueries"><span class="hs-identifier hs-var">RequestHandler.handleChainIndexQueries</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member WalletEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleOwnAddressesQueries"><span class="hs-identifier hs-var">RequestHandler.handleOwnAddressesQueries</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (Reader ContractInstanceId) effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleOwnInstanceIdQueries"><span class="hs-identifier hs-var">RequestHandler.handleOwnInstanceIdQueries</span></a></span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (LogMsg RequestHandlerLogMsg) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleSlotNotifications"><span class="hs-identifier hs-var">RequestHandler.handleSlotNotifications</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleCurrentNodeClientSlotQueries"><span class="hs-identifier hs-var">RequestHandler.handleCurrentNodeClientSlotQueries</span></a></span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member ChainIndexQueryEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleCurrentChainIndexSlotQueries"><span class="hs-identifier hs-var">RequestHandler.handleCurrentChainIndexSlotQueries</span></a></span><span>
</span><span id="line-260"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (LogMsg RequestHandlerLogMsg) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleTimeNotifications"><span class="hs-identifier hs-var">RequestHandler.handleTimeNotifications</span></a></span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleCurrentTimeQueries"><span class="hs-identifier hs-var">RequestHandler.handleCurrentTimeQueries</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleCurrentNodeClientTimeRangeQueries"><span class="hs-identifier hs-var">RequestHandler.handleCurrentNodeClientTimeRangeQueries</span></a></span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleTimeToSlotConversions"><span class="hs-identifier hs-var">RequestHandler.handleTimeToSlotConversions</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member WalletEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleYieldedUnbalancedTx"><span class="hs-identifier hs-var">RequestHandler.handleYieldedUnbalancedTx</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member (LogMsg RequestHandlerLogMsg) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleAdjustUnbalancedTx"><span class="hs-identifier hs-var">RequestHandler.handleAdjustUnbalancedTx</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]).
(Member (LogObserve (LogMessage Text)) effs,
 Member NodeClientEffect effs) =&gt;
RequestHandler effs PABReq PABResp
</span><a href="Plutus.Contract.Trace.html#handleGetParams"><span class="hs-identifier hs-var">RequestHandler.handleGetParams</span></a></span><span>
</span><span id="line-267"></span><span>
</span><span id="line-268"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#decodeEvent"><span class="hs-identifier hs-type">decodeEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565187"><span class="annot"><a href="#local-6989586621680565187"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-270"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565187"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-271"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatorRuntimeError"><span class="hs-identifier hs-type">EmulatorRuntimeError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565187"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-273"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">JSON.Value</span></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565187"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span>
</span><span id="line-275"></span><span id="decodeEvent"><span class="annot"><span class="annottext">decodeEvent :: Value -&gt; Eff effs PABResp
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#decodeEvent"><span class="hs-identifier hs-var hs-var">decodeEvent</span></a></span></span><span> </span><span id="local-6989586621680564770"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564770"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Result PABResp
forall a. FromJSON a =&gt; Value -&gt; Result a
</span><span class="hs-identifier hs-var">JSON.fromJSON</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564770"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">JSON.Error</span></span><span> </span><span id="local-6989586621680564767"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680564767"><span class="hs-identifier hs-var">e'</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-278"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564766"><span class="annot"><span class="annottext">msg :: EmulatorRuntimeError
</span><a href="#local-6989586621680564766"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Value -&gt; EmulatorRuntimeError
</span><a href="Plutus.Trace.Emulator.Types.html#EmulatorJSONDecodingError"><span class="hs-identifier hs-var">EmulatorJSONDecodingError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621680564767"><span class="hs-identifier hs-var">e'</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680564770"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-279"></span><span>                </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logError</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg -&gt; Eff effs ())
-&gt; ContractInstanceMsg -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorRuntimeError -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#InstErr"><span class="hs-identifier hs-var">InstErr</span></a></span><span> </span><span class="annot"><span class="annottext">EmulatorRuntimeError
</span><a href="#local-6989586621680564766"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="annottext">EmulatorRuntimeError -&gt; Eff effs PABResp
forall e (effs :: [* -&gt; *]) a.
Member (Error e) effs =&gt;
e -&gt; Eff effs a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">EmulatorRuntimeError
</span><a href="#local-6989586621680564766"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-281"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">JSON.Success</span></span><span> </span><span id="local-6989586621680564764"><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564764"><span class="hs-identifier hs-var">event'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PABResp -&gt; Eff effs PABResp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564764"><span class="hs-identifier hs-var">event'</span></a></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-type">getHooks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565208"><span class="annot"><a href="#local-6989586621680565208"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565207"><span class="annot"><a href="#local-6989586621680565207"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565206"><span class="annot"><a href="#local-6989586621680565206"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565209"><span class="annot"><a href="#local-6989586621680565209"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565208"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565207"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565206"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565209"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565209"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier hs-type">PABReq</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-284"></span><span id="getHooks"><span class="annot"><span class="annottext">getHooks :: Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var hs-var">getHooks</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e () -&gt; [Request PABReq])
-&gt; Eff effs [Request PABReq]
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565208"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565207"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565206"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Requests PABReq -&gt; [Request PABReq]
forall o. Requests o -&gt; [Request o]
</span><a href="Plutus.Contract.Resumable.html#unRequests"><span class="hs-identifier hs-var hs-var">State.unRequests</span></a></span><span> </span><span class="annot"><span class="annottext">(Requests PABReq -&gt; [Request PABReq])
-&gt; (ContractInstanceStateInternal w s e () -&gt; Requests PABReq)
-&gt; ContractInstanceStateInternal w s e ()
-&gt; [Request PABReq]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Requests PABReq)
  (ResumableResult w e PABResp PABReq ())
  (Requests PABReq)
-&gt; ResumableResult w e PABResp PABReq () -&gt; Requests PABReq
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Requests PABReq)
  (ResumableResult w e PABResp PABReq ())
  (Requests PABReq)
forall w e i o1 a o2.
Lens
  (ResumableResult w e i o1 a)
  (ResumableResult w e i o2 a)
  (Requests o1)
  (Requests o2)
</span><a href="Plutus.Contract.Types.html#requests"><span class="hs-identifier hs-var">requests</span></a></span><span> </span><span class="annot"><span class="annottext">(ResumableResult w e PABResp PABReq () -&gt; Requests PABReq)
-&gt; (ContractInstanceStateInternal w s e ()
    -&gt; ResumableResult w e PABResp PABReq ())
-&gt; ContractInstanceStateInternal w s e ()
-&gt; Requests PABReq
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (ResumableResult w e PABResp PABReq ())
  (SuspendedContract w e PABResp PABReq ())
  (ResumableResult w e PABResp PABReq ())
-&gt; SuspendedContract w e PABResp PABReq ()
-&gt; ResumableResult w e PABResp PABReq ()
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (ResumableResult w e PABResp PABReq ())
  (SuspendedContract w e PABResp PABReq ())
  (ResumableResult w e PABResp PABReq ())
forall w e i o a.
Lens' (SuspendedContract w e i o a) (ResumableResult w e i o a)
</span><a href="Plutus.Contract.Types.html#resumableResult"><span class="hs-identifier hs-var">resumableResult</span></a></span><span> </span><span class="annot"><span class="annottext">(SuspendedContract w e PABResp PABReq ()
 -&gt; ResumableResult w e PABResp PABReq ())
-&gt; (ContractInstanceStateInternal w s e ()
    -&gt; SuspendedContract w e PABResp PABReq ())
-&gt; ContractInstanceStateInternal w s e ()
-&gt; ResumableResult w e PABResp PABReq ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
-&gt; SuspendedContract w e PABResp PABReq ()
forall w (s :: Row *) e a.
ContractInstanceStateInternal w s e a
-&gt; SuspendedContract w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#cisiSuspState"><span class="hs-identifier hs-var hs-var">cisiSuspState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- | Update the contract instance with information from the new block.</span><span>
</span><span id="line-287"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#processNewTransactions"><span class="hs-identifier hs-type">processNewTransactions</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-288"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565173"><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565172"><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565171"><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565170"><span class="annot"><a href="#local-6989586621680565170"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-289"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565170"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565170"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChainTx</span></span><span class="hs-special">]</span><span>
</span><span id="line-294"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565170"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-295"></span><span id="processNewTransactions"><span class="annot"><span class="annottext">processNewTransactions :: Block -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#processNewTransactions"><span class="hs-identifier hs-var hs-var">processNewTransactions</span></a></span></span><span> </span><span id="local-6989586621680564762"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680564762"><span class="hs-identifier hs-var">txns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><span class="annottext">Block -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Block -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxStatus"><span class="hs-identifier hs-var">updateTxStatus</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680564762"><span class="hs-identifier hs-var">txns</span></a></span><span>
</span><span id="line-297"></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564760"><span class="annot"><span class="annottext">ciTxns :: [ChainIndexTx]
</span><a href="#local-6989586621680564760"><span class="hs-identifier hs-var hs-var">ciTxns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OnChainTx -&gt; ChainIndexTx) -&gt; Block -&gt; [ChainIndexTx]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; ChainIndexTx
</span><span class="hs-identifier hs-var">fromOnChainTx</span></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680564762"><span class="hs-identifier hs-var">txns</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="annot"><span class="annottext">[ChainIndexTx] -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
[ChainIndexTx] -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutStatus"><span class="hs-identifier hs-var">updateTxOutStatus</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainIndexTx]
</span><a href="#local-6989586621680564760"><span class="hs-identifier hs-var">ciTxns</span></a></span><span>
</span><span id="line-300"></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564758"><span class="annot"><span class="annottext">blck :: IndexedBlock
</span><a href="#local-6989586621680564758"><span class="hs-identifier hs-var hs-var">blck</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ChainIndexTx] -&gt; IndexedBlock
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#indexBlock"><span class="hs-identifier hs-var">indexBlock</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainIndexTx]
</span><a href="#local-6989586621680564760"><span class="hs-identifier hs-var">ciTxns</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="annot"><span class="annottext">IndexedBlock -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
IndexedBlock -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutSpent"><span class="hs-identifier hs-var">updateTxOutSpent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564758"><span class="hs-identifier hs-var">blck</span></a></span><span>
</span><span id="line-303"></span><span>    </span><span class="annot"><span class="annottext">IndexedBlock -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
IndexedBlock -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutProduced"><span class="hs-identifier hs-var">updateTxOutProduced</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565173"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565172"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565171"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564758"><span class="hs-identifier hs-var">blck</span></a></span><span>
</span><span id="line-304"></span><span>
</span><span id="line-305"></span><span class="hs-comment">-- | Update the contract instance with transaction status information from the</span><span>
</span><span id="line-306"></span><span class="hs-comment">--   new block.</span><span>
</span><span id="line-307"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxStatus"><span class="hs-identifier hs-type">updateTxStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680564755"><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680564754"><span class="annot"><a href="#local-6989586621680564754"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680564753"><span class="annot"><a href="#local-6989586621680564753"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680564752"><span class="annot"><a href="#local-6989586621680564752"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564752"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564752"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">OnChainTx</span></span><span class="hs-special">]</span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680564752"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span id="updateTxStatus"><span class="annot"><span class="annottext">updateTxStatus :: Block -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxStatus"><span class="hs-identifier hs-var hs-var">updateTxStatus</span></a></span></span><span> </span><span id="local-6989586621680564751"><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680564751"><span class="hs-identifier hs-var">txns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>    </span><span class="hs-comment">-- Check whether the contract instance is waiting for a status change of any</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-comment">-- of the new transactions. If that is the case, call 'addResponse' to send the</span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-comment">-- response.</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564750"><span class="annot"><span class="annottext">txWithStatus :: OnChainTx -&gt; (TxId, TxValidity)
</span><a href="#local-6989586621680564750"><span class="hs-identifier hs-var hs-var">txWithStatus</span></a></span></span><span> </span><span id="local-6989586621680564749"><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680564749"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoTx -&gt; TxId
</span><span class="hs-identifier hs-var">getCardanoTxId</span></span><span> </span><span class="annot"><span class="annottext">(CardanoTx -&gt; TxId) -&gt; CardanoTx -&gt; TxId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; CardanoTx
</span><span class="hs-identifier hs-var">unOnChain</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680564749"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; Bool
</span><span class="hs-identifier hs-var">onChainTxIsValid</span></span><span> </span><span class="annot"><span class="annottext">OnChainTx
</span><a href="#local-6989586621680564749"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TxValidity
</span><span class="hs-identifier hs-var">TxValid</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TxValidity
</span><span class="hs-identifier hs-var">TxInvalid</span></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>        </span><span id="local-6989586621680564748"><span class="annot"><span class="annottext">statusMap :: Map TxId TxValidity
</span><a href="#local-6989586621680564748"><span class="hs-identifier hs-var hs-var">statusMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxId, TxValidity)] -&gt; Map TxId TxValidity
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(TxId, TxValidity)] -&gt; Map TxId TxValidity)
-&gt; [(TxId, TxValidity)] -&gt; Map TxId TxValidity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(OnChainTx -&gt; (TxId, TxValidity)) -&gt; Block -&gt; [(TxId, TxValidity)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">OnChainTx -&gt; (TxId, TxValidity)
</span><a href="#local-6989586621680564750"><span class="hs-identifier hs-var">txWithStatus</span></a></span><span> </span><span class="annot"><span class="annottext">Block
</span><a href="#local-6989586621680564751"><span class="hs-identifier hs-var">txns</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span id="local-6989586621680564746"><span class="annot"><span class="annottext">[Request TxId]
</span><a href="#local-6989586621680564746"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Request PABReq -&gt; Maybe (Request TxId))
-&gt; [Request PABReq] -&gt; [Request TxId]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABReq -&gt; Maybe TxId) -&gt; Request PABReq -&gt; Maybe (Request TxId)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First TxId) PABReq TxId -&gt; PABReq -&gt; Maybe TxId
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First TxId) PABReq TxId
Prism' PABReq TxId
</span><a href="Plutus.Contract.Effects.html#_AwaitTxStatusChangeReq"><span class="hs-identifier hs-var">E._AwaitTxStatusChangeReq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Request PABReq] -&gt; [Request TxId])
-&gt; Eff effs [Request PABReq] -&gt; Eff effs [Request TxId]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564753"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564742"><span class="annot"><span class="annottext">mpReq :: Request TxId -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564742"><span class="hs-identifier hs-var hs-var">mpReq</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564741"><span class="annot"><span class="annottext">RequestID
rqID :: RequestID
rqID :: forall o. Request o -&gt; RequestID
</span><a href="#local-6989586621680564741"><span class="hs-identifier hs-var hs-var">rqID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564740"><span class="annot"><span class="annottext">IterationID
itID :: IterationID
itID :: forall o. Request o -&gt; IterationID
</span><a href="#local-6989586621680564740"><span class="hs-identifier hs-var hs-var">itID</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rqRequest :: forall o. Request o -&gt; o
</span><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier hs-var">rqRequest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680564739"><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621680564739"><span class="hs-identifier hs-var">txid</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxId -&gt; Map TxId TxValidity -&gt; Maybe TxValidity
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621680564739"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxId TxValidity
</span><a href="#local-6989586621680564748"><span class="hs-identifier hs-var">statusMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><span class="annottext">Maybe TxValidity
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-325"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680564737"><span class="annot"><span class="annottext">TxValidity
</span><a href="#local-6989586621680564737"><span class="hs-identifier hs-var">newStatus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Response PABResp -&gt; Maybe (Response PABResp)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response :: forall i. RequestID -&gt; IterationID -&gt; i -&gt; Response i
</span><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">rspRqID :: RequestID
</span><a href="Plutus.Contract.Resumable.html#rspRqID"><span class="hs-identifier hs-var">rspRqID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">RequestID
</span><a href="#local-6989586621680564741"><span class="hs-identifier hs-var">rqID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspItID :: IterationID
</span><a href="Plutus.Contract.Resumable.html#rspItID"><span class="hs-identifier hs-var">rspItID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">IterationID
</span><a href="#local-6989586621680564740"><span class="hs-identifier hs-var">itID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspResponse :: PABResp
</span><a href="Plutus.Contract.Resumable.html#rspResponse"><span class="hs-identifier hs-var">rspResponse</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TxId -&gt; TxStatus -&gt; PABResp
</span><a href="Plutus.Contract.Effects.html#AwaitTxStatusChangeResp"><span class="hs-identifier hs-var">AwaitTxStatusChangeResp</span></a></span><span> </span><span class="annot"><span class="annottext">TxId
</span><a href="#local-6989586621680564739"><span class="hs-identifier hs-var">txid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxValidity -&gt; () -&gt; TxStatus
forall a. TxValidity -&gt; a -&gt; RollbackState a
</span><span class="hs-identifier hs-var">Committed</span></span><span> </span><span class="annot"><span class="annottext">TxValidity
</span><a href="#local-6989586621680564737"><span class="hs-identifier hs-var">newStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>        </span><span id="local-6989586621680564736"><span class="annot"><span class="annottext">txStatusHk :: Maybe (Response PABResp)
</span><a href="#local-6989586621680564736"><span class="hs-identifier hs-var hs-var">txStatusHk</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response PABResp] -&gt; Maybe (Response PABResp)
forall a. [a] -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Response PABResp] -&gt; Maybe (Response PABResp))
-&gt; [Response PABResp] -&gt; Maybe (Response PABResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request TxId -&gt; Maybe (Response PABResp))
-&gt; [Request TxId] -&gt; [Response PABResp]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Request TxId -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564742"><span class="hs-identifier hs-var">mpReq</span></a></span><span> </span><span class="annot"><span class="annottext">[Request TxId]
</span><a href="#local-6989586621680564746"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-327"></span><span>    </span><span class="annot"><span class="annottext">(Response PABResp -&gt; Eff effs ())
-&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var">addResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564753"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564736"><span class="hs-identifier hs-var">txStatusHk</span></a></span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564755"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564754"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564753"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564736"><span class="hs-identifier hs-var">txStatusHk</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span class="hs-comment">-- | Update the contract instance with transaction outputs status information</span><span>
</span><span id="line-331"></span><span class="hs-comment">-- from the new block.</span><span>
</span><span id="line-332"></span><span class="hs-comment">--</span><span>
</span><span id="line-333"></span><span class="hs-comment">-- Currently, all tx outputs of a block will either go to the state</span><span>
</span><span id="line-334"></span><span class="hs-comment">-- 'TxOutConfirmedUnspent' or 'TxOutConfirmedSpent' (we don't currently</span><span>
</span><span id="line-335"></span><span class="hs-comment">-- represent the @TentativelyConfirmed@ state in the emulator.</span><span>
</span><span id="line-336"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutStatus"><span class="hs-identifier hs-type">updateTxOutStatus</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565101"><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565100"><span class="annot"><a href="#local-6989586621680565100"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565099"><span class="annot"><a href="#local-6989586621680565099"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565098"><span class="annot"><a href="#local-6989586621680565098"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-338"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565100"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565099"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565098"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-339"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565098"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ChainIndexTx</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Block of transactions</span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565098"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span id="updateTxOutStatus"><span class="annot"><span class="annottext">updateTxOutStatus :: [ChainIndexTx] -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutStatus"><span class="hs-identifier hs-var hs-var">updateTxOutStatus</span></a></span></span><span> </span><span id="local-6989586621680564734"><span class="annot"><span class="annottext">[ChainIndexTx]
</span><a href="#local-6989586621680564734"><span class="hs-identifier hs-var">txns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- Check whether the contract instance is waiting for a status change of a</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- transaction output of any of the new transactions. If that is the case,</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-comment">-- call 'addResponse' to sent the response.</span><span>
</span><span id="line-348"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564733"><span class="annot"><span class="annottext">getSpentOutputs :: ChainIndexTx -&gt; [TxOutRef]
</span><a href="#local-6989586621680564733"><span class="hs-identifier hs-var hs-var">getSpentOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Getting [TxOutRef] ChainIndexTx [TxOutRef]
-&gt; ChainIndexTx -&gt; [TxOutRef]
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting [TxOutRef] ChainIndexTx [TxOutRef]
Lens' ChainIndexTx [TxOutRef]
</span><span class="hs-identifier hs-var">citxInputs</span></span><span>
</span><span id="line-349"></span><span>        </span><span id="local-6989586621680564732"><span class="annot"><span class="annottext">txWithTxOutStatus :: ChainIndexTx -&gt; [(TxOutRef, RollbackState TxOutState)]
</span><a href="#local-6989586621680564732"><span class="hs-identifier hs-var hs-var">txWithTxOutStatus</span></a></span></span><span> </span><span id="local-6989586621680564731"><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564731"><span class="hs-identifier hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564730"><span class="annot"><span class="annottext">validity :: TxValidity
</span><a href="#local-6989586621680564730"><span class="hs-identifier hs-var hs-var">validity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ChainIndexTx -&gt; TxValidity
</span><span class="hs-identifier hs-var">validityFromChainIndex</span></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564731"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-350"></span><span>             </span><span class="annot"><span class="annottext">(TxOutRef -&gt; (TxOutRef, RollbackState TxOutState))
-&gt; [TxOutRef] -&gt; [(TxOutRef, RollbackState TxOutState)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">TxValidity -&gt; TxOutState -&gt; RollbackState TxOutState
forall a. TxValidity -&gt; a -&gt; RollbackState a
</span><span class="hs-identifier hs-var">Committed</span></span><span> </span><span class="annot"><span class="annottext">TxValidity
</span><a href="#local-6989586621680564730"><span class="hs-identifier hs-var">validity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxId -&gt; TxOutState
</span><span class="hs-identifier hs-var">Spent</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexTx -&gt; TxId
</span><span class="hs-identifier hs-var hs-var">_citxTxId</span></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564731"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexTx -&gt; [TxOutRef]
</span><a href="#local-6989586621680564733"><span class="hs-identifier hs-var">getSpentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564731"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-351"></span><span>          </span><span class="annot"><span class="annottext">[(TxOutRef, RollbackState TxOutState)]
-&gt; [(TxOutRef, RollbackState TxOutState)]
-&gt; [(TxOutRef, RollbackState TxOutState)]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; (TxOutRef, RollbackState TxOutState))
-&gt; [TxOutRef] -&gt; [(TxOutRef, RollbackState TxOutState)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">TxValidity -&gt; TxOutState -&gt; RollbackState TxOutState
forall a. TxValidity -&gt; a -&gt; RollbackState a
</span><span class="hs-identifier hs-var">Committed</span></span><span> </span><span class="annot"><span class="annottext">TxValidity
</span><a href="#local-6989586621680564730"><span class="hs-identifier hs-var">validity</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutState
</span><span class="hs-identifier hs-var">Unspent</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexTx -&gt; [TxOutRef]
</span><span class="hs-identifier hs-var">txOutRefs</span></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564731"><span class="hs-identifier hs-var">tx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621680564729"><span class="annot"><span class="annottext">statusMap :: Map TxOutRef (RollbackState TxOutState)
</span><a href="#local-6989586621680564729"><span class="hs-identifier hs-var hs-var">statusMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxOutRef, RollbackState TxOutState)]
-&gt; Map TxOutRef (RollbackState TxOutState)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="annot"><span class="annottext">([(TxOutRef, RollbackState TxOutState)]
 -&gt; Map TxOutRef (RollbackState TxOutState))
-&gt; [(TxOutRef, RollbackState TxOutState)]
-&gt; Map TxOutRef (RollbackState TxOutState)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ChainIndexTx -&gt; [(TxOutRef, RollbackState TxOutState)])
-&gt; [ChainIndexTx] -&gt; [(TxOutRef, RollbackState TxOutState)]
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx -&gt; [(TxOutRef, RollbackState TxOutState)]
</span><a href="#local-6989586621680564732"><span class="hs-identifier hs-var">txWithTxOutStatus</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainIndexTx]
</span><a href="#local-6989586621680564734"><span class="hs-identifier hs-var">txns</span></a></span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621680564727"><span class="annot"><span class="annottext">[Request TxIn]
</span><a href="#local-6989586621680564727"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Request PABReq -&gt; Maybe (Request TxIn))
-&gt; [Request PABReq] -&gt; [Request TxIn]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABReq -&gt; Maybe TxIn) -&gt; Request PABReq -&gt; Maybe (Request TxIn)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First TxIn) PABReq TxIn -&gt; PABReq -&gt; Maybe TxIn
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First TxIn) PABReq TxIn
Prism' PABReq TxIn
</span><a href="Plutus.Contract.Effects.html#_AwaitTxOutStatusChangeReq"><span class="hs-identifier hs-var">E._AwaitTxOutStatusChangeReq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Request PABReq] -&gt; [Request TxIn])
-&gt; Eff effs [Request PABReq] -&gt; Eff effs [Request TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565100"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565099"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564725"><span class="annot"><span class="annottext">mpReq :: Request TxIn -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564725"><span class="hs-identifier hs-var hs-var">mpReq</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564724"><span class="annot"><span class="annottext">RequestID
rqID :: RequestID
rqID :: forall o. Request o -&gt; RequestID
</span><a href="#local-6989586621680564724"><span class="hs-identifier hs-var hs-var">rqID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564723"><span class="annot"><span class="annottext">IterationID
itID :: IterationID
itID :: forall o. Request o -&gt; IterationID
</span><a href="#local-6989586621680564723"><span class="hs-identifier hs-var hs-var">itID</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rqRequest :: forall o. Request o -&gt; o
</span><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier hs-var">rqRequest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680564722"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680564722"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-355"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; Map TxOutRef (RollbackState TxOutState)
-&gt; Maybe (RollbackState TxOutState)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn -&gt; TxOutRef
</span><span class="hs-identifier hs-var">fromCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680564722"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef (RollbackState TxOutState)
</span><a href="#local-6989586621680564729"><span class="hs-identifier hs-var">statusMap</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-356"></span><span>                </span><span class="annot"><span class="annottext">Maybe (RollbackState TxOutState)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-357"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680564721"><span class="annot"><span class="annottext">RollbackState TxOutState
</span><a href="#local-6989586621680564721"><span class="hs-identifier hs-var">newStatus</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-358"></span><span>                    </span><span class="annot"><span class="annottext">Response PABResp -&gt; Maybe (Response PABResp)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response :: forall i. RequestID -&gt; IterationID -&gt; i -&gt; Response i
</span><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rspRqID :: RequestID
</span><a href="Plutus.Contract.Resumable.html#rspRqID"><span class="hs-identifier hs-var">rspRqID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">RequestID
</span><a href="#local-6989586621680564724"><span class="hs-identifier hs-var">rqID</span></a></span><span>
</span><span id="line-359"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspItID :: IterationID
</span><a href="Plutus.Contract.Resumable.html#rspItID"><span class="hs-identifier hs-var">rspItID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">IterationID
</span><a href="#local-6989586621680564723"><span class="hs-identifier hs-var">itID</span></a></span><span>
</span><span id="line-360"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspResponse :: PABResp
</span><a href="Plutus.Contract.Resumable.html#rspResponse"><span class="hs-identifier hs-var">rspResponse</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">TxIn -&gt; RollbackState TxOutState -&gt; PABResp
</span><a href="Plutus.Contract.Effects.html#AwaitTxOutStatusChangeResp"><span class="hs-identifier hs-var">E.AwaitTxOutStatusChangeResp</span></a></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680564722"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">RollbackState TxOutState
</span><a href="#local-6989586621680564721"><span class="hs-identifier hs-var">newStatus</span></a></span><span>
</span><span id="line-361"></span><span>                                  </span><span class="hs-special">}</span><span>
</span><span id="line-362"></span><span>        </span><span id="local-6989586621680564719"><span class="annot"><span class="annottext">utxoResp :: Maybe (Response PABResp)
</span><a href="#local-6989586621680564719"><span class="hs-identifier hs-var hs-var">utxoResp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response PABResp] -&gt; Maybe (Response PABResp)
forall a. [a] -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Response PABResp] -&gt; Maybe (Response PABResp))
-&gt; [Response PABResp] -&gt; Maybe (Response PABResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request TxIn -&gt; Maybe (Response PABResp))
-&gt; [Request TxIn] -&gt; [Response PABResp]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Request TxIn -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564725"><span class="hs-identifier hs-var">mpReq</span></a></span><span> </span><span class="annot"><span class="annottext">[Request TxIn]
</span><a href="#local-6989586621680564727"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="annot"><span class="annottext">(Response PABResp -&gt; Eff effs ())
-&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var">addResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565100"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565099"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564719"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-364"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565101"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565100"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565099"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564719"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-365"></span><span>
</span><span id="line-366"></span><span class="hs-comment">-- | Update the contract instance with transaction output information from the</span><span>
</span><span id="line-367"></span><span class="hs-comment">--   new block.</span><span>
</span><span id="line-368"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutProduced"><span class="hs-identifier hs-type">updateTxOutProduced</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680564718"><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680564717"><span class="annot"><a href="#local-6989586621680564717"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680564716"><span class="annot"><a href="#local-6989586621680564716"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680564715"><span class="annot"><a href="#local-6989586621680564715"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-370"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564717"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564716"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564715"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680564715"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680564715"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span id="updateTxOutProduced"><span class="annot"><span class="annottext">updateTxOutProduced :: IndexedBlock -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutProduced"><span class="hs-identifier hs-var hs-var">updateTxOutProduced</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564713"><span class="annot"><span class="annottext">Map CardanoAddress (NonEmpty ChainIndexTx)
ibUtxoProduced :: IndexedBlock -&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
ibUtxoProduced :: Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var hs-var">ibUtxoProduced</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- Check whether the contract instance is waiting for address changes</span><span>
</span><span id="line-378"></span><span>    </span><span id="local-6989586621680564711"><span class="annot"><span class="annottext">[Request CardanoAddress]
</span><a href="#local-6989586621680564711"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Request PABReq -&gt; Maybe (Request CardanoAddress))
-&gt; [Request PABReq] -&gt; [Request CardanoAddress]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABReq -&gt; Maybe CardanoAddress)
-&gt; Request PABReq -&gt; Maybe (Request CardanoAddress)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First CardanoAddress) PABReq CardanoAddress
-&gt; PABReq -&gt; Maybe CardanoAddress
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First CardanoAddress) PABReq CardanoAddress
Prism' PABReq CardanoAddress
</span><a href="Plutus.Contract.Effects.html#_AwaitUtxoProducedReq"><span class="hs-identifier hs-var">E._AwaitUtxoProducedReq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Request PABReq] -&gt; [Request CardanoAddress])
-&gt; Eff effs [Request PABReq] -&gt; Eff effs [Request CardanoAddress]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564717"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564716"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564709"><span class="annot"><span class="annottext">mpReq :: Request CardanoAddress -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564709"><span class="hs-identifier hs-var hs-var">mpReq</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564708"><span class="annot"><span class="annottext">RequestID
rqID :: RequestID
rqID :: forall o. Request o -&gt; RequestID
</span><a href="#local-6989586621680564708"><span class="hs-identifier hs-var hs-var">rqID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564707"><span class="annot"><span class="annottext">IterationID
itID :: IterationID
itID :: forall o. Request o -&gt; IterationID
</span><a href="#local-6989586621680564707"><span class="hs-identifier hs-var hs-var">itID</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rqRequest :: forall o. Request o -&gt; o
</span><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier hs-var">rqRequest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680564706"><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680564706"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-380"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">CardanoAddress
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
-&gt; Maybe (NonEmpty ChainIndexTx)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680564706"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="#local-6989586621680564713"><span class="hs-identifier hs-var">ibUtxoProduced</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-381"></span><span>                </span><span class="annot"><span class="annottext">Maybe (NonEmpty ChainIndexTx)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-382"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680564705"><span class="annot"><span class="annottext">NonEmpty ChainIndexTx
</span><a href="#local-6989586621680564705"><span class="hs-identifier hs-var">newTxns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Response PABResp -&gt; Maybe (Response PABResp)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response :: forall i. RequestID -&gt; IterationID -&gt; i -&gt; Response i
</span><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">rspRqID :: RequestID
</span><a href="Plutus.Contract.Resumable.html#rspRqID"><span class="hs-identifier hs-var">rspRqID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">RequestID
</span><a href="#local-6989586621680564708"><span class="hs-identifier hs-var">rqID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspItID :: IterationID
</span><a href="Plutus.Contract.Resumable.html#rspItID"><span class="hs-identifier hs-var">rspItID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">IterationID
</span><a href="#local-6989586621680564707"><span class="hs-identifier hs-var">itID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspResponse :: PABResp
</span><a href="Plutus.Contract.Resumable.html#rspResponse"><span class="hs-identifier hs-var">rspResponse</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">NonEmpty ChainIndexTx -&gt; PABResp
</span><a href="Plutus.Contract.Effects.html#AwaitUtxoProducedResp"><span class="hs-identifier hs-var">E.AwaitUtxoProducedResp</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty ChainIndexTx
</span><a href="#local-6989586621680564705"><span class="hs-identifier hs-var">newTxns</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-383"></span><span>        </span><span id="local-6989586621680564703"><span class="annot"><span class="annottext">utxoResp :: Maybe (Response PABResp)
</span><a href="#local-6989586621680564703"><span class="hs-identifier hs-var hs-var">utxoResp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response PABResp] -&gt; Maybe (Response PABResp)
forall a. [a] -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Response PABResp] -&gt; Maybe (Response PABResp))
-&gt; [Response PABResp] -&gt; Maybe (Response PABResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request CardanoAddress -&gt; Maybe (Response PABResp))
-&gt; [Request CardanoAddress] -&gt; [Response PABResp]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Request CardanoAddress -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564709"><span class="hs-identifier hs-var">mpReq</span></a></span><span> </span><span class="annot"><span class="annottext">[Request CardanoAddress]
</span><a href="#local-6989586621680564711"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-384"></span><span>    </span><span class="annot"><span class="annottext">(Response PABResp -&gt; Eff effs ())
-&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var">addResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564717"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564716"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564703"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-385"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564718"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564717"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680564716"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564703"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-386"></span><span>
</span><span id="line-387"></span><span class="hs-comment">-- | Update the contract instance with transaction input information from the</span><span>
</span><span id="line-388"></span><span class="hs-comment">--   new block.</span><span>
</span><span id="line-389"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutSpent"><span class="hs-identifier hs-type">updateTxOutSpent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565096"><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565095"><span class="annot"><a href="#local-6989586621680565095"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565094"><span class="annot"><a href="#local-6989586621680565094"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565093"><span class="annot"><a href="#local-6989586621680565093"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565094"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565093"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565093"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-393"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-394"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span>
</span><span id="line-396"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565093"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-397"></span><span id="updateTxOutSpent"><span class="annot"><span class="annottext">updateTxOutSpent :: IndexedBlock -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#updateTxOutSpent"><span class="hs-identifier hs-var hs-var">updateTxOutSpent</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564702"><span class="annot"><span class="annottext">Map TxIn ChainIndexTx
ibUtxoSpent :: IndexedBlock -&gt; Map TxIn ChainIndexTx
ibUtxoSpent :: Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var hs-var">ibUtxoSpent</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-comment">-- Check whether the contract instance is waiting for address changes</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621680564700"><span class="annot"><span class="annottext">[Request TxIn]
</span><a href="#local-6989586621680564700"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Request PABReq -&gt; Maybe (Request TxIn))
-&gt; [Request PABReq] -&gt; [Request TxIn]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABReq -&gt; Maybe TxIn) -&gt; Request PABReq -&gt; Maybe (Request TxIn)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting (First TxIn) PABReq TxIn -&gt; PABReq -&gt; Maybe TxIn
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First TxIn) PABReq TxIn
Prism' PABReq TxIn
</span><a href="Plutus.Contract.Effects.html#_AwaitUtxoSpentReq"><span class="hs-identifier hs-var">E._AwaitUtxoSpentReq</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Request PABReq] -&gt; [Request TxIn])
-&gt; Eff effs [Request PABReq] -&gt; Eff effs [Request TxIn]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565094"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-400"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564698"><span class="annot"><span class="annottext">mpReq :: Request TxIn -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564698"><span class="hs-identifier hs-var hs-var">mpReq</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Request"><span class="hs-identifier hs-type">Request</span></a></span><span class="hs-special">{</span><span id="local-6989586621680564697"><span class="annot"><span class="annottext">RequestID
rqID :: RequestID
rqID :: forall o. Request o -&gt; RequestID
</span><a href="#local-6989586621680564697"><span class="hs-identifier hs-var hs-var">rqID</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680564696"><span class="annot"><span class="annottext">IterationID
itID :: IterationID
itID :: forall o. Request o -&gt; IterationID
</span><a href="#local-6989586621680564696"><span class="hs-identifier hs-var hs-var">itID</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rqRequest :: forall o. Request o -&gt; o
</span><a href="Plutus.Contract.Resumable.html#rqRequest"><span class="hs-identifier hs-var">rqRequest</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680564695"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680564695"><span class="hs-identifier hs-var">addr</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-401"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TxIn -&gt; Map TxIn ChainIndexTx -&gt; Maybe ChainIndexTx
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621680564695"><span class="hs-identifier hs-var">addr</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn ChainIndexTx
</span><a href="#local-6989586621680564702"><span class="hs-identifier hs-var">ibUtxoSpent</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-402"></span><span>                </span><span class="annot"><span class="annottext">Maybe ChainIndexTx
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-403"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680564694"><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564694"><span class="hs-identifier hs-var">newTxns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Response PABResp -&gt; Maybe (Response PABResp)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Response :: forall i. RequestID -&gt; IterationID -&gt; i -&gt; Response i
</span><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">rspRqID :: RequestID
</span><a href="Plutus.Contract.Resumable.html#rspRqID"><span class="hs-identifier hs-var">rspRqID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">RequestID
</span><a href="#local-6989586621680564697"><span class="hs-identifier hs-var">rqID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspItID :: IterationID
</span><a href="Plutus.Contract.Resumable.html#rspItID"><span class="hs-identifier hs-var">rspItID</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">IterationID
</span><a href="#local-6989586621680564696"><span class="hs-identifier hs-var">itID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rspResponse :: PABResp
</span><a href="Plutus.Contract.Resumable.html#rspResponse"><span class="hs-identifier hs-var">rspResponse</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ChainIndexTx -&gt; PABResp
</span><a href="Plutus.Contract.Effects.html#AwaitUtxoSpentResp"><span class="hs-identifier hs-var">E.AwaitUtxoSpentResp</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564694"><span class="hs-identifier hs-var">newTxns</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-404"></span><span>        </span><span id="local-6989586621680564692"><span class="annot"><span class="annottext">utxoResp :: Maybe (Response PABResp)
</span><a href="#local-6989586621680564692"><span class="hs-identifier hs-var hs-var">utxoResp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Response PABResp] -&gt; Maybe (Response PABResp)
forall a. [a] -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([Response PABResp] -&gt; Maybe (Response PABResp))
-&gt; [Response PABResp] -&gt; Maybe (Response PABResp)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request TxIn -&gt; Maybe (Response PABResp))
-&gt; [Request TxIn] -&gt; [Response PABResp]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">Request TxIn -&gt; Maybe (Response PABResp)
</span><a href="#local-6989586621680564698"><span class="hs-identifier hs-var">mpReq</span></a></span><span> </span><span class="annot"><span class="annottext">[Request TxIn]
</span><a href="#local-6989586621680564700"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-405"></span><span>    </span><span class="annot"><span class="annottext">(Response PABResp -&gt; Eff effs ())
-&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var">addResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565094"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564692"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565096"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565095"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565094"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564692"><span class="hs-identifier hs-var">utxoResp</span></a></span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="hs-comment">-- | Add a 'Response' to the contract instance state</span><span>
</span><span id="line-409"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-type">addResponse</span></a></span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565054"><span class="annot"><a href="#local-6989586621680565054"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565053"><span class="annot"><a href="#local-6989586621680565053"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565052"><span class="annot"><a href="#local-6989586621680565052"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565055"><span class="annot"><a href="#local-6989586621680565055"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-411"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565054"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565052"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565055"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-412"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565055"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565054"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-415"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565055"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span id="addResponse"><span class="annot"><span class="annottext">addResponse :: Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var hs-var">addResponse</span></a></span></span><span> </span><span id="local-6989586621680564691"><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680564691"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>    </span><span id="local-6989586621680564690"><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
</span><a href="#local-6989586621680564690"><span class="hs-identifier hs-var">oldState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs (ContractInstanceStateInternal w s e ())
forall s (effs :: [* -&gt; *]). Member (State s) effs =&gt; Eff effs s
</span><span class="hs-identifier hs-var">get</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565054"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565052"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564689"><span class="annot"><span class="annottext">newState :: Maybe (ContractInstanceStateInternal w s e ())
</span><a href="#local-6989586621680564689"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Response PABResp
-&gt; ContractInstanceStateInternal w s e ()
-&gt; Maybe (ContractInstanceStateInternal w s e ())
forall w (s :: Row *) e a.
Monoid w =&gt;
Response PABResp
-&gt; ContractInstanceStateInternal w s e a
-&gt; Maybe (ContractInstanceStateInternal w s e a)
</span><a href="Plutus.Trace.Emulator.Types.html#addEventInstanceState"><span class="hs-identifier hs-var">addEventInstanceState</span></a></span><span> </span><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680564691"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
</span><a href="#local-6989586621680564690"><span class="hs-identifier hs-var">oldState</span></a></span><span>
</span><span id="line-420"></span><span>    </span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e () -&gt; Eff effs ())
-&gt; Maybe (ContractInstanceStateInternal w s e ()) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e () -&gt; Eff effs ()
forall s (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
s -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">Maybe (ContractInstanceStateInternal w s e ())
</span><a href="#local-6989586621680564689"><span class="hs-identifier hs-var">newState</span></a></span><span>
</span><span id="line-421"></span><span>    </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logNewMessages"><span class="hs-identifier hs-var">logNewMessages</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565054"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565053"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565052"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="hs-keyword">type</span><span> </span><span id="ContractInstanceRequests"><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceRequests"><span class="hs-identifier hs-var">ContractInstanceRequests</span></a></span></span><span> </span><span id="local-6989586621680564688"><span class="annot"><a href="#local-6989586621680564688"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-424"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span>
</span><span id="line-425"></span><span>         </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects%27"><span class="hs-identifier hs-type">EmulatedWalletEffects'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680564688"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span class="hs-comment">-- | Respond to a specific event</span><span>
</span><span id="line-428"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToEvent"><span class="hs-identifier hs-type">respondToEvent</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565185"><span class="annot"><a href="#local-6989586621680565185"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565184"><span class="annot"><a href="#local-6989586621680565184"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565183"><span class="annot"><a href="#local-6989586621680565183"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565182"><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565185"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565184"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565183"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Members</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier hs-type">EmulatedWalletEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-433"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-434"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565185"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-435"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span>
</span><span id="line-437"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565182"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span id="respondToEvent"><span class="annot"><span class="annottext">respondToEvent :: PABResp -&gt; Eff effs (Maybe (Response PABResp))
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToEvent"><span class="hs-identifier hs-var hs-var">respondToEvent</span></a></span></span><span> </span><span id="local-6989586621680564687"><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564687"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff effs (Maybe (Response PABResp))
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (Reader ContractInstanceId) effs,
 Member (LogMsg ContractInstanceMsg) effs,
 Members EmulatedWalletEffects effs, Monoid w) =&gt;
Bool
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff effs (Maybe (Response PABResp))
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToRequest"><span class="hs-identifier hs-var">respondToRequest</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565185"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565184"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565183"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="annot"><span class="annottext">(RequestHandler
   (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
 -&gt; Eff effs (Maybe (Response PABResp)))
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff effs (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PABReq
 -&gt; Eff
      (NonDet : Reader ContractInstanceId : EmulatedWalletEffects)
      PABResp)
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall (effs :: [* -&gt; *]) req resp.
(req -&gt; Eff (NonDet : effs) resp) -&gt; RequestHandler effs req resp
</span><a href="Plutus.Contract.Trace.RequestHandler.html#RequestHandler"><span class="hs-identifier hs-var">RequestHandler</span></a></span><span> </span><span class="annot"><span class="annottext">((PABReq
  -&gt; Eff
       (NonDet : Reader ContractInstanceId : EmulatedWalletEffects)
       PABResp)
 -&gt; RequestHandler
      (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp)
-&gt; (PABReq
    -&gt; Eff
         (NonDet : Reader ContractInstanceId : EmulatedWalletEffects)
         PABResp)
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680564686"><span class="annot"><span class="annottext">PABReq
</span><a href="#local-6989586621680564686"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-439"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Eff
     (NonDet : Reader ContractInstanceId : EmulatedWalletEffects) ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool
 -&gt; Eff
      (NonDet : Reader ContractInstanceId : EmulatedWalletEffects) ())
-&gt; Bool
-&gt; Eff
     (NonDet : Reader ContractInstanceId : EmulatedWalletEffects) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PABReq
</span><a href="#local-6989586621680564686"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">PABReq -&gt; PABResp -&gt; Bool
</span><a href="Plutus.Contract.Effects.html#matches"><span class="hs-operator hs-var">`matches`</span></a></span><span> </span><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-440"></span><span>    </span><span class="annot"><span class="annottext">PABResp
-&gt; Eff
     (NonDet : Reader ContractInstanceId : EmulatedWalletEffects)
     PABResp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">PABResp
</span><a href="#local-6989586621680564687"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span class="hs-comment">-- | Inspect the open requests of a contract instance,</span><span>
</span><span id="line-443"></span><span class="hs-comment">--   and maybe respond to them. Returns the response that was provided to the</span><span>
</span><span id="line-444"></span><span class="hs-comment">--   contract, if any.</span><span>
</span><span id="line-445"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToRequest"><span class="hs-identifier hs-type">respondToRequest</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565139"><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565138"><span class="annot"><a href="#local-6989586621680565138"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565137"><span class="annot"><a href="#local-6989586621680565137"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565136"><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-446"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565138"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565137"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-447"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Members</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier hs-type">EmulatedWalletEffects</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-comment">-- ^ Flag on whether to log 'NoRequestsHandled' messages.</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contract.Trace.RequestHandler.html#RequestHandler"><span class="hs-identifier hs-type">RequestHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier hs-type">EmulatedWalletEffects</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABReq"><span class="hs-identifier hs-type">PABReq</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-comment">-- ^ How to respond to the requests.</span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-456"></span><span id="respondToRequest"><span class="annot"><span class="annottext">respondToRequest :: Bool
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; Eff effs (Maybe (Response PABResp))
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#respondToRequest"><span class="hs-identifier hs-var hs-var">respondToRequest</span></a></span></span><span> </span><span id="local-6989586621680564685"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564685"><span class="hs-identifier hs-var">isLogShowed</span></a></span></span><span> </span><span id="local-6989586621680564684"><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
</span><a href="#local-6989586621680564684"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-457"></span><span>    </span><span id="local-6989586621680564683"><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564683"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565138"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565137"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680564682"><span class="annot"><span class="annottext">Eff
  (Reader ContractInstanceId : EmulatedWalletEffects)
  (Maybe (Response PABResp))
</span><a href="#local-6989586621680564682"><span class="hs-identifier hs-var">hdl</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#EmulatedWalletEffects"><span class="hs-identifier hs-type">EmulatedWalletEffects</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects)
  (Request PABReq)
  (Response PABResp)
-&gt; [Request PABReq]
-&gt; Eff
     (Reader ContractInstanceId : EmulatedWalletEffects)
     (Maybe (Response PABResp))
forall (effs :: [* -&gt; *]) req resp.
RequestHandler effs req resp -&gt; [req] -&gt; Eff effs (Maybe resp)
</span><a href="Plutus.Contract.Trace.RequestHandler.html#tryHandler"><span class="hs-identifier hs-var">tryHandler</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
-&gt; RequestHandler
     (Reader ContractInstanceId : EmulatedWalletEffects)
     (Request PABReq)
     (Response PABResp)
forall (effs :: [* -&gt; *]) req resp.
RequestHandler effs req resp
-&gt; RequestHandler effs (Request req) (Response resp)
</span><a href="Plutus.Contract.Trace.RequestHandler.html#wrapHandler"><span class="hs-identifier hs-var">wrapHandler</span></a></span><span> </span><span class="annot"><span class="annottext">RequestHandler
  (Reader ContractInstanceId : EmulatedWalletEffects) PABReq PABResp
</span><a href="#local-6989586621680564684"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564683"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-459"></span><span>        </span><span id="local-6989586621680564681"><span class="annot"><span class="annottext">Eff (ContractInstanceRequests effs) (Maybe (Response PABResp))
</span><a href="#local-6989586621680564681"><span class="hs-identifier hs-var">hdl'</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#ContractInstanceRequests"><span class="hs-identifier hs-type">ContractInstanceRequests</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Eff
  (Reader ContractInstanceId : EmulatedWalletEffects)
  (Maybe (Response PABResp))
-&gt; Eff (ContractInstanceRequests effs) (Maybe (Response PABResp))
forall (effs :: [* -&gt; *]) (as :: [* -&gt; *]).
CanWeakenEnd as effs =&gt;
Eff as ~&gt; Eff effs
</span><span class="hs-identifier hs-var">raiseEnd</span></span><span> </span><span class="annot"><span class="annottext">Eff
  (Reader ContractInstanceId : EmulatedWalletEffects)
  (Maybe (Response PABResp))
</span><a href="#local-6989586621680564682"><span class="hs-identifier hs-var">hdl</span></a></span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span>        </span><span id="local-6989586621680564680"><span class="annot"><span class="annottext">Eff effs (Maybe (Response PABResp))
</span><a href="#local-6989586621680564680"><span class="hs-identifier hs-var">response_</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565136"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-462"></span><span>            </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (LogMsg Text) effs =&gt;
Eff (LogMsg Text : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>                    </span><span class="annot"><span class="annottext">(Eff (LogMsg Text : effs) (Maybe (Response PABResp))
 -&gt; Eff effs (Maybe (Response PABResp)))
-&gt; Eff (LogMsg Text : effs) (Maybe (Response PABResp))
-&gt; Eff effs (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (LogMsg TxBalanceMsg) effs =&gt;
Eff (LogMsg TxBalanceMsg : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxBalanceMsg</span></span><span class="hs-special">)</span><span>
</span><span id="line-464"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (LogMsg TxBalanceMsg : LogMsg Text : effs)
   (Maybe (Response PABResp))
 -&gt; Eff (LogMsg Text : effs) (Maybe (Response PABResp)))
-&gt; Eff
     (LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
-&gt; Eff (LogMsg Text : effs) (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (LogMsg RequestHandlerLogMsg) effs =&gt;
Eff (LogMsg RequestHandlerLogMsg : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.LogMessages.html#RequestHandlerLogMsg"><span class="hs-identifier hs-type">RequestHandlerLogMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (LogMsg RequestHandlerLogMsg
      : LogMsg TxBalanceMsg : LogMsg Text : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (LogMsg TxBalanceMsg : LogMsg Text : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (LogObserve (LogMessage Text)) effs =&gt;
Eff (LogObserve (LogMessage Text) : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogObserve</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMessage</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (LogObserve (LogMessage Text)
      : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
      : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (LogMsg RequestHandlerLogMsg
         : LogMsg TxBalanceMsg : LogMsg Text : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (LogObserve (LogMessage Text)
        : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
        : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member ChainIndexQueryEffect effs =&gt;
Eff (ChainIndexQueryEffect : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">ChainIndexQueryEffect</span></span><span>
</span><span id="line-467"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (ChainIndexQueryEffect
      : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
      : LogMsg TxBalanceMsg : LogMsg Text : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (LogObserve (LogMessage Text)
         : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
         : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (LogObserve (LogMessage Text)
        : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
        : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member NodeClientEffect effs =&gt;
Eff (NodeClientEffect : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Wallet.Effects.html#NodeClientEffect"><span class="hs-identifier hs-type">NodeClientEffect</span></a></span><span>
</span><span id="line-468"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (NodeClientEffect
      : ChainIndexQueryEffect : LogObserve (LogMessage Text)
      : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
      : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (ChainIndexQueryEffect
         : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
         : LogMsg TxBalanceMsg : LogMsg Text : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (NodeClientEffect
        : ChainIndexQueryEffect : LogObserve (LogMessage Text)
        : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
        : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (Error WalletAPIError) effs =&gt;
Eff (Error WalletAPIError : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Error</span></span><span> </span><span class="annot"><a href="Wallet.Emulator.Error.html#WalletAPIError"><span class="hs-identifier hs-type">WAPI.WalletAPIError</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (Error WalletAPIError
      : NodeClientEffect : ChainIndexQueryEffect
      : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
      : LogMsg TxBalanceMsg : LogMsg Text : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (NodeClientEffect
         : ChainIndexQueryEffect : LogObserve (LogMessage Text)
         : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
         : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (Error WalletAPIError
        : NodeClientEffect : ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (NodeClientEffect
        : ChainIndexQueryEffect : LogObserve (LogMessage Text)
        : LogMsg RequestHandlerLogMsg : LogMsg TxBalanceMsg : LogMsg Text
        : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member WalletEffect effs =&gt;
Eff (WalletEffect : effs) ~&gt; Eff effs
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Wallet.Effects.html#WalletEffect"><span class="hs-identifier hs-type">WalletEffect</span></a></span><span>
</span><span id="line-470"></span><span>                    </span><span class="annot"><span class="annottext">(Eff
   (WalletEffect
      : Error WalletAPIError : NodeClientEffect : ChainIndexQueryEffect
      : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
      : LogMsg TxBalanceMsg : LogMsg Text : effs)
   (Maybe (Response PABResp))
 -&gt; Eff
      (Error WalletAPIError
         : NodeClientEffect : ChainIndexQueryEffect
         : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
         : LogMsg TxBalanceMsg : LogMsg Text : effs)
      (Maybe (Response PABResp)))
-&gt; Eff
     (WalletEffect
        : Error WalletAPIError : NodeClientEffect : ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
-&gt; Eff
     (Error WalletAPIError
        : NodeClientEffect : ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceRequests effs) (Maybe (Response PABResp))
-&gt; Eff
     (WalletEffect
        : Error WalletAPIError : NodeClientEffect : ChainIndexQueryEffect
        : LogObserve (LogMessage Text) : LogMsg RequestHandlerLogMsg
        : LogMsg TxBalanceMsg : LogMsg Text : effs)
     (Maybe (Response PABResp))
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]).
Member eff effs =&gt;
Eff (eff : effs) ~&gt; Eff effs
</span><span class="hs-identifier hs-var">subsume</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Wallet.Types.html#ContractInstanceId"><span class="hs-identifier hs-type">ContractInstanceId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff (ContractInstanceRequests effs) (Maybe (Response PABResp))
</span><a href="#local-6989586621680564681"><span class="hs-identifier hs-var">hdl'</span></a></span><span>
</span><span id="line-471"></span><span>    </span><span id="local-6989586621680564679"><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564679"><span class="hs-identifier hs-var">response</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff effs (Maybe (Response PABResp))
</span><a href="#local-6989586621680564680"><span class="hs-identifier hs-var">response_</span></a></span><span>
</span><span id="line-472"></span><span>    </span><span class="annot"><span class="annottext">(Response PABResp -&gt; Eff effs ())
-&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs, Monoid w) =&gt;
Response PABResp -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#addResponse"><span class="hs-identifier hs-var">addResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565138"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565137"><span class="hs-identifier hs-type">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564679"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (LogMsg ContractInstanceMsg) effs,
 Member (State (ContractInstanceStateInternal w s e ())) effs) =&gt;
Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var">logResponse</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565139"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565138"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565137"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564685"><span class="hs-identifier hs-var">isLogShowed</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564679"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-474"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Response PABResp) -&gt; Eff effs (Maybe (Response PABResp))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="#local-6989586621680564679"><span class="hs-identifier hs-var">response</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span class="hs-comment">---</span><span>
</span><span id="line-477"></span><span class="hs-comment">-- Logging</span><span>
</span><span id="line-478"></span><span class="hs-comment">---</span><span>
</span><span id="line-479"></span><span>
</span><span id="line-480"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-type">logResponse</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565050"><span class="annot"><a href="#local-6989586621680565050"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565049"><span class="annot"><a href="#local-6989586621680565049"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565048"><span class="annot"><a href="#local-6989586621680565048"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565051"><span class="annot"><a href="#local-6989586621680565051"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565051"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-482"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565050"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565048"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565051"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-483"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-484"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span> </span><span class="hs-comment">-- ^ Flag on whether to log 'NoRequestsHandled' messages</span><span>
</span><span id="line-485"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contract.Resumable.html#Response"><span class="hs-identifier hs-type">Response</span></a></span><span> </span><span class="annot"><a href="Plutus.Contract.Effects.html#PABResp"><span class="hs-identifier hs-type">PABResp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-486"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565051"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span id="logResponse"><span class="annot"><span class="annottext">logResponse :: Bool -&gt; Maybe (Response PABResp) -&gt; Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logResponse"><span class="hs-identifier hs-var hs-var">logResponse</span></a></span></span><span> </span><span id="local-6989586621680564678"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564678"><span class="hs-identifier hs-var">isLogShowed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-488"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Response PABResp)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Eff effs () -&gt; Eff effs ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621680564678"><span class="hs-identifier hs-var">isLogShowed</span></a></span><span> </span><span class="annot"><span class="annottext">(Eff effs () -&gt; Eff effs ()) -&gt; Eff effs () -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logDebug</span></span><span> </span><span class="annot"><span class="annottext">ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#NoRequestsHandled"><span class="hs-identifier hs-var">NoRequestsHandled</span></a></span><span>
</span><span id="line-489"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621680564677"><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680564677"><span class="hs-identifier hs-var">rsp</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-490"></span><span>        </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logDebug</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg -&gt; Eff effs ())
-&gt; ContractInstanceMsg -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Response Value -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#HandledRequest"><span class="hs-identifier hs-var">HandledRequest</span></a></span><span> </span><span class="annot"><span class="annottext">(Response Value -&gt; ContractInstanceMsg)
-&gt; Response Value -&gt; ContractInstanceMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(PABResp -&gt; Value) -&gt; Response PABResp -&gt; Response Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PABResp -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">JSON.toJSON</span></span><span> </span><span class="annot"><span class="annottext">Response PABResp
</span><a href="#local-6989586621680564677"><span class="hs-identifier hs-var">rsp</span></a></span><span>
</span><span id="line-491"></span><span>        </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs) =&gt;
Eff effs ()
forall w (s :: Row *) e (effs :: [* -&gt; *]).
(Member (State (ContractInstanceStateInternal w s e ())) effs,
 Member (LogMsg ContractInstanceMsg) effs) =&gt;
Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logCurrentRequests"><span class="hs-identifier hs-var">logCurrentRequests</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565050"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565049"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565048"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-492"></span><span>
</span><span id="line-493"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#logCurrentRequests"><span class="hs-identifier hs-type">logCurrentRequests</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565287"><span class="annot"><a href="#local-6989586621680565287"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565286"><span class="annot"><a href="#local-6989586621680565286"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565285"><span class="annot"><a href="#local-6989586621680565285"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565288"><span class="annot"><a href="#local-6989586621680565288"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565287"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565286"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565285"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565288"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565288"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-496"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565288"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-498"></span><span id="logCurrentRequests"><span class="annot"><span class="annottext">logCurrentRequests :: Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logCurrentRequests"><span class="hs-identifier hs-var hs-var">logCurrentRequests</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-499"></span><span>    </span><span id="local-6989586621680564676"><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564676"><span class="hs-identifier hs-var">hks</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
forall w (s :: Row *) e (effs :: [* -&gt; *]).
Member (State (ContractInstanceStateInternal w s e ())) effs =&gt;
Eff effs [Request PABReq]
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#getHooks"><span class="hs-identifier hs-var">getHooks</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565287"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565286"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680565285"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="annot"><span class="annottext">ContractInstanceMsg -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logDebug</span></span><span> </span><span class="annot"><span class="annottext">(ContractInstanceMsg -&gt; Eff effs ())
-&gt; ContractInstanceMsg -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Request Value] -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#CurrentRequests"><span class="hs-identifier hs-var">CurrentRequests</span></a></span><span> </span><span class="annot"><span class="annottext">([Request Value] -&gt; ContractInstanceMsg)
-&gt; [Request Value] -&gt; ContractInstanceMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Request PABReq -&gt; Request Value)
-&gt; [Request PABReq] -&gt; [Request Value]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PABReq -&gt; Value) -&gt; Request PABReq -&gt; Request Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">PABReq -&gt; Value
forall a. ToJSON a =&gt; a -&gt; Value
</span><span class="hs-identifier hs-var">JSON.toJSON</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Request PABReq]
</span><a href="#local-6989586621680564676"><span class="hs-identifier hs-var">hks</span></a></span><span>
</span><span id="line-501"></span><span>
</span><span id="line-502"></span><span class="hs-comment">-- | Take the new log messages that were produced by the contract</span><span>
</span><span id="line-503"></span><span class="hs-comment">--   instance and log them with the 'LogMsg' effect.</span><span>
</span><span id="line-504"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#logNewMessages"><span class="hs-identifier hs-type">logNewMessages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680565291"><span class="annot"><a href="#local-6989586621680565291"><span class="hs-identifier hs-type">w</span></a></span></span><span> </span><span id="local-6989586621680565290"><span class="annot"><a href="#local-6989586621680565290"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621680565289"><span class="annot"><a href="#local-6989586621680565289"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span id="local-6989586621680565292"><span class="annot"><a href="#local-6989586621680565292"><span class="hs-identifier hs-type">effs</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-505"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceMsg"><span class="hs-identifier hs-type">ContractInstanceMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565292"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-506"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565291"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565290"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565289"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680565292"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680565292"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span id="logNewMessages"><span class="annot"><span class="annottext">logNewMessages :: Eff effs ()
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#logNewMessages"><span class="hs-identifier hs-var hs-var">logNewMessages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-510"></span><span>    </span><span id="local-6989586621680564675"><span class="annot"><span class="annottext">Seq (LogMessage Value)
</span><a href="#local-6989586621680564675"><span class="hs-identifier hs-var">newContractLogs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ContractInstanceStateInternal w s e () -&gt; Seq (LogMessage Value))
-&gt; Eff effs (Seq (LogMessage Value))
forall s a (effs :: [* -&gt; *]).
Member (State s) effs =&gt;
(s -&gt; a) -&gt; Eff effs a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Emulator.Types.html#ContractInstanceStateInternal"><span class="hs-identifier hs-type">ContractInstanceStateInternal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565291"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565290"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680565289"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Getting
  (Seq (LogMessage Value))
  (SuspendedContract w e PABResp PABReq ())
  (Seq (LogMessage Value))
-&gt; SuspendedContract w e PABResp PABReq ()
-&gt; Seq (LogMessage Value)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ResumableResult w e PABResp PABReq ()
 -&gt; Const
      (Seq (LogMessage Value)) (ResumableResult w e PABResp PABReq ()))
-&gt; SuspendedContract w e PABResp PABReq ()
-&gt; Const
     (Seq (LogMessage Value)) (SuspendedContract w e PABResp PABReq ())
forall w e i o a.
Lens' (SuspendedContract w e i o a) (ResumableResult w e i o a)
</span><a href="Plutus.Contract.Types.html#resumableResult"><span class="hs-identifier hs-var">resumableResult</span></a></span><span> </span><span class="annot"><span class="annottext">((ResumableResult w e PABResp PABReq ()
  -&gt; Const
       (Seq (LogMessage Value)) (ResumableResult w e PABResp PABReq ()))
 -&gt; SuspendedContract w e PABResp PABReq ()
 -&gt; Const
      (Seq (LogMessage Value)) (SuspendedContract w e PABResp PABReq ()))
-&gt; ((Seq (LogMessage Value)
     -&gt; Const (Seq (LogMessage Value)) (Seq (LogMessage Value)))
    -&gt; ResumableResult w e PABResp PABReq ()
    -&gt; Const
         (Seq (LogMessage Value)) (ResumableResult w e PABResp PABReq ()))
-&gt; Getting
     (Seq (LogMessage Value))
     (SuspendedContract w e PABResp PABReq ())
     (Seq (LogMessage Value))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (LogMessage Value)
 -&gt; Const (Seq (LogMessage Value)) (Seq (LogMessage Value)))
-&gt; ResumableResult w e PABResp PABReq ()
-&gt; Const
     (Seq (LogMessage Value)) (ResumableResult w e PABResp PABReq ())
forall w e i o1 a.
Lens' (ResumableResult w e i o1 a) (Seq (LogMessage Value))
</span><a href="Plutus.Contract.Types.html#lastLogs"><span class="hs-identifier hs-var">lastLogs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SuspendedContract w e PABResp PABReq () -&gt; Seq (LogMessage Value))
-&gt; (ContractInstanceStateInternal w s e ()
    -&gt; SuspendedContract w e PABResp PABReq ())
-&gt; ContractInstanceStateInternal w s e ()
-&gt; Seq (LogMessage Value)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ContractInstanceStateInternal w s e ()
-&gt; SuspendedContract w e PABResp PABReq ()
forall w (s :: Row *) e a.
ContractInstanceStateInternal w s e a
-&gt; SuspendedContract w e PABResp PABReq a
</span><a href="Plutus.Trace.Emulator.Types.html#cisiSuspState"><span class="hs-identifier hs-var hs-var">cisiSuspState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>    </span><span class="annot"><span class="annottext">(LogMessage Value -&gt; Eff effs ())
-&gt; Seq (LogMessage Value) -&gt; Eff effs ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogMsg ContractInstanceMsg () -&gt; Eff effs ()
forall (eff :: * -&gt; *) (effs :: [* -&gt; *]) a.
Member eff effs =&gt;
eff a -&gt; Eff effs a
</span><span class="hs-identifier hs-var">send</span></span><span> </span><span class="annot"><span class="annottext">(LogMsg ContractInstanceMsg () -&gt; Eff effs ())
-&gt; (LogMessage Value -&gt; LogMsg ContractInstanceMsg ())
-&gt; LogMessage Value
-&gt; Eff effs ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LogMessage ContractInstanceMsg -&gt; LogMsg ContractInstanceMsg ()
forall a. LogMessage a -&gt; LogMsg a ()
</span><span class="hs-identifier hs-var">LMessage</span></span><span> </span><span class="annot"><span class="annottext">(LogMessage ContractInstanceMsg -&gt; LogMsg ContractInstanceMsg ())
-&gt; (LogMessage Value -&gt; LogMessage ContractInstanceMsg)
-&gt; LogMessage Value
-&gt; LogMsg ContractInstanceMsg ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; ContractInstanceMsg)
-&gt; LogMessage Value -&gt; LogMessage ContractInstanceMsg
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ContractInstanceMsg
</span><a href="Plutus.Trace.Emulator.Types.html#ContractLog"><span class="hs-identifier hs-var">ContractLog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Seq (LogMessage Value)
</span><a href="#local-6989586621680564675"><span class="hs-identifier hs-var">newContractLogs</span></a></span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span class="hs-comment">-- | A block of transactions, indexed by tx outputs spent and by</span><span>
</span><span id="line-514"></span><span class="hs-comment">--   addresses on which new outputs are produced</span><span>
</span><span id="line-515"></span><span class="hs-keyword">data</span><span> </span><span id="IndexedBlock"><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-var">IndexedBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-516"></span><span>  </span><span id="IndexedBlock"><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-var">IndexedBlock</span></a></span></span><span>
</span><span id="line-517"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="ibUtxoSpent"><span class="annot"><span class="annottext">IndexedBlock -&gt; Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var hs-var">ibUtxoSpent</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.TxIn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainIndexTx</span></span><span>
</span><span id="line-518"></span><span>    </span><span class="hs-special">,</span><span> </span><span id="ibUtxoProduced"><span class="annot"><span class="annottext">IndexedBlock -&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var hs-var">ibUtxoProduced</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoAddress</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ChainIndexTx</span></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-520"></span><span>
</span><span id="line-521"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680564670"><span id="local-6989586621680564672"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-522"></span><span>  </span><span id="local-6989586621680564668"><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564668"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621680564667"><span class="annot"><span class="annottext">&lt;&gt; :: IndexedBlock -&gt; IndexedBlock -&gt; IndexedBlock
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621680564666"><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564666"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-523"></span><span>    </span><span class="annot"><span class="annottext">IndexedBlock :: Map TxIn ChainIndexTx
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx) -&gt; IndexedBlock
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span>
</span><span id="line-524"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ibUtxoSpent :: Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var">ibUtxoSpent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IndexedBlock -&gt; Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var hs-var">ibUtxoSpent</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564668"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn ChainIndexTx
-&gt; Map TxIn ChainIndexTx -&gt; Map TxIn ChainIndexTx
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock -&gt; Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var hs-var">ibUtxoSpent</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564666"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-525"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ibUtxoProduced :: Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var">ibUtxoProduced</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty ChainIndexTx
 -&gt; NonEmpty ChainIndexTx -&gt; NonEmpty ChainIndexTx)
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.unionWith</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ChainIndexTx
-&gt; NonEmpty ChainIndexTx -&gt; NonEmpty ChainIndexTx
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IndexedBlock -&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var hs-var">ibUtxoProduced</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564668"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IndexedBlock -&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var hs-var">ibUtxoProduced</span></a></span><span> </span><span class="annot"><span class="annottext">IndexedBlock
</span><a href="#local-6989586621680564666"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680564659"><span id="local-6989586621680564661"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-529"></span><span>  </span><span id="local-6989586621680564657"><span class="annot"><span class="annottext">mempty :: IndexedBlock
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxIn ChainIndexTx
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx) -&gt; IndexedBlock
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-var">IndexedBlock</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn ChainIndexTx
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Map CardanoAddress (NonEmpty ChainIndexTx)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#indexBlock"><span class="hs-identifier hs-type">indexBlock</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ChainIndexTx</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span>
</span><span id="line-532"></span><span id="indexBlock"><span class="annot"><span class="annottext">indexBlock :: [ChainIndexTx] -&gt; IndexedBlock
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#indexBlock"><span class="hs-identifier hs-var hs-var">indexBlock</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ChainIndexTx -&gt; IndexedBlock) -&gt; [ChainIndexTx] -&gt; IndexedBlock
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldMap</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx -&gt; IndexedBlock
</span><a href="#local-6989586621680564656"><span class="hs-identifier hs-var">indexTx</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-533"></span><span>  </span><span id="local-6989586621680564656"><span class="annot"><span class="annottext">indexTx :: ChainIndexTx -&gt; IndexedBlock
</span><a href="#local-6989586621680564656"><span class="hs-identifier hs-var hs-var">indexTx</span></a></span></span><span> </span><span id="local-6989586621680564655"><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564655"><span class="hs-identifier hs-var">otx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-534"></span><span>    </span><span class="annot"><span class="annottext">IndexedBlock :: Map TxIn ChainIndexTx
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx) -&gt; IndexedBlock
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#IndexedBlock"><span class="hs-identifier hs-type">IndexedBlock</span></a></span><span>
</span><span id="line-535"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ibUtxoSpent :: Map TxIn ChainIndexTx
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoSpent"><span class="hs-identifier hs-var">ibUtxoSpent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxIn -&gt; ChainIndexTx) -&gt; Set TxIn -&gt; Map TxIn ChainIndexTx
forall k a. (k -&gt; a) -&gt; Set k -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ChainIndexTx -&gt; TxIn -&gt; ChainIndexTx
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564655"><span class="hs-identifier hs-var">otx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Set TxIn -&gt; Map TxIn ChainIndexTx)
-&gt; Set TxIn -&gt; Map TxIn ChainIndexTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; Set TxIn
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Set TxIn) -&gt; [TxIn] -&gt; Set TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; [TxIn])
-&gt; ([TxIn] -&gt; [TxIn]) -&gt; Either ToCardanoError [TxIn] -&gt; [TxIn]
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [TxIn]
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [TxIn])
-&gt; (ToCardanoError -&gt; String) -&gt; ToCardanoError -&gt; [TxIn]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Plutus.Trace.Emulator.ContractInstance.indexBlock: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String)
-&gt; (ToCardanoError -&gt; String) -&gt; ToCardanoError -&gt; String
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">show</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; [TxIn]
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError [TxIn] -&gt; [TxIn])
-&gt; Either ToCardanoError [TxIn] -&gt; [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-536"></span><span>            </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Either ToCardanoError TxIn)
-&gt; [TxOutRef] -&gt; Either ToCardanoError [TxIn]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">([TxOutRef] -&gt; Either ToCardanoError [TxIn])
-&gt; [TxOutRef] -&gt; Either ToCardanoError [TxIn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Getting [TxOutRef] ChainIndexTx [TxOutRef]
-&gt; ChainIndexTx -&gt; [TxOutRef]
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="annot"><span class="annottext">Getting [TxOutRef] ChainIndexTx [TxOutRef]
Lens' ChainIndexTx [TxOutRef]
</span><span class="hs-identifier hs-var">citxInputs</span></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564655"><span class="hs-identifier hs-var">otx</span></a></span><span>
</span><span id="line-537"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ibUtxoProduced :: Map CardanoAddress (NonEmpty ChainIndexTx)
</span><a href="Plutus.Trace.Emulator.ContractInstance.html#ibUtxoProduced"><span class="hs-identifier hs-var">ibUtxoProduced</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NonEmpty ChainIndexTx
 -&gt; NonEmpty ChainIndexTx -&gt; NonEmpty ChainIndexTx)
-&gt; [(CardanoAddress, NonEmpty ChainIndexTx)]
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromListWith</span></span><span> </span><span class="annot"><span class="annottext">NonEmpty ChainIndexTx
-&gt; NonEmpty ChainIndexTx -&gt; NonEmpty ChainIndexTx
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span> </span><span class="annot"><span class="annottext">([(CardanoAddress, NonEmpty ChainIndexTx)]
 -&gt; Map CardanoAddress (NonEmpty ChainIndexTx))
-&gt; [(CardanoAddress, NonEmpty ChainIndexTx)]
-&gt; Map CardanoAddress (NonEmpty ChainIndexTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx -&gt; [ChainIndexTxOut]
</span><span class="hs-identifier hs-var">txOuts</span></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564655"><span class="hs-identifier hs-var">otx</span></a></span><span> </span><span class="annot"><span class="annottext">[ChainIndexTxOut]
-&gt; (ChainIndexTxOut -&gt; [(CardanoAddress, NonEmpty ChainIndexTx)])
-&gt; [(CardanoAddress, NonEmpty ChainIndexTx)]
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="hs-identifier hs-type">ChainIndexTxOut</span></span><span class="hs-special">{</span><span id="local-6989586621680564648"><span class="annot"><span class="annottext">CardanoAddress
citoAddress :: CardanoAddress
citoAddress :: ChainIndexTxOut -&gt; CardanoAddress
</span><a href="#local-6989586621680564648"><span class="hs-identifier hs-var hs-var">citoAddress</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680564648"><span class="hs-identifier hs-var">citoAddress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ChainIndexTx
</span><a href="#local-6989586621680564655"><span class="hs-identifier hs-var">otx</span></a></span><span> </span><span class="annot"><span class="annottext">ChainIndexTx -&gt; [ChainIndexTx] -&gt; NonEmpty ChainIndexTx
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-539"></span></pre></body></html>