<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span id="%24con2tag_LAv3bAeN85JHaETuwnBdLI"></span><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds           #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass      #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric       #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia         #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts    #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GADTs               #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase          #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns      #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings   #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes          #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell     #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications    #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies        #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators       #-}</span><span>
</span><span id="line-18"></span><span class="hs-comment">{-

Implements a scheduler for cooperative multitasking. The scheduler supports
system calls for suspending threads, sending messages to other threads, and
starting new threads. Threads have a priority (see note [Thread Priority]).
They can send and receive messages of a user-defined type. The scheduler is
implemented as handler of the 'Control.Monad.Freer.Coroutine.Yield' effect, and
threads are @freer-simple@ programs that use that effect.

-}</span><span>
</span><span id="line-28"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Trace.Scheduler</span><span class="hs-special">(</span><span>
</span><span id="line-29"></span><span>    </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier">ThreadId</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SysCall"><span class="hs-identifier">SysCall</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier">MessageCall</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadCall"><span class="hs-identifier">ThreadCall</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier">WithPriority</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier">Priority</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier">Tag</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier">EmSystemCall</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#AgentSystemCall"><span class="hs-identifier">AgentSystemCall</span></a></span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier">SuspendedThread</span></a></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier">EmThread</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier">SchedulerState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Thread API</span></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#runThreads"><span class="hs-identifier">runThreads</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#fork"><span class="hs-identifier">fork</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#sleep"><span class="hs-identifier">sleep</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#exit"><span class="hs-identifier">exit</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Etc.</span></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkThread"><span class="hs-identifier">mkThread</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier">mkSysCall</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier">mkAgentSysCall</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier">SchedulerLog</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadEvent"><span class="hs-identifier">ThreadEvent</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Empty</span></span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Coroutine</span></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Extras.Log</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">LogMsg</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">logDebug</span></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Freer.Reader</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashMap</span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashMap.Strict</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashMap</span></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">HashSet</span></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.HashSet</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">HashSet</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Hashable</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Hashable</span></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Seq</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Sequence</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Seq</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html"><span class="hs-identifier">Plutus.Trace.Tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier">Tag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter.Extras</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PrettyShow</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Tagged</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span class="hs-comment">{- Note [Thread Tag]

Within the scheduler, threads are identified by their 'ThreadId'. The thread
ID is assigned at runtime when a new thread is started. So the thread ID
depends on the state of the scheduler at the time the thread is started.

This makes it hard to refer to individual threads outside of the scheduler,
for example, when we inspect the emulator log. To make it easier to find
threads later on in the log, each thread also has a user-defined tag. The
scheduler maintains a map of tags to thread IDs, so that we can send messages
to threads that we only know the tag of.

It is up to the user to ensure that tags are unique. If two threads have the
same tag, the functioning of the scheduler is not affected (each thread still
has its own mailbox), but the tag can no longer be used to uniquely identify a
thread. In practice however the number of interesting threads is small enough
that finding distinct tags for them is not a problem.

-}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="hs-comment">-- | Unique identifier of a thread.</span><span>
</span><span id="line-95"></span><span id="local-6989586621680553987"><span id="local-6989586621680553988"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="ThreadId"><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-var">ThreadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ThreadId"><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-var">ThreadId</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unThreadId"><span class="annot"><span class="annottext">ThreadId -&gt; Int
</span><a href="Plutus.Trace.Scheduler.html#unThreadId"><span class="hs-identifier hs-var hs-var">unThreadId</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-96"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553981"><span id="local-6989586621680553983"><span class="annot"><span class="annottext">ThreadId -&gt; ThreadId -&gt; Bool
(ThreadId -&gt; ThreadId -&gt; Bool)
-&gt; (ThreadId -&gt; ThreadId -&gt; Bool) -&gt; Eq ThreadId
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ThreadId -&gt; ThreadId -&gt; Bool
$c/= :: ThreadId -&gt; ThreadId -&gt; Bool
== :: ThreadId -&gt; ThreadId -&gt; Bool
$c== :: ThreadId -&gt; ThreadId -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553965"><span id="local-6989586621680553967"><span id="local-6989586621680553969"><span id="local-6989586621680553971"><span id="local-6989586621680553973"><span id="local-6989586621680553975"><span id="local-6989586621680553977"><span class="annot"><span class="annottext">Eq ThreadId
Eq ThreadId
-&gt; (ThreadId -&gt; ThreadId -&gt; Ordering)
-&gt; (ThreadId -&gt; ThreadId -&gt; Bool)
-&gt; (ThreadId -&gt; ThreadId -&gt; Bool)
-&gt; (ThreadId -&gt; ThreadId -&gt; Bool)
-&gt; (ThreadId -&gt; ThreadId -&gt; Bool)
-&gt; (ThreadId -&gt; ThreadId -&gt; ThreadId)
-&gt; (ThreadId -&gt; ThreadId -&gt; ThreadId)
-&gt; Ord ThreadId
ThreadId -&gt; ThreadId -&gt; Bool
ThreadId -&gt; ThreadId -&gt; Ordering
ThreadId -&gt; ThreadId -&gt; ThreadId
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ThreadId -&gt; ThreadId -&gt; ThreadId
$cmin :: ThreadId -&gt; ThreadId -&gt; ThreadId
max :: ThreadId -&gt; ThreadId -&gt; ThreadId
$cmax :: ThreadId -&gt; ThreadId -&gt; ThreadId
&gt;= :: ThreadId -&gt; ThreadId -&gt; Bool
$c&gt;= :: ThreadId -&gt; ThreadId -&gt; Bool
&gt; :: ThreadId -&gt; ThreadId -&gt; Bool
$c&gt; :: ThreadId -&gt; ThreadId -&gt; Bool
&lt;= :: ThreadId -&gt; ThreadId -&gt; Bool
$c&lt;= :: ThreadId -&gt; ThreadId -&gt; Bool
&lt; :: ThreadId -&gt; ThreadId -&gt; Bool
$c&lt; :: ThreadId -&gt; ThreadId -&gt; Bool
compare :: ThreadId -&gt; ThreadId -&gt; Ordering
$ccompare :: ThreadId -&gt; ThreadId -&gt; Ordering
$cp1Ord :: Eq ThreadId
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553958"><span id="local-6989586621680553960"><span id="local-6989586621680553962"><span class="annot"><span class="annottext">Int -&gt; ThreadId -&gt; ShowS
[ThreadId] -&gt; ShowS
ThreadId -&gt; String
(Int -&gt; ThreadId -&gt; ShowS)
-&gt; (ThreadId -&gt; String) -&gt; ([ThreadId] -&gt; ShowS) -&gt; Show ThreadId
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ThreadId] -&gt; ShowS
$cshowList :: [ThreadId] -&gt; ShowS
show :: ThreadId -&gt; String
$cshow :: ThreadId -&gt; String
showsPrec :: Int -&gt; ThreadId -&gt; ShowS
$cshowsPrec :: Int -&gt; ThreadId -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ThreadId -&gt; Rep ThreadId x)
-&gt; (forall x. Rep ThreadId x -&gt; ThreadId) -&gt; Generic ThreadId
forall x. Rep ThreadId x -&gt; ThreadId
forall x. ThreadId -&gt; Rep ThreadId x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ThreadId x -&gt; ThreadId
$cfrom :: forall x. ThreadId -&gt; Rep ThreadId x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553950"><span id="local-6989586621680553952"><span class="annot"><span class="annottext">Int -&gt; ThreadId -&gt; Int
ThreadId -&gt; Int
(Int -&gt; ThreadId -&gt; Int) -&gt; (ThreadId -&gt; Int) -&gt; Hashable ThreadId
forall a. (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
hash :: ThreadId -&gt; Int
$chash :: ThreadId -&gt; Int
hashWithSalt :: Int -&gt; ThreadId -&gt; Int
$chashWithSalt :: Int -&gt; ThreadId -&gt; Int
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Hashable</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553941"><span id="local-6989586621680553943"><span id="local-6989586621680553945"><span id="local-6989586621680553947"><span class="annot"><span class="annottext">[ThreadId] -&gt; Encoding
[ThreadId] -&gt; Value
ThreadId -&gt; Encoding
ThreadId -&gt; Value
(ThreadId -&gt; Value)
-&gt; (ThreadId -&gt; Encoding)
-&gt; ([ThreadId] -&gt; Value)
-&gt; ([ThreadId] -&gt; Encoding)
-&gt; ToJSON ThreadId
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ThreadId] -&gt; Encoding
$ctoEncodingList :: [ThreadId] -&gt; Encoding
toJSONList :: [ThreadId] -&gt; Value
$ctoJSONList :: [ThreadId] -&gt; Value
toEncoding :: ThreadId -&gt; Encoding
$ctoEncoding :: ThreadId -&gt; Encoding
toJSON :: ThreadId -&gt; Value
$ctoJSON :: ThreadId -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553936"><span id="local-6989586621680553938"><span class="annot"><span class="annottext">Value -&gt; Parser [ThreadId]
Value -&gt; Parser ThreadId
(Value -&gt; Parser ThreadId)
-&gt; (Value -&gt; Parser [ThreadId]) -&gt; FromJSON ThreadId
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ThreadId]
$cparseJSONList :: Value -&gt; Parser [ThreadId]
parseJSON :: Value -&gt; Parser ThreadId
$cparseJSON :: Value -&gt; Parser ThreadId
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680553931"><span id="local-6989586621680553933"><span class="annot"><span class="annottext">[ThreadId] -&gt; Doc ann
ThreadId -&gt; Doc ann
(forall ann. ThreadId -&gt; Doc ann)
-&gt; (forall ann. [ThreadId] -&gt; Doc ann) -&gt; Pretty ThreadId
forall ann. [ThreadId] -&gt; Doc ann
forall ann. ThreadId -&gt; Doc ann
forall a.
(forall ann. a -&gt; Doc ann)
-&gt; (forall ann. [a] -&gt; Doc ann) -&gt; Pretty a
prettyList :: [ThreadId] -&gt; Doc ann
$cprettyList :: forall ann. [ThreadId] -&gt; Doc ann
pretty :: ThreadId -&gt; Doc ann
$cpretty :: forall ann. ThreadId -&gt; Doc ann
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Pretty</span></span></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Tagged</span></span><span> </span><span class="annot"><span class="hs-string">&quot;Thread&quot;</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Int</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="hs-comment">-- | ID of the first thread.</span><span>
</span><span id="line-101"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-type">initialThreadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span>
</span><span id="line-102"></span><span id="initialThreadId"><span class="annot"><span class="annottext">initialThreadId :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var hs-var">initialThreadId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-var">ThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-comment">{- Note [Thread Priority]

When a thread yields control it assigns itself one of three priorities. The
priority determines how long the thread goes to sleep for. The scheduler
maintains one queue of suspended threads for each priority.

In the emulator, we use thread priorities to drive the progress of simulated
time. See note [Simulator Time] in 'Plutus.Trace.Emulator.System' for details.

-}</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">{- Note [Freeze and Thaw]

Freezing and unfreezing use two slightly different mechanims.

To freeze a thread, that thread must suspend itself with the 'Frozen' priority.
If we want to be able to freeze a thread from the outside, we need to send it a
message instructing it to do so. (In the emulator, this is the 'Freeze'
constructor of 'Plutus.Trace.Emulator.Types.EmulatorMessage'.)

@
  mkSysCall @_ @EmulatorMessage Normal (Message threadId Freeze)
@


To unfreeze a thread, we use the 'Thaw' system call of the emulator.

@
  mkSysCall @_ @systemEvent Normal (Thaw threadId)
@

Note how the sytem event type in the first line is instantiated to
'EmulatorMessage', and in the second line it is free. The goal of this
somewhat roundabout approach is to avoid having to fish out the thread from the
queues of the scheduler state. Instead, we tell the thread to freeze itself, so
we don't have to mess with the queues.

-}</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | Priority of a thread.</span><span>
</span><span id="line-144"></span><span id="local-6989586621680553927"><span id="local-6989586621680553928"></span></span><span class="hs-keyword">data</span><span> </span><span id="Priority"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-var">Priority</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>    </span><span id="Normal"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span></span><span> </span><span class="hs-comment">-- ^ Thread is ready to run</span><span>
</span><span id="line-146"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Sleeping"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Sleeping"><span class="hs-identifier hs-var">Sleeping</span></a></span></span><span> </span><span class="hs-comment">-- ^ Thread is sleeping, to be resumed only after an external event happens</span><span>
</span><span id="line-147"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Frozen"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Frozen"><span class="hs-identifier hs-var">Frozen</span></a></span></span><span> </span><span class="hs-comment">-- ^ Thread is frozen, it will only be resumed after it is manually unfrozen via the 'Thaw' sys call.</span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553920"><span id="local-6989586621680553922"><span class="annot"><span class="annottext">Priority -&gt; Priority -&gt; Bool
(Priority -&gt; Priority -&gt; Bool)
-&gt; (Priority -&gt; Priority -&gt; Bool) -&gt; Eq Priority
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Priority -&gt; Priority -&gt; Bool
$c/= :: Priority -&gt; Priority -&gt; Bool
== :: Priority -&gt; Priority -&gt; Bool
$c== :: Priority -&gt; Priority -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553914"><span id="local-6989586621680553916"><span id="local-6989586621680553918"><span class="annot"><span class="annottext">Int -&gt; Priority -&gt; ShowS
[Priority] -&gt; ShowS
Priority -&gt; String
(Int -&gt; Priority -&gt; ShowS)
-&gt; (Priority -&gt; String) -&gt; ([Priority] -&gt; ShowS) -&gt; Show Priority
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Priority] -&gt; ShowS
$cshowList :: [Priority] -&gt; ShowS
show :: Priority -&gt; String
$cshow :: Priority -&gt; String
showsPrec :: Int -&gt; Priority -&gt; ShowS
$cshowsPrec :: Int -&gt; Priority -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. Priority -&gt; Rep Priority x)
-&gt; (forall x. Rep Priority x -&gt; Priority) -&gt; Generic Priority
forall x. Rep Priority x -&gt; Priority
forall x. Priority -&gt; Rep Priority x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Priority x -&gt; Priority
$cfrom :: forall x. Priority -&gt; Rep Priority x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553904"><span id="local-6989586621680553906"><span id="local-6989586621680553908"><span id="local-6989586621680553910"><span class="annot"><span class="annottext">[Priority] -&gt; Encoding
[Priority] -&gt; Value
Priority -&gt; Encoding
Priority -&gt; Value
(Priority -&gt; Value)
-&gt; (Priority -&gt; Encoding)
-&gt; ([Priority] -&gt; Value)
-&gt; ([Priority] -&gt; Encoding)
-&gt; ToJSON Priority
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [Priority] -&gt; Encoding
$ctoEncodingList :: [Priority] -&gt; Encoding
toJSONList :: [Priority] -&gt; Value
$ctoJSONList :: [Priority] -&gt; Value
toEncoding :: Priority -&gt; Encoding
$ctoEncoding :: Priority -&gt; Encoding
toJSON :: Priority -&gt; Value
$ctoJSON :: Priority -&gt; Value
</span><a href="#local-6989586621680553904"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553900"><span id="local-6989586621680553902"><span class="annot"><span class="annottext">Value -&gt; Parser [Priority]
Value -&gt; Parser Priority
(Value -&gt; Parser Priority)
-&gt; (Value -&gt; Parser [Priority]) -&gt; FromJSON Priority
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [Priority]
$cparseJSONList :: Value -&gt; Parser [Priority]
parseJSON :: Value -&gt; Parser Priority
$cparseJSON :: Value -&gt; Parser Priority
</span><a href="#local-6989586621680553900"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680553896"><span id="local-6989586621680553898"><span class="annot"><span class="annottext">[Priority] -&gt; Doc ann
Priority -&gt; Doc ann
(forall ann. Priority -&gt; Doc ann)
-&gt; (forall ann. [Priority] -&gt; Doc ann) -&gt; Pretty Priority
forall ann. [Priority] -&gt; Doc ann
forall ann. Priority -&gt; Doc ann
forall a.
(forall ann. a -&gt; Doc ann)
-&gt; (forall ann. [a] -&gt; Doc ann) -&gt; Pretty a
prettyList :: [Priority] -&gt; Doc ann
$cprettyList :: forall ann. [Priority] -&gt; Doc ann
pretty :: Priority -&gt; Doc ann
$cpretty :: forall ann. Priority -&gt; Doc ann
</span><a href="#local-6989586621680553896"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Pretty</span></a></span></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrettyShow</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-comment">-- | A thread with a 'Priority'.</span><span>
</span><span id="line-153"></span><span class="hs-keyword">data</span><span> </span><span id="WithPriority"><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-var">WithPriority</span></a></span></span><span> </span><span id="local-6989586621680554181"><span class="annot"><a href="#local-6989586621680554181"><span class="hs-identifier hs-type">t</span></a></span></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="WithPriority"><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-var">WithPriority</span></a></span></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="_priority"><span class="annot"><span class="annottext">WithPriority t -&gt; Priority
</span><a href="Plutus.Trace.Scheduler.html#_priority"><span class="hs-identifier hs-var hs-var">_priority</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_thread"><span class="annot"><span class="annottext">WithPriority t -&gt; t
</span><a href="Plutus.Trace.Scheduler.html#_thread"><span class="hs-identifier hs-var hs-var">_thread</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680554181"><span class="hs-identifier hs-type">t</span></a></span><span>
</span><span id="line-157"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680553889"><span id="local-6989586621680553891"><span class="annot"><span class="annottext">a -&gt; WithPriority b -&gt; WithPriority a
(a -&gt; b) -&gt; WithPriority a -&gt; WithPriority b
(forall a b. (a -&gt; b) -&gt; WithPriority a -&gt; WithPriority b)
-&gt; (forall a b. a -&gt; WithPriority b -&gt; WithPriority a)
-&gt; Functor WithPriority
forall a b. a -&gt; WithPriority b -&gt; WithPriority a
forall a b. (a -&gt; b) -&gt; WithPriority a -&gt; WithPriority b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b)
-&gt; (forall a b. a -&gt; f b -&gt; f a) -&gt; Functor f
&lt;$ :: a -&gt; WithPriority b -&gt; WithPriority a
$c&lt;$ :: forall a b. a -&gt; WithPriority b -&gt; WithPriority a
fmap :: (a -&gt; b) -&gt; WithPriority a -&gt; WithPriority b
$cfmap :: forall a b. (a -&gt; b) -&gt; WithPriority a -&gt; WithPriority b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Functor</span></a></span></span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="hs-keyword">type</span><span> </span><span id="SuspendedThread"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier hs-var">SuspendedThread</span></a></span></span><span> </span><span id="local-6989586621680553887"><span class="annot"><a href="#local-6989586621680553887"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553886"><span class="annot"><a href="#local-6989586621680553886"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553885"><span class="annot"><a href="#local-6989586621680553885"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553887"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553886"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553885"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-160"></span><span>
</span><span id="line-161"></span><span class="hs-keyword">type</span><span> </span><span id="EmSystemCall"><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-var">EmSystemCall</span></a></span></span><span> </span><span id="local-6989586621680553884"><span class="annot"><a href="#local-6989586621680553884"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553883"><span class="annot"><a href="#local-6989586621680553883"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553882"><span class="annot"><a href="#local-6989586621680553882"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SysCall"><span class="hs-identifier hs-type">SysCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553884"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553883"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553882"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>
</span><span id="line-163"></span><span class="hs-keyword">type</span><span> </span><span id="AgentSystemCall"><span class="annot"><a href="Plutus.Trace.Scheduler.html#AgentSystemCall"><span class="hs-identifier hs-var">AgentSystemCall</span></a></span></span><span> </span><span id="local-6989586621680553881"><span class="annot"><a href="#local-6989586621680553881"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier hs-type">MessageCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553881"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Thread that can be run by the scheduler</span><span>
</span><span id="line-166"></span><span class="hs-keyword">data</span><span> </span><span id="EmThread"><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-var">EmThread</span></a></span></span><span> </span><span id="local-6989586621680554171"><span class="annot"><a href="#local-6989586621680554171"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554172"><span class="annot"><a href="#local-6989586621680554172"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680554170"><span class="annot"><a href="#local-6989586621680554170"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-167"></span><span>    </span><span id="EmThread"><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-var">EmThread</span></a></span></span><span>
</span><span id="line-168"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="_continuation"><span class="annot"><span class="annottext">EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="Plutus.Trace.Scheduler.html#_continuation"><span class="hs-identifier hs-var hs-var">_continuation</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554172"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680554171"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Status</span></span><span> </span><span class="annot"><a href="#local-6989586621680554171"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554171"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554172"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554170"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554172"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The continuation to be run when the thread is resumed.</span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_threadId"><span class="annot"><span class="annottext">EmThread effs systemEvent a -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_threadId"><span class="hs-identifier hs-var hs-var">_threadId</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ Thread ID</span><span>
</span><span id="line-170"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_tag"><span class="annot"><span class="annottext">EmThread effs systemEvent a -&gt; Tag
</span><a href="Plutus.Trace.Scheduler.html#_tag"><span class="hs-identifier hs-var hs-var">_tag</span></a></span></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-comment">-- ^ Tag of the thread. See note [Thread Tag]</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="hs-comment">-- | The system calls we can make to the scheduler, affecting the the threads</span><span>
</span><span id="line-174"></span><span class="hs-comment">--   that are currently running.</span><span>
</span><span id="line-175"></span><span class="hs-keyword">data</span><span> </span><span id="ThreadCall"><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadCall"><span class="hs-identifier hs-var">ThreadCall</span></a></span></span><span> </span><span id="local-6989586621680554138"><span class="annot"><a href="#local-6989586621680554138"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554137"><span class="annot"><a href="#local-6989586621680554137"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680554136"><span class="annot"><a href="#local-6989586621680554136"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="Fork"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Fork"><span class="hs-identifier hs-var">Fork</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier hs-type">SuspendedThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554138"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554137"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554136"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Start a new thread with a new thread ID.</span><span>
</span><span id="line-177"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Thaw"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Thaw"><span class="hs-identifier hs-var">Thaw</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ Unfreeze a thread.</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Exit"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Exit"><span class="hs-identifier hs-var">Exit</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680554136"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-comment">-- ^ Terminate the scheduler.</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span class="hs-comment">-- | Sending messages to other threads and waiting for new messages to arrive.</span><span>
</span><span id="line-181"></span><span class="hs-keyword">data</span><span> </span><span id="MessageCall"><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier hs-var">MessageCall</span></a></span></span><span> </span><span id="local-6989586621680554128"><span class="annot"><a href="#local-6989586621680554128"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="WaitForMessage"><span class="annot"><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span></span><span> </span><span class="hs-comment">-- ^ Suspend ourselves (the caller) until we receive a message</span><span>
</span><span id="line-183"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Broadcast"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Broadcast"><span class="hs-identifier hs-var">Broadcast</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621680554128"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-comment">-- ^ Send a message to all threads</span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Message"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Message"><span class="hs-identifier hs-var">Message</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554128"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-comment">-- ^ Send a message to a specific thread</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-keyword">type</span><span> </span><span id="SysCall"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SysCall"><span class="hs-identifier hs-var">SysCall</span></a></span></span><span> </span><span id="local-6989586621680553870"><span class="annot"><a href="#local-6989586621680553870"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553869"><span class="annot"><a href="#local-6989586621680553869"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553868"><span class="annot"><a href="#local-6989586621680553868"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier hs-type">MessageCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553869"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadCall"><span class="hs-identifier hs-type">ThreadCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553870"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553869"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553868"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span id="_Message"><span id="_Broadcast"><span id="_WaitForMessage"><span id="local-6989586621680554128"><span class="hs-identifier">makePrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MessageCall</span></span></span></span></span><span>
</span><span id="line-189"></span><span id="_Exit"><span id="_Thaw"><span id="_Fork"><span id="local-6989586621680553863"><span id="local-6989586621680553864"><span id="local-6989586621680554136"><span id="local-6989586621680554137"><span id="local-6989586621680554138"><span class="hs-identifier">makePrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ThreadCall</span></span></span></span></span></span></span></span></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-comment">-- | Scheduler state</span><span>
</span><span id="line-192"></span><span class="hs-keyword">data</span><span> </span><span id="SchedulerState"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-var">SchedulerState</span></a></span></span><span> </span><span id="local-6989586621680554196"><span class="annot"><a href="#local-6989586621680554196"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554195"><span class="annot"><a href="#local-6989586621680554195"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680554194"><span class="annot"><a href="#local-6989586621680554194"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="SchedulerState"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-var">SchedulerState</span></a></span></span><span>
</span><span id="line-194"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="_normalPrio"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Seq (EmThread effs systemEvent a)
</span><a href="Plutus.Trace.Scheduler.html#_normalPrio"><span class="hs-identifier hs-var hs-var">_normalPrio</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554196"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554195"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554194"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^  Threads running at normal priority</span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_sleeping"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Seq (EmThread effs systemEvent a)
</span><a href="Plutus.Trace.Scheduler.html#_sleeping"><span class="hs-identifier hs-var hs-var">_sleeping</span></a></span></span><span>      </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554196"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554195"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554194"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Sleeping threads (waiting for an external event)</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_frozen"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Seq (EmThread effs systemEvent a)
</span><a href="Plutus.Trace.Scheduler.html#_frozen"><span class="hs-identifier hs-var hs-var">_frozen</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554196"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554195"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554194"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Frozen threads (will not be resumed until they are explicitly unfrozen)</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_lastThreadId"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_lastThreadId"><span class="hs-identifier hs-var hs-var">_lastThreadId</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-comment">-- ^ Last thread id assigned to a thread</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_mailboxes"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; HashMap ThreadId (Seq systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#_mailboxes"><span class="hs-identifier hs-var hs-var">_mailboxes</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HashMap</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Seq</span></span><span> </span><span class="annot"><a href="#local-6989586621680554195"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The mailboxes of all active threads.</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="_activeThreads"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a -&gt; Map Tag (HashSet ThreadId)
</span><a href="Plutus.Trace.Scheduler.html#_activeThreads"><span class="hs-identifier hs-var hs-var">_activeThreads</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HashSet</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Map of tags to thread IDs. See note [Thread Tag]</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span id="sleeping"><span id="normalPrio"><span id="mailboxes"><span id="lastThreadId"><span id="frozen"><span id="activeThreads"><span id="local-6989586621680554194"><span id="local-6989586621680554195"><span id="local-6989586621680554196"><span class="hs-identifier">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SchedulerState</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- | Remove a thread from the set of active threads. Usually called when the</span><span>
</span><span id="line-205"></span><span class="hs-comment">--   thread is finished.</span><span>
</span><span id="line-206"></span><span id="local-6989586621680554075"><span id="local-6989586621680554076"><span id="local-6989586621680554077"><span class="annot"><a href="Plutus.Trace.Scheduler.html#removeActiveThread"><span class="hs-identifier hs-type">removeActiveThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554077"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554076"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554075"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554077"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554076"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554075"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-207"></span><span id="removeActiveThread"><span class="annot"><span class="annottext">removeActiveThread :: ThreadId
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#removeActiveThread"><span class="hs-identifier hs-var hs-var">removeActiveThread</span></a></span></span><span> </span><span id="local-6989586621680553845"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553845"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ASetter
  (SchedulerState effs systemEvent a)
  (SchedulerState effs systemEvent a)
  (HashSet ThreadId)
  (HashSet ThreadId)
-&gt; (HashSet ThreadId -&gt; HashSet ThreadId)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-identifier hs-var">over</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Map Tag (HashSet ThreadId)
 -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a) (Map Tag (HashSet ThreadId))
</span><a href="Plutus.Trace.Scheduler.html#activeThreads"><span class="hs-identifier hs-var">activeThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Map Tag (HashSet ThreadId)
  -&gt; Identity (Map Tag (HashSet ThreadId)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
    -&gt; Map Tag (HashSet ThreadId)
    -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; ASetter
     (SchedulerState effs systemEvent a)
     (SchedulerState effs systemEvent a)
     (HashSet ThreadId)
     (HashSet ThreadId)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(HashSet ThreadId -&gt; Identity (HashSet ThreadId))
-&gt; Map Tag (HashSet ThreadId)
-&gt; Identity (Map Tag (HashSet ThreadId))
forall (f :: * -&gt; *) a b. Functor f =&gt; Setter (f a) (f b) a b
</span><span class="hs-identifier hs-var">mapped</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadId -&gt; HashSet ThreadId -&gt; HashSet ThreadId
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.delete</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553845"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>
</span><span id="line-209"></span><span class="hs-comment">-- | A suspended thread with a priority and the thread itself.</span><span>
</span><span id="line-210"></span><span id="local-6989586621680554085"><span id="local-6989586621680554086"><span id="local-6989586621680554087"><span class="annot"><a href="Plutus.Trace.Scheduler.html#suspendThread"><span class="hs-identifier hs-type">suspendThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554087"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554086"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554085"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier hs-type">SuspendedThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554087"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554086"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554085"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-211"></span><span id="suspendThread"><span class="annot"><span class="annottext">suspendThread :: Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#suspendThread"><span class="hs-identifier hs-var hs-var">suspendThread</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
forall t. Priority -&gt; t -&gt; WithPriority t
</span><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-var">WithPriority</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | Make a thread with the given priority from an action. This is a</span><span>
</span><span id="line-214"></span><span class="hs-comment">--   convenience for defining 'SimulatorInterpreter' values.</span><span>
</span><span id="line-215"></span><span id="local-6989586621680554133"><span id="local-6989586621680554134"><span id="local-6989586621680554135"><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkThread"><span class="hs-identifier hs-type">mkThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554135"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554134"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554133"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554134"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680554135"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier hs-type">SuspendedThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554135"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554134"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554133"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-216"></span><span id="mkThread"><span class="annot"><span class="annottext">mkThread :: Tag
-&gt; Priority
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; ThreadId
-&gt; SuspendedThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#mkThread"><span class="hs-identifier hs-var hs-var">mkThread</span></a></span></span><span> </span><span id="local-6989586621680553839"><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553839"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680553838"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553838"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span id="local-6989586621680553837"><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553837"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span id="local-6989586621680553836"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553836"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680553835"><span class="annot"><span class="annottext">action' :: Eff
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553835"><span class="hs-identifier hs-var hs-var">action'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadId
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; Eff
     (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
forall r (effs :: [* -&gt; *]) a.
r -&gt; Eff (Reader r : effs) a -&gt; Eff effs a
</span><span class="hs-identifier hs-var">runReader</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553836"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553837"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">WithPriority :: forall t. Priority -&gt; t -&gt; WithPriority t
</span><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_priority :: Priority
</span><a href="Plutus.Trace.Scheduler.html#_priority"><span class="hs-identifier hs-var">_priority</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553838"><span class="hs-identifier hs-var">prio</span></a></span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_thread :: EmThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#_thread"><span class="hs-identifier hs-var">_thread</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmThread :: forall (effs :: [* -&gt; *]) systemEvent a.
(Maybe systemEvent
 -&gt; Eff
      effs
      (Status
         effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()))
-&gt; ThreadId -&gt; Tag -&gt; EmThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span>
</span><span id="line-221"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_threadId :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_threadId"><span class="hs-identifier hs-var">_threadId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553836"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-222"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_continuation :: Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="Plutus.Trace.Scheduler.html#_continuation"><span class="hs-identifier hs-var">_continuation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Maybe systemEvent
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Eff
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
forall a b (effs :: [* -&gt; *]) r.
Eff (Yield a b : effs) r -&gt; Eff effs (Status effs a b r)
</span><span class="hs-identifier hs-var">runC</span></span><span> </span><span class="annot"><span class="annottext">Eff
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553835"><span class="hs-identifier hs-var">action'</span></a></span><span>
</span><span id="line-223"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_tag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#_tag"><span class="hs-identifier hs-var">_tag</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553839"><span class="hs-identifier hs-var">tag</span></a></span><span>
</span><span id="line-224"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-225"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-comment">-- | Make a 'MessageCall' system call for some agent</span><span>
</span><span id="line-228"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-type">mkAgentSysCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680553832"><span class="annot"><a href="#local-6989586621680553832"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553831"><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-229"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#AgentSystemCall"><span class="hs-identifier hs-type">AgentSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680553832"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span> </span><span class="hs-comment">-- ^ The 'Priority' of the caller</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#MessageCall"><span class="hs-identifier hs-type">MessageCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-comment">-- ^ The system call</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680553832"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span id="mkAgentSysCall"><span class="annot"><span class="annottext">mkAgentSysCall :: Priority -&gt; MessageCall systemEvent -&gt; Eff effs (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkAgentSysCall"><span class="hs-identifier hs-var hs-var">mkAgentSysCall</span></a></span></span><span> </span><span id="local-6989586621680553830"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553830"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span id="local-6989586621680553829"><span class="annot"><span class="annottext">MessageCall systemEvent
</span><a href="#local-6989586621680553829"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AgentSystemCall systemEvent
-&gt; (Maybe systemEvent -&gt; Maybe systemEvent)
-&gt; Eff effs (Maybe systemEvent)
forall a b (effs :: [* -&gt; *]) c.
Member (Yield a b) effs =&gt;
a -&gt; (b -&gt; c) -&gt; Eff effs c
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#AgentSystemCall"><span class="hs-identifier hs-type">AgentSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553831"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Priority -&gt; MessageCall systemEvent -&gt; AgentSystemCall systemEvent
forall t. Priority -&gt; t -&gt; WithPriority t
</span><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-var">WithPriority</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553830"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall systemEvent
</span><a href="#local-6989586621680553829"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent -&gt; Maybe systemEvent
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | Make a system call</span><span>
</span><span id="line-236"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier hs-type">mkSysCall</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680554147"><span class="annot"><a href="#local-6989586621680554147"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554146"><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680554144"><span class="annot"><a href="#local-6989586621680554144"><span class="hs-identifier hs-type">effs2</span></a></span></span><span> </span><span id="local-6989586621680554145"><span class="annot"><a href="#local-6989586621680554145"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554147"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554145"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680554144"><span class="hs-identifier hs-type">effs2</span></a></span><span>
</span><span id="line-238"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span> </span><span class="hs-comment">-- ^ The 'Priority' of the caller</span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SysCall"><span class="hs-identifier hs-type">SysCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554147"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554145"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-comment">-- ^ The system call</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680554144"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span id="mkSysCall"><span class="annot"><span class="annottext">mkSysCall :: Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier hs-var hs-var">mkSysCall</span></a></span></span><span> </span><span id="local-6989586621680553826"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553826"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span id="local-6989586621680553825"><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553825"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmSystemCall effs systemEvent a
-&gt; (Maybe systemEvent -&gt; Maybe systemEvent)
-&gt; Eff effs2 (Maybe systemEvent)
forall a b (effs :: [* -&gt; *]) c.
Member (Yield a b) effs =&gt;
a -&gt; (b -&gt; c) -&gt; Eff effs c
</span><span class="hs-identifier hs-var">yield</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554147"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554145"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554146"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Priority
-&gt; SysCall effs systemEvent a -&gt; EmSystemCall effs systemEvent a
forall t. Priority -&gt; t -&gt; WithPriority t
</span><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-var">WithPriority</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553826"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553825"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent -&gt; Maybe systemEvent
forall a. a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span class="hs-comment">-- | Start a new thread</span><span>
</span><span id="line-244"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#fork"><span class="hs-identifier hs-type">fork</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680553824"><span class="annot"><a href="#local-6989586621680553824"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553823"><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553822"><span class="annot"><a href="#local-6989586621680553822"><span class="hs-identifier hs-type">effs2</span></a></span></span><span> </span><span id="local-6989586621680553821"><span class="annot"><a href="#local-6989586621680553821"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553824"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553821"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680553822"><span class="hs-identifier hs-type">effs2</span></a></span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span> </span><span class="hs-comment">-- ^ Tag of the new thread. See note [Thread Tag]</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span> </span><span class="hs-comment">-- ^ Priority of the new thread.</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553824"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553821"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680553824"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680553822"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553823"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span id="fork"><span class="annot"><span class="annottext">fork :: Tag
-&gt; Priority
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#fork"><span class="hs-identifier hs-var hs-var">fork</span></a></span></span><span> </span><span id="local-6989586621680553820"><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553820"><span class="hs-identifier hs-var">tag</span></a></span></span><span> </span><span id="local-6989586621680553819"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553819"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span id="local-6989586621680553818"><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553818"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
forall (effs :: [* -&gt; *]) systemEvent (effs2 :: [* -&gt; *]) a.
Member
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent))
  effs2 =&gt;
Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier hs-var">mkSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553819"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadCall effs systemEvent a -&gt; SysCall effs systemEvent a
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadCall effs systemEvent a -&gt; SysCall effs systemEvent a)
-&gt; ThreadCall effs systemEvent a -&gt; SysCall effs systemEvent a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; SuspendedThread effs systemEvent a)
-&gt; ThreadCall effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
(ThreadId -&gt; SuspendedThread effs systemEvent a)
-&gt; ThreadCall effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#Fork"><span class="hs-identifier hs-var">Fork</span></a></span><span> </span><span class="annot"><span class="annottext">((ThreadId -&gt; SuspendedThread effs systemEvent a)
 -&gt; ThreadCall effs systemEvent a)
-&gt; (ThreadId -&gt; SuspendedThread effs systemEvent a)
-&gt; ThreadCall effs systemEvent a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
-&gt; Priority
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; ThreadId
-&gt; SuspendedThread effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
Tag
-&gt; Priority
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; ThreadId
-&gt; SuspendedThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#mkThread"><span class="hs-identifier hs-var">mkThread</span></a></span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553820"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553819"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553818"><span class="hs-identifier hs-var">action</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-comment">-- | Suspend the current thread</span><span>
</span><span id="line-253"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#sleep"><span class="hs-identifier hs-type">sleep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680553817"><span class="annot"><a href="#local-6989586621680553817"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553816"><span class="annot"><a href="#local-6989586621680553816"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553815"><span class="annot"><a href="#local-6989586621680553815"><span class="hs-identifier hs-type">effs2</span></a></span></span><span> </span><span id="local-6989586621680553814"><span class="annot"><a href="#local-6989586621680553814"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-254"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553817"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553816"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553814"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553816"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680553815"><span class="hs-identifier hs-type">effs2</span></a></span><span>
</span><span id="line-255"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span>
</span><span id="line-256"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680553815"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553816"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span id="sleep"><span class="annot"><span class="annottext">sleep :: Priority -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#sleep"><span class="hs-identifier hs-var hs-var">sleep</span></a></span></span><span> </span><span id="local-6989586621680553813"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553813"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
forall (effs :: [* -&gt; *]) systemEvent (effs2 :: [* -&gt; *]) a.
Member
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent))
  effs2 =&gt;
Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier hs-var">mkSysCall</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553817"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553816"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553815"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553814"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553813"><span class="hs-identifier hs-var">prio</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MessageCall systemEvent -&gt; SysCall effs systemEvent a
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall systemEvent
forall systemEvent. MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>
</span><span id="line-259"></span><span class="hs-comment">-- | Stop the scheduler and let it return with the given value.</span><span>
</span><span id="line-260"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#exit"><span class="hs-identifier hs-type">exit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680553812"><span class="annot"><a href="#local-6989586621680553812"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553811"><span class="annot"><a href="#local-6989586621680553811"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680553810"><span class="annot"><a href="#local-6989586621680553810"><span class="hs-identifier hs-type">effs2</span></a></span></span><span> </span><span id="local-6989586621680553809"><span class="annot"><a href="#local-6989586621680553809"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-261"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553812"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553811"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553809"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553811"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680553810"><span class="hs-identifier hs-type">effs2</span></a></span><span>
</span><span id="line-262"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621680553809"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680553810"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553811"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span id="exit"><span class="annot"><span class="annottext">exit :: a -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#exit"><span class="hs-identifier hs-var hs-var">exit</span></a></span></span><span> </span><span id="local-6989586621680553808"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553808"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
forall (effs :: [* -&gt; *]) systemEvent (effs2 :: [* -&gt; *]) a.
Member
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent))
  effs2 =&gt;
Priority
-&gt; SysCall effs systemEvent a -&gt; Eff effs2 (Maybe systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#mkSysCall"><span class="hs-identifier hs-var">mkSysCall</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553812"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553811"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621680553810"><span class="hs-identifier hs-type">effs2</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadCall effs systemEvent a -&gt; SysCall effs systemEvent a
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; ThreadCall effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
a -&gt; ThreadCall effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#Exit"><span class="hs-identifier hs-var">Exit</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553808"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-264"></span><span>
</span><span id="line-265"></span><span class="hs-comment">-- | Tag of the initial thread.</span><span>
</span><span id="line-266"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#initialThreadTag"><span class="hs-identifier hs-type">initialThreadTag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-267"></span><span id="initialThreadTag"><span class="annot"><span class="annottext">initialThreadTag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#initialThreadTag"><span class="hs-identifier hs-var hs-var">initialThreadTag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><span class="hs-string">&quot;initial thread&quot;</span></span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Handle the 'Yield (EmSystemCall effs systemEvent) (Maybe systemEvent)'</span><span>
</span><span id="line-270"></span><span class="hs-comment">--   effect using the scheduler, see note [Scheduler]. 'runThreads' only</span><span>
</span><span id="line-271"></span><span class="hs-comment">--   returns when all threads are finished, returning `Nothing`, or when</span><span>
</span><span id="line-272"></span><span class="hs-comment">--   `exit` is called, in which case the value passed to `exit` is returned.</span><span>
</span><span id="line-273"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#runThreads"><span class="hs-identifier hs-type">runThreads</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680553806"><span class="annot"><a href="#local-6989586621680553806"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680553805"><span class="annot"><a href="#local-6989586621680553805"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680553804"><span class="annot"><a href="#local-6989586621680553804"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-275"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553804"><span class="hs-identifier hs-type">systemEvent</span></a></span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680553805"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Reader</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Yield</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmSystemCall"><span class="hs-identifier hs-type">EmSystemCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553805"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553804"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553806"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553804"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="annot"><a href="#local-6989586621680553805"><span class="hs-identifier hs-type">effs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680553805"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680553806"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="runThreads"><span class="annot"><span class="annottext">runThreads :: Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
-&gt; Eff effs (Maybe a)
</span><a href="Plutus.Trace.Scheduler.html#runThreads"><span class="hs-identifier hs-var hs-var">runThreads</span></a></span></span><span> </span><span id="local-6989586621680553803"><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553803"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-281"></span><span>    </span><span id="local-6989586621680553802"><span class="annot"><span class="annottext">Status
  effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()
</span><a href="#local-6989586621680553802"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Eff
  (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
forall a b (effs :: [* -&gt; *]) r.
Eff (Yield a b : effs) r -&gt; Eff effs (Status effs a b r)
</span><span class="hs-identifier hs-var">runC</span></span><span> </span><span class="annot"><span class="annottext">(Eff
   (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
      : effs)
   ()
 -&gt; Eff
      effs
      (Status
         effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()))
-&gt; Eff
     (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
-&gt; Eff
     (Reader ThreadId
        : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
-&gt; Eff
     (Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
        : effs)
     ()
forall r (effs :: [* -&gt; *]) a.
r -&gt; Eff (Reader r : effs) a -&gt; Eff effs a
</span><span class="hs-identifier hs-var">runReader</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var">initialThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">Eff
  (Reader ThreadId
     : Yield (EmSystemCall effs systemEvent a) (Maybe systemEvent)
     : effs)
  ()
</span><a href="#local-6989586621680553803"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
  effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()
</span><a href="#local-6989586621680553802"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-283"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Done</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Eff effs (Maybe a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Continue</span></span><span> </span><span class="annot"><span class="annottext">EmSystemCall effs systemEvent a
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621680553799"><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553799"><span class="hs-identifier hs-var">k'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-285"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680553798"><span class="annot"><span class="annottext">initialThread :: EmThread effs systemEvent a
</span><a href="#local-6989586621680553798"><span class="hs-identifier hs-var hs-var">initialThread</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmThread :: forall (effs :: [* -&gt; *]) systemEvent a.
(Maybe systemEvent
 -&gt; Eff
      effs
      (Status
         effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()))
-&gt; ThreadId -&gt; Tag -&gt; EmThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_continuation :: Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="Plutus.Trace.Scheduler.html#_continuation"><span class="hs-identifier hs-var">_continuation</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553799"><span class="hs-identifier hs-var">k'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_threadId :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_threadId"><span class="hs-identifier hs-var">_threadId</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var">initialThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_tag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#_tag"><span class="hs-identifier hs-var">_tag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="Plutus.Trace.Scheduler.html#initialThreadTag"><span class="hs-identifier hs-var">initialThreadTag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-286"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
forall a (effs :: [* -&gt; *]) systemEvent.
(Eq systemEvent, Member (LogMsg SchedulerLog) effs) =&gt;
SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
</span><a href="Plutus.Trace.Scheduler.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a))
-&gt; SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span>
</span><span id="line-288"></span><span>                    </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Tag (HashSet ThreadId)
 -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a) (Map Tag (HashSet ThreadId))
</span><a href="Plutus.Trace.Scheduler.html#activeThreads"><span class="hs-identifier hs-var">activeThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Map Tag (HashSet ThreadId)
  -&gt; Identity (Map Tag (HashSet ThreadId)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
    -&gt; Map Tag (HashSet ThreadId)
    -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; (HashSet ThreadId -&gt; Identity (HashSet ThreadId))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (Map Tag (HashSet ThreadId))
-&gt; Lens'
     (Map Tag (HashSet ThreadId))
     (Maybe (IxValue (Map Tag (HashSet ThreadId))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map Tag (HashSet ThreadId))
Tag
</span><a href="Plutus.Trace.Scheduler.html#initialThreadTag"><span class="hs-identifier hs-var">initialThreadTag</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (HashSet ThreadId) -&gt; Identity (Maybe (HashSet ThreadId)))
 -&gt; Map Tag (HashSet ThreadId)
 -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; ((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
    -&gt; Maybe (HashSet ThreadId) -&gt; Identity (Maybe (HashSet ThreadId)))
-&gt; (HashSet ThreadId -&gt; Identity (HashSet ThreadId))
-&gt; Map Tag (HashSet ThreadId)
-&gt; Identity (Map Tag (HashSet ThreadId))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ThreadId
-&gt; Iso' (Maybe (HashSet ThreadId)) (HashSet ThreadId)
forall a. Eq a =&gt; a -&gt; Iso' (Maybe a) a
</span><span class="hs-identifier hs-var">non</span></span><span> </span><span class="annot"><span class="annottext">HashSet ThreadId
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (HashSet ThreadId -&gt; HashSet ThreadId)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; HashSet ThreadId -&gt; HashSet ThreadId
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.insert</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var">initialThreadId</span></a></span><span>
</span><span id="line-289"></span><span>                    </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; (Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
-&gt; Lens'
     (HashMap ThreadId (Seq systemEvent))
     (Maybe (IxValue (HashMap ThreadId (Seq systemEvent))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var">initialThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Seq systemEvent
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a (Maybe b) -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">?~</span></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
forall a. Seq a
</span><span class="hs-identifier hs-var">Seq.empty</span></span><span>
</span><span id="line-290"></span><span>                    </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a, ThreadId)
-&gt; SchedulerState effs systemEvent a
forall a b. (a, b) -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((SchedulerState effs systemEvent a, ThreadId)
 -&gt; SchedulerState effs systemEvent a)
-&gt; (SchedulerState effs systemEvent a
    -&gt; (SchedulerState effs systemEvent a, ThreadId))
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a, ThreadId)
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a, ThreadId)
</span><a href="Plutus.Trace.Scheduler.html#nextThreadId"><span class="hs-identifier hs-var">nextThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>                    </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#enqueue"><span class="hs-identifier hs-var">enqueue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#suspendThread"><span class="hs-identifier hs-var">suspendThread</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553798"><span class="hs-identifier hs-var">initialThread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="hs-comment">-- | Run the threads that are scheduled in a 'SchedulerState' to completion.</span><span>
</span><span id="line-294"></span><span class="annot"><a href="Plutus.Trace.Scheduler.html#loop"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680554113"><span class="annot"><a href="#local-6989586621680554113"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621680554114"><span class="annot"><a href="#local-6989586621680554114"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554117"><span class="annot"><a href="#local-6989586621680554117"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-295"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554117"><span class="hs-identifier hs-type">systemEvent</span></a></span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680554114"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-297"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554114"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554117"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554113"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680554114"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554113"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-300"></span><span id="loop"><span class="annot"><span class="annottext">loop :: SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
</span><a href="Plutus.Trace.Scheduler.html#loop"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span id="local-6989586621680553786"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553786"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; SchedulerDQResult effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
-&gt; SchedulerDQResult effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#dequeue"><span class="hs-identifier hs-var">dequeue</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553786"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-302"></span><span>        </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#AThread"><span class="hs-identifier hs-type">AThread</span></a></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span class="hs-special">{</span><span id="local-6989586621680553783"><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
_continuation :: Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
_continuation :: forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553783"><span class="hs-identifier hs-var hs-var">_continuation</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553782"><span class="annot"><span class="annottext">ThreadId
_threadId :: ThreadId
_threadId :: forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a -&gt; ThreadId
</span><a href="#local-6989586621680553782"><span class="hs-identifier hs-var hs-var">_threadId</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553781"><span class="annot"><span class="annottext">Tag
_tag :: Tag
_tag :: forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a -&gt; Tag
</span><a href="#local-6989586621680553781"><span class="hs-identifier hs-var hs-var">_tag</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680553780"><span class="annot"><span class="annottext">Maybe systemEvent
</span><a href="#local-6989586621680553780"><span class="hs-identifier hs-var">event</span></a></span></span><span> </span><span id="local-6989586621680553779"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553779"><span class="hs-identifier hs-var">schedulerState</span></a></span></span><span> </span><span id="local-6989586621680553778"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553778"><span class="hs-identifier hs-var">prio</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680553777"><span class="annot"><span class="annottext">mkLog :: ThreadEvent -&gt; SchedulerLog
</span><a href="#local-6989586621680553777"><span class="hs-identifier hs-var hs-var">mkLog</span></a></span></span><span> </span><span id="local-6989586621680553776"><span class="annot"><span class="annottext">ThreadEvent
</span><a href="#local-6989586621680553776"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchedulerLog :: ThreadEvent -&gt; ThreadId -&gt; Tag -&gt; Priority -&gt; SchedulerLog
</span><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">slEvent :: ThreadEvent
</span><a href="Plutus.Trace.Scheduler.html#slEvent"><span class="hs-identifier hs-var">slEvent</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ThreadEvent
</span><a href="#local-6989586621680553776"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slThread :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#slThread"><span class="hs-identifier hs-var">slThread</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553782"><span class="hs-identifier hs-var">_threadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slPrio :: Priority
</span><a href="Plutus.Trace.Scheduler.html#slPrio"><span class="hs-identifier hs-var">slPrio</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553778"><span class="hs-identifier hs-var">prio</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slTag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#slTag"><span class="hs-identifier hs-var">slTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553781"><span class="hs-identifier hs-var">_tag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-304"></span><span>            </span><span id="local-6989586621680553770"><span class="annot"><span class="annottext">Status
  effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()
</span><a href="#local-6989586621680553770"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553783"><span class="hs-identifier hs-var">_continuation</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent
</span><a href="#local-6989586621680553780"><span class="hs-identifier hs-var">event</span></a></span><span>
</span><span id="line-305"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Status
  effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()
</span><a href="#local-6989586621680553770"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Done</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
forall a (effs :: [* -&gt; *]) systemEvent.
(Eq systemEvent, Member (LogMsg SchedulerLog) effs) =&gt;
SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
</span><a href="Plutus.Trace.Scheduler.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a))
-&gt; SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553779"><span class="hs-identifier hs-var">schedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
ThreadId
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#removeActiveThread"><span class="hs-identifier hs-var">removeActiveThread</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553782"><span class="hs-identifier hs-var">_threadId</span></a></span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Continue</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span class="hs-special">{</span><span id="local-6989586621680553769"><span class="annot"><span class="annottext">Priority
_priority :: Priority
_priority :: forall t. WithPriority t -&gt; Priority
</span><a href="#local-6989586621680553769"><span class="hs-identifier hs-var hs-var">_priority</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_thread :: forall t. WithPriority t -&gt; t
</span><a href="Plutus.Trace.Scheduler.html#_thread"><span class="hs-identifier hs-var">_thread</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621680553768"><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553768"><span class="hs-identifier hs-var">sysCall</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680553767"><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553767"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-308"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680553766"><span class="annot"><span class="annottext">thisThread :: SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553766"><span class="hs-identifier hs-var hs-var">thisThread</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
Priority
-&gt; EmThread effs systemEvent a
-&gt; SuspendedThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#suspendThread"><span class="hs-identifier hs-var">suspendThread</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553769"><span class="hs-identifier hs-var">_priority</span></a></span><span> </span><span class="annot"><span class="annottext">EmThread :: forall (effs :: [* -&gt; *]) systemEvent a.
(Maybe systemEvent
 -&gt; Eff
      effs
      (Status
         effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ()))
-&gt; ThreadId -&gt; Tag -&gt; EmThread effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">_threadId :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_threadId"><span class="hs-identifier hs-var">_threadId</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553782"><span class="hs-identifier hs-var">_threadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_continuation :: Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="Plutus.Trace.Scheduler.html#_continuation"><span class="hs-identifier hs-var">_continuation</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Maybe systemEvent
-&gt; Eff
     effs
     (Status
        effs (EmSystemCall effs systemEvent a) (Maybe systemEvent) ())
</span><a href="#local-6989586621680553767"><span class="hs-identifier hs-var">k</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_tag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#_tag"><span class="hs-identifier hs-var">_tag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553781"><span class="hs-identifier hs-var">_tag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-309"></span><span>                    </span><span id="local-6989586621680553765"><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
</span><a href="#local-6989586621680553765"><span class="hs-identifier hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553779"><span class="hs-identifier hs-var">schedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#enqueue"><span class="hs-identifier hs-var">enqueue</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553766"><span class="hs-identifier hs-var">thisThread</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; Eff effs (Either a (SchedulerState effs systemEvent a)))
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">SysCall effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall systemEvent (effs :: [* -&gt; *]) a.
(Eq systemEvent, Member (LogMsg SchedulerLog) effs) =&gt;
SysCall effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#handleSysCall"><span class="hs-identifier hs-var">handleSysCall</span></a></span><span> </span><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553768"><span class="hs-identifier hs-var">sysCall</span></a></span><span>
</span><span id="line-310"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
</span><a href="#local-6989586621680553765"><span class="hs-identifier hs-var">newState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>                        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680553763"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553763"><span class="hs-identifier hs-var">a</span></a></span></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerLog -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logDebug</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThreadEvent -&gt; SchedulerLog
</span><a href="#local-6989586621680553777"><span class="hs-identifier hs-var">mkLog</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadEvent
</span><a href="Plutus.Trace.Scheduler.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Eff effs () -&gt; Eff effs (Maybe a) -&gt; Eff effs (Maybe a)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Eff effs (Maybe a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553763"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-312"></span><span>                        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621680553761"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553761"><span class="hs-identifier hs-var">newState'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
forall a (effs :: [* -&gt; *]) systemEvent.
(Eq systemEvent, Member (LogMsg SchedulerLog) effs) =&gt;
SchedulerState effs systemEvent a -&gt; Eff effs (Maybe a)
</span><a href="Plutus.Trace.Scheduler.html#loop"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553761"><span class="hs-identifier hs-var">newState'</span></a></span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">SchedulerDQResult effs systemEvent a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Eff effs (Maybe a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-314"></span><span>
</span><span id="line-315"></span><span class="hs-comment">-- | Deal with a system call from a running thread.</span><span>
</span><span id="line-316"></span><span id="local-6989586621680554072"><span id="local-6989586621680554073"><span id="local-6989586621680554074"><span class="annot"><a href="Plutus.Trace.Scheduler.html#handleSysCall"><span class="hs-identifier hs-type">handleSysCall</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-317"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Eq</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554074"><span class="hs-identifier hs-type">systemEvent</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Member</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">LogMsg</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621680554073"><span class="hs-identifier hs-type">effs</span></a></span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SysCall"><span class="hs-identifier hs-type">SysCall</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554073"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554074"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554072"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-321"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554073"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554074"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554072"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-322"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Eff</span></span><span> </span><span class="annot"><a href="#local-6989586621680554073"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554072"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554073"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554074"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554072"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-323"></span><span id="handleSysCall"><span class="annot"><span class="annottext">handleSysCall :: SysCall effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#handleSysCall"><span class="hs-identifier hs-var hs-var">handleSysCall</span></a></span></span><span> </span><span id="local-6989586621680553760"><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553760"><span class="hs-identifier hs-var">sysCall</span></a></span></span><span> </span><span id="local-6989586621680553759"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SysCall effs systemEvent a
</span><a href="#local-6989586621680553760"><span class="hs-identifier hs-var">sysCall</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-324"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Fork"><span class="hs-identifier hs-type">Fork</span></a></span><span> </span><span id="local-6989586621680553758"><span class="annot"><span class="annottext">ThreadId -&gt; SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553758"><span class="hs-identifier hs-var">newThread</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-325"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553757"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553757"><span class="hs-identifier hs-var">schedulerState'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553756"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553756"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a, ThreadId)
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a, ThreadId)
</span><a href="Plutus.Trace.Scheduler.html#nextThreadId"><span class="hs-identifier hs-var">nextThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span>
</span><span id="line-326"></span><span>            </span><span id="local-6989586621680553755"><span class="annot"><span class="annottext">t :: SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553755"><span class="hs-identifier hs-var hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553758"><span class="hs-identifier hs-var">newThread</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553756"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-327"></span><span>            </span><span id="local-6989586621680553754"><span class="annot"><span class="annottext">tag :: Tag
</span><a href="#local-6989586621680553754"><span class="hs-identifier hs-var hs-var">tag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a -&gt; Tag
forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a -&gt; Tag
</span><a href="Plutus.Trace.Scheduler.html#_tag"><span class="hs-identifier hs-var hs-var">_tag</span></a></span><span> </span><span class="annot"><span class="annottext">(EmThread effs systemEvent a -&gt; Tag)
-&gt; EmThread effs systemEvent a -&gt; Tag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a -&gt; EmThread effs systemEvent a
forall t. WithPriority t -&gt; t
</span><a href="Plutus.Trace.Scheduler.html#_thread"><span class="hs-identifier hs-var hs-var">_thread</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553755"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-328"></span><span>            </span><span id="local-6989586621680553753"><span class="annot"><span class="annottext">newState :: SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553753"><span class="hs-identifier hs-var hs-var">newState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#enqueue"><span class="hs-identifier hs-var">enqueue</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553755"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553757"><span class="hs-identifier hs-var">schedulerState'</span></a></span><span>
</span><span id="line-329"></span><span>                        </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Map Tag (HashSet ThreadId)
 -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a) (Map Tag (HashSet ThreadId))
</span><a href="Plutus.Trace.Scheduler.html#activeThreads"><span class="hs-identifier hs-var">activeThreads</span></a></span><span> </span><span class="annot"><span class="annottext">((Map Tag (HashSet ThreadId)
  -&gt; Identity (Map Tag (HashSet ThreadId)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
    -&gt; Map Tag (HashSet ThreadId)
    -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; (HashSet ThreadId -&gt; Identity (HashSet ThreadId))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (Map Tag (HashSet ThreadId))
-&gt; Lens'
     (Map Tag (HashSet ThreadId))
     (Maybe (IxValue (Map Tag (HashSet ThreadId))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map Tag (HashSet ThreadId))
Tag
</span><a href="#local-6989586621680553754"><span class="hs-identifier hs-var">tag</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (HashSet ThreadId) -&gt; Identity (Maybe (HashSet ThreadId)))
 -&gt; Map Tag (HashSet ThreadId)
 -&gt; Identity (Map Tag (HashSet ThreadId)))
-&gt; ((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
    -&gt; Maybe (HashSet ThreadId) -&gt; Identity (Maybe (HashSet ThreadId)))
-&gt; (HashSet ThreadId -&gt; Identity (HashSet ThreadId))
-&gt; Map Tag (HashSet ThreadId)
-&gt; Identity (Map Tag (HashSet ThreadId))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ThreadId
-&gt; Iso' (Maybe (HashSet ThreadId)) (HashSet ThreadId)
forall a. Eq a =&gt; a -&gt; Iso' (Maybe a) a
</span><span class="hs-identifier hs-var">non</span></span><span> </span><span class="annot"><span class="annottext">HashSet ThreadId
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">((HashSet ThreadId -&gt; Identity (HashSet ThreadId))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (HashSet ThreadId -&gt; HashSet ThreadId)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; HashSet ThreadId -&gt; HashSet ThreadId
forall a. (Eq a, Hashable a) =&gt; a -&gt; HashSet a -&gt; HashSet a
</span><span class="hs-identifier hs-var">HashSet.insert</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553756"><span class="hs-identifier hs-var">tid</span></a></span><span>
</span><span id="line-330"></span><span>                        </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; (Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
-&gt; Lens'
     (HashMap ThreadId (Seq systemEvent))
     (Maybe (IxValue (HashMap ThreadId (Seq systemEvent))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
ThreadId
</span><a href="#local-6989586621680553756"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Maybe (Seq systemEvent)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent -&gt; Maybe (Seq systemEvent)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
forall a. Seq a
</span><span class="hs-identifier hs-var">Seq.empty</span></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">SchedulerLog -&gt; Eff effs ()
forall a (effs :: [* -&gt; *]).
Member (LogMsg a) effs =&gt;
a -&gt; Eff effs ()
</span><span class="hs-identifier hs-var">logDebug</span></span><span> </span><span class="annot"><span class="annottext">(SchedulerLog -&gt; Eff effs ()) -&gt; SchedulerLog -&gt; Eff effs ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerLog :: ThreadEvent -&gt; ThreadId -&gt; Tag -&gt; Priority -&gt; SchedulerLog
</span><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">slEvent :: ThreadEvent
</span><a href="Plutus.Trace.Scheduler.html#slEvent"><span class="hs-identifier hs-var">slEvent</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadEvent
</span><a href="Plutus.Trace.Scheduler.html#Started"><span class="hs-identifier hs-var">Started</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slThread :: ThreadId
</span><a href="Plutus.Trace.Scheduler.html#slThread"><span class="hs-identifier hs-var">slThread</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553756"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slPrio :: Priority
</span><a href="Plutus.Trace.Scheduler.html#slPrio"><span class="hs-identifier hs-var">slPrio</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a -&gt; Priority
forall t. WithPriority t -&gt; Priority
</span><a href="Plutus.Trace.Scheduler.html#_priority"><span class="hs-identifier hs-var hs-var">_priority</span></a></span><span> </span><span class="annot"><span class="annottext">SuspendedThread effs systemEvent a
</span><a href="#local-6989586621680553755"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slTag :: Tag
</span><a href="Plutus.Trace.Scheduler.html#slTag"><span class="hs-identifier hs-var">slTag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553754"><span class="hs-identifier hs-var">tag</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-332"></span><span>        </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553753"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-333"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">MessageCall systemEvent
</span><a href="Plutus.Trace.Scheduler.html#WaitForMessage"><span class="hs-identifier hs-var">WaitForMessage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (SchedulerState effs systemEvent a)
 -&gt; Eff effs (Either a (SchedulerState effs systemEvent a)))
-&gt; Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span>
</span><span id="line-334"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Broadcast"><span class="hs-identifier hs-type">Broadcast</span></a></span><span> </span><span id="local-6989586621680553750"><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553750"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (SchedulerState effs systemEvent a)
 -&gt; Eff effs (Either a (SchedulerState effs systemEvent a)))
-&gt; Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a
 -&gt; Either a (SchedulerState effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((Seq systemEvent -&gt; Identity (Seq systemEvent))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; (Seq systemEvent -&gt; Identity (Seq systemEvent))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq systemEvent -&gt; Identity (Seq systemEvent))
-&gt; HashMap ThreadId (Seq systemEvent)
-&gt; Identity (HashMap ThreadId (Seq systemEvent))
forall (f :: * -&gt; *) a b.
Traversable f =&gt;
IndexedTraversal Int (f a) (f b) a b
</span><span class="hs-identifier hs-var">traversed</span></span><span> </span><span class="annot"><span class="annottext">((Seq systemEvent -&gt; Identity (Seq systemEvent))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (Seq systemEvent -&gt; Seq systemEvent)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq systemEvent -&gt; systemEvent -&gt; Seq systemEvent
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553750"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-335"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Message"><span class="hs-identifier hs-type">Message</span></a></span><span> </span><span id="local-6989586621680553747"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553747"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621680553746"><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553746"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (SchedulerState effs systemEvent a)
 -&gt; Eff effs (Either a (SchedulerState effs systemEvent a)))
-&gt; Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a
 -&gt; Either a (SchedulerState effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((Seq systemEvent -&gt; Identity (Seq systemEvent))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; (Seq systemEvent -&gt; Identity (Seq systemEvent))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
-&gt; Lens'
     (HashMap ThreadId (Seq systemEvent))
     (Maybe (IxValue (HashMap ThreadId (Seq systemEvent))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
ThreadId
</span><a href="#local-6989586621680553747"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
 -&gt; HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; ((Seq systemEvent -&gt; Identity (Seq systemEvent))
    -&gt; Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
-&gt; (Seq systemEvent -&gt; Identity (Seq systemEvent))
-&gt; HashMap ThreadId (Seq systemEvent)
-&gt; Identity (HashMap ThreadId (Seq systemEvent))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent -&gt; Iso' (Maybe (Seq systemEvent)) (Seq systemEvent)
forall a. Eq a =&gt; a -&gt; Iso' (Maybe a) a
</span><span class="hs-identifier hs-var">non</span></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq systemEvent -&gt; Identity (Seq systemEvent))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (Seq systemEvent -&gt; Seq systemEvent)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq systemEvent -&gt; systemEvent -&gt; Seq systemEvent
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553746"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Thaw"><span class="hs-identifier hs-type">Thaw</span></a></span><span> </span><span id="local-6989586621680553745"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553745"><span class="hs-identifier hs-var">tid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553744"><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553744"><span class="hs-identifier hs-var">thawed</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553743"><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553743"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EmThread effs systemEvent a -&gt; Bool)
-&gt; Seq (EmThread effs systemEvent a)
-&gt; (Seq (EmThread effs systemEvent a),
    Seq (EmThread effs systemEvent a))
forall a. (a -&gt; Bool) -&gt; Seq a -&gt; (Seq a, Seq a)
</span><span class="hs-identifier hs-var">Seq.partition</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span class="hs-special">{</span><span id="local-6989586621680553741"><span class="annot"><span class="annottext">ThreadId
_threadId :: ThreadId
_threadId :: forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a -&gt; ThreadId
</span><a href="#local-6989586621680553741"><span class="hs-identifier hs-var hs-var">_threadId</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553741"><span class="hs-identifier hs-var">_threadId</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; ThreadId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553745"><span class="hs-identifier hs-var">tid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Getting
     (Seq (EmThread effs systemEvent a))
     (SchedulerState effs systemEvent a)
     (Seq (EmThread effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Seq (EmThread effs systemEvent a))
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#frozen"><span class="hs-identifier hs-var">frozen</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>        </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (SchedulerState effs systemEvent a)
 -&gt; Eff effs (Either a (SchedulerState effs systemEvent a)))
-&gt; Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-339"></span><span>            </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a
 -&gt; Either a (SchedulerState effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; Either a (SchedulerState effs systemEvent a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-340"></span><span>            </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553759"><span class="hs-identifier hs-var">schedulerState</span></a></span><span>
</span><span id="line-341"></span><span>                </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#frozen"><span class="hs-identifier hs-var">frozen</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553743"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-342"></span><span>                </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#normalPrio"><span class="hs-identifier hs-var">normalPrio</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall a s t. Semigroup a =&gt; ASetter s t a a -&gt; a -&gt; s -&gt; t
</span><span class="hs-operator hs-var">&lt;&gt;~</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553744"><span class="hs-identifier hs-var">thawed</span></a></span><span>
</span><span id="line-343"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Exit"><span class="hs-identifier hs-type">Exit</span></a></span><span> </span><span id="local-6989586621680553738"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553738"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a (SchedulerState effs systemEvent a)
-&gt; Eff effs (Either a (SchedulerState effs systemEvent a))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a (SchedulerState effs systemEvent a)
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621680553738"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Return a fresh thread ID and increment the counter</span><span>
</span><span id="line-347"></span><span id="local-6989586621680554091"><span id="local-6989586621680554092"><span id="local-6989586621680554093"><span class="annot"><a href="Plutus.Trace.Scheduler.html#nextThreadId"><span class="hs-identifier hs-type">nextThreadId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554093"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554092"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554091"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554093"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554092"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554091"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-348"></span><span id="nextThreadId"><span class="annot"><span class="annottext">nextThreadId :: SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a, ThreadId)
</span><a href="Plutus.Trace.Scheduler.html#nextThreadId"><span class="hs-identifier hs-var hs-var">nextThreadId</span></a></span></span><span> </span><span id="local-6989586621680553737"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553737"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553737"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; Identity ThreadId)
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens' (SchedulerState effs systemEvent a) ThreadId
</span><a href="Plutus.Trace.Scheduler.html#lastThreadId"><span class="hs-identifier hs-var">lastThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">((ThreadId -&gt; Identity ThreadId)
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (ThreadId -&gt; ThreadId)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-var">ThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; ThreadId) -&gt; (ThreadId -&gt; Int) -&gt; ThreadId -&gt; ThreadId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int
forall a. Enum a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; (ThreadId -&gt; Int) -&gt; ThreadId -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; Int
</span><a href="Plutus.Trace.Scheduler.html#unThreadId"><span class="hs-identifier hs-var hs-var">unThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553737"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Getting ThreadId (SchedulerState effs systemEvent a) ThreadId
-&gt; ThreadId
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting ThreadId (SchedulerState effs systemEvent a) ThreadId
forall (effs :: [* -&gt; *]) systemEvent a.
Lens' (SchedulerState effs systemEvent a) ThreadId
</span><a href="Plutus.Trace.Scheduler.html#lastThreadId"><span class="hs-identifier hs-var">lastThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>
</span><span id="line-350"></span><span class="hs-comment">-- | State of the scheduler before any threads are run.</span><span>
</span><span id="line-351"></span><span id="local-6989586621680554110"><span id="local-6989586621680554111"><span id="local-6989586621680554112"><span class="annot"><a href="Plutus.Trace.Scheduler.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554112"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554111"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554110"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-352"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
-&gt; Seq (EmThread effs systemEvent a)
-&gt; Seq (EmThread effs systemEvent a)
-&gt; ThreadId
-&gt; HashMap ThreadId (Seq systemEvent)
-&gt; Map Tag (HashSet ThreadId)
-&gt; SchedulerState effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
Seq (EmThread effs systemEvent a)
-&gt; Seq (EmThread effs systemEvent a)
-&gt; Seq (EmThread effs systemEvent a)
-&gt; ThreadId
-&gt; HashMap ThreadId (Seq systemEvent)
-&gt; Map Tag (HashSet ThreadId)
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-var">SchedulerState</span></a></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
forall a. Seq a
</span><span class="hs-identifier hs-var">Seq.empty</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
forall a. Seq a
</span><span class="hs-identifier hs-var">Seq.empty</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
forall a. Seq a
</span><span class="hs-identifier hs-var">Seq.empty</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="Plutus.Trace.Scheduler.html#initialThreadId"><span class="hs-identifier hs-var">initialThreadId</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ThreadId (Seq systemEvent)
forall k v. HashMap k v
</span><span class="hs-identifier hs-var">HashMap.empty</span></span><span> </span><span class="annot"><span class="annottext">Map Tag (HashSet ThreadId)
forall k a. Map k a
</span><span class="hs-identifier hs-var">Map.empty</span></span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="hs-comment">-- | Add a suspended thread to the queue.</span><span>
</span><span id="line-355"></span><span id="local-6989586621680554088"><span id="local-6989586621680554089"><span id="local-6989586621680554090"><span class="annot"><a href="Plutus.Trace.Scheduler.html#enqueue"><span class="hs-identifier hs-type">enqueue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SuspendedThread"><span class="hs-identifier hs-type">SuspendedThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554090"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554089"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554088"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554090"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554089"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554088"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554090"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554089"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554088"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-356"></span><span id="enqueue"><span class="annot"><span class="annottext">enqueue :: SuspendedThread effs systemEvent a
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#enqueue"><span class="hs-identifier hs-var hs-var">enqueue</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#WithPriority"><span class="hs-identifier hs-type">WithPriority</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621680553733"><span class="annot"><span class="annottext">Priority
_priority :: Priority
_priority :: forall t. WithPriority t -&gt; Priority
</span><a href="#local-6989586621680553733"><span class="hs-identifier hs-var hs-var">_priority</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553732"><span class="annot"><span class="annottext">EmThread effs systemEvent a
_thread :: EmThread effs systemEvent a
_thread :: forall t. WithPriority t -&gt; t
</span><a href="#local-6989586621680553732"><span class="hs-identifier hs-var hs-var">_thread</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680553731"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553731"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553733"><span class="hs-identifier hs-var">_priority</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>        </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553731"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#normalPrio"><span class="hs-identifier hs-var">normalPrio</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (Seq (EmThread effs systemEvent a)
    -&gt; Seq (EmThread effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
-&gt; EmThread effs systemEvent a -&gt; Seq (EmThread effs systemEvent a)
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553732"><span class="hs-identifier hs-var">_thread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>        </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Sleeping"><span class="hs-identifier hs-var">Sleeping</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553731"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#sleeping"><span class="hs-identifier hs-var">sleeping</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (Seq (EmThread effs systemEvent a)
    -&gt; Seq (EmThread effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
-&gt; EmThread effs systemEvent a -&gt; Seq (EmThread effs systemEvent a)
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553732"><span class="hs-identifier hs-var">_thread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>        </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Frozen"><span class="hs-identifier hs-var">Frozen</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553731"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#frozen"><span class="hs-identifier hs-var">frozen</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; (Seq (EmThread effs systemEvent a)
    -&gt; Seq (EmThread effs systemEvent a))
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; (a -&gt; b) -&gt; s -&gt; t
</span><span class="hs-operator hs-var">%~</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
-&gt; EmThread effs systemEvent a -&gt; Seq (EmThread effs systemEvent a)
forall s a. Snoc s s a a =&gt; s -&gt; a -&gt; s
</span><span class="hs-operator hs-var">|&gt;</span></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553732"><span class="hs-identifier hs-var">_thread</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-361"></span><span>
</span><span id="line-362"></span><span class="hs-comment">-- | Result of calling 'dequeue'. Either a thread that is ready to receive a</span><span>
</span><span id="line-363"></span><span class="hs-comment">--   message, or no more threads.</span><span>
</span><span id="line-364"></span><span class="hs-keyword">data</span><span> </span><span id="SchedulerDQResult"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerDQResult"><span class="hs-identifier hs-var">SchedulerDQResult</span></a></span></span><span> </span><span id="local-6989586621680554025"><span class="annot"><a href="#local-6989586621680554025"><span class="hs-identifier hs-type">effs</span></a></span></span><span> </span><span id="local-6989586621680554024"><span class="annot"><a href="#local-6989586621680554024"><span class="hs-identifier hs-type">systemEvent</span></a></span></span><span> </span><span id="local-6989586621680554023"><span class="annot"><a href="#local-6989586621680554023"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="AThread"><span class="annot"><a href="Plutus.Trace.Scheduler.html#AThread"><span class="hs-identifier hs-var">AThread</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554025"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554024"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554023"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554024"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554025"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554024"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554023"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span>
</span><span id="line-366"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NoMoreThreads"><span class="annot"><a href="Plutus.Trace.Scheduler.html#NoMoreThreads"><span class="hs-identifier hs-var">NoMoreThreads</span></a></span></span><span>
</span><span id="line-367"></span><span>
</span><span id="line-368"></span><span id="local-6989586621680554078"><span id="local-6989586621680554079"><span id="local-6989586621680554080"><span class="annot"><a href="Plutus.Trace.Scheduler.html#dequeue"><span class="hs-identifier hs-type">dequeue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554080"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554079"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554078"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerDQResult"><span class="hs-identifier hs-type">SchedulerDQResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554080"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554079"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554078"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-369"></span><span id="dequeue"><span class="annot"><span class="annottext">dequeue :: SchedulerState effs systemEvent a
-&gt; SchedulerDQResult effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#dequeue"><span class="hs-identifier hs-var hs-var">dequeue</span></a></span></span><span> </span><span id="local-6989586621680553729"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553729"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Maybe
     (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
      Priority)
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
-&gt; Maybe
     (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
      Priority)
</span><a href="Plutus.Trace.Scheduler.html#dequeueThread"><span class="hs-identifier hs-var">dequeueThread</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553729"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">Maybe
  (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
   Priority)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SchedulerDQResult effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerDQResult effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#NoMoreThreads"><span class="hs-identifier hs-var">NoMoreThreads</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553727"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553727"><span class="hs-identifier hs-var">s'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553726"><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553726"><span class="hs-identifier hs-var">thread</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553725"><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553725"><span class="hs-identifier hs-var">prio</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; ThreadId
-&gt; Maybe (SchedulerState effs systemEvent a, systemEvent)
forall (effs :: [* -&gt; *]) systemEvent a.
SchedulerState effs systemEvent a
-&gt; ThreadId
-&gt; Maybe (SchedulerState effs systemEvent a, systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#dequeueMessage"><span class="hs-identifier hs-var">dequeueMessage</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553727"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EmThread effs systemEvent a -&gt; ThreadId
forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#_threadId"><span class="hs-identifier hs-var hs-var">_threadId</span></a></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553726"><span class="hs-identifier hs-var">thread</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">Maybe (SchedulerState effs systemEvent a, systemEvent)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; SchedulerState effs systemEvent a
-&gt; Priority
-&gt; SchedulerDQResult effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; SchedulerState effs systemEvent a
-&gt; Priority
-&gt; SchedulerDQResult effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#AThread"><span class="hs-identifier hs-var">AThread</span></a></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553726"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe systemEvent
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553727"><span class="hs-identifier hs-var">s'</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553725"><span class="hs-identifier hs-var">prio</span></a></span><span>
</span><span id="line-373"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553723"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553723"><span class="hs-identifier hs-var">s''</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553722"><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553722"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; SchedulerState effs systemEvent a
-&gt; Priority
-&gt; SchedulerDQResult effs systemEvent a
forall (effs :: [* -&gt; *]) systemEvent a.
EmThread effs systemEvent a
-&gt; Maybe systemEvent
-&gt; SchedulerState effs systemEvent a
-&gt; Priority
-&gt; SchedulerDQResult effs systemEvent a
</span><a href="Plutus.Trace.Scheduler.html#AThread"><span class="hs-identifier hs-var">AThread</span></a></span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553726"><span class="hs-identifier hs-var">thread</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">systemEvent -&gt; Maybe systemEvent
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553722"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553723"><span class="hs-identifier hs-var">s''</span></a></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553725"><span class="hs-identifier hs-var">prio</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span class="hs-comment">-- | Find the next thread that is ready to be resumed.</span><span>
</span><span id="line-376"></span><span class="hs-comment">--   See note [Thread Priority]</span><span>
</span><span id="line-377"></span><span id="local-6989586621680554026"><span id="local-6989586621680554027"><span id="local-6989586621680554028"><span class="annot"><a href="Plutus.Trace.Scheduler.html#dequeueThread"><span class="hs-identifier hs-type">dequeueThread</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554028"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554027"><span class="hs-identifier hs-type">systemEvent</span></a></span><span>  </span><span class="annot"><a href="#local-6989586621680554026"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554028"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554027"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554026"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#EmThread"><span class="hs-identifier hs-type">EmThread</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554028"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554027"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554026"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-378"></span><span id="dequeueThread"><span class="annot"><span class="annottext">dequeueThread :: SchedulerState effs systemEvent a
-&gt; Maybe
     (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
      Priority)
</span><a href="Plutus.Trace.Scheduler.html#dequeueThread"><span class="hs-identifier hs-var hs-var">dequeueThread</span></a></span></span><span> </span><span id="local-6989586621680553721"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553721"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553721"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Getting
     (Seq (EmThread effs systemEvent a))
     (SchedulerState effs systemEvent a)
     (Seq (EmThread effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Seq (EmThread effs systemEvent a))
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#normalPrio"><span class="hs-identifier hs-var">normalPrio</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-380"></span><span>        </span><span id="local-6989586621680553720"><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553720"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621680553718"><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553718"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a, EmThread effs systemEvent a,
 Priority)
-&gt; Maybe
     (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
      Priority)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553721"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#normalPrio"><span class="hs-identifier hs-var">normalPrio</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553718"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553720"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Normal"><span class="hs-identifier hs-var">Normal</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>        </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><span class="hs-identifier hs-var">Empty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553721"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Getting
     (Seq (EmThread effs systemEvent a))
     (SchedulerState effs systemEvent a)
     (Seq (EmThread effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Seq (EmThread effs systemEvent a))
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#sleeping"><span class="hs-identifier hs-var">sleeping</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-382"></span><span>                </span><span id="local-6989586621680553716"><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553716"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621680553715"><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553715"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a, EmThread effs systemEvent a,
 Priority)
-&gt; Maybe
     (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
      Priority)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553721"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(Seq (EmThread effs systemEvent a)
 -&gt; Identity (Seq (EmThread effs systemEvent a)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (Seq (EmThread effs systemEvent a))
</span><a href="Plutus.Trace.Scheduler.html#sleeping"><span class="hs-identifier hs-var">sleeping</span></a></span><span> </span><span class="annot"><span class="annottext">((Seq (EmThread effs systemEvent a)
  -&gt; Identity (Seq (EmThread effs systemEvent a)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Seq (EmThread effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><a href="#local-6989586621680553715"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">EmThread effs systemEvent a
</span><a href="#local-6989586621680553716"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="Plutus.Trace.Scheduler.html#Sleeping"><span class="hs-identifier hs-var">Sleeping</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                </span><span class="annot"><span class="annottext">Seq (EmThread effs systemEvent a)
</span><span class="hs-identifier hs-var">Empty</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe
  (SchedulerState effs systemEvent a, EmThread effs systemEvent a,
   Priority)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-384"></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- | Get the first message for the thread.</span><span>
</span><span id="line-386"></span><span id="local-6989586621680554020"><span id="local-6989586621680554021"><span id="local-6989586621680554022"><span class="annot"><a href="Plutus.Trace.Scheduler.html#dequeueMessage"><span class="hs-identifier hs-type">dequeueMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554022"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554021"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554020"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerState"><span class="hs-identifier hs-type">SchedulerState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554022"><span class="hs-identifier hs-type">effs</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554021"><span class="hs-identifier hs-type">systemEvent</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680554020"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621680554021"><span class="hs-identifier hs-type">systemEvent</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-387"></span><span id="dequeueMessage"><span class="annot"><span class="annottext">dequeueMessage :: SchedulerState effs systemEvent a
-&gt; ThreadId
-&gt; Maybe (SchedulerState effs systemEvent a, systemEvent)
</span><a href="Plutus.Trace.Scheduler.html#dequeueMessage"><span class="hs-identifier hs-var hs-var">dequeueMessage</span></a></span></span><span> </span><span id="local-6989586621680553714"><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553714"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621680553713"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553713"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-388"></span><span>    </span><span id="local-6989586621680553712"><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553712"><span class="hs-identifier hs-var">mailbox</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553714"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; Getting
     (Maybe (Seq systemEvent))
     (SchedulerState effs systemEvent a)
     (Maybe (Seq systemEvent))
-&gt; Maybe (Seq systemEvent)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Const
      (Maybe (Seq systemEvent)) (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Const
     (Maybe (Seq systemEvent)) (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Const
       (Maybe (Seq systemEvent)) (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Const
      (Maybe (Seq systemEvent)) (SchedulerState effs systemEvent a))
-&gt; ((Maybe (Seq systemEvent)
     -&gt; Const (Maybe (Seq systemEvent)) (Maybe (Seq systemEvent)))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Const
         (Maybe (Seq systemEvent)) (HashMap ThreadId (Seq systemEvent)))
-&gt; Getting
     (Maybe (Seq systemEvent))
     (SchedulerState effs systemEvent a)
     (Maybe (Seq systemEvent))
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
-&gt; Lens'
     (HashMap ThreadId (Seq systemEvent))
     (Maybe (IxValue (HashMap ThreadId (Seq systemEvent))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
ThreadId
</span><a href="#local-6989586621680553713"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680553711"><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553711"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553710"><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553710"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553712"><span class="hs-identifier hs-var">mailbox</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
</span><span class="hs-identifier hs-var">Empty</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (systemEvent, Seq systemEvent)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621680553709"><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553709"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-operator hs-type">:&lt;|</span></span><span> </span><span id="local-6989586621680553708"><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553708"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(systemEvent, Seq systemEvent)
-&gt; Maybe (systemEvent, Seq systemEvent)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553709"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553708"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-390"></span><span>    </span><span class="annot"><span class="annottext">(SchedulerState effs systemEvent a, systemEvent)
-&gt; Maybe (SchedulerState effs systemEvent a, systemEvent)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
</span><a href="#local-6989586621680553714"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">SchedulerState effs systemEvent a
-&gt; (SchedulerState effs systemEvent a
    -&gt; SchedulerState effs systemEvent a)
-&gt; SchedulerState effs systemEvent a
forall a b. a -&gt; (a -&gt; b) -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">(HashMap ThreadId (Seq systemEvent)
 -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall (effs :: [* -&gt; *]) systemEvent a.
Lens'
  (SchedulerState effs systemEvent a)
  (HashMap ThreadId (Seq systemEvent))
</span><a href="Plutus.Trace.Scheduler.html#mailboxes"><span class="hs-identifier hs-var">mailboxes</span></a></span><span> </span><span class="annot"><span class="annottext">((HashMap ThreadId (Seq systemEvent)
  -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; ((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
    -&gt; HashMap ThreadId (Seq systemEvent)
    -&gt; Identity (HashMap ThreadId (Seq systemEvent)))
-&gt; (Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
-&gt; SchedulerState effs systemEvent a
-&gt; Identity (SchedulerState effs systemEvent a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
-&gt; Lens'
     (HashMap ThreadId (Seq systemEvent))
     (Maybe (IxValue (HashMap ThreadId (Seq systemEvent))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (HashMap ThreadId (Seq systemEvent))
ThreadId
</span><a href="#local-6989586621680553713"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe (Seq systemEvent) -&gt; Identity (Maybe (Seq systemEvent)))
 -&gt; SchedulerState effs systemEvent a
 -&gt; Identity (SchedulerState effs systemEvent a))
-&gt; Maybe (Seq systemEvent)
-&gt; SchedulerState effs systemEvent a
-&gt; SchedulerState effs systemEvent a
forall s t a b. ASetter s t a b -&gt; b -&gt; s -&gt; t
</span><span class="hs-operator hs-var">.~</span></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent -&gt; Maybe (Seq systemEvent)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Seq systemEvent
</span><a href="#local-6989586621680553710"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">systemEvent
</span><a href="#local-6989586621680553711"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>
</span><span id="line-392"></span><span class="hs-comment">---</span><span>
</span><span id="line-393"></span><span class="hs-comment">--- Logging etc.</span><span>
</span><span id="line-394"></span><span class="hs-comment">---</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span id="local-6989586621680553706"><span id="local-6989586621680553707"></span></span><span class="hs-keyword">data</span><span> </span><span id="ThreadEvent"><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadEvent"><span class="hs-identifier hs-var">ThreadEvent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Stopped"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Stopped"><span class="hs-identifier hs-var">Stopped</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Resumed"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Resumed"><span class="hs-identifier hs-var">Resumed</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Suspended"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Suspended"><span class="hs-identifier hs-var">Suspended</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Started"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Started"><span class="hs-identifier hs-var">Started</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Thawed"><span class="annot"><a href="Plutus.Trace.Scheduler.html#Thawed"><span class="hs-identifier hs-var">Thawed</span></a></span></span><span>
</span><span id="line-397"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553699"><span id="local-6989586621680553701"><span class="annot"><span class="annottext">ThreadEvent -&gt; ThreadEvent -&gt; Bool
(ThreadEvent -&gt; ThreadEvent -&gt; Bool)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Bool) -&gt; Eq ThreadEvent
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c/= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
== :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c== :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553684"><span id="local-6989586621680553686"><span id="local-6989586621680553688"><span id="local-6989586621680553690"><span id="local-6989586621680553692"><span id="local-6989586621680553694"><span id="local-6989586621680553696"><span class="annot"><span class="annottext">Eq ThreadEvent
Eq ThreadEvent
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Ordering)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Bool)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Bool)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Bool)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; Bool)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent)
-&gt; (ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent)
-&gt; Ord ThreadEvent
ThreadEvent -&gt; ThreadEvent -&gt; Bool
ThreadEvent -&gt; ThreadEvent -&gt; Ordering
ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
min :: ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent
$cmin :: ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent
max :: ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent
$cmax :: ThreadEvent -&gt; ThreadEvent -&gt; ThreadEvent
&gt;= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c&gt;= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
&gt; :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c&gt; :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
&lt;= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c&lt;= :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
&lt; :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
$c&lt; :: ThreadEvent -&gt; ThreadEvent -&gt; Bool
compare :: ThreadEvent -&gt; ThreadEvent -&gt; Ordering
$ccompare :: ThreadEvent -&gt; ThreadEvent -&gt; Ordering
$cp1Ord :: Eq ThreadEvent
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553678"><span id="local-6989586621680553680"><span id="local-6989586621680553682"><span class="annot"><span class="annottext">Int -&gt; ThreadEvent -&gt; ShowS
[ThreadEvent] -&gt; ShowS
ThreadEvent -&gt; String
(Int -&gt; ThreadEvent -&gt; ShowS)
-&gt; (ThreadEvent -&gt; String)
-&gt; ([ThreadEvent] -&gt; ShowS)
-&gt; Show ThreadEvent
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ThreadEvent] -&gt; ShowS
$cshowList :: [ThreadEvent] -&gt; ShowS
show :: ThreadEvent -&gt; String
$cshow :: ThreadEvent -&gt; String
showsPrec :: Int -&gt; ThreadEvent -&gt; ShowS
$cshowsPrec :: Int -&gt; ThreadEvent -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ThreadEvent -&gt; Rep ThreadEvent x)
-&gt; (forall x. Rep ThreadEvent x -&gt; ThreadEvent)
-&gt; Generic ThreadEvent
forall x. Rep ThreadEvent x -&gt; ThreadEvent
forall x. ThreadEvent -&gt; Rep ThreadEvent x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ThreadEvent x -&gt; ThreadEvent
$cfrom :: forall x. ThreadEvent -&gt; Rep ThreadEvent x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-398"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553668"><span id="local-6989586621680553670"><span id="local-6989586621680553672"><span id="local-6989586621680553674"><span class="annot"><span class="annottext">[ThreadEvent] -&gt; Encoding
[ThreadEvent] -&gt; Value
ThreadEvent -&gt; Encoding
ThreadEvent -&gt; Value
(ThreadEvent -&gt; Value)
-&gt; (ThreadEvent -&gt; Encoding)
-&gt; ([ThreadEvent] -&gt; Value)
-&gt; ([ThreadEvent] -&gt; Encoding)
-&gt; ToJSON ThreadEvent
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ThreadEvent] -&gt; Encoding
$ctoEncodingList :: [ThreadEvent] -&gt; Encoding
toJSONList :: [ThreadEvent] -&gt; Value
$ctoJSONList :: [ThreadEvent] -&gt; Value
toEncoding :: ThreadEvent -&gt; Encoding
$ctoEncoding :: ThreadEvent -&gt; Encoding
toJSON :: ThreadEvent -&gt; Value
$ctoJSON :: ThreadEvent -&gt; Value
</span><a href="#local-6989586621680553668"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553664"><span id="local-6989586621680553666"><span class="annot"><span class="annottext">Value -&gt; Parser [ThreadEvent]
Value -&gt; Parser ThreadEvent
(Value -&gt; Parser ThreadEvent)
-&gt; (Value -&gt; Parser [ThreadEvent]) -&gt; FromJSON ThreadEvent
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ThreadEvent]
$cparseJSONList :: Value -&gt; Parser [ThreadEvent]
parseJSON :: Value -&gt; Parser ThreadEvent
$cparseJSON :: Value -&gt; Parser ThreadEvent
</span><a href="#local-6989586621680553664"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680553660"><span id="local-6989586621680553662"><span class="annot"><span class="annottext">[ThreadEvent] -&gt; Doc ann
ThreadEvent -&gt; Doc ann
(forall ann. ThreadEvent -&gt; Doc ann)
-&gt; (forall ann. [ThreadEvent] -&gt; Doc ann) -&gt; Pretty ThreadEvent
forall ann. [ThreadEvent] -&gt; Doc ann
forall ann. ThreadEvent -&gt; Doc ann
forall a.
(forall ann. a -&gt; Doc ann)
-&gt; (forall ann. [a] -&gt; Doc ann) -&gt; Pretty a
prettyList :: [ThreadEvent] -&gt; Doc ann
$cprettyList :: forall ann. [ThreadEvent] -&gt; Doc ann
pretty :: ThreadEvent -&gt; Doc ann
$cpretty :: forall ann. ThreadEvent -&gt; Doc ann
</span><a href="#local-6989586621680553660"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Pretty</span></a></span></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PrettyShow</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadEvent"><span class="hs-identifier hs-type">ThreadEvent</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span id="local-6989586621680553658"><span id="local-6989586621680553659"></span></span><span class="hs-keyword">data</span><span> </span><span id="SchedulerLog"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-var">SchedulerLog</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-402"></span><span>    </span><span id="SchedulerLog"><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-var">SchedulerLog</span></a></span></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="slEvent"><span class="annot"><span class="annottext">SchedulerLog -&gt; ThreadEvent
</span><a href="Plutus.Trace.Scheduler.html#slEvent"><span class="hs-identifier hs-var hs-var">slEvent</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadEvent"><span class="hs-identifier hs-type">ThreadEvent</span></a></span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slThread"><span class="annot"><span class="annottext">SchedulerLog -&gt; ThreadId
</span><a href="Plutus.Trace.Scheduler.html#slThread"><span class="hs-identifier hs-var hs-var">slThread</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#ThreadId"><span class="hs-identifier hs-type">ThreadId</span></a></span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slTag"><span class="annot"><span class="annottext">SchedulerLog -&gt; Tag
</span><a href="Plutus.Trace.Scheduler.html#slTag"><span class="hs-identifier hs-var hs-var">slTag</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Tag.html#Tag"><span class="hs-identifier hs-type">Tag</span></a></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slPrio"><span class="annot"><span class="annottext">SchedulerLog -&gt; Priority
</span><a href="Plutus.Trace.Scheduler.html#slPrio"><span class="hs-identifier hs-var hs-var">slPrio</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#Priority"><span class="hs-identifier hs-type">Priority</span></a></span><span>
</span><span id="line-407"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553654"><span id="local-6989586621680553656"><span class="annot"><span class="annottext">SchedulerLog -&gt; SchedulerLog -&gt; Bool
(SchedulerLog -&gt; SchedulerLog -&gt; Bool)
-&gt; (SchedulerLog -&gt; SchedulerLog -&gt; Bool) -&gt; Eq SchedulerLog
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SchedulerLog -&gt; SchedulerLog -&gt; Bool
$c/= :: SchedulerLog -&gt; SchedulerLog -&gt; Bool
== :: SchedulerLog -&gt; SchedulerLog -&gt; Bool
$c== :: SchedulerLog -&gt; SchedulerLog -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553648"><span id="local-6989586621680553650"><span id="local-6989586621680553652"><span class="annot"><span class="annottext">Int -&gt; SchedulerLog -&gt; ShowS
[SchedulerLog] -&gt; ShowS
SchedulerLog -&gt; String
(Int -&gt; SchedulerLog -&gt; ShowS)
-&gt; (SchedulerLog -&gt; String)
-&gt; ([SchedulerLog] -&gt; ShowS)
-&gt; Show SchedulerLog
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SchedulerLog] -&gt; ShowS
$cshowList :: [SchedulerLog] -&gt; ShowS
show :: SchedulerLog -&gt; String
$cshow :: SchedulerLog -&gt; String
showsPrec :: Int -&gt; SchedulerLog -&gt; ShowS
$cshowsPrec :: Int -&gt; SchedulerLog -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. SchedulerLog -&gt; Rep SchedulerLog x)
-&gt; (forall x. Rep SchedulerLog x -&gt; SchedulerLog)
-&gt; Generic SchedulerLog
forall x. Rep SchedulerLog x -&gt; SchedulerLog
forall x. SchedulerLog -&gt; Rep SchedulerLog x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SchedulerLog x -&gt; SchedulerLog
$cfrom :: forall x. SchedulerLog -&gt; Rep SchedulerLog x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680553638"><span id="local-6989586621680553640"><span id="local-6989586621680553642"><span id="local-6989586621680553644"><span class="annot"><span class="annottext">[SchedulerLog] -&gt; Encoding
[SchedulerLog] -&gt; Value
SchedulerLog -&gt; Encoding
SchedulerLog -&gt; Value
(SchedulerLog -&gt; Value)
-&gt; (SchedulerLog -&gt; Encoding)
-&gt; ([SchedulerLog] -&gt; Value)
-&gt; ([SchedulerLog] -&gt; Encoding)
-&gt; ToJSON SchedulerLog
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [SchedulerLog] -&gt; Encoding
$ctoEncodingList :: [SchedulerLog] -&gt; Encoding
toJSONList :: [SchedulerLog] -&gt; Value
$ctoJSONList :: [SchedulerLog] -&gt; Value
toEncoding :: SchedulerLog -&gt; Encoding
$ctoEncoding :: SchedulerLog -&gt; Encoding
toJSON :: SchedulerLog -&gt; Value
$ctoJSON :: SchedulerLog -&gt; Value
</span><a href="#local-6989586621680553638"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553634"><span id="local-6989586621680553636"><span class="annot"><span class="annottext">Value -&gt; Parser [SchedulerLog]
Value -&gt; Parser SchedulerLog
(Value -&gt; Parser SchedulerLog)
-&gt; (Value -&gt; Parser [SchedulerLog]) -&gt; FromJSON SchedulerLog
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [SchedulerLog]
$cparseJSONList :: Value -&gt; Parser [SchedulerLog]
parseJSON :: Value -&gt; Parser SchedulerLog
$cparseJSON :: Value -&gt; Parser SchedulerLog
</span><a href="#local-6989586621680553634"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680553631"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-412"></span><span>    </span><span id="local-6989586621680553630"><span class="annot"><span class="annottext">pretty :: SchedulerLog -&gt; Doc ann
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></span></span><span> </span><span class="annot"><a href="Plutus.Trace.Scheduler.html#SchedulerLog"><span class="hs-identifier hs-type">SchedulerLog</span></a></span><span class="hs-special">{</span><span id="local-6989586621680553628"><span class="annot"><span class="annottext">ThreadEvent
slEvent :: ThreadEvent
slEvent :: SchedulerLog -&gt; ThreadEvent
</span><a href="#local-6989586621680553628"><span class="hs-identifier hs-var hs-var">slEvent</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553627"><span class="annot"><span class="annottext">ThreadId
slThread :: ThreadId
slThread :: SchedulerLog -&gt; ThreadId
</span><a href="#local-6989586621680553627"><span class="hs-identifier hs-var hs-var">slThread</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553626"><span class="annot"><span class="annottext">Tag
slTag :: Tag
slTag :: SchedulerLog -&gt; Tag
</span><a href="#local-6989586621680553626"><span class="hs-identifier hs-var hs-var">slTag</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680553625"><span class="annot"><span class="annottext">Priority
slPrio :: Priority
slPrio :: SchedulerLog -&gt; Priority
</span><a href="#local-6989586621680553625"><span class="hs-identifier hs-var hs-var">slPrio</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-413"></span><span>        </span><span class="annot"><span class="annottext">ThreadId -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621680553627"><span class="hs-identifier hs-var">slThread</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Tag -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Tag
</span><a href="#local-6989586621680553626"><span class="hs-identifier hs-var">slTag</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
forall ann. Doc ann
</span><span class="hs-identifier hs-var">colon</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThreadEvent -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ThreadEvent
</span><a href="#local-6989586621680553628"><span class="hs-identifier hs-var">slEvent</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">parens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Priority -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Priority
</span><a href="#local-6989586621680553625"><span class="hs-identifier hs-var">slPrio</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-414"></span></pre></body></html>