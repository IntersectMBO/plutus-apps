<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds                 #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass            #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric             #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia               #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE EmptyCase                 #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE ExistentialQuantification #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts          #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE GADTs                     #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase                #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns            #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings         #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE PolyKinds                 #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell           #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE TupleSections             #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications          #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies              #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators             #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances      #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns              #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-missing-import-lists #-}</span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ledger.Tx.Constraints.OffChain</span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Lookups</span></span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier">ScriptLookups</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#typedValidatorLookups"><span class="hs-identifier">typedValidatorLookups</span></a></span><span>
</span><span id="line-25"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#generalise"><span class="hs-identifier">generalise</span></a></span><span>
</span><span id="line-26"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#unspentOutputs"><span class="hs-identifier">unspentOutputs</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mintingPolicy"><span class="hs-identifier">mintingPolicy</span></a></span><span>
</span><span id="line-28"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1MintingPolicy"><span class="hs-identifier">plutusV1MintingPolicy</span></a></span><span>
</span><span id="line-29"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2MintingPolicy"><span class="hs-identifier">plutusV2MintingPolicy</span></a></span><span>
</span><span id="line-30"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#otherScript"><span class="hs-identifier">otherScript</span></a></span><span>
</span><span id="line-31"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1OtherScript"><span class="hs-identifier">plutusV1OtherScript</span></a></span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2OtherScript"><span class="hs-identifier">plutusV2OtherScript</span></a></span><span>
</span><span id="line-33"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#otherData"><span class="hs-identifier">otherData</span></a></span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKey"><span class="hs-identifier">paymentPubKey</span></a></span><span>
</span><span id="line-35"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKeyHash"><span class="hs-identifier">paymentPubKeyHash</span></a></span><span>
</span><span id="line-36"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Constraints resolution</span></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier">SomeLookupsAndConstraints</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier">UnbalancedTx</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier">tx</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txInsCollateral"><span class="hs-identifier">txInsCollateral</span></a></span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier">txValidityRange</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txOuts"><span class="hs-identifier">txOuts</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#utxoIndex"><span class="hs-identifier">utxoIndex</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#emptyUnbalancedTx"><span class="hs-identifier">emptyUnbalancedTx</span></a></span><span>
</span><span id="line-45"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#adjustUnbalancedTx"><span class="hs-identifier">adjustUnbalancedTx</span></a></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkTx"><span class="hs-identifier">mkTx</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkTxWithParams"><span class="hs-identifier">mkTxWithParams</span></a></span><span>
</span><span id="line-48"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkSomeTx"><span class="hs-identifier">mkSomeTx</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier">MkTxError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_TypeCheckFailed"><span class="hs-identifier">_TypeCheckFailed</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_ToCardanoError"><span class="hs-identifier">_ToCardanoError</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_TxOutRefNotFound"><span class="hs-identifier">_TxOutRefNotFound</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_TxOutRefWrongType"><span class="hs-identifier">_TxOutRefWrongType</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_TxOutRefNoReferenceScript"><span class="hs-identifier">_TxOutRefNoReferenceScript</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_DatumNotFound"><span class="hs-identifier">_DatumNotFound</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_DeclaredInputMismatch"><span class="hs-identifier">_DeclaredInputMismatch</span></a></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_MintingPolicyNotFound"><span class="hs-identifier">_MintingPolicyNotFound</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_ScriptHashNotFound"><span class="hs-identifier">_ScriptHashNotFound</span></a></span><span>
</span><span id="line-59"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_TypedValidatorMissing"><span class="hs-identifier">_TypedValidatorMissing</span></a></span><span>
</span><span id="line-60"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_DatumWrongHash"><span class="hs-identifier">_DatumWrongHash</span></a></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_CannotSatisfyAny"><span class="hs-identifier">_CannotSatisfyAny</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_NoMatchingOutputFound"><span class="hs-identifier">_NoMatchingOutputFound</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#_MultipleMatchingOutputsFound"><span class="hs-identifier">_MultipleMatchingOutputsFound</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Internals exposed for testing</span></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier">ValueSpentBalances</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier">provided</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#required"><span class="hs-identifier">required</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#missingValueSpent"><span class="hs-identifier">missingValueSpent</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier">ConstraintProcessingState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier">unbalancedTx</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier">valueSpentInputs</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentOutputs"><span class="hs-identifier">valueSpentOutputs</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#paramsL"><span class="hs-identifier">paramsL</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#processConstraintFun"><span class="hs-identifier">processConstraintFun</span></a></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#addOwnInput"><span class="hs-identifier">addOwnInput</span></a></span><span>
</span><span id="line-76"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#addOwnOutput"><span class="hs-identifier">addOwnOutput</span></a></span><span>
</span><span id="line-77"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#updateUtxoIndex"><span class="hs-identifier">updateUtxoIndex</span></a></span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier">lookupTxOutRef</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupMintingPolicy"><span class="hs-identifier">lookupMintingPolicy</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier">lookupScript</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupScriptAsReferenceScript"><span class="hs-identifier">lookupScriptAsReferenceScript</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#prepareConstraints"><span class="hs-identifier">prepareConstraints</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOut"><span class="hs-identifier">resolveScriptTxOut</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier">resolveScriptTxOutValidator</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier">resolveScriptTxOutDatumAndValue</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWithOrigin"><span class="hs-identifier">DatumWithOrigin</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier">datumWitness</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#checkValueSpent"><span class="hs-identifier">checkValueSpent</span></a></span><span>
</span><span id="line-89"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SortedConstraints"><span class="hs-identifier">SortedConstraints</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#initialState"><span class="hs-identifier">initialState</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Api.Shelley</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node.Params</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PParams</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Params</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">networkIdL</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pProtocolParams</span></span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node.TimeSlot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">posixTimeRangeToContainedSlotRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">slotRangeToPOSIXTimeRange</span></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens.Extras</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">is</span></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Except</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Except</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MonadError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catchError</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">guard</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">lift</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">runExcept</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">throwError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">unless</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.Reader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ask</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">runReaderT</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">asks</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Monad.State</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MonadState</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">get</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">put</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">execStateT</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">gets</span></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">partitionEithers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">traverse_</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Map</span></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">mapMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">First</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">First</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">getFirst</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Set</span></span><span class="hs-special">)</span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Set</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Datum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Language</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PlutusV1</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PlutusV2</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MintingPolicy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MintingPolicyHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">POSIXTimeRange</span></span><span class="hs-special">,</span><span>
</span><span id="line-114"></span><span>               </span><span class="annot"><span class="hs-identifier">Redeemer</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Redeemer</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">UtxoIndex</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Versioned</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">adjustTxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">decoratedTxOutReferenceScript</span></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PaymentPubKey</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PaymentPubKey</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PaymentPubKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PaymentPubKeyHash</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Crypto</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pubKeyHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Interval</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Orphans</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getRedeemer</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getValidator</span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DecoratedTxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxOutRef</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Tx</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoBuildTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoBuildTx</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toCardanoMintWitness</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toCardanoPolicyId</span></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.CardanoAPI</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C</span></span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html"><span class="hs-identifier">Ledger.Tx.Constraints.TxConstraints</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.ValidityInterval.html"><span class="hs-identifier">Ledger.Tx.Constraints.ValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.ValidityInterval.html#toPlutusInterval"><span class="hs-identifier">toPlutusInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Typed.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Any</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ConnectionError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">UnknownRef</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TypedValidator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">tvValidator</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tvValidatorHash</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>                             </span><span class="annot"><span class="hs-identifier">ValidatorTypes</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">DatumType</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RedeemerType</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">validatorAddress</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">datumHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">scriptHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V2.Typed.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Typed</span></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Api</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Datum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Datum</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DatumHash</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StakingCredential</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Validator</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">getMintingPolicy</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintingPolicy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintingPolicy</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MintingPolicyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintingPolicyHash</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Script</span></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>                                 </span><span class="annot"><span class="hs-identifier">ScriptHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptHash</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Validator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Validator</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ValidatorHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ValidatorHash</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toBuiltinData</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Lattice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">BoundedMeetSemiLattice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">top</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">JoinSemiLattice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(\/)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MeetSemiLattice</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(/\)</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Numeric</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">N</span></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prettyprinter</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Pretty</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pretty</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">colon</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">hang</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">viaShow</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">vsep</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&lt;+&gt;)</span></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="local-6989586621679467234"><span id="local-6989586621679467235"></span></span><span class="hs-keyword">data</span><span> </span><span id="ScriptLookups"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-var">ScriptLookups</span></a></span></span><span> </span><span id="local-6989586621679467889"><span class="annot"><a href="#local-6989586621679467889"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-141"></span><span>    </span><span id="ScriptLookups"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-var">ScriptLookups</span></a></span></span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="slTxOutputs"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecoratedTxOut</span></span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">-- ^ Unspent outputs that the script may want to spend</span><span>
</span><span id="line-144"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slOtherScripts"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var hs-var">slOtherScripts</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>        </span><span class="hs-comment">-- ^ Scripts other than &quot;our script&quot;</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slOtherData"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var hs-var">slOtherData</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- ^ Datums that we might need</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slPaymentPubKeyHashes"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Set PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slPaymentPubKeyHashes"><span class="hs-identifier hs-var hs-var">slPaymentPubKeyHashes</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Set</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKeyHash</span></span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-comment">-- ^ Public keys that we might need</span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slTypedValidator"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TypedValidator</span></span><span> </span><span class="annot"><a href="#local-6989586621679467889"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>        </span><span class="hs-comment">-- ^ The script instance with the typed validator hash &amp; actual compiled program</span><span>
</span><span id="line-152"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slOwnPaymentPubKeyHash"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnPaymentPubKeyHash"><span class="hs-identifier hs-var hs-var">slOwnPaymentPubKeyHash</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKeyHash</span></span><span>
</span><span id="line-153"></span><span>        </span><span class="hs-comment">-- ^ The contract's payment public key hash, used for depositing tokens etc.</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="slOwnStakingCredential"><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe StakingCredential
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnStakingCredential"><span class="hs-identifier hs-var hs-var">slOwnStakingCredential</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StakingCredential</span></span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-comment">-- ^ The contract's staking credentials (optional)</span><span>
</span><span id="line-156"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467220"><span id="local-6989586621679467222"><span id="local-6989586621679467224"><span class="annot"><span class="annottext">Int -&gt; ScriptLookups a -&gt; ShowS
[ScriptLookups a] -&gt; ShowS
ScriptLookups a -&gt; String
(Int -&gt; ScriptLookups a -&gt; ShowS)
-&gt; (ScriptLookups a -&gt; String)
-&gt; ([ScriptLookups a] -&gt; ShowS)
-&gt; Show (ScriptLookups a)
forall a. Int -&gt; ScriptLookups a -&gt; ShowS
forall a. [ScriptLookups a] -&gt; ShowS
forall a. ScriptLookups a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ScriptLookups a] -&gt; ShowS
$cshowList :: forall a. [ScriptLookups a] -&gt; ShowS
show :: ScriptLookups a -&gt; String
$cshow :: forall a. ScriptLookups a -&gt; String
showsPrec :: Int -&gt; ScriptLookups a -&gt; ShowS
$cshowsPrec :: forall a. Int -&gt; ScriptLookups a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ScriptLookups a -&gt; Rep (ScriptLookups a) x)
-&gt; (forall x. Rep (ScriptLookups a) x -&gt; ScriptLookups a)
-&gt; Generic (ScriptLookups a)
forall x. Rep (ScriptLookups a) x -&gt; ScriptLookups a
forall x. ScriptLookups a -&gt; Rep (ScriptLookups a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (ScriptLookups a) x -&gt; ScriptLookups a
forall a x. ScriptLookups a -&gt; Rep (ScriptLookups a) x
$cto :: forall a x. Rep (ScriptLookups a) x -&gt; ScriptLookups a
$cfrom :: forall a x. ScriptLookups a -&gt; Rep (ScriptLookups a) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span>          </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467208"><span id="local-6989586621679467210"><span id="local-6989586621679467212"><span id="local-6989586621679467214"><span class="annot"><span class="annottext">[ScriptLookups a] -&gt; Encoding
[ScriptLookups a] -&gt; Value
ScriptLookups a -&gt; Encoding
ScriptLookups a -&gt; Value
(ScriptLookups a -&gt; Value)
-&gt; (ScriptLookups a -&gt; Encoding)
-&gt; ([ScriptLookups a] -&gt; Value)
-&gt; ([ScriptLookups a] -&gt; Encoding)
-&gt; ToJSON (ScriptLookups a)
forall a. [ScriptLookups a] -&gt; Encoding
forall a. [ScriptLookups a] -&gt; Value
forall a. ScriptLookups a -&gt; Encoding
forall a. ScriptLookups a -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [ScriptLookups a] -&gt; Encoding
$ctoEncodingList :: forall a. [ScriptLookups a] -&gt; Encoding
toJSONList :: [ScriptLookups a] -&gt; Value
$ctoJSONList :: forall a. [ScriptLookups a] -&gt; Value
toEncoding :: ScriptLookups a -&gt; Encoding
$ctoEncoding :: forall a. ScriptLookups a -&gt; Encoding
toJSON :: ScriptLookups a -&gt; Value
$ctoJSON :: forall a. ScriptLookups a -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467203"><span id="local-6989586621679467205"><span class="annot"><span class="annottext">Value -&gt; Parser [ScriptLookups a]
Value -&gt; Parser (ScriptLookups a)
(Value -&gt; Parser (ScriptLookups a))
-&gt; (Value -&gt; Parser [ScriptLookups a])
-&gt; FromJSON (ScriptLookups a)
forall a. Value -&gt; Parser [ScriptLookups a]
forall a. Value -&gt; Parser (ScriptLookups a)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [ScriptLookups a]
$cparseJSONList :: forall a. Value -&gt; Parser [ScriptLookups a]
parseJSON :: Value -&gt; Parser (ScriptLookups a)
$cparseJSON :: forall a. Value -&gt; Parser (ScriptLookups a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span id="local-6989586621679467201"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#generalise"><span class="hs-identifier hs-type">generalise</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467201"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Any</span></span></span><span>
</span><span id="line-160"></span><span id="generalise"><span class="annot"><span class="annottext">generalise :: ScriptLookups a -&gt; ScriptLookups Any
</span><a href="Ledger.Tx.Constraints.OffChain.html#generalise"><span class="hs-identifier hs-var hs-var">generalise</span></a></span></span><span> </span><span id="local-6989586621679467200"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467200"><span class="hs-identifier hs-var">sl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679467199"><span class="annot"><span class="annottext">validator :: Maybe (TypedValidator Any)
</span><a href="#local-6989586621679467199"><span class="hs-identifier hs-var hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TypedValidator a -&gt; TypedValidator Any)
-&gt; Maybe (TypedValidator a) -&gt; Maybe (TypedValidator Any)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; TypedValidator Any
forall a. TypedValidator a -&gt; TypedValidator Any
</span><span class="hs-identifier hs-var">Typed.generalise</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe (TypedValidator a)
forall a. ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467200"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467200"><span class="hs-identifier hs-var">sl</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">slTypedValidator :: Maybe (TypedValidator Any)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var">slTypedValidator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (TypedValidator Any)
</span><a href="#local-6989586621679467199"><span class="hs-identifier hs-var">validator</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span id="local-6989586621679467197"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679467192"><span id="local-6989586621679467194"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467197"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-165"></span><span>    </span><span id="local-6989586621679467190"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679467189"><span class="annot"><span class="annottext">&lt;&gt; :: ScriptLookups a -&gt; ScriptLookups a -&gt; ScriptLookups a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679467188"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="annottext">ScriptLookups :: forall a.
Map TxOutRef DecoratedTxOut
-&gt; Map ScriptHash (Versioned Script)
-&gt; Map DatumHash Datum
-&gt; Set PaymentPubKeyHash
-&gt; Maybe (TypedValidator a)
-&gt; Maybe PaymentPubKeyHash
-&gt; Maybe StakingCredential
-&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span>
</span><span id="line-167"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slTxOutputs :: Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var">slTxOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
-&gt; Map TxOutRef DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slOtherScripts :: Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var">slOtherScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
forall a. ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var hs-var">slOtherScripts</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (Versioned Script)
-&gt; Map ScriptHash (Versioned Script)
-&gt; Map ScriptHash (Versioned Script)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
forall a. ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var hs-var">slOtherScripts</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-169"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slOtherData :: Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var">slOtherData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map DatumHash Datum
forall a. ScriptLookups a -&gt; Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var hs-var">slOtherData</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Map DatumHash Datum -&gt; Map DatumHash Datum -&gt; Map DatumHash Datum
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map DatumHash Datum
forall a. ScriptLookups a -&gt; Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var hs-var">slOtherData</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-170"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slPaymentPubKeyHashes :: Set PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slPaymentPubKeyHashes"><span class="hs-identifier hs-var">slPaymentPubKeyHashes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Set PaymentPubKeyHash
forall a. ScriptLookups a -&gt; Set PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slPaymentPubKeyHashes"><span class="hs-identifier hs-var hs-var">slPaymentPubKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Set PaymentPubKeyHash
-&gt; Set PaymentPubKeyHash -&gt; Set PaymentPubKeyHash
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Set PaymentPubKeyHash
forall a. ScriptLookups a -&gt; Set PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slPaymentPubKeyHashes"><span class="hs-identifier hs-var hs-var">slPaymentPubKeyHashes</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-171"></span><span>            </span><span class="hs-comment">-- 'First' to match the semigroup instance of Map (left-biased)</span><span>
</span><span id="line-172"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slTypedValidator :: Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var">slTypedValidator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(First (TypedValidator a) -&gt; TypedValidator a)
-&gt; Maybe (First (TypedValidator a)) -&gt; Maybe (TypedValidator a)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">First (TypedValidator a) -&gt; TypedValidator a
forall a. First a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">getFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (First (TypedValidator a)) -&gt; Maybe (TypedValidator a))
-&gt; Maybe (First (TypedValidator a)) -&gt; Maybe (TypedValidator a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; First (TypedValidator a)
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(TypedValidator a -&gt; First (TypedValidator a))
-&gt; Maybe (TypedValidator a) -&gt; Maybe (First (TypedValidator a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe (TypedValidator a)
forall a. ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (First (TypedValidator a))
-&gt; Maybe (First (TypedValidator a))
-&gt; Maybe (First (TypedValidator a))
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; First (TypedValidator a)
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(TypedValidator a -&gt; First (TypedValidator a))
-&gt; Maybe (TypedValidator a) -&gt; Maybe (First (TypedValidator a))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe (TypedValidator a)
forall a. ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-173"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slOwnPaymentPubKeyHash :: Maybe PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnPaymentPubKeyHash"><span class="hs-identifier hs-var">slOwnPaymentPubKeyHash</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><span class="annottext">(First PaymentPubKeyHash -&gt; PaymentPubKeyHash)
-&gt; Maybe (First PaymentPubKeyHash) -&gt; Maybe PaymentPubKeyHash
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">First PaymentPubKeyHash -&gt; PaymentPubKeyHash
forall a. First a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">getFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (First PaymentPubKeyHash) -&gt; Maybe PaymentPubKeyHash)
-&gt; Maybe (First PaymentPubKeyHash) -&gt; Maybe PaymentPubKeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; First PaymentPubKeyHash
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; First PaymentPubKeyHash)
-&gt; Maybe PaymentPubKeyHash -&gt; Maybe (First PaymentPubKeyHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe PaymentPubKeyHash
forall a. ScriptLookups a -&gt; Maybe PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnPaymentPubKeyHash"><span class="hs-identifier hs-var hs-var">slOwnPaymentPubKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                             </span><span class="annot"><span class="annottext">Maybe (First PaymentPubKeyHash)
-&gt; Maybe (First PaymentPubKeyHash)
-&gt; Maybe (First PaymentPubKeyHash)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; First PaymentPubKeyHash
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(PaymentPubKeyHash -&gt; First PaymentPubKeyHash)
-&gt; Maybe PaymentPubKeyHash -&gt; Maybe (First PaymentPubKeyHash)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe PaymentPubKeyHash
forall a. ScriptLookups a -&gt; Maybe PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnPaymentPubKeyHash"><span class="hs-identifier hs-var hs-var">slOwnPaymentPubKeyHash</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slOwnStakingCredential :: Maybe StakingCredential
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnStakingCredential"><span class="hs-identifier hs-var">slOwnStakingCredential</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-177"></span><span>                </span><span class="annot"><span class="annottext">(First StakingCredential -&gt; StakingCredential)
-&gt; Maybe (First StakingCredential) -&gt; Maybe StakingCredential
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">First StakingCredential -&gt; StakingCredential
forall a. First a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var">getFirst</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (First StakingCredential) -&gt; Maybe StakingCredential)
-&gt; Maybe (First StakingCredential) -&gt; Maybe StakingCredential
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakingCredential -&gt; First StakingCredential
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(StakingCredential -&gt; First StakingCredential)
-&gt; Maybe StakingCredential -&gt; Maybe (First StakingCredential)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe StakingCredential
forall a. ScriptLookups a -&gt; Maybe StakingCredential
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnStakingCredential"><span class="hs-identifier hs-var hs-var">slOwnStakingCredential</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467190"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>                             </span><span class="annot"><span class="annottext">Maybe (First StakingCredential)
-&gt; Maybe (First StakingCredential)
-&gt; Maybe (First StakingCredential)
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StakingCredential -&gt; First StakingCredential
forall a. a -&gt; First a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">First</span></a></span><span> </span><span class="annot"><span class="annottext">(StakingCredential -&gt; First StakingCredential)
-&gt; Maybe StakingCredential -&gt; Maybe (First StakingCredential)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Maybe StakingCredential
forall a. ScriptLookups a -&gt; Maybe StakingCredential
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOwnStakingCredential"><span class="hs-identifier hs-var hs-var">slOwnStakingCredential</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679467188"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>            </span><span class="hs-special">}</span></span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span id="local-6989586621679467186"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679467181"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Monoid</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467186"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-182"></span><span>    </span><span id="local-6989586621679467179"><span class="annot"><span class="annottext">mappend :: ScriptLookups a -&gt; ScriptLookups a -&gt; ScriptLookups a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mappend</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; ScriptLookups a -&gt; ScriptLookups a
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">(&lt;&gt;)</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span id="local-6989586621679467178"><span class="annot"><span class="annottext">mempty :: ScriptLookups a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">mempty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
-&gt; Map ScriptHash (Versioned Script)
-&gt; Map DatumHash Datum
-&gt; Set PaymentPubKeyHash
-&gt; Maybe (TypedValidator a)
-&gt; Maybe PaymentPubKeyHash
-&gt; Maybe StakingCredential
-&gt; ScriptLookups a
forall a.
Map TxOutRef DecoratedTxOut
-&gt; Map ScriptHash (Versioned Script)
-&gt; Map DatumHash Datum
-&gt; Set PaymentPubKeyHash
-&gt; Maybe (TypedValidator a)
-&gt; Maybe PaymentPubKeyHash
-&gt; Maybe StakingCredential
-&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-var">ScriptLookups</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Map ScriptHash (Versioned Script)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Map DatumHash Datum
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Set PaymentPubKeyHash
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypedValidator a)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe PaymentPubKeyHash
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span></span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span class="hs-comment">-- | A script lookups value with a script instance. For convenience this also</span><span>
</span><span id="line-186"></span><span class="hs-comment">--   includes the minting policy script that forwards all checks to the</span><span>
</span><span id="line-187"></span><span class="hs-comment">--   instance's validator.</span><span>
</span><span id="line-188"></span><span class="hs-comment">--</span><span>
</span><span id="line-189"></span><span class="hs-comment">-- If called multiple times, only the first typed validator is kept:</span><span>
</span><span id="line-190"></span><span class="hs-comment">--</span><span>
</span><span id="line-191"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-192"></span><span class="hs-comment">-- typedValidatorLookups tv1 &lt;&gt; typedValidatorLookups tv2 &lt;&gt; ...</span><span>
</span><span id="line-193"></span><span class="hs-comment">--     == typedValidatorLookups tv1</span><span>
</span><span id="line-194"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-195"></span><span id="local-6989586621679467177"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#typedValidatorLookups"><span class="hs-identifier hs-type">typedValidatorLookups</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TypedValidator</span></span><span> </span><span class="annot"><a href="#local-6989586621679467177"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467177"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-196"></span><span id="typedValidatorLookups"><span class="annot"><span class="annottext">typedValidatorLookups :: TypedValidator a -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#typedValidatorLookups"><span class="hs-identifier hs-var hs-var">typedValidatorLookups</span></a></span></span><span> </span><span id="local-6989586621679467176"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-197"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ValidatorHash</span></span><span> </span><span id="local-6989586621679467175"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679467175"><span class="hs-identifier hs-var">vh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467174"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679467174"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; ValidatorHash
forall a. TypedValidator a -&gt; ValidatorHash
</span><span class="hs-identifier hs-var hs-var">tvValidatorHash</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; Versioned Validator
forall a. TypedValidator a -&gt; Versioned Validator
</span><span class="hs-identifier hs-var hs-var">tvValidator</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MintingPolicyHash</span></span><span> </span><span id="local-6989586621679467173"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679467173"><span class="hs-identifier hs-var">mph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467172"><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679467172"><span class="hs-identifier hs-var">mp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; MintingPolicyHash
forall a. TypedValidator a -&gt; MintingPolicyHash
</span><span class="hs-identifier hs-var">Typed.forwardingMintingPolicyHash</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; Versioned MintingPolicy
forall a. TypedValidator a -&gt; Versioned MintingPolicy
</span><span class="hs-identifier hs-var">Typed.vForwardingMintingPolicy</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ScriptLookups Any
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slOtherScripts :: Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var">slOtherScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">[(ScriptHash, Versioned Script)]
-&gt; Map ScriptHash (Versioned Script)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.fromList</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ScriptHash
</span><span class="hs-identifier hs-var">ScriptHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679467175"><span class="hs-identifier hs-var">vh</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; Script) -&gt; Versioned Validator -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Validator -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getValidator</span></span><span> </span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679467174"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ScriptHash
</span><span class="hs-identifier hs-var">ScriptHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679467173"><span class="hs-identifier hs-var">mph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(MintingPolicy -&gt; Script)
-&gt; Versioned MintingPolicy -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getMintingPolicy</span></span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679467172"><span class="hs-identifier hs-var">mp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">slTypedValidator :: Maybe (TypedValidator a)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTypedValidator"><span class="hs-identifier hs-var">slTypedValidator</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; Maybe (TypedValidator a)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679467176"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-205"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | A script lookups value that uses the map of unspent outputs to resolve</span><span>
</span><span id="line-209"></span><span class="hs-comment">--   input constraints.</span><span>
</span><span id="line-210"></span><span id="local-6989586621679467168"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#unspentOutputs"><span class="hs-identifier hs-type">unspentOutputs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecoratedTxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467168"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-211"></span><span id="unspentOutputs"><span class="annot"><span class="annottext">unspentOutputs :: Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#unspentOutputs"><span class="hs-identifier hs-var hs-var">unspentOutputs</span></a></span></span><span> </span><span id="local-6989586621679467167"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679467167"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slTxOutputs :: Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var">slTxOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679467167"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="hs-comment">-- | A script lookups value with a versioned minting policy script.</span><span>
</span><span id="line-214"></span><span id="local-6989586621679467854"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mintingPolicy"><span class="hs-identifier hs-type">mintingPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467854"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-215"></span><span id="mintingPolicy"><span class="annot"><span class="annottext">mintingPolicy :: Versioned MintingPolicy -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#mintingPolicy"><span class="hs-identifier hs-var hs-var">mintingPolicy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(MintingPolicy -&gt; Script)
-&gt; Versioned MintingPolicy -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicy -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getMintingPolicy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679467166"><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467166"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slOtherScripts :: Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var">slOtherScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Versioned Script -&gt; Map ScriptHash (Versioned Script)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned Script -&gt; ScriptHash
</span><span class="hs-identifier hs-var">scriptHash</span></span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467166"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467166"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | A script lookups value with a PlutusV1 minting policy script.</span><span>
</span><span id="line-218"></span><span id="local-6989586621679467164"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1MintingPolicy"><span class="hs-identifier hs-type">plutusV1MintingPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467164"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-219"></span><span id="plutusV1MintingPolicy"><span class="annot"><span class="annottext">plutusV1MintingPolicy :: MintingPolicy -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1MintingPolicy"><span class="hs-identifier hs-var hs-var">plutusV1MintingPolicy</span></a></span></span><span> </span><span id="local-6989586621679467163"><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679467163"><span class="hs-identifier hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy -&gt; ScriptLookups a
forall a. Versioned MintingPolicy -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#mintingPolicy"><span class="hs-identifier hs-var">mintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicy -&gt; Language -&gt; Versioned MintingPolicy
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679467163"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">PlutusV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="hs-comment">-- | A script lookups value with a PlutusV2 minting policy script.</span><span>
</span><span id="line-222"></span><span id="local-6989586621679467161"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2MintingPolicy"><span class="hs-identifier hs-type">plutusV2MintingPolicy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicy</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467161"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-223"></span><span id="plutusV2MintingPolicy"><span class="annot"><span class="annottext">plutusV2MintingPolicy :: MintingPolicy -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2MintingPolicy"><span class="hs-identifier hs-var hs-var">plutusV2MintingPolicy</span></a></span></span><span> </span><span id="local-6989586621679467160"><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679467160"><span class="hs-identifier hs-var">pl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy -&gt; ScriptLookups a
forall a. Versioned MintingPolicy -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#mintingPolicy"><span class="hs-identifier hs-var">mintingPolicy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicy -&gt; Language -&gt; Versioned MintingPolicy
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicy
</span><a href="#local-6989586621679467160"><span class="hs-identifier hs-var">pl</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">PlutusV2</span></span><span class="hs-special">)</span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span class="hs-comment">-- | A script lookups value with a versioned validator script.</span><span>
</span><span id="line-226"></span><span id="local-6989586621679467848"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#otherScript"><span class="hs-identifier hs-type">otherScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467848"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-227"></span><span id="otherScript"><span class="annot"><span class="annottext">otherScript :: Versioned Validator -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherScript"><span class="hs-identifier hs-var hs-var">otherScript</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Validator -&gt; Script) -&gt; Versioned Validator -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Validator -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getValidator</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621679467159"><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467159"><span class="hs-identifier hs-var">script</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slOtherScripts :: Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var">slOtherScripts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Versioned Script -&gt; Map ScriptHash (Versioned Script)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned Script -&gt; ScriptHash
</span><span class="hs-identifier hs-var">scriptHash</span></span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467159"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Versioned Script
</span><a href="#local-6989586621679467159"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span class="hs-comment">-- | A script lookups value with a PlutusV1 validator script.</span><span>
</span><span id="line-230"></span><span id="local-6989586621679467158"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1OtherScript"><span class="hs-identifier hs-type">plutusV1OtherScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467158"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-231"></span><span id="plutusV1OtherScript"><span class="annot"><span class="annottext">plutusV1OtherScript :: Validator -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#plutusV1OtherScript"><span class="hs-identifier hs-var hs-var">plutusV1OtherScript</span></a></span></span><span> </span><span id="local-6989586621679467157"><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679467157"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Versioned Validator -&gt; ScriptLookups a
forall a. Versioned Validator -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherScript"><span class="hs-identifier hs-var">otherScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validator -&gt; Language -&gt; Versioned Validator
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679467157"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">PlutusV1</span></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span class="hs-comment">-- | A script lookups value with a PlutusV2 validator script.</span><span>
</span><span id="line-234"></span><span id="local-6989586621679467156"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2OtherScript"><span class="hs-identifier hs-type">plutusV2OtherScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467156"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-235"></span><span id="plutusV2OtherScript"><span class="annot"><span class="annottext">plutusV2OtherScript :: Validator -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#plutusV2OtherScript"><span class="hs-identifier hs-var hs-var">plutusV2OtherScript</span></a></span></span><span> </span><span id="local-6989586621679467155"><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679467155"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Versioned Validator -&gt; ScriptLookups a
forall a. Versioned Validator -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherScript"><span class="hs-identifier hs-var">otherScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validator -&gt; Language -&gt; Versioned Validator
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">Validator
</span><a href="#local-6989586621679467155"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">PlutusV2</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- | A script lookups value with a datum.</span><span>
</span><span id="line-238"></span><span id="local-6989586621679467154"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#otherData"><span class="hs-identifier hs-type">otherData</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467154"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-239"></span><span id="otherData"><span class="annot"><span class="annottext">otherData :: Datum -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherData"><span class="hs-identifier hs-var hs-var">otherData</span></a></span></span><span> </span><span id="local-6989586621679467153"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679467153"><span class="hs-identifier hs-var">dt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679467152"><span class="annot"><span class="annottext">dh :: DatumHash
</span><a href="#local-6989586621679467152"><span class="hs-identifier hs-var hs-var">dh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumHash
</span><span class="hs-identifier hs-var">datumHash</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679467153"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slOtherData :: Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var">slOtherData</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Datum -&gt; Map DatumHash Datum
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679467152"><span class="hs-identifier hs-var">dh</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679467153"><span class="hs-identifier hs-var">dt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span id="txValidityRange%27"><span id="txOuts%27"><span id="txMintValue%27"><span id="txInsReference%27"><span id="txInsCollateral%27"><span id="txIns%27"><span id="txExtraKeyWits%27"><span id="local-6989586621679467797"><span id="local-6989586621679467798"><span class="hs-identifier">makeLensesFor</span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txIns&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txIns'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txInsCollateral&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txInsCollateral'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txInsReference&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txInsReference'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txExtraKeyWits&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txExtraKeyWits'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txOuts&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txOuts'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txValidityRange&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txValidityRange'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;txMintValue&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;txMintValue'&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>    </span><span class="hs-special">]</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">C.TxBodyContent</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txIns"><span class="hs-identifier hs-type">txIns</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxIn</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BuildTxWith</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BuildTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Witness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.WitCtxTxIn</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-254"></span><span id="txIns"><span class="annot"><span class="annottext">txIns :: ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
 -&gt; f [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txIns"><span class="hs-identifier hs-var hs-var">txIns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; f [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; f [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
 -&gt; f [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era. Lens' (TxBodyContent build era) (TxIns build era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txIns%27"><span class="hs-identifier hs-var">txIns'</span></a></span><span>
</span><span id="line-255"></span><span>
</span><span id="line-256"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txInsCollateral"><span class="hs-identifier hs-type">txInsCollateral</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.TxIn</span></span><span class="hs-special">]</span><span>
</span><span id="line-257"></span><span id="txInsCollateral"><span class="annot"><span class="annottext">txInsCollateral :: ([TxIn] -&gt; f [TxIn]) -&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsCollateral"><span class="hs-identifier hs-var hs-var">txInsCollateral</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (([TxIn] -&gt; f [TxIn])
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ([TxIn] -&gt; f [TxIn])
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxInsCollateral BabbageEra -&gt; f (TxInsCollateral BabbageEra))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era.
Lens' (TxBodyContent build era) (TxInsCollateral era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsCollateral%27"><span class="hs-identifier hs-var">txInsCollateral'</span></a></span><span> </span><span class="annot"><span class="annottext">((TxInsCollateral BabbageEra -&gt; f (TxInsCollateral BabbageEra))
 -&gt; TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; (([TxIn] -&gt; f [TxIn])
    -&gt; TxInsCollateral BabbageEra -&gt; f (TxInsCollateral BabbageEra))
-&gt; ([TxIn] -&gt; f [TxIn])
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxInsCollateral BabbageEra -&gt; [TxIn])
-&gt; ([TxIn] -&gt; TxInsCollateral BabbageEra)
-&gt; Iso
     (TxInsCollateral BabbageEra)
     (TxInsCollateral BabbageEra)
     [TxIn]
     [TxIn]
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><span class="hs-identifier hs-var">iso</span></span><span> </span><span class="annot"><span class="annottext">TxInsCollateral BabbageEra -&gt; [TxIn]
forall era. TxInsCollateral era -&gt; [TxIn]
</span><a href="#local-6989586621679467140"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxInsCollateral BabbageEra
</span><a href="#local-6989586621679467139"><span class="hs-identifier hs-var">fromList</span></a></span><span>
</span><span id="line-258"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-259"></span><span>        </span><span id="local-6989586621679467140"><span class="annot"><span class="annottext">toList :: TxInsCollateral era -&gt; [TxIn]
</span><a href="#local-6989586621679467140"><span class="hs-identifier hs-var hs-var">toList</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxInsCollateral era
</span><span class="hs-identifier hs-var">C.TxInsCollateralNone</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><a href="#local-6989586621679467140"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxInsCollateral</span></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679467136"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467136"><span class="hs-identifier hs-var">txins</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467136"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-261"></span><span>        </span><span id="local-6989586621679467139"><span class="annot"><span class="annottext">fromList :: [TxIn] -&gt; TxInsCollateral BabbageEra
</span><a href="#local-6989586621679467139"><span class="hs-identifier hs-var hs-var">fromList</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInsCollateral BabbageEra
forall era. TxInsCollateral era
</span><span class="hs-identifier hs-var">C.TxInsCollateralNone</span></span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><a href="#local-6989586621679467139"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span id="local-6989586621679467135"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467135"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra BabbageEra
-&gt; [TxIn] -&gt; TxInsCollateral BabbageEra
forall era.
CollateralSupportedInEra era -&gt; [TxIn] -&gt; TxInsCollateral era
</span><span class="hs-identifier hs-var">C.TxInsCollateral</span></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.CollateralInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467135"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txExtraKeyWits"><span class="hs-identifier hs-type">txExtraKeyWits</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Set.Set</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Hash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.PaymentKey</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span id="txExtraKeyWits"><span class="annot"><span class="annottext">txExtraKeyWits :: (Set (Hash PaymentKey) -&gt; f (Set (Hash PaymentKey)))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txExtraKeyWits"><span class="hs-identifier hs-var hs-var">txExtraKeyWits</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; ((Set (Hash PaymentKey) -&gt; f (Set (Hash PaymentKey)))
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; (Set (Hash PaymentKey) -&gt; f (Set (Hash PaymentKey)))
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxExtraKeyWitnesses BabbageEra
 -&gt; f (TxExtraKeyWitnesses BabbageEra))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era.
Lens' (TxBodyContent build era) (TxExtraKeyWitnesses era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txExtraKeyWits%27"><span class="hs-identifier hs-var">txExtraKeyWits'</span></a></span><span> </span><span class="annot"><span class="annottext">((TxExtraKeyWitnesses BabbageEra
  -&gt; f (TxExtraKeyWitnesses BabbageEra))
 -&gt; TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ((Set (Hash PaymentKey) -&gt; f (Set (Hash PaymentKey)))
    -&gt; TxExtraKeyWitnesses BabbageEra
    -&gt; f (TxExtraKeyWitnesses BabbageEra))
-&gt; (Set (Hash PaymentKey) -&gt; f (Set (Hash PaymentKey)))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxExtraKeyWitnesses BabbageEra -&gt; Set (Hash PaymentKey))
-&gt; (Set (Hash PaymentKey) -&gt; TxExtraKeyWitnesses BabbageEra)
-&gt; Iso
     (TxExtraKeyWitnesses BabbageEra)
     (TxExtraKeyWitnesses BabbageEra)
     (Set (Hash PaymentKey))
     (Set (Hash PaymentKey))
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><span class="hs-identifier hs-var">iso</span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses BabbageEra -&gt; Set (Hash PaymentKey)
forall era. TxExtraKeyWitnesses era -&gt; Set (Hash PaymentKey)
</span><a href="#local-6989586621679467132"><span class="hs-identifier hs-var">toSet</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey) -&gt; TxExtraKeyWitnesses BabbageEra
</span><a href="#local-6989586621679467131"><span class="hs-identifier hs-var">fromSet</span></a></span><span>
</span><span id="line-266"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>        </span><span id="local-6989586621679467132"><span class="annot"><span class="annottext">toSet :: TxExtraKeyWitnesses era -&gt; Set (Hash PaymentKey)
</span><a href="#local-6989586621679467132"><span class="hs-identifier hs-var hs-var">toSet</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">C.TxExtraKeyWitnessesNone</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="annot"><a href="#local-6989586621679467132"><span class="hs-identifier hs-var">toSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxExtraKeyWitnesses</span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnessesSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679467128"><span class="annot"><span class="annottext">[Hash PaymentKey]
</span><a href="#local-6989586621679467128"><span class="hs-identifier hs-var">txwits</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey] -&gt; Set (Hash PaymentKey)
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">[Hash PaymentKey]
</span><a href="#local-6989586621679467128"><span class="hs-identifier hs-var">txwits</span></a></span><span>
</span><span id="line-269"></span><span>        </span><span id="local-6989586621679467131"><span class="annot"><span class="annottext">fromSet :: Set (Hash PaymentKey) -&gt; TxExtraKeyWitnesses BabbageEra
</span><a href="#local-6989586621679467131"><span class="hs-identifier hs-var hs-var">fromSet</span></a></span></span><span> </span><span id="local-6989586621679467126"><span class="annot"><span class="annottext">Set (Hash PaymentKey)
</span><a href="#local-6989586621679467126"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey) -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey)
</span><a href="#local-6989586621679467126"><span class="hs-identifier hs-var">s</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses BabbageEra
forall era. TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">C.TxExtraKeyWitnessesNone</span></span><span>
</span><span id="line-270"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnessesSupportedInEra BabbageEra
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses BabbageEra
forall era.
TxExtraKeyWitnessesSupportedInEra era
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">C.TxExtraKeyWitnesses</span></span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnessesSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.ExtraKeyWitnessesInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">([Hash PaymentKey] -&gt; TxExtraKeyWitnesses BabbageEra)
-&gt; [Hash PaymentKey] -&gt; TxExtraKeyWitnesses BabbageEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey) -&gt; [Hash PaymentKey]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey)
</span><a href="#local-6989586621679467126"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference"><span class="hs-identifier hs-type">txInsReference</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.TxIn</span></span><span class="hs-special">]</span><span>
</span><span id="line-273"></span><span id="txInsReference"><span class="annot"><span class="annottext">txInsReference :: ([TxIn] -&gt; f [TxIn]) -&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference"><span class="hs-identifier hs-var hs-var">txInsReference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (([TxIn] -&gt; f [TxIn])
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ([TxIn] -&gt; f [TxIn])
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxInsReference BuildTx BabbageEra
 -&gt; f (TxInsReference BuildTx BabbageEra))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era.
Lens' (TxBodyContent build era) (TxInsReference build era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference%27"><span class="hs-identifier hs-var">txInsReference'</span></a></span><span> </span><span class="annot"><span class="annottext">((TxInsReference BuildTx BabbageEra
  -&gt; f (TxInsReference BuildTx BabbageEra))
 -&gt; TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; (([TxIn] -&gt; f [TxIn])
    -&gt; TxInsReference BuildTx BabbageEra
    -&gt; f (TxInsReference BuildTx BabbageEra))
-&gt; ([TxIn] -&gt; f [TxIn])
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxInsReference BuildTx BabbageEra -&gt; [TxIn])
-&gt; ([TxIn] -&gt; TxInsReference BuildTx BabbageEra)
-&gt; Iso
     (TxInsReference BuildTx BabbageEra)
     (TxInsReference BuildTx BabbageEra)
     [TxIn]
     [TxIn]
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><span class="hs-identifier hs-var">iso</span></span><span> </span><span class="annot"><span class="annottext">TxInsReference BuildTx BabbageEra -&gt; [TxIn]
forall build era. TxInsReference build era -&gt; [TxIn]
</span><a href="#local-6989586621679467121"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">[TxIn] -&gt; TxInsReference BuildTx BabbageEra
forall build. [TxIn] -&gt; TxInsReference build BabbageEra
</span><a href="#local-6989586621679467120"><span class="hs-identifier hs-var">fromList</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-275"></span><span>        </span><span id="local-6989586621679467121"><span class="annot"><span class="annottext">toList :: TxInsReference build era -&gt; [TxIn]
</span><a href="#local-6989586621679467121"><span class="hs-identifier hs-var hs-var">toList</span></a></span></span><span> </span><span class="annot"><span class="annottext">TxInsReference build era
</span><span class="hs-identifier hs-var">C.TxInsReferenceNone</span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><a href="#local-6989586621679467121"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxInsReference</span></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra era
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679467117"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467117"><span class="hs-identifier hs-var">txins</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467117"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-277"></span><span>        </span><span id="local-6989586621679467120"><span class="annot"><span class="annottext">fromList :: [TxIn] -&gt; TxInsReference build BabbageEra
</span><a href="#local-6989586621679467120"><span class="hs-identifier hs-var hs-var">fromList</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInsReference build BabbageEra
forall build era. TxInsReference build era
</span><span class="hs-identifier hs-var">C.TxInsReferenceNone</span></span><span>
</span><span id="line-278"></span><span>        </span><span class="annot"><a href="#local-6989586621679467120"><span class="hs-identifier hs-var">fromList</span></a></span><span> </span><span id="local-6989586621679467116"><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467116"><span class="hs-identifier hs-var">txins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra BabbageEra
-&gt; [TxIn] -&gt; TxInsReference build BabbageEra
forall era build.
ReferenceTxInsScriptsInlineDatumsSupportedInEra era
-&gt; [TxIn] -&gt; TxInsReference build era
</span><span class="hs-identifier hs-var">C.TxInsReference</span></span><span> </span><span class="annot"><span class="annottext">ReferenceTxInsScriptsInlineDatumsSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.ReferenceTxInsScriptsInlineDatumsInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
</span><a href="#local-6989586621679467116"><span class="hs-identifier hs-var">txins</span></a></span><span>
</span><span id="line-279"></span><span>
</span><span id="line-280"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txMintValue"><span class="hs-identifier hs-type">txMintValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span>
</span><span id="line-281"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.PolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ScriptWitness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.WitCtxMint</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-282"></span><span id="txMintValue"><span class="annot"><span class="annottext">txMintValue :: ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
 -&gt; f (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txMintValue"><span class="hs-identifier hs-var hs-var">txMintValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
     -&gt; f (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
    -&gt; f (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMintValue BuildTx BabbageEra
 -&gt; f (TxMintValue BuildTx BabbageEra))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era.
Lens' (TxBodyContent build era) (TxMintValue build era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txMintValue%27"><span class="hs-identifier hs-var">txMintValue'</span></a></span><span> </span><span class="annot"><span class="annottext">((TxMintValue BuildTx BabbageEra
  -&gt; f (TxMintValue BuildTx BabbageEra))
 -&gt; TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; (((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
     -&gt; f (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
    -&gt; TxMintValue BuildTx BabbageEra
    -&gt; f (TxMintValue BuildTx BabbageEra))
-&gt; ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
    -&gt; f (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxMintValue BuildTx BabbageEra
 -&gt; (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
    -&gt; TxMintValue BuildTx BabbageEra)
-&gt; Iso
     (TxMintValue BuildTx BabbageEra)
     (TxMintValue BuildTx BabbageEra)
     (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
     (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
forall s a b t. (s -&gt; a) -&gt; (b -&gt; t) -&gt; Iso s t a b
</span><span class="hs-identifier hs-var">iso</span></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx BabbageEra
-&gt; (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
</span><a href="#local-6989586621679467113"><span class="hs-identifier hs-var">toMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
-&gt; TxMintValue BuildTx BabbageEra
</span><a href="#local-6989586621679467112"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-284"></span><span>        </span><span class="annot"><a href="#local-6989586621679467113"><span class="hs-identifier hs-type">toMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.TxMintValue</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.PolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ScriptWitness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.WitCtxMint</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-285"></span><span>        </span><span id="local-6989586621679467113"><span class="annot"><span class="annottext">toMaybe :: TxMintValue BuildTx BabbageEra
-&gt; (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
</span><a href="#local-6989586621679467113"><span class="hs-identifier hs-var hs-var">toMaybe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxMintValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra BabbageEra
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679467110"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679467110"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.BuildTxWith</span></span><span> </span><span id="local-6989586621679467108"><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
</span><a href="#local-6989586621679467108"><span class="hs-identifier hs-var">msc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679467110"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
</span><a href="#local-6989586621679467108"><span class="hs-identifier hs-var">msc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-286"></span><span>        </span><span class="annot"><a href="#local-6989586621679467113"><span class="hs-identifier hs-var">toMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx BabbageEra
</span><span class="hs-identifier">_</span></span><span>                                       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>        </span><span class="annot"><a href="#local-6989586621679467112"><span class="hs-identifier hs-type">fromMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.Value</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Map.Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.PolicyId</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ScriptWitness</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.WitCtxMint</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.TxMintValue</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BuildTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span>
</span><span id="line-288"></span><span>        </span><span id="local-6989586621679467112"><span class="annot"><span class="annottext">fromMaybe :: (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
-&gt; TxMintValue BuildTx BabbageEra
</span><a href="#local-6989586621679467112"><span class="hs-identifier hs-var hs-var">fromMaybe</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467107"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679467107"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467106"><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
</span><a href="#local-6989586621679467106"><span class="hs-identifier hs-var">msc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra BabbageEra
-&gt; Value
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
-&gt; TxMintValue BuildTx BabbageEra
forall era build.
MultiAssetSupportedInEra era
-&gt; Value
-&gt; BuildTxWith build (Map PolicyId (ScriptWitness WitCtxMint era))
-&gt; TxMintValue build era
</span><span class="hs-identifier hs-var">C.TxMintValue</span></span><span> </span><span class="annot"><span class="annottext">MultiAssetSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.MultiAssetInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679467107"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
-&gt; BuildTxWith
     BuildTx (Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">C.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
</span><a href="#local-6989586621679467106"><span class="hs-identifier hs-var">msc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txOuts"><span class="hs-identifier hs-type">txOuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">]</span><span>
</span><span id="line-291"></span><span id="txOuts"><span class="annot"><span class="annottext">txOuts :: ([TxOut] -&gt; f [TxOut]) -&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txOuts"><span class="hs-identifier hs-var hs-var">txOuts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (([TxOut] -&gt; f [TxOut])
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ([TxOut] -&gt; f [TxOut])
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut CtxTx BabbageEra] -&gt; f [TxOut CtxTx BabbageEra])
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era. Lens' (TxBodyContent build era) [TxOut CtxTx era]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txOuts%27"><span class="hs-identifier hs-var">txOuts'</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxOut CtxTx BabbageEra] -&gt; f [TxOut CtxTx BabbageEra])
 -&gt; TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; (([TxOut] -&gt; f [TxOut])
    -&gt; [TxOut CtxTx BabbageEra] -&gt; f [TxOut CtxTx BabbageEra])
-&gt; ([TxOut] -&gt; f [TxOut])
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; f [TxOut])
-&gt; [TxOut CtxTx BabbageEra] -&gt; f [TxOut CtxTx BabbageEra]
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span>
</span><span id="line-292"></span><span>
</span><span id="line-293"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier hs-type">txValidityRange</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Lens'</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.TxValidityLowerBound</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.TxValidityUpperBound</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span id="txValidityRange"><span class="annot"><span class="annottext">txValidityRange :: ((TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; f (TxValidityLowerBound BabbageEra,
       TxValidityUpperBound BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier hs-var hs-var">txValidityRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra
 -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; CardanoBuildTx -&gt; f CardanoBuildTx
forall s t a b. (Coercible s a, Coercible t b) =&gt; Iso s t a b
</span><span class="hs-identifier hs-var">coerced</span></span><span> </span><span class="annot"><span class="annottext">((TxBodyContent BuildTx BabbageEra
  -&gt; f (TxBodyContent BuildTx BabbageEra))
 -&gt; CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; f (TxValidityLowerBound BabbageEra,
           TxValidityUpperBound BabbageEra))
    -&gt; TxBodyContent BuildTx BabbageEra
    -&gt; f (TxBodyContent BuildTx BabbageEra))
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; f (TxValidityLowerBound BabbageEra,
          TxValidityUpperBound BabbageEra))
-&gt; CardanoBuildTx
-&gt; f CardanoBuildTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; f (TxValidityLowerBound BabbageEra,
       TxValidityUpperBound BabbageEra))
-&gt; TxBodyContent BuildTx BabbageEra
-&gt; f (TxBodyContent BuildTx BabbageEra)
forall build era.
Lens'
  (TxBodyContent build era)
  (TxValidityLowerBound era, TxValidityUpperBound era)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange%27"><span class="hs-identifier hs-var">txValidityRange'</span></a></span><span>
</span><span id="line-295"></span><span>
</span><span id="line-296"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#emptyCardanoBuildTx"><span class="hs-identifier hs-type">emptyCardanoBuildTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span>
</span><span id="line-297"></span><span id="emptyCardanoBuildTx"><span class="annot"><span class="annottext">emptyCardanoBuildTx :: Params -&gt; CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#emptyCardanoBuildTx"><span class="hs-identifier hs-var hs-var">emptyCardanoBuildTx</span></a></span></span><span> </span><span id="local-6989586621679467103"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679467103"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxBodyContent BuildTx BabbageEra -&gt; CardanoBuildTx
</span><span class="hs-identifier hs-var">C.CardanoBuildTx</span></span><span> </span><span class="annot"><span class="annottext">(TxBodyContent BuildTx BabbageEra -&gt; CardanoBuildTx)
-&gt; TxBodyContent BuildTx BabbageEra -&gt; CardanoBuildTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxBodyContent :: forall build era.
TxIns build era
-&gt; TxInsCollateral era
-&gt; TxInsReference build era
-&gt; [TxOut CtxTx era]
-&gt; TxTotalCollateral era
-&gt; TxReturnCollateral CtxTx era
-&gt; TxFee era
-&gt; (TxValidityLowerBound era, TxValidityUpperBound era)
-&gt; TxMetadataInEra era
-&gt; TxAuxScripts era
-&gt; TxExtraKeyWitnesses era
-&gt; BuildTxWith build (Maybe ProtocolParameters)
-&gt; TxWithdrawals build era
-&gt; TxCertificates build era
-&gt; TxUpdateProposal era
-&gt; TxMintValue build era
-&gt; TxScriptValidity era
-&gt; TxBodyContent build era
</span><span class="hs-identifier hs-type">C.TxBodyContent</span></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">txIns :: [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
</span><span class="hs-identifier hs-var">C.txIns</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-299"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInsCollateral :: TxInsCollateral BabbageEra
</span><span class="hs-identifier hs-var">C.txInsCollateral</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra BabbageEra
-&gt; [TxIn] -&gt; TxInsCollateral BabbageEra
forall era.
CollateralSupportedInEra era -&gt; [TxIn] -&gt; TxInsCollateral era
</span><span class="hs-identifier hs-var">C.TxInsCollateral</span></span><span> </span><span class="annot"><span class="annottext">CollateralSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.CollateralInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">[TxIn]
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-300"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txInsReference :: TxInsReference BuildTx BabbageEra
</span><span class="hs-identifier hs-var">C.txInsReference</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInsReference BuildTx BabbageEra
forall build era. TxInsReference build era
</span><span class="hs-identifier hs-var">C.TxInsReferenceNone</span></span><span>
</span><span id="line-301"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txOuts :: [TxOut CtxTx BabbageEra]
</span><span class="hs-identifier hs-var">C.txOuts</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOut CtxTx BabbageEra]
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-302"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txTotalCollateral :: TxTotalCollateral BabbageEra
</span><span class="hs-identifier hs-var">C.txTotalCollateral</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxTotalCollateral BabbageEra
forall era. TxTotalCollateral era
</span><span class="hs-identifier hs-var">C.TxTotalCollateralNone</span></span><span>
</span><span id="line-303"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txReturnCollateral :: TxReturnCollateral CtxTx BabbageEra
</span><span class="hs-identifier hs-var">C.txReturnCollateral</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxReturnCollateral CtxTx BabbageEra
forall ctx era. TxReturnCollateral ctx era
</span><span class="hs-identifier hs-var">C.TxReturnCollateralNone</span></span><span>
</span><span id="line-304"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txFee :: TxFee BabbageEra
</span><span class="hs-identifier hs-var">C.txFee</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxFeesExplicitInEra BabbageEra -&gt; Lovelace -&gt; TxFee BabbageEra
forall era. TxFeesExplicitInEra era -&gt; Lovelace -&gt; TxFee era
</span><span class="hs-identifier hs-var">C.TxFeeExplicit</span></span><span> </span><span class="annot"><span class="annottext">TxFeesExplicitInEra BabbageEra
</span><span class="hs-identifier hs-var">C.TxFeesExplicitInBabbageEra</span></span><span> </span><span class="annot"><span class="annottext">Lovelace
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txValidityRange :: (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><span class="hs-identifier hs-var">C.txValidityRange</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxValidityLowerBound BabbageEra
forall era. TxValidityLowerBound era
</span><span class="hs-identifier hs-var">C.TxValidityNoLowerBound</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra BabbageEra
-&gt; TxValidityUpperBound BabbageEra
forall era.
ValidityNoUpperBoundSupportedInEra era -&gt; TxValidityUpperBound era
</span><span class="hs-identifier hs-var">C.TxValidityNoUpperBound</span></span><span> </span><span class="annot"><span class="annottext">ValidityNoUpperBoundSupportedInEra BabbageEra
</span><span class="hs-identifier hs-var">C.ValidityNoUpperBoundInBabbageEra</span></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txMintValue :: TxMintValue BuildTx BabbageEra
</span><span class="hs-identifier hs-var">C.txMintValue</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMintValue BuildTx BabbageEra
forall build era. TxMintValue build era
</span><span class="hs-identifier hs-var">C.TxMintNone</span></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txProtocolParams :: BuildTxWith BuildTx (Maybe ProtocolParameters)
</span><span class="hs-identifier hs-var">C.txProtocolParams</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ProtocolParameters
-&gt; BuildTxWith BuildTx (Maybe ProtocolParameters)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">C.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">(Maybe ProtocolParameters
 -&gt; BuildTxWith BuildTx (Maybe ProtocolParameters))
-&gt; Maybe ProtocolParameters
-&gt; BuildTxWith BuildTx (Maybe ProtocolParameters)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ProtocolParameters -&gt; Maybe ProtocolParameters
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ProtocolParameters -&gt; Maybe ProtocolParameters)
-&gt; ProtocolParameters -&gt; Maybe ProtocolParameters
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; ProtocolParameters
</span><span class="hs-identifier hs-var">pProtocolParams</span></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679467103"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-308"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txScriptValidity :: TxScriptValidity BabbageEra
</span><span class="hs-identifier hs-var">C.txScriptValidity</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxScriptValidity BabbageEra
forall era. TxScriptValidity era
</span><span class="hs-identifier hs-var">C.TxScriptValidityNone</span></span><span>
</span><span id="line-309"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txExtraKeyWits :: TxExtraKeyWitnesses BabbageEra
</span><span class="hs-identifier hs-var">C.txExtraKeyWits</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxExtraKeyWitnesses BabbageEra
forall era. TxExtraKeyWitnesses era
</span><span class="hs-identifier hs-var">C.TxExtraKeyWitnessesNone</span></span><span>
</span><span id="line-310"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txMetadata :: TxMetadataInEra BabbageEra
</span><span class="hs-identifier hs-var">C.txMetadata</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxMetadataInEra BabbageEra
forall era. TxMetadataInEra era
</span><span class="hs-identifier hs-var">C.TxMetadataNone</span></span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txAuxScripts :: TxAuxScripts BabbageEra
</span><span class="hs-identifier hs-var">C.txAuxScripts</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxAuxScripts BabbageEra
forall era. TxAuxScripts era
</span><span class="hs-identifier hs-var">C.TxAuxScriptsNone</span></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txWithdrawals :: TxWithdrawals BuildTx BabbageEra
</span><span class="hs-identifier hs-var">C.txWithdrawals</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxWithdrawals BuildTx BabbageEra
forall build era. TxWithdrawals build era
</span><span class="hs-identifier hs-var">C.TxWithdrawalsNone</span></span><span>
</span><span id="line-313"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txCertificates :: TxCertificates BuildTx BabbageEra
</span><span class="hs-identifier hs-var">C.txCertificates</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxCertificates BuildTx BabbageEra
forall build era. TxCertificates build era
</span><span class="hs-identifier hs-var">C.TxCertificatesNone</span></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txUpdateProposal :: TxUpdateProposal BabbageEra
</span><span class="hs-identifier hs-var">C.txUpdateProposal</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxUpdateProposal BabbageEra
forall era. TxUpdateProposal era
</span><span class="hs-identifier hs-var">C.TxUpdateProposalNone</span></span><span>
</span><span id="line-315"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-316"></span><span>
</span><span id="line-317"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#emptyUnbalancedTx"><span class="hs-identifier hs-type">emptyUnbalancedTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span>
</span><span id="line-318"></span><span id="emptyUnbalancedTx"><span class="annot"><span class="annottext">emptyUnbalancedTx :: Params -&gt; UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#emptyUnbalancedTx"><span class="hs-identifier hs-var hs-var">emptyUnbalancedTx</span></a></span></span><span> </span><span id="local-6989586621679467070"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679467070"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx -&gt; UtxoIndex -&gt; UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedCardanoTx"><span class="hs-identifier hs-var">UnbalancedCardanoTx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#emptyCardanoBuildTx"><span class="hs-identifier hs-var">emptyCardanoBuildTx</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679467070"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UtxoIndex
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-319"></span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | A script lookups value with a payment public key</span><span>
</span><span id="line-321"></span><span id="local-6989586621679467068"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKey"><span class="hs-identifier hs-type">paymentPubKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKey</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467068"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-322"></span><span id="paymentPubKey"><span class="annot"><span class="annottext">paymentPubKey :: PaymentPubKey -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKey"><span class="hs-identifier hs-var hs-var">paymentPubKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKey</span></span><span> </span><span id="local-6989586621679467067"><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679467067"><span class="hs-identifier hs-var">pk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-323"></span><span>   </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; ScriptLookups a
forall a. PaymentPubKeyHash -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKeyHash"><span class="hs-identifier hs-var">paymentPubKeyHash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PubKeyHash -&gt; PaymentPubKeyHash
</span><span class="hs-identifier hs-var">PaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">(PubKeyHash -&gt; PaymentPubKeyHash)
-&gt; PubKeyHash -&gt; PaymentPubKeyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PubKey -&gt; PubKeyHash
</span><span class="hs-identifier hs-var">pubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">PubKey
</span><a href="#local-6989586621679467067"><span class="hs-identifier hs-var">pk</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span class="hs-comment">-- | A script lookups value with a payment public key</span><span>
</span><span id="line-326"></span><span id="local-6989586621679467725"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKeyHash"><span class="hs-identifier hs-type">paymentPubKeyHash</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKeyHash</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467725"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-327"></span><span id="paymentPubKeyHash"><span class="annot"><span class="annottext">paymentPubKeyHash :: PaymentPubKeyHash -&gt; ScriptLookups a
</span><a href="Ledger.Tx.Constraints.OffChain.html#paymentPubKeyHash"><span class="hs-identifier hs-var hs-var">paymentPubKeyHash</span></a></span></span><span> </span><span id="local-6989586621679467066"><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679467066"><span class="hs-identifier hs-var">pkh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-328"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups a
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">slPaymentPubKeyHashes :: Set PaymentPubKeyHash
</span><a href="Ledger.Tx.Constraints.OffChain.html#slPaymentPubKeyHashes"><span class="hs-identifier hs-var">slPaymentPubKeyHashes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Set PaymentPubKeyHash
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679467066"><span class="hs-identifier hs-var">pkh</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">-- | An unbalanced transaction. It needs to be balanced and signed before it</span><span>
</span><span id="line-332"></span><span class="hs-comment">--   can be submitted to the ledger. See note [Submitting transactions from</span><span>
</span><span id="line-333"></span><span class="hs-comment">--   Plutus contracts] in 'Plutus.Contract.Wallet'.</span><span>
</span><span id="line-334"></span><span id="local-6989586621679467063"><span id="local-6989586621679467064"></span></span><span class="hs-keyword">data</span><span> </span><span id="UnbalancedTx"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-var">UnbalancedTx</span></a></span></span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="UnbalancedCardanoTx"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedCardanoTx"><span class="hs-identifier hs-var">UnbalancedCardanoTx</span></a></span></span><span>
</span><span id="line-336"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="unBalancedCardanoBuildTx"><span class="annot"><span class="annottext">UnbalancedTx -&gt; CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unBalancedCardanoBuildTx"><span class="hs-identifier hs-var hs-var">unBalancedCardanoBuildTx</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span>
</span><span id="line-337"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="unBalancedTxUtxoIndex"><span class="annot"><span class="annottext">UnbalancedTx -&gt; UtxoIndex
</span><a href="Ledger.Tx.Constraints.OffChain.html#unBalancedTxUtxoIndex"><span class="hs-identifier hs-var hs-var">unBalancedTxUtxoIndex</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">UtxoIndex</span></span><span>
</span><span id="line-338"></span><span>        </span><span class="hs-comment">-- ^ Utxo lookups that are used for adding inputs to the 'UnbalancedTx'.</span><span>
</span><span id="line-339"></span><span>        </span><span class="hs-comment">-- Simply refers to  'slTxOutputs' of 'ScriptLookups'.</span><span>
</span><span id="line-340"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-341"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467057"><span id="local-6989586621679467059"><span class="annot"><span class="annottext">UnbalancedTx -&gt; UnbalancedTx -&gt; Bool
(UnbalancedTx -&gt; UnbalancedTx -&gt; Bool)
-&gt; (UnbalancedTx -&gt; UnbalancedTx -&gt; Bool) -&gt; Eq UnbalancedTx
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: UnbalancedTx -&gt; UnbalancedTx -&gt; Bool
$c/= :: UnbalancedTx -&gt; UnbalancedTx -&gt; Bool
== :: UnbalancedTx -&gt; UnbalancedTx -&gt; Bool
$c== :: UnbalancedTx -&gt; UnbalancedTx -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. UnbalancedTx -&gt; Rep UnbalancedTx x)
-&gt; (forall x. Rep UnbalancedTx x -&gt; UnbalancedTx)
-&gt; Generic UnbalancedTx
forall x. Rep UnbalancedTx x -&gt; UnbalancedTx
forall x. UnbalancedTx -&gt; Rep UnbalancedTx x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep UnbalancedTx x -&gt; UnbalancedTx
$cfrom :: forall x. UnbalancedTx -&gt; Rep UnbalancedTx x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467048"><span id="local-6989586621679467050"><span id="local-6989586621679467052"><span class="annot"><span class="annottext">Int -&gt; UnbalancedTx -&gt; ShowS
[UnbalancedTx] -&gt; ShowS
UnbalancedTx -&gt; String
(Int -&gt; UnbalancedTx -&gt; ShowS)
-&gt; (UnbalancedTx -&gt; String)
-&gt; ([UnbalancedTx] -&gt; ShowS)
-&gt; Show UnbalancedTx
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [UnbalancedTx] -&gt; ShowS
$cshowList :: [UnbalancedTx] -&gt; ShowS
show :: UnbalancedTx -&gt; String
$cshow :: UnbalancedTx -&gt; String
showsPrec :: Int -&gt; UnbalancedTx -&gt; ShowS
$cshowsPrec :: Int -&gt; UnbalancedTx -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467044"><span id="local-6989586621679467046"><span class="annot"><span class="annottext">Value -&gt; Parser [UnbalancedTx]
Value -&gt; Parser UnbalancedTx
(Value -&gt; Parser UnbalancedTx)
-&gt; (Value -&gt; Parser [UnbalancedTx]) -&gt; FromJSON UnbalancedTx
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [UnbalancedTx]
$cparseJSONList :: Value -&gt; Parser [UnbalancedTx]
parseJSON :: Value -&gt; Parser UnbalancedTx
$cparseJSON :: Value -&gt; Parser UnbalancedTx
</span><a href="#local-6989586621679467044"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679467036"><span id="local-6989586621679467038"><span id="local-6989586621679467040"><span id="local-6989586621679467042"><span class="annot"><span class="annottext">[UnbalancedTx] -&gt; Encoding
[UnbalancedTx] -&gt; Value
UnbalancedTx -&gt; Encoding
UnbalancedTx -&gt; Value
(UnbalancedTx -&gt; Value)
-&gt; (UnbalancedTx -&gt; Encoding)
-&gt; ([UnbalancedTx] -&gt; Value)
-&gt; ([UnbalancedTx] -&gt; Encoding)
-&gt; ToJSON UnbalancedTx
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [UnbalancedTx] -&gt; Encoding
$ctoEncodingList :: [UnbalancedTx] -&gt; Encoding
toJSONList :: [UnbalancedTx] -&gt; Value
$ctoJSONList :: [UnbalancedTx] -&gt; Value
toEncoding :: UnbalancedTx -&gt; Encoding
$ctoEncoding :: UnbalancedTx -&gt; Encoding
toJSON :: UnbalancedTx -&gt; Value
$ctoJSON :: UnbalancedTx -&gt; Value
</span><a href="#local-6989586621679467036"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span id="cardanoTx"><span id="utxoIndex"><span class="hs-identifier">makeLensesFor</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;unBalancedCardanoBuildTx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;cardanoTx&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;unBalancedTxUtxoIndex&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;utxoIndex&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-347"></span><span>    </span><span class="hs-special">]</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">UnbalancedTx</span></span></span><span>
</span><span id="line-348"></span><span>
</span><span id="line-349"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-type">tx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Traversal'</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CardanoBuildTx</span></span><span>
</span><span id="line-350"></span><span id="tx"><span class="annot"><span class="annottext">tx :: (CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; UnbalancedTx -&gt; f UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; f CardanoBuildTx)
-&gt; UnbalancedTx -&gt; f UnbalancedTx
Lens' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#cardanoTx"><span class="hs-identifier hs-var">cardanoTx</span></a></span><span>
</span><span id="line-351"></span><span>
</span><span id="line-352"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679467032"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-353"></span><span>    </span><span id="local-6989586621679467030"><span class="annot"><span class="annottext">pretty :: UnbalancedTx -&gt; Doc ann
</span><a href="#local-6989586621679467030"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedCardanoTx"><span class="hs-identifier hs-type">UnbalancedCardanoTx</span></a></span><span> </span><span id="local-6989586621679467029"><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679467029"><span class="hs-identifier hs-var">utx</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.UTxO</span></span><span> </span><span id="local-6989586621679467027"><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO BabbageEra)
</span><a href="#local-6989586621679467027"><span class="hs-identifier hs-var">utxo</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc ann -&gt; Doc ann
forall ann. Int -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">hang</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc ann -&gt; Doc ann) -&gt; Doc ann -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Tx:&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679467029"><span class="hs-identifier hs-var">utx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc ann -&gt; Doc ann
forall ann. Int -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">hang</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc ann -&gt; Doc ann) -&gt; Doc ann -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc ann] -&gt; Doc ann) -&gt; [Doc ann] -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Requires signatures:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; Doc ann
forall a ann. Show a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">viaShow</span></span><span> </span><span class="annot"><span class="annottext">(Hash PaymentKey -&gt; Doc ann) -&gt; [Hash PaymentKey] -&gt; [Doc ann]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Set (Hash PaymentKey) -&gt; [Hash PaymentKey]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CardanoBuildTx
</span><a href="#local-6989586621679467029"><span class="hs-identifier hs-var">utx</span></a></span><span> </span><span class="annot"><span class="annottext">CardanoBuildTx
-&gt; Getting
     (Set (Hash PaymentKey)) CardanoBuildTx (Set (Hash PaymentKey))
-&gt; Set (Hash PaymentKey)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Set (Hash PaymentKey)) CardanoBuildTx (Set (Hash PaymentKey))
Lens' CardanoBuildTx (Set (Hash PaymentKey))
</span><a href="Ledger.Tx.Constraints.OffChain.html#txExtraKeyWits"><span class="hs-identifier hs-var">txExtraKeyWits</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Doc ann -&gt; Doc ann
forall ann. Int -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-identifier hs-var">hang</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Doc ann -&gt; Doc ann) -&gt; Doc ann -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Doc ann] -&gt; Doc ann
forall ann. [Doc ann] -&gt; Doc ann
</span><span class="hs-identifier hs-var">vsep</span></span><span> </span><span class="annot"><span class="annottext">([Doc ann] -&gt; Doc ann) -&gt; [Doc ann] -&gt; Doc ann
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Utxo index:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; [Doc ann] -&gt; [Doc ann]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxIn, TxOut CtxUTxO BabbageEra) -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">((TxIn, TxOut CtxUTxO BabbageEra) -&gt; Doc ann)
-&gt; [(TxIn, TxOut CtxUTxO BabbageEra)] -&gt; [Doc ann]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO BabbageEra)
-&gt; [(TxIn, TxOut CtxUTxO BabbageEra)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">Map TxIn (TxOut CtxUTxO BabbageEra)
</span><a href="#local-6989586621679467027"><span class="hs-identifier hs-var">utxo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-359"></span><span>
</span><span id="line-360"></span><span class="hs-comment">{- Note [Balance of value spent]

To build a transaction that satisfies the 'MustSpendAtLeast' and
'MustProduceAtLeast' constraints, we keep a tally of the required and
actual values we encounter on either side of the transaction. Then we
compute the missing value on both sides, and add an input with the
join of the positive parts [1] of the missing values.

[1] See 'Plutus.V1.Ledger.Value.split'

-}</span><span>
</span><span id="line-371"></span><span>
</span><span id="line-372"></span><span class="hs-comment">-- | The balances we track for computing the missing 'Value' (if any)</span><span>
</span><span id="line-373"></span><span class="hs-comment">--   that needs to be added to the transaction.</span><span>
</span><span id="line-374"></span><span class="hs-comment">--   See note [Balance of value spent].</span><span>
</span><span id="line-375"></span><span id="local-6989586621679467023"><span id="local-6989586621679467024"></span></span><span class="hs-keyword">data</span><span> </span><span id="ValueSpentBalances"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-var">ValueSpentBalances</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-376"></span><span>    </span><span id="ValueSpentBalances"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-var">ValueSpentBalances</span></a></span></span><span>
</span><span id="line-377"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="vbsRequired"><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var hs-var">vbsRequired</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-378"></span><span>        </span><span class="hs-comment">-- ^ Required value spent by the transaction.</span><span>
</span><span id="line-379"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="vbsProvided"><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var hs-var">vbsProvided</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-380"></span><span>        </span><span class="hs-comment">-- ^ Value provided by an input or output of the transaction.</span><span>
</span><span id="line-381"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679467014"><span id="local-6989586621679467016"><span id="local-6989586621679467018"><span class="annot"><span class="annottext">Int -&gt; ValueSpentBalances -&gt; ShowS
[ValueSpentBalances] -&gt; ShowS
ValueSpentBalances -&gt; String
(Int -&gt; ValueSpentBalances -&gt; ShowS)
-&gt; (ValueSpentBalances -&gt; String)
-&gt; ([ValueSpentBalances] -&gt; ShowS)
-&gt; Show ValueSpentBalances
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [ValueSpentBalances] -&gt; ShowS
$cshowList :: [ValueSpentBalances] -&gt; ShowS
show :: ValueSpentBalances -&gt; String
$cshow :: ValueSpentBalances -&gt; String
showsPrec :: Int -&gt; ValueSpentBalances -&gt; ShowS
$cshowsPrec :: Int -&gt; ValueSpentBalances -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. ValueSpentBalances -&gt; Rep ValueSpentBalances x)
-&gt; (forall x. Rep ValueSpentBalances x -&gt; ValueSpentBalances)
-&gt; Generic ValueSpentBalances
forall x. Rep ValueSpentBalances x -&gt; ValueSpentBalances
forall x. ValueSpentBalances -&gt; Rep ValueSpentBalances x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep ValueSpentBalances x -&gt; ValueSpentBalances
$cfrom :: forall x. ValueSpentBalances -&gt; Rep ValueSpentBalances x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-382"></span><span>
</span><span id="line-383"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679467007"><span id="local-6989586621679467009"><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Semigroup</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-384"></span><span>    </span><span id="local-6989586621679467006"><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467006"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621679467005"><span class="annot"><span class="annottext">&lt;&gt; :: ValueSpentBalances -&gt; ValueSpentBalances -&gt; ValueSpentBalances
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var hs-var hs-var hs-var">&lt;&gt;</span></a></span></span><span> </span><span id="local-6989586621679467004"><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467004"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-385"></span><span>        </span><span class="annot"><span class="annottext">ValueSpentBalances :: Value -&gt; Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vbsRequired :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var">vbsRequired</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var hs-var">vbsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467006"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. JoinSemiLattice a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">\/</span></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var hs-var">vbsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467004"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-387"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vbsProvided :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var">vbsProvided</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var hs-var">vbsProvided</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467006"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. JoinSemiLattice a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">\/</span></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var hs-var">vbsProvided</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances
</span><a href="#local-6989586621679467004"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-388"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span class="hs-comment">-- No @Monoid ValueSpentBalances@ because @max@ (used by 'convexUnion') is only</span><span>
</span><span id="line-391"></span><span class="hs-comment">-- a semigroup. In this module we only use @Value@s with non-negative amounts,</span><span>
</span><span id="line-392"></span><span class="hs-comment">-- so @mempty :: Value@ technically is the identity, but I'd rather not</span><span>
</span><span id="line-393"></span><span class="hs-comment">-- define the instance. Maybe we need a type for non-negative @Value@s.</span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-keyword">data</span><span> </span><span id="ConstraintProcessingState"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-var">ConstraintProcessingState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-396"></span><span>    </span><span id="ConstraintProcessingState"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-var">ConstraintProcessingState</span></a></span></span><span>
</span><span id="line-397"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="cpsUnbalancedTx"><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsUnbalancedTx"><span class="hs-identifier hs-var hs-var">cpsUnbalancedTx</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span>
</span><span id="line-398"></span><span>        </span><span class="hs-comment">-- ^ The unbalanced transaction that we're building</span><span>
</span><span id="line-399"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="cpsValueSpentBalancesInputs"><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsValueSpentBalancesInputs"><span class="hs-identifier hs-var hs-var">cpsValueSpentBalancesInputs</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span>
</span><span id="line-400"></span><span>        </span><span class="hs-comment">-- ^ Balance of the values given and required for the transaction's</span><span>
</span><span id="line-401"></span><span>        </span><span class="hs-comment">--   inputs</span><span>
</span><span id="line-402"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="cpsValueSpentBalancesOutputs"><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsValueSpentBalancesOutputs"><span class="hs-identifier hs-var hs-var">cpsValueSpentBalancesOutputs</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span>
</span><span id="line-403"></span><span>        </span><span class="hs-comment">-- ^ Balance of the values produced and required for the transaction's</span><span>
</span><span id="line-404"></span><span>        </span><span class="hs-comment">--   outputs</span><span>
</span><span id="line-405"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="cpsParams"><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsParams"><span class="hs-identifier hs-var hs-var">cpsParams</span></a></span></span><span>                    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span>
</span><span id="line-406"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-407"></span><span>
</span><span id="line-408"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#missingValueSpent"><span class="hs-identifier hs-type">missingValueSpent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-409"></span><span id="missingValueSpent"><span class="annot"><span class="annottext">missingValueSpent :: ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#missingValueSpent"><span class="hs-identifier hs-var hs-var">missingValueSpent</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466998"><span class="annot"><span class="annottext">Value
vbsRequired :: Value
vbsRequired :: ValueSpentBalances -&gt; Value
</span><a href="#local-6989586621679466998"><span class="hs-identifier hs-var hs-var">vbsRequired</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466997"><span class="annot"><span class="annottext">Value
vbsProvided :: Value
vbsProvided :: ValueSpentBalances -&gt; Value
</span><a href="#local-6989586621679466997"><span class="hs-identifier hs-var hs-var">vbsProvided</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-411"></span><span>        </span><span id="local-6989586621679466996"><span class="annot"><span class="annottext">difference :: Value
</span><a href="#local-6989586621679466996"><span class="hs-identifier hs-var hs-var">difference</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466998"><span class="hs-identifier hs-var">vbsRequired</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a
</span><span class="hs-identifier hs-var">N.negate</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466997"><span class="hs-identifier hs-var">vbsProvided</span></a></span><span>
</span><span id="line-412"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466994"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466994"><span class="hs-identifier hs-var">missing</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; (Value, Value)
</span><span class="hs-identifier hs-var">Value.split</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466996"><span class="hs-identifier hs-var">difference</span></a></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466994"><span class="hs-identifier hs-var">missing</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span id="paramsL"><span id="valueSpentOutputs"><span id="valueSpentInputs"><span id="unbalancedTx"><span class="hs-identifier">makeLensesFor</span><span>
</span><span id="line-416"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cpsUnbalancedTx&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;unbalancedTx&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cpsMintRedeemers&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;mintRedeemers&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cpsValueSpentBalancesInputs&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;valueSpentInputs&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-419"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cpsValueSpentBalancesOutputs&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;valueSpentOutputs&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;cpsParams&quot;</span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot;paramsL&quot;</span><span class="hs-special">)</span><span>
</span><span id="line-421"></span><span>    </span><span class="hs-special">]</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">ConstraintProcessingState</span></span></span></span></span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span>
</span><span id="line-424"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: Params -&gt; ConstraintProcessingState
</span><a href="Ledger.Tx.Constraints.OffChain.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span id="local-6989586621679466992"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466992"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState :: UnbalancedTx
-&gt; ValueSpentBalances
-&gt; ValueSpentBalances
-&gt; Params
-&gt; ConstraintProcessingState
</span><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span>
</span><span id="line-425"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cpsUnbalancedTx :: UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsUnbalancedTx"><span class="hs-identifier hs-var">cpsUnbalancedTx</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params -&gt; UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#emptyUnbalancedTx"><span class="hs-identifier hs-var">emptyUnbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466992"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-426"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpsValueSpentBalancesInputs :: ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsValueSpentBalancesInputs"><span class="hs-identifier hs-var">cpsValueSpentBalancesInputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-var">ValueSpentBalances</span></a></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-427"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpsValueSpentBalancesOutputs :: ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsValueSpentBalancesOutputs"><span class="hs-identifier hs-var">cpsValueSpentBalancesOutputs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-var">ValueSpentBalances</span></a></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span>
</span><span id="line-428"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cpsParams :: Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsParams"><span class="hs-identifier hs-var">cpsParams</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466992"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-type">provided</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span>
</span><span id="line-432"></span><span id="provided"><span class="annot"><span class="annottext">provided :: Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var hs-var">provided</span></a></span></span><span> </span><span id="local-6989586621679466991"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466991"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances :: Value -&gt; Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vbsProvided :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var">vbsProvided</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466991"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vbsRequired :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var">vbsRequired</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#required"><span class="hs-identifier hs-type">required</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span>
</span><span id="line-435"></span><span id="required"><span class="annot"><span class="annottext">required :: Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#required"><span class="hs-identifier hs-var hs-var">required</span></a></span></span><span> </span><span id="local-6989586621679466990"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466990"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances :: Value -&gt; Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#ValueSpentBalances"><span class="hs-identifier hs-type">ValueSpentBalances</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">vbsRequired :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsRequired"><span class="hs-identifier hs-var">vbsRequired</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466990"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">vbsProvided :: Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#vbsProvided"><span class="hs-identifier hs-var">vbsProvided</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span class="hs-comment">-- | Some typed 'TxConstraints' and the 'ScriptLookups' needed to turn them</span><span>
</span><span id="line-438"></span><span class="hs-comment">--   into an 'UnbalancedTx'.</span><span>
</span><span id="line-439"></span><span class="hs-keyword">data</span><span> </span><span id="SomeLookupsAndConstraints"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-var">SomeLookupsAndConstraints</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-440"></span><span>    </span><span id="SomeLookupsAndConstraints"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-var">SomeLookupsAndConstraints</span></a></span></span><span>
</span><span id="line-441"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679466988"><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>        </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-443"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466988"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-444"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-type">SomeLookupsAndConstraints</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span id="local-6989586621679466986"><span id="local-6989586621679466987"></span></span><span class="hs-keyword">data</span><span> </span><span id="MkTxError"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-var">MkTxError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-447"></span><span>      </span><span id="TypeCheckFailed"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TypeCheckFailed"><span class="hs-identifier hs-var">TypeCheckFailed</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Typed.ConnectionError</span></span><span>
</span><span id="line-448"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ToCardanoError"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToCardanoError</span></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TxOutRefNotFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNotFound"><span class="hs-identifier hs-var">TxOutRefNotFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TxOutRefWrongType"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefWrongType"><span class="hs-identifier hs-var">TxOutRefWrongType</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TxOutRefNoReferenceScript"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNoReferenceScript"><span class="hs-identifier hs-var">TxOutRefNoReferenceScript</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DatumNotFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumNotFound"><span class="hs-identifier hs-var">DatumNotFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DatumHash</span></span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DeclaredInputMismatch"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredInputMismatch"><span class="hs-identifier hs-var">DeclaredInputMismatch</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DeclaredOutputMismatch"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredOutputMismatch"><span class="hs-identifier hs-var">DeclaredOutputMismatch</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-455"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MintingPolicyNotFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MintingPolicyNotFound"><span class="hs-identifier hs-var">MintingPolicyNotFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicyHash</span></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="ScriptHashNotFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptHashNotFound"><span class="hs-identifier hs-var">ScriptHashNotFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptHash</span></span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="TypedValidatorMissing"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TypedValidatorMissing"><span class="hs-identifier hs-var">TypedValidatorMissing</span></a></span></span><span>
</span><span id="line-458"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DatumWrongHash"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWrongHash"><span class="hs-identifier hs-var">DatumWrongHash</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">DatumHash</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="CannotSatisfyAny"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#CannotSatisfyAny"><span class="hs-identifier hs-var">CannotSatisfyAny</span></a></span></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NoMatchingOutputFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#NoMatchingOutputFound"><span class="hs-identifier hs-var">NoMatchingOutputFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidatorHash</span></span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MultipleMatchingOutputsFound"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MultipleMatchingOutputsFound"><span class="hs-identifier hs-var">MultipleMatchingOutputsFound</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidatorHash</span></span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousRedeemer"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousRedeemer"><span class="hs-identifier hs-var">AmbiguousRedeemer</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Redeemer</span></span><span class="hs-special">]</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="AmbiguousReferenceScript"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousReferenceScript"><span class="hs-identifier hs-var">AmbiguousReferenceScript</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">TxOutRef</span></span><span class="hs-special">]</span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466965"><span id="local-6989586621679466967"><span class="annot"><span class="annottext">MkTxError -&gt; MkTxError -&gt; Bool
(MkTxError -&gt; MkTxError -&gt; Bool)
-&gt; (MkTxError -&gt; MkTxError -&gt; Bool) -&gt; Eq MkTxError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: MkTxError -&gt; MkTxError -&gt; Bool
$c/= :: MkTxError -&gt; MkTxError -&gt; Bool
== :: MkTxError -&gt; MkTxError -&gt; Bool
$c== :: MkTxError -&gt; MkTxError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466959"><span id="local-6989586621679466961"><span id="local-6989586621679466963"><span class="annot"><span class="annottext">Int -&gt; MkTxError -&gt; ShowS
[MkTxError] -&gt; ShowS
MkTxError -&gt; String
(Int -&gt; MkTxError -&gt; ShowS)
-&gt; (MkTxError -&gt; String)
-&gt; ([MkTxError] -&gt; ShowS)
-&gt; Show MkTxError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [MkTxError] -&gt; ShowS
$cshowList :: [MkTxError] -&gt; ShowS
show :: MkTxError -&gt; String
$cshow :: MkTxError -&gt; String
showsPrec :: Int -&gt; MkTxError -&gt; ShowS
$cshowsPrec :: Int -&gt; MkTxError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. MkTxError -&gt; Rep MkTxError x)
-&gt; (forall x. Rep MkTxError x -&gt; MkTxError) -&gt; Generic MkTxError
forall x. Rep MkTxError x -&gt; MkTxError
forall x. MkTxError -&gt; Rep MkTxError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep MkTxError x -&gt; MkTxError
$cfrom :: forall x. MkTxError -&gt; Rep MkTxError x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466949"><span id="local-6989586621679466951"><span id="local-6989586621679466953"><span id="local-6989586621679466955"><span class="annot"><span class="annottext">[MkTxError] -&gt; Encoding
[MkTxError] -&gt; Value
MkTxError -&gt; Encoding
MkTxError -&gt; Value
(MkTxError -&gt; Value)
-&gt; (MkTxError -&gt; Encoding)
-&gt; ([MkTxError] -&gt; Value)
-&gt; ([MkTxError] -&gt; Encoding)
-&gt; ToJSON MkTxError
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [MkTxError] -&gt; Encoding
$ctoEncodingList :: [MkTxError] -&gt; Encoding
toJSONList :: [MkTxError] -&gt; Value
$ctoJSONList :: [MkTxError] -&gt; Value
toEncoding :: MkTxError -&gt; Encoding
$ctoEncoding :: MkTxError -&gt; Encoding
toJSON :: MkTxError -&gt; Value
$ctoJSON :: MkTxError -&gt; Value
</span><a href="#local-6989586621679466949"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466945"><span id="local-6989586621679466947"><span class="annot"><span class="annottext">Value -&gt; Parser [MkTxError]
Value -&gt; Parser MkTxError
(Value -&gt; Parser MkTxError)
-&gt; (Value -&gt; Parser [MkTxError]) -&gt; FromJSON MkTxError
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [MkTxError]
$cparseJSONList :: Value -&gt; Parser [MkTxError]
parseJSON :: Value -&gt; Parser MkTxError
$cparseJSON :: Value -&gt; Parser MkTxError
</span><a href="#local-6989586621679466945"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-466"></span><span id="_AmbiguousReferenceScript"><span id="_AmbiguousRedeemer"><span id="_DeclaredOutputMismatch"><span id="_MkTxError"><span id="local-6989586621679466892"><span id="local-6989586621679466894"><span id="local-6989586621679466896"><span id="local-6989586621679466898"><span id="local-6989586621679466900"><span id="local-6989586621679466902"><span id="local-6989586621679466904"><span id="local-6989586621679466906"><span id="local-6989586621679466908"><span id="local-6989586621679466910"><span id="local-6989586621679466912"><span id="local-6989586621679466914"><span id="local-6989586621679466916"><span id="local-6989586621679466918"><span id="local-6989586621679466920"><span id="local-6989586621679466922"><span id="local-6989586621679466924"><span id="local-6989586621679466926"><span id="local-6989586621679466928"><span id="local-6989586621679466929"><span id="local-6989586621679466930"><span id="local-6989586621679466931"><span id="local-6989586621679466932"><span id="local-6989586621679466933"><span id="local-6989586621679466934"><span id="local-6989586621679466935"><span id="local-6989586621679466936"><span id="local-6989586621679466937"><span id="local-6989586621679466938"><span id="local-6989586621679466939"><span id="local-6989586621679466940"><span id="local-6989586621679466941"><span id="local-6989586621679466942"><span id="local-6989586621679466943"><span id="local-6989586621679466944"><span id="_MultipleMatchingOutputsFound"><span id="_NoMatchingOutputFound"><span id="_CannotSatisfyAny"><span id="_DatumWrongHash"><span id="_TypedValidatorMissing"><span id="_ScriptHashNotFound"><span id="_MintingPolicyNotFound"><span id="_DeclaredInputMismatch"><span id="_DatumNotFound"><span id="_TxOutRefNoReferenceScript"><span id="_TxOutRefWrongType"><span id="_TxOutRefNotFound"><span id="_ToCardanoError"><span id="_TypeCheckFailed"><span id="AsMkTxError"><span id="local-6989586621679467678"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">MkTxError</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679466884"><span class="annot"><span class="hs-identifier hs-type">Pretty</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-469"></span><span>    </span><span id="local-6989586621679466883"><span class="annot"><span class="annottext">pretty :: MkTxError -&gt; Doc ann
</span><a href="#local-6989586621679466883"><span class="hs-identifier hs-var hs-var hs-var hs-var">pretty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-470"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TypeCheckFailed"><span class="hs-identifier hs-type">TypeCheckFailed</span></a></span><span> </span><span id="local-6989586621679466882"><span class="annot"><span class="annottext">ConnectionError
</span><a href="#local-6989586621679466882"><span class="hs-identifier hs-var">e</span></a></span></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Type check failed:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ConnectionError -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ConnectionError
</span><a href="#local-6989586621679466882"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-471"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-type">ToCardanoError</span></a></span><span> </span><span id="local-6989586621679466881"><span class="annot"><span class="annottext">ToCardanoError
</span><a href="#local-6989586621679466881"><span class="hs-identifier hs-var">e</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Cardano conversion error:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ToCardanoError
</span><a href="#local-6989586621679466881"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-472"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNotFound"><span class="hs-identifier hs-type">TxOutRefNotFound</span></a></span><span> </span><span id="local-6989586621679466880"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466880"><span class="hs-identifier hs-var">t</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Tx out reference not found:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466880"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefWrongType"><span class="hs-identifier hs-type">TxOutRefWrongType</span></a></span><span> </span><span id="local-6989586621679466879"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466879"><span class="hs-identifier hs-var">t</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Tx out reference wrong type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466879"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNoReferenceScript"><span class="hs-identifier hs-type">TxOutRefNoReferenceScript</span></a></span><span> </span><span id="local-6989586621679466878"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466878"><span class="hs-identifier hs-var">t</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Tx out reference does not contain a reference script:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466878"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumNotFound"><span class="hs-identifier hs-type">DatumNotFound</span></a></span><span> </span><span id="local-6989586621679466877"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466877"><span class="hs-identifier hs-var">h</span></a></span></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;No datum with hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466877"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;was found in lookups value&quot;</span></span><span>
</span><span id="line-476"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredInputMismatch"><span class="hs-identifier hs-type">DeclaredInputMismatch</span></a></span><span> </span><span id="local-6989586621679466876"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466876"><span class="hs-identifier hs-var">v</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Discrepancy of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466876"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;inputs&quot;</span></span><span>
</span><span id="line-477"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredOutputMismatch"><span class="hs-identifier hs-type">DeclaredOutputMismatch</span></a></span><span> </span><span id="local-6989586621679466875"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466875"><span class="hs-identifier hs-var">v</span></a></span></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Discrepancy of&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466875"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;outputs&quot;</span></span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MintingPolicyNotFound"><span class="hs-identifier hs-type">MintingPolicyNotFound</span></a></span><span> </span><span id="local-6989586621679466874"><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466874"><span class="hs-identifier hs-var">h</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;No minting policy with hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466874"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;was found&quot;</span></span><span>
</span><span id="line-479"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptHashNotFound"><span class="hs-identifier hs-type">ScriptHashNotFound</span></a></span><span> </span><span id="local-6989586621679466873"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679466873"><span class="hs-identifier hs-var">h</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;No script with hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679466873"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;was found&quot;</span></span><span>
</span><span id="line-480"></span><span>        </span><span class="annot"><span class="annottext">MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TypedValidatorMissing"><span class="hs-identifier hs-var">TypedValidatorMissing</span></a></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Script instance is missing&quot;</span></span><span>
</span><span id="line-481"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWrongHash"><span class="hs-identifier hs-type">DatumWrongHash</span></a></span><span> </span><span id="local-6989586621679466872"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466872"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span id="local-6989586621679466871"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466871"><span class="hs-identifier hs-var">d</span></a></span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Wrong hash for datum&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466871"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Doc ann
forall ann. Doc ann
</span><span class="hs-identifier hs-var">colon</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466872"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-482"></span><span>        </span><span class="annot"><span class="annottext">MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#CannotSatisfyAny"><span class="hs-identifier hs-var">CannotSatisfyAny</span></a></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Cannot satisfy any of the required constraints&quot;</span></span><span>
</span><span id="line-483"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#NoMatchingOutputFound"><span class="hs-identifier hs-type">NoMatchingOutputFound</span></a></span><span> </span><span id="local-6989586621679466870"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466870"><span class="hs-identifier hs-var">h</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;No matching output found for validator hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466870"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-484"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MultipleMatchingOutputsFound"><span class="hs-identifier hs-type">MultipleMatchingOutputsFound</span></a></span><span> </span><span id="local-6989586621679466869"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466869"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Multiple matching outputs found for validator hash&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466869"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-485"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousRedeemer"><span class="hs-identifier hs-type">AmbiguousRedeemer</span></a></span><span> </span><span id="local-6989586621679466868"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466868"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679466867"><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621679466867"><span class="hs-identifier hs-var">rs</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Try to spend a script output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466868"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-486"></span><span>                                       </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;with different redeemers:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[Redeemer] -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621679466867"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-487"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousReferenceScript"><span class="hs-identifier hs-type">AmbiguousReferenceScript</span></a></span><span> </span><span id="local-6989586621679466866"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466866"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span id="local-6989586621679466865"><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679466865"><span class="hs-identifier hs-var">rss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;Try to spend a script output&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466866"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-488"></span><span>                                       </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann
</span><span class="hs-string">&quot;with different referenceScript:&quot;</span></span><span> </span><span class="annot"><span class="annottext">Doc ann -&gt; Doc ann -&gt; Doc ann
forall ann. Doc ann -&gt; Doc ann -&gt; Doc ann
</span><span class="hs-operator hs-var">&lt;+&gt;</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span><span class="hs-identifier hs-var">pretty</span></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679466865"><span class="hs-identifier hs-var">rss</span></a></span><span>
</span><span id="line-489"></span><span>
</span><span id="line-490"></span><span class="hs-comment">-- | Given a list of 'SomeLookupsAndConstraints' describing the constraints</span><span>
</span><span id="line-491"></span><span class="hs-comment">--   for several scripts, build a single transaction that runs all the scripts.</span><span>
</span><span id="line-492"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkSomeTx"><span class="hs-identifier hs-type">mkSomeTx</span></a></span><span>
</span><span id="line-493"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span>
</span><span id="line-494"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-type">SomeLookupsAndConstraints</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-495"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span>
</span><span id="line-496"></span><span id="mkSomeTx"><span class="annot"><span class="annottext">mkSomeTx :: Params
-&gt; [SomeLookupsAndConstraints] -&gt; Either MkTxError UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#mkSomeTx"><span class="hs-identifier hs-var hs-var">mkSomeTx</span></a></span></span><span> </span><span id="local-6989586621679466864"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466864"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679466863"><span class="annot"><span class="annottext">[SomeLookupsAndConstraints]
</span><a href="#local-6989586621679466863"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-497"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466862"><span class="annot"><span class="annottext">process :: SomeLookupsAndConstraints
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="#local-6989586621679466862"><span class="hs-identifier hs-var hs-var">process</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-498"></span><span>            </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-type">SomeLookupsAndConstraints</span></a></span><span> </span><span id="local-6989586621679466861"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466861"><span class="hs-identifier hs-var">lookups</span></a></span></span><span> </span><span id="local-6989586621679466860"><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466860"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-499"></span><span>                </span><span class="annot"><span class="annottext">ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
forall a.
(FromData (DatumType a), ToData (DatumType a),
 ToData (RedeemerType a)) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processLookupsAndConstraints"><span class="hs-identifier hs-var">processLookupsAndConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466861"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466860"><span class="hs-identifier hs-var">constraints</span></a></span><span>
</span><span id="line-500"></span><span>    </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">(ConstraintProcessingState -&gt; UnbalancedTx)
-&gt; Either MkTxError ConstraintProcessingState
-&gt; Either MkTxError UnbalancedTx
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsUnbalancedTx"><span class="hs-identifier hs-var hs-var">cpsUnbalancedTx</span></a></span><span>
</span><span id="line-501"></span><span>        </span><span class="annot"><span class="annottext">(Either MkTxError ConstraintProcessingState
 -&gt; Either MkTxError UnbalancedTx)
-&gt; Either MkTxError ConstraintProcessingState
-&gt; Either MkTxError UnbalancedTx
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Except MkTxError ConstraintProcessingState
-&gt; Either MkTxError ConstraintProcessingState
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span>
</span><span id="line-502"></span><span>        </span><span class="annot"><span class="annottext">(Except MkTxError ConstraintProcessingState
 -&gt; Either MkTxError ConstraintProcessingState)
-&gt; Except MkTxError ConstraintProcessingState
-&gt; Either MkTxError ConstraintProcessingState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">StateT ConstraintProcessingState (Except MkTxError) [()]
-&gt; ConstraintProcessingState
-&gt; Except MkTxError ConstraintProcessingState
forall (m :: * -&gt; *) s a. Monad m =&gt; StateT s m a -&gt; s -&gt; m s
</span><span class="hs-identifier hs-var">execStateT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SomeLookupsAndConstraints
 -&gt; StateT ConstraintProcessingState (Except MkTxError) ())
-&gt; [SomeLookupsAndConstraints]
-&gt; StateT ConstraintProcessingState (Except MkTxError) [()]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">SomeLookupsAndConstraints
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="#local-6989586621679466862"><span class="hs-identifier hs-var">process</span></a></span><span> </span><span class="annot"><span class="annottext">[SomeLookupsAndConstraints]
</span><a href="#local-6989586621679466863"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; ConstraintProcessingState
</span><a href="Ledger.Tx.Constraints.OffChain.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466864"><span class="hs-identifier hs-var">params</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span class="hs-keyword">data</span><span> </span><span id="SortedConstraints"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SortedConstraints"><span class="hs-identifier hs-var">SortedConstraints</span></a></span></span><span>
</span><span id="line-505"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="MkSortedConstraints"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkSortedConstraints"><span class="hs-identifier hs-var">MkSortedConstraints</span></a></span></span><span>
</span><span id="line-506"></span><span>   </span><span class="hs-special">{</span><span> </span><span id="rangeConstraints"><span class="annot"><span class="annottext">SortedConstraints -&gt; [POSIXTimeRange]
</span><a href="Ledger.Tx.Constraints.OffChain.html#rangeConstraints"><span class="hs-identifier hs-var hs-var">rangeConstraints</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">POSIXTimeRange</span></span><span class="hs-special">]</span><span>
</span><span id="line-507"></span><span>   </span><span class="hs-special">,</span><span> </span><span id="otherConstraints"><span class="annot"><span class="annottext">SortedConstraints -&gt; [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherConstraints"><span class="hs-identifier hs-var hs-var">otherConstraints</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-508"></span><span>   </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466851"><span id="local-6989586621679466853"><span class="annot"><span class="annottext">SortedConstraints -&gt; SortedConstraints -&gt; Bool
(SortedConstraints -&gt; SortedConstraints -&gt; Bool)
-&gt; (SortedConstraints -&gt; SortedConstraints -&gt; Bool)
-&gt; Eq SortedConstraints
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SortedConstraints -&gt; SortedConstraints -&gt; Bool
$c/= :: SortedConstraints -&gt; SortedConstraints -&gt; Bool
== :: SortedConstraints -&gt; SortedConstraints -&gt; Bool
$c== :: SortedConstraints -&gt; SortedConstraints -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466845"><span id="local-6989586621679466847"><span id="local-6989586621679466849"><span class="annot"><span class="annottext">Int -&gt; SortedConstraints -&gt; ShowS
[SortedConstraints] -&gt; ShowS
SortedConstraints -&gt; String
(Int -&gt; SortedConstraints -&gt; ShowS)
-&gt; (SortedConstraints -&gt; String)
-&gt; ([SortedConstraints] -&gt; ShowS)
-&gt; Show SortedConstraints
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SortedConstraints] -&gt; ShowS
$cshowList :: [SortedConstraints] -&gt; ShowS
show :: SortedConstraints -&gt; String
$cshow :: SortedConstraints -&gt; String
showsPrec :: Int -&gt; SortedConstraints -&gt; ShowS
$cshowsPrec :: Int -&gt; SortedConstraints -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span class="hs-comment">-- | Filtering MustSpend constraints to ensure their consistency and check that we do not try to spend them</span><span>
</span><span id="line-511"></span><span class="hs-comment">-- with different redeemer or reference scripts.</span><span>
</span><span id="line-512"></span><span class="hs-comment">--</span><span>
</span><span id="line-513"></span><span class="hs-comment">-- When:</span><span>
</span><span id="line-514"></span><span class="hs-comment">--     - 2 or more MustSpendPubkeyOutput are defined for the same output, we only keep the first one</span><span>
</span><span id="line-515"></span><span class="hs-comment">--     - 2 or more MustSpendScriptOutpt are defined for the same output:</span><span>
</span><span id="line-516"></span><span class="hs-comment">--          - if they have different redeemer, we throw an 'AmbiguousRedeemer' error;</span><span>
</span><span id="line-517"></span><span class="hs-comment">--          - if they provide more than one reference script we throw an 'AmbiguousReferenceScript' error;</span><span>
</span><span id="line-518"></span><span class="hs-comment">--          - if only one define a reference script, we use that reference script.</span><span>
</span><span id="line-519"></span><span id="local-6989586621679467569"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-type">cleaningMustSpendConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-520"></span><span id="cleaningMustSpendConstraints"><span class="annot"><span class="annottext">cleaningMustSpendConstraints :: [TxConstraint] -&gt; m [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var hs-var">cleaningMustSpendConstraints</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466843"><span class="annot"><span class="annottext">x :: TxConstraint
</span><a href="#local-6989586621679466843"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span id="local-6989586621679466841"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679466840"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466840"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-521"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-522"></span><span>        </span><span id="local-6989586621679466839"><span class="annot"><span class="annottext">spendSame :: TxConstraint -&gt; Bool
</span><a href="#local-6989586621679466839"><span class="hs-identifier hs-var hs-var">spendSame</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span id="local-6989586621679466838"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466838"><span class="hs-identifier hs-var">t'</span></a></span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; TxOutRef -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466838"><span class="hs-identifier hs-var">t'</span></a></span><span>
</span><span id="line-523"></span><span>        </span><span class="annot"><a href="#local-6989586621679466839"><span class="hs-identifier hs-var">spendSame</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-524"></span><span>        </span><span id="local-6989586621679466837"><span class="annot"><span class="annottext">getRedeemer :: TxConstraint -&gt; Maybe Redeemer
</span><a href="#local-6989586621679466837"><span class="hs-identifier hs-var hs-var">getRedeemer</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679466836"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466836"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Maybe Redeemer
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466836"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-525"></span><span>        </span><span class="annot"><a href="#local-6989586621679466837"><span class="hs-identifier hs-var">getRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
</span><span class="hs-identifier">_</span></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Redeemer
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-526"></span><span>        </span><span id="local-6989586621679466835"><span class="annot"><span class="annottext">getReferenceScript :: TxConstraint -&gt; Maybe TxOutRef
</span><a href="#local-6989586621679466835"><span class="hs-identifier hs-var hs-var">getReferenceScript</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679466834"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466834"><span class="hs-identifier hs-var">rs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466834"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><a href="#local-6989586621679466835"><span class="hs-identifier hs-var">getReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
</span><span class="hs-identifier">_</span></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-528"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621679466833"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466833"><span class="hs-identifier hs-var">mustSpendSame</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466832"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466832"><span class="hs-identifier hs-var">otherConstraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; Bool)
-&gt; [TxConstraint] -&gt; ([TxConstraint], [TxConstraint])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">List.partition</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; Bool
</span><a href="#local-6989586621679466839"><span class="hs-identifier hs-var">spendSame</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466840"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-529"></span><span>        </span><span id="local-6989586621679466830"><span class="annot"><span class="annottext">redeemers :: Set Redeemer
</span><a href="#local-6989586621679466830"><span class="hs-identifier hs-var hs-var">redeemers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Redeemer] -&gt; Set Redeemer
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([Redeemer] -&gt; Set Redeemer) -&gt; [Redeemer] -&gt; Set Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; Maybe Redeemer) -&gt; [TxConstraint] -&gt; [Redeemer]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; Maybe Redeemer
</span><a href="#local-6989586621679466837"><span class="hs-identifier hs-var">getRedeemer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466843"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">TxConstraint -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466833"><span class="hs-identifier hs-var">mustSpendSame</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-530"></span><span>        </span><span id="local-6989586621679466829"><span class="annot"><span class="annottext">referenceScripts :: Set TxOutRef
</span><a href="#local-6989586621679466829"><span class="hs-identifier hs-var hs-var">referenceScripts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxOutRef] -&gt; Set TxOutRef
forall a. Ord a =&gt; [a] -&gt; Set a
</span><span class="hs-identifier hs-var">Set.fromList</span></span><span> </span><span class="annot"><span class="annottext">([TxOutRef] -&gt; Set TxOutRef) -&gt; [TxOutRef] -&gt; Set TxOutRef
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; Maybe TxOutRef) -&gt; [TxConstraint] -&gt; [TxOutRef]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; Maybe TxOutRef
</span><a href="#local-6989586621679466835"><span class="hs-identifier hs-var">getReferenceScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466843"><span class="hs-identifier hs-var">x</span></a></span><span class="annot"><span class="annottext">TxConstraint -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466833"><span class="hs-identifier hs-var">mustSpendSame</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-531"></span><span>    </span><span id="local-6989586621679466828"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466828"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set Redeemer -&gt; [Redeemer]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set Redeemer
</span><a href="#local-6989586621679466830"><span class="hs-identifier hs-var">redeemers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-532"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m Redeemer
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m Redeemer) -&gt; MkTxError -&gt; m Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; [Redeemer] -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousRedeemer"><span class="hs-identifier hs-var">AmbiguousRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Can't happen as x must have a redeemer</span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-special">[</span><span id="local-6989586621679466827"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466827"><span class="hs-identifier hs-var">red</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; m Redeemer
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466827"><span class="hs-identifier hs-var">red</span></a></span><span>
</span><span id="line-534"></span><span>                </span><span id="local-6989586621679466826"><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621679466826"><span class="hs-identifier hs-var">rs</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m Redeemer
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m Redeemer) -&gt; MkTxError -&gt; m Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; [Redeemer] -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousRedeemer"><span class="hs-identifier hs-var">AmbiguousRedeemer</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[Redeemer]
</span><a href="#local-6989586621679466826"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-535"></span><span>    </span><span id="local-6989586621679466825"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466825"><span class="hs-identifier hs-var">rs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Set TxOutRef -&gt; [TxOutRef]
forall a. Set a -&gt; [a]
</span><span class="hs-identifier hs-var">Set.toList</span></span><span> </span><span class="annot"><span class="annottext">Set TxOutRef
</span><a href="#local-6989586621679466829"><span class="hs-identifier hs-var">referenceScripts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-536"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef -&gt; m (Maybe TxOutRef)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-537"></span><span>                </span><span class="hs-special">[</span><span id="local-6989586621679466824"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466824"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef -&gt; m (Maybe TxOutRef)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe TxOutRef -&gt; m (Maybe TxOutRef))
-&gt; Maybe TxOutRef -&gt; m (Maybe TxOutRef)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Maybe TxOutRef
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466824"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-538"></span><span>                </span><span id="local-6989586621679466823"><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679466823"><span class="hs-identifier hs-var">rs</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m (Maybe TxOutRef)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m (Maybe TxOutRef))
-&gt; MkTxError -&gt; m (Maybe TxOutRef)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; [TxOutRef] -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#AmbiguousReferenceScript"><span class="hs-identifier hs-var">AmbiguousReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">[TxOutRef]
</span><a href="#local-6989586621679466823"><span class="hs-identifier hs-var">rs</span></a></span><span>
</span><span id="line-539"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; Maybe TxOutRef -&gt; TxConstraint
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-var">MustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466841"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466828"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466825"><span class="hs-identifier hs-var">rs</span></a></span><span class="annot"><span class="annottext">TxConstraint -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TxConstraint] -&gt; [TxConstraint])
-&gt; m [TxConstraint] -&gt; m [TxConstraint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; m [TxConstraint]
forall (m :: * -&gt; *).
MonadError MkTxError m =&gt;
[TxConstraint] -&gt; m [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466832"><span class="hs-identifier hs-var">otherConstraints</span></a></span><span>
</span><span id="line-540"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466822"><span class="annot"><span class="annottext">x :: TxConstraint
</span><a href="#local-6989586621679466822"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendPubKeyOutput"><span class="hs-identifier hs-type">MustSpendPubKeyOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679466820"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466820"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-541"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466822"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TxConstraint] -&gt; [TxConstraint])
-&gt; m [TxConstraint] -&gt; m [TxConstraint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; m [TxConstraint]
forall (m :: * -&gt; *).
MonadError MkTxError m =&gt;
[TxConstraint] -&gt; m [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxConstraint -&gt; Bool) -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466822"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; TxConstraint -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">/=</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466820"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; m [TxConstraint]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-543"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466818"><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466818"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679466817"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466817"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466818"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. a -&gt; [a] -&gt; [a]
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-var">:</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([TxConstraint] -&gt; [TxConstraint])
-&gt; m [TxConstraint] -&gt; m [TxConstraint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; m [TxConstraint]
forall (m :: * -&gt; *).
MonadError MkTxError m =&gt;
[TxConstraint] -&gt; m [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466817"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-544"></span><span>
</span><span id="line-545"></span><span id="local-6989586621679467539"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#prepareConstraints"><span class="hs-identifier hs-type">prepareConstraints</span></a></span><span>
</span><span id="line-546"></span><span>    </span><span class="hs-glyph">::</span><span>
</span><span id="line-547"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-548"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier hs-type">ScriptInputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-552"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier hs-type">ScriptOutputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-553"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-554"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467539"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#SortedConstraints"><span class="hs-identifier hs-type">SortedConstraints</span></a></span></span><span>
</span><span id="line-555"></span><span id="prepareConstraints"><span class="annot"><span class="annottext">prepareConstraints :: [ScriptInputConstraint (RedeemerType a)]
-&gt; [ScriptOutputConstraint (DatumType a)]
-&gt; [TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SortedConstraints
</span><a href="Ledger.Tx.Constraints.OffChain.html#prepareConstraints"><span class="hs-identifier hs-var hs-var">prepareConstraints</span></a></span></span><span> </span><span id="local-6989586621679466816"><span class="annot"><span class="annottext">[ScriptInputConstraint (RedeemerType a)]
</span><a href="#local-6989586621679466816"><span class="hs-identifier hs-var">ownInputs</span></a></span></span><span> </span><span id="local-6989586621679466815"><span class="annot"><span class="annottext">[ScriptOutputConstraint (DatumType a)]
</span><a href="#local-6989586621679466815"><span class="hs-identifier hs-var">ownOutputs</span></a></span></span><span> </span><span id="local-6989586621679466814"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466814"><span class="hs-identifier hs-var">constraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-556"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-557"></span><span>      </span><span id="local-6989586621679466813"><span class="annot"><span class="annottext">extractPosixTimeRange :: TxConstraint -&gt; Either POSIXTimeRange TxConstraint
</span><a href="#local-6989586621679466813"><span class="hs-identifier hs-var hs-var">extractPosixTimeRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-558"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustValidateInTimeRange"><span class="hs-identifier hs-type">MustValidateInTimeRange</span></a></span><span> </span><span id="local-6989586621679466811"><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466811"><span class="hs-identifier hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; Either POSIXTimeRange TxConstraint
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTimeRange -&gt; Either POSIXTimeRange TxConstraint)
-&gt; POSIXTimeRange -&gt; Either POSIXTimeRange TxConstraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; POSIXTimeRange
forall a. ValidityInterval a -&gt; Interval a
</span><a href="Ledger.Tx.Constraints.ValidityInterval.html#toPlutusInterval"><span class="hs-identifier hs-var">toPlutusInterval</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466811"><span class="hs-identifier hs-var">range</span></a></span><span>
</span><span id="line-559"></span><span>        </span><span id="local-6989586621679466810"><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466810"><span class="hs-identifier hs-var">other</span></a></span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; Either POSIXTimeRange TxConstraint
forall a b. b -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
</span><a href="#local-6989586621679466810"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-560"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679466809"><span class="annot"><span class="annottext">[POSIXTimeRange]
</span><a href="#local-6989586621679466809"><span class="hs-identifier hs-var">ranges</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466808"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466808"><span class="hs-identifier hs-var">_nonRangeConstraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either POSIXTimeRange TxConstraint]
-&gt; ([POSIXTimeRange], [TxConstraint])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">([Either POSIXTimeRange TxConstraint]
 -&gt; ([POSIXTimeRange], [TxConstraint]))
-&gt; [Either POSIXTimeRange TxConstraint]
-&gt; ([POSIXTimeRange], [TxConstraint])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint -&gt; Either POSIXTimeRange TxConstraint
</span><a href="#local-6989586621679466813"><span class="hs-identifier hs-var">extractPosixTimeRange</span></a></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; Either POSIXTimeRange TxConstraint)
-&gt; [TxConstraint] -&gt; [Either POSIXTimeRange TxConstraint]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466814"><span class="hs-identifier hs-var">constraints</span></a></span><span>
</span><span id="line-561"></span><span>    </span><span id="local-6989586621679466807"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466807"><span class="hs-identifier hs-var">ownInputConstraints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScriptInputConstraint (RedeemerType a)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxConstraint)
-&gt; [ScriptInputConstraint (RedeemerType a)]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     [TxConstraint]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptInputConstraint (RedeemerType a)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxConstraint
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m,
 FromData (DatumType a), ToData (DatumType a),
 ToData (RedeemerType a)) =&gt;
ScriptInputConstraint (RedeemerType a) -&gt; m TxConstraint
</span><a href="Ledger.Tx.Constraints.OffChain.html#addOwnInput"><span class="hs-identifier hs-var">addOwnInput</span></a></span><span> </span><span class="annot"><span class="annottext">[ScriptInputConstraint (RedeemerType a)]
</span><a href="#local-6989586621679466816"><span class="hs-identifier hs-var">ownInputs</span></a></span><span>
</span><span id="line-562"></span><span>    </span><span id="local-6989586621679466806"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466806"><span class="hs-identifier hs-var">ownOutputConstraints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScriptOutputConstraint (DatumType a)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxConstraint)
-&gt; [ScriptOutputConstraint (DatumType a)]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     [TxConstraint]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptOutputConstraint (DatumType a)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxConstraint
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m,
 ToData (DatumType a)) =&gt;
ScriptOutputConstraint (DatumType a) -&gt; m TxConstraint
</span><a href="Ledger.Tx.Constraints.OffChain.html#addOwnOutput"><span class="hs-identifier hs-var">addOwnOutput</span></a></span><span> </span><span class="annot"><span class="annottext">[ScriptOutputConstraint (DatumType a)]
</span><a href="#local-6989586621679466815"><span class="hs-identifier hs-var">ownOutputs</span></a></span><span>
</span><span id="line-563"></span><span>    </span><span id="local-6989586621679466805"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466805"><span class="hs-identifier hs-var">cleanedConstraints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     [TxConstraint]
forall (m :: * -&gt; *).
MonadError MkTxError m =&gt;
[TxConstraint] -&gt; m [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#cleaningMustSpendConstraints"><span class="hs-identifier hs-var">cleaningMustSpendConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466814"><span class="hs-identifier hs-var">constraints</span></a></span><span>
</span><span id="line-564"></span><span>    </span><span class="annot"><span class="annottext">SortedConstraints
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SortedConstraints
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(SortedConstraints
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      SortedConstraints)
-&gt; SortedConstraints
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SortedConstraints
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[POSIXTimeRange] -&gt; [TxConstraint] -&gt; SortedConstraints
</span><a href="Ledger.Tx.Constraints.OffChain.html#MkSortedConstraints"><span class="hs-identifier hs-var">MkSortedConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[POSIXTimeRange]
</span><a href="#local-6989586621679466809"><span class="hs-identifier hs-var">ranges</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466805"><span class="hs-identifier hs-var">cleanedConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466806"><span class="hs-identifier hs-var">ownOutputConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint] -&gt; [TxConstraint] -&gt; [TxConstraint]
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466807"><span class="hs-identifier hs-var">ownInputConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span class="hs-comment">-- | Resolve some 'TxConstraints' by modifying the 'UnbalancedTx' in the</span><span>
</span><span id="line-568"></span><span class="hs-comment">--   'ConstraintProcessingState'</span><span>
</span><span id="line-569"></span><span id="local-6989586621679467594"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#processLookupsAndConstraints"><span class="hs-identifier hs-type">processLookupsAndConstraints</span></a></span><span>
</span><span id="line-570"></span><span>    </span><span class="hs-glyph">::</span><span>
</span><span id="line-571"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-572"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-573"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-575"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-576"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467594"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-578"></span><span id="processLookupsAndConstraints"><span class="annot"><span class="annottext">processLookupsAndConstraints :: ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processLookupsAndConstraints"><span class="hs-identifier hs-var hs-var">processLookupsAndConstraints</span></a></span></span><span> </span><span id="local-6989586621679466804"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466804"><span class="hs-identifier hs-var">lookups</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466802"><span class="annot"><span class="annottext">[TxConstraint]
txConstraints :: forall i o. TxConstraints i o -&gt; [TxConstraint]
txConstraints :: [TxConstraint]
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#txConstraints"><span class="hs-identifier hs-var hs-var">txConstraints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466800"><span class="annot"><span class="annottext">[ScriptInputConstraint (RedeemerType a)]
txOwnInputs :: forall i o. TxConstraints i o -&gt; [ScriptInputConstraint i]
txOwnInputs :: [ScriptInputConstraint (RedeemerType a)]
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#txOwnInputs"><span class="hs-identifier hs-var hs-var">txOwnInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txConstraintFuns :: forall i o. TxConstraints i o -&gt; TxConstraintFuns
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#txConstraintFuns"><span class="hs-identifier hs-var">txConstraintFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFuns"><span class="hs-identifier hs-type">TxConstraintFuns</span></a></span><span> </span><span id="local-6989586621679466796"><span class="annot"><span class="annottext">[TxConstraintFun]
</span><a href="#local-6989586621679466796"><span class="hs-identifier hs-var">txCnsFuns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466795"><span class="annot"><span class="annottext">[ScriptOutputConstraint (DatumType a)]
txOwnOutputs :: forall i o. TxConstraints i o -&gt; [ScriptOutputConstraint o]
txOwnOutputs :: [ScriptOutputConstraint (DatumType a)]
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#txOwnOutputs"><span class="hs-identifier hs-var hs-var">txOwnOutputs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-579"></span><span>        </span><span class="annot"><span class="annottext">(ReaderT
   (ScriptLookups a)
   (StateT ConstraintProcessingState (Except MkTxError))
   ()
 -&gt; ScriptLookups a
 -&gt; StateT ConstraintProcessingState (Except MkTxError) ())
-&gt; ScriptLookups a
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
-&gt; ScriptLookups a
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
forall r (m :: * -&gt; *) a. ReaderT r m a -&gt; r -&gt; m a
</span><span class="hs-identifier hs-var hs-var">runReaderT</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466804"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">(ReaderT
   (ScriptLookups a)
   (StateT ConstraintProcessingState (Except MkTxError))
   ()
 -&gt; StateT ConstraintProcessingState (Except MkTxError) ())
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-580"></span><span>            </span><span id="local-6989586621679466792"><span class="annot"><span class="annottext">SortedConstraints
</span><a href="#local-6989586621679466792"><span class="hs-identifier hs-var">sortedConstraints</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ScriptInputConstraint (RedeemerType a)]
-&gt; [ScriptOutputConstraint (DatumType a)]
-&gt; [TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SortedConstraints
forall a.
(FromData (DatumType a), ToData (DatumType a),
 ToData (RedeemerType a)) =&gt;
[ScriptInputConstraint (RedeemerType a)]
-&gt; [ScriptOutputConstraint (DatumType a)]
-&gt; [TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SortedConstraints
</span><a href="Ledger.Tx.Constraints.OffChain.html#prepareConstraints"><span class="hs-identifier hs-var">prepareConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">[ScriptInputConstraint (RedeemerType a)]
</span><a href="#local-6989586621679466800"><span class="hs-identifier hs-var">txOwnInputs</span></a></span><span> </span><span class="annot"><span class="annottext">[ScriptOutputConstraint (DatumType a)]
</span><a href="#local-6989586621679466795"><span class="hs-identifier hs-var">txOwnOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466802"><span class="hs-identifier hs-var">txConstraints</span></a></span><span>
</span><span id="line-581"></span><span>            </span><span class="annot"><span class="annottext">(TxConstraint
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; [TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a.
TxConstraint
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processConstraint"><span class="hs-identifier hs-var">processConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SortedConstraints -&gt; [TxConstraint]
</span><a href="Ledger.Tx.Constraints.OffChain.html#otherConstraints"><span class="hs-identifier hs-var hs-var">otherConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SortedConstraints
</span><a href="#local-6989586621679466792"><span class="hs-identifier hs-var">sortedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-582"></span><span>            </span><span class="annot"><span class="annottext">(TxConstraintFun
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; [TxConstraintFun]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraintFun
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a.
TxConstraintFun
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processConstraintFun"><span class="hs-identifier hs-var">processConstraintFun</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraintFun]
</span><a href="#local-6989586621679466796"><span class="hs-identifier hs-var">txCnsFuns</span></a></span><span>
</span><span id="line-583"></span><span>            </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m,
 MonadState ConstraintProcessingState m, MonadError MkTxError m) =&gt;
m ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#checkValueSpent"><span class="hs-identifier hs-var">checkValueSpent</span></a></span><span>
</span><span id="line-584"></span><span>            </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m,
 MonadState ConstraintProcessingState m, MonadError MkTxError m) =&gt;
m ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#updateUtxoIndex"><span class="hs-identifier hs-var">updateUtxoIndex</span></a></span><span>
</span><span id="line-585"></span><span>            </span><span class="annot"><span class="annottext">StateT ConstraintProcessingState (Except MkTxError) ()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (t :: (* -&gt; *) -&gt; * -&gt; *) (m :: * -&gt; *) a.
(MonadTrans t, Monad m) =&gt;
m a -&gt; t m a
</span><span class="hs-identifier hs-var">lift</span></span><span> </span><span class="annot"><span class="annottext">(StateT ConstraintProcessingState (Except MkTxError) ()
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[POSIXTimeRange]
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#setValidityRange"><span class="hs-identifier hs-var">setValidityRange</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SortedConstraints -&gt; [POSIXTimeRange]
</span><a href="Ledger.Tx.Constraints.OffChain.html#rangeConstraints"><span class="hs-identifier hs-var hs-var">rangeConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SortedConstraints
</span><a href="#local-6989586621679466792"><span class="hs-identifier hs-var">sortedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-586"></span><span>
</span><span id="line-587"></span><span id="local-6989586621679467533"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#processConstraintFun"><span class="hs-identifier hs-type">processConstraintFun</span></a></span><span>
</span><span id="line-588"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFun"><span class="hs-identifier hs-type">TxConstraintFun</span></a></span><span>
</span><span id="line-589"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467533"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-590"></span><span id="processConstraintFun"><span class="annot"><span class="annottext">processConstraintFun :: TxConstraintFun
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processConstraintFun"><span class="hs-identifier hs-var hs-var">processConstraintFun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-591"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutputWithMatchingDatumAndValue"><span class="hs-identifier hs-type">MustSpendScriptOutputWithMatchingDatumAndValue</span></a></span><span> </span><span id="local-6989586621679466788"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466788"><span class="hs-identifier hs-var">vh</span></a></span></span><span> </span><span id="local-6989586621679466787"><span class="annot"><span class="annottext">Datum -&gt; Bool
</span><a href="#local-6989586621679466787"><span class="hs-identifier hs-var">datumPred</span></a></span></span><span> </span><span id="local-6989586621679466786"><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="#local-6989586621679466786"><span class="hs-identifier hs-var">valuePred</span></a></span></span><span> </span><span id="local-6989586621679466785"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466785"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-592"></span><span>        </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466784"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
slTxOutputs :: Map TxOutRef DecoratedTxOut
slTxOutputs :: forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466784"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  (ScriptLookups a)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-comment">-- TODO: Need to precalculate the validator hash or else this won't work</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-comment">-- with PlutusV2 validator. This means changing `DecoratedTxOut` to</span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-comment">-- include the hash.</span><span>
</span><span id="line-596"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466783"><span class="annot"><span class="annottext">matches :: Maybe (Versioned Validator, DatumWithOrigin, Value) -&gt; Bool
</span><a href="#local-6989586621679466783"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned Validator
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466782"><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466782"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466781"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466781"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Bool
</span><a href="#local-6989586621679466787"><span class="hs-identifier hs-var">datumPred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumWithOrigin -&gt; Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#getDatum"><span class="hs-identifier hs-var hs-var">getDatum</span></a></span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466782"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&amp;&amp;</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="#local-6989586621679466786"><span class="hs-identifier hs-var">valuePred</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466781"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-597"></span><span>            </span><span class="annot"><a href="#local-6989586621679466783"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator, DatumWithOrigin, Value)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>        </span><span id="local-6989586621679466778"><span class="annot"><span class="annottext">[(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))]
</span><a href="#local-6989586621679466778"><span class="hs-identifier hs-var">opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
 -&gt; [(TxOutRef,
      Maybe (Versioned Validator, DatumWithOrigin, Value))])
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Map
        TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     [(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
-&gt; [(TxOutRef,
     Maybe (Versioned Validator, DatumWithOrigin, Value))]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">Map.toList</span></span><span> </span><span class="annot"><span class="annottext">(Map TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
 -&gt; [(TxOutRef,
      Maybe (Versioned Validator, DatumWithOrigin, Value))])
-&gt; (Map
      TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
    -&gt; Map
         TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
-&gt; Map
     TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
-&gt; [(TxOutRef,
     Maybe (Versioned Validator, DatumWithOrigin, Value))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Versioned Validator, DatumWithOrigin, Value) -&gt; Bool)
-&gt; Map
     TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
-&gt; Map
     TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator, DatumWithOrigin, Value) -&gt; Bool
</span><a href="#local-6989586621679466783"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>                </span><span class="annot"><span class="annottext">(ReaderT
   (ScriptLookups a)
   (StateT ConstraintProcessingState (Except MkTxError))
   (Map
      TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      [(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))])
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Map
        TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     [(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DecoratedTxOut
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Maybe (Versioned Validator, DatumWithOrigin, Value)))
-&gt; Map TxOutRef DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Map
        TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Maybe (Versioned Validator, DatumWithOrigin, Value))
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DecoratedTxOut
-&gt; m (Maybe (Versioned Validator, DatumWithOrigin, Value))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOut"><span class="hs-identifier hs-var">resolveScriptTxOut</span></a></span><span>
</span><span id="line-601"></span><span>                </span><span class="annot"><span class="annottext">(Map TxOutRef DecoratedTxOut
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Map
         TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value))))
-&gt; Map TxOutRef DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Map
        TxOutRef (Maybe (Versioned Validator, DatumWithOrigin, Value)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DecoratedTxOut -&gt; Bool)
-&gt; Map TxOutRef DecoratedTxOut -&gt; Map TxOutRef DecoratedTxOut
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe ValidatorHash -&gt; Maybe ValidatorHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; Maybe ValidatorHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466788"><span class="hs-identifier hs-var">vh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe ValidatorHash -&gt; Bool)
-&gt; (DecoratedTxOut -&gt; Maybe ValidatorHash)
-&gt; DecoratedTxOut
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (First ValidatorHash) DecoratedTxOut ValidatorHash
-&gt; DecoratedTxOut -&gt; Maybe ValidatorHash
forall s (m :: * -&gt; *) a.
MonadReader s m =&gt;
Getting (First a) s a -&gt; m (Maybe a)
</span><span class="hs-identifier hs-var">preview</span></span><span> </span><span class="annot"><span class="annottext">Getting (First ValidatorHash) DecoratedTxOut ValidatorHash
Traversal' DecoratedTxOut ValidatorHash
</span><span class="hs-identifier hs-var">Tx.decoratedTxOutValidatorHash</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466784"><span class="hs-identifier hs-var">slTxOutputs</span></a></span><span>
</span><span id="line-602"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))]
</span><a href="#local-6989586621679466778"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-603"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#NoMatchingOutputFound"><span class="hs-identifier hs-var">NoMatchingOutputFound</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466788"><span class="hs-identifier hs-var">vh</span></a></span><span>
</span><span id="line-604"></span><span>            </span><span class="hs-special">[</span><span class="hs-special">(</span><span id="local-6989586621679466774"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466774"><span class="hs-identifier hs-var">ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466773"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466773"><span class="hs-identifier hs-var">validator</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466772"><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466772"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466771"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466771"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-605"></span><span>                </span><span id="local-6989586621679466770"><span class="annot"><span class="annottext">WitnessHeader
</span><a href="#local-6989586621679466770"><span class="hs-identifier hs-var">mkWitness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError WitnessHeader
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      WitnessHeader)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Script -&gt; Either ToCardanoError WitnessHeader
</span><span class="hs-identifier hs-var">C.toCardanoTxInScriptWitnessHeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validator -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getValidator</span></span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; Script) -&gt; Versioned Validator -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466773"><span class="hs-identifier hs-var">validator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>                </span><span id="local-6989586621679466767"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466767"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466774"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-607"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466765"><span class="annot"><span class="annottext">witness :: Witness WitCtxTxIn BabbageEra
</span><a href="#local-6989586621679466765"><span class="hs-identifier hs-var hs-var">witness</span></a></span></span><span>
</span><span id="line-608"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn BabbageEra
-&gt; Witness WitCtxTxIn BabbageEra
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">C.ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">C.ScriptWitnessForSpending</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn BabbageEra
 -&gt; Witness WitCtxTxIn BabbageEra)
-&gt; ScriptWitness WitCtxTxIn BabbageEra
-&gt; Witness WitCtxTxIn BabbageEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-609"></span><span>                            </span><span class="annot"><span class="annottext">WitnessHeader
</span><a href="#local-6989586621679466770"><span class="hs-identifier hs-var">mkWitness</span></a></span><span>
</span><span id="line-610"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Datum -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">C.toCardanoDatumWitness</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; ScriptDatum WitCtxTxIn)
-&gt; Maybe Datum -&gt; ScriptDatum WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin -&gt; Maybe Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier hs-var">datumWitness</span></a></span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466772"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-611"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; ScriptData
</span><span class="hs-identifier hs-var">C.toCardanoScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Redeemer -&gt; BuiltinData
</span><span class="hs-identifier hs-var hs-var">getRedeemer</span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466785"><span class="hs-identifier hs-var">red</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-612"></span><span>                            </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">C.zeroExecutionUnits</span></span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span>                </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
 -&gt; Identity
      [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txIns"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="annot"><span class="annottext">(([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
  -&gt; Identity
       [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466767"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn BabbageEra
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">C.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn BabbageEra
</span><a href="#local-6989586621679466765"><span class="hs-identifier hs-var">witness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-615"></span><span>
</span><span id="line-616"></span><span>                </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466771"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-617"></span><span>            </span><span class="annot"><span class="annottext">[(TxOutRef, Maybe (Versioned Validator, DatumWithOrigin, Value))]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#MultipleMatchingOutputsFound"><span class="hs-identifier hs-var">MultipleMatchingOutputsFound</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466788"><span class="hs-identifier hs-var">vh</span></a></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="hs-keyword">data</span><span> </span><span id="DatumWithOrigin"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWithOrigin"><span class="hs-identifier hs-var">DatumWithOrigin</span></a></span></span><span>
</span><span id="line-620"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="DatumInTx"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumInTx"><span class="hs-identifier hs-var">DatumInTx</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getDatum"><span class="annot"><span class="annottext">DatumWithOrigin -&gt; Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#getDatum"><span class="hs-identifier hs-var hs-var">getDatum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-621"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="DatumInline"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumInline"><span class="hs-identifier hs-var">DatumInline</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="getDatum"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#getDatum"><span class="hs-identifier hs-var">getDatum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier hs-type">datumWitness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWithOrigin"><span class="hs-identifier hs-type">DatumWithOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span>
</span><span id="line-624"></span><span id="datumWitness"><span class="annot"><span class="annottext">datumWitness :: DatumWithOrigin -&gt; Maybe Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier hs-var hs-var">datumWitness</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumInTx"><span class="hs-identifier hs-type">DatumInTx</span></a></span><span> </span><span id="local-6989586621679466756"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466756"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Maybe Datum
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466756"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-625"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier hs-var">datumWitness</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumInline"><span class="hs-identifier hs-type">DatumInline</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Datum
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-626"></span><span>
</span><span id="line-627"></span><span id="local-6989586621679467531"><span id="local-6989586621679467532"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#checkValueSpent"><span class="hs-identifier hs-type">checkValueSpent</span></a></span><span>
</span><span id="line-628"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467532"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467531"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-629"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467531"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-630"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467531"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467531"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-633"></span><span id="checkValueSpent"><span class="annot"><span class="annottext">checkValueSpent :: m ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#checkValueSpent"><span class="hs-identifier hs-var hs-var">checkValueSpent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-634"></span><span>    </span><span id="local-6989586621679466755"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466755"><span class="hs-identifier hs-var">missingInputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const Value) ConstraintProcessingState ValueSpentBalances
-&gt; (ValueSpentBalances -&gt; Value) -&gt; m Value
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const Value) ConstraintProcessingState ValueSpentBalances
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#missingValueSpent"><span class="hs-identifier hs-var">missingValueSpent</span></a></span><span>
</span><span id="line-635"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><span class="hs-identifier hs-var">Value.isZero</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466755"><span class="hs-identifier hs-var">missingInputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m ()) -&gt; MkTxError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredInputMismatch"><span class="hs-identifier hs-var">DeclaredInputMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466755"><span class="hs-identifier hs-var">missingInputs</span></a></span><span>
</span><span id="line-636"></span><span>    </span><span id="local-6989586621679466752"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466752"><span class="hs-identifier hs-var">missingOutputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const Value) ConstraintProcessingState ValueSpentBalances
-&gt; (ValueSpentBalances -&gt; Value) -&gt; m Value
forall s (m :: * -&gt; *) r a.
MonadState s m =&gt;
LensLike' (Const r) s a -&gt; (a -&gt; r) -&gt; m r
</span><span class="hs-identifier hs-var">uses</span></span><span> </span><span class="annot"><span class="annottext">LensLike'
  (Const Value) ConstraintProcessingState ValueSpentBalances
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentOutputs"><span class="hs-identifier hs-var">valueSpentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">ValueSpentBalances -&gt; Value
</span><a href="Ledger.Tx.Constraints.OffChain.html#missingValueSpent"><span class="hs-identifier hs-var">missingValueSpent</span></a></span><span>
</span><span id="line-637"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><span class="hs-identifier hs-var">Value.isZero</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466752"><span class="hs-identifier hs-var">missingOutputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m ()) -&gt; MkTxError -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#DeclaredOutputMismatch"><span class="hs-identifier hs-var">DeclaredOutputMismatch</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466752"><span class="hs-identifier hs-var">missingOutputs</span></a></span><span>
</span><span id="line-638"></span><span>
</span><span id="line-639"></span><span class="hs-comment">-- | Reinject the validityRange inside the unbalanced Tx.</span><span>
</span><span id="line-640"></span><span class="hs-comment">--   As the Tx is a Caradano transaction, and as we have access to the SlotConfig,</span><span>
</span><span id="line-641"></span><span class="hs-comment">--   we can already internalize the constraints for the test</span><span>
</span><span id="line-642"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#setValidityRange"><span class="hs-identifier hs-type">setValidityRange</span></a></span><span>
</span><span id="line-643"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">POSIXTimeRange</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span id="setValidityRange"><span class="annot"><span class="annottext">setValidityRange :: [POSIXTimeRange]
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#setValidityRange"><span class="hs-identifier hs-var hs-var">setValidityRange</span></a></span></span><span> </span><span id="local-6989586621679466751"><span class="annot"><span class="annottext">[POSIXTimeRange]
</span><a href="#local-6989586621679466751"><span class="hs-identifier hs-var">ranges</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-645"></span><span>  </span><span id="local-6989586621679466750"><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679466750"><span class="hs-identifier hs-var">slotConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ConstraintProcessingState -&gt; SlotConfig)
-&gt; StateT ConstraintProcessingState (Except MkTxError) SlotConfig
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; SlotConfig
</span><span class="hs-identifier hs-var hs-var">pSlotConfig</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; SlotConfig)
-&gt; (ConstraintProcessingState -&gt; Params)
-&gt; ConstraintProcessingState
-&gt; SlotConfig
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsParams"><span class="hs-identifier hs-var hs-var">cpsParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466748"><span class="annot"><span class="annottext">slotRange :: SlotRange
</span><a href="#local-6989586621679466748"><span class="hs-identifier hs-var hs-var">slotRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; SlotRange -&gt; SlotRange)
-&gt; SlotRange -&gt; [SlotRange] -&gt; SlotRange
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange -&gt; SlotRange -&gt; SlotRange
forall a. MeetSemiLattice a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">(/\)</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
forall a. BoundedMeetSemiLattice a =&gt; a
</span><span class="hs-identifier hs-var">top</span></span><span> </span><span class="annot"><span class="annottext">([SlotRange] -&gt; SlotRange) -&gt; [SlotRange] -&gt; SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotConfig -&gt; POSIXTimeRange -&gt; SlotRange
</span><span class="hs-identifier hs-var">posixTimeRangeToContainedSlotRange</span></span><span> </span><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679466750"><span class="hs-identifier hs-var">slotConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTimeRange -&gt; SlotRange) -&gt; [POSIXTimeRange] -&gt; [SlotRange]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[POSIXTimeRange]
</span><a href="#local-6989586621679466751"><span class="hs-identifier hs-var">ranges</span></a></span><span>
</span><span id="line-647"></span><span>  </span><span id="local-6989586621679466746"><span class="annot"><span class="annottext">(TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466746"><span class="hs-identifier hs-var">cTxTR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; StateT
     ConstraintProcessingState
     (Except MkTxError)
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   ToCardanoError
   (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; StateT
      ConstraintProcessingState
      (Except MkTxError)
      (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; StateT
     ConstraintProcessingState
     (Except MkTxError)
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><span class="hs-identifier hs-var">C.toCardanoValidityRange</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679466748"><span class="hs-identifier hs-var">slotRange</span></a></span><span>
</span><span id="line-648"></span><span>  </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; Identity
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; Identity
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; Identity
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; Identity
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; Identity
      (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier hs-var">txValidityRange</span></a></span><span> </span><span class="annot"><span class="annottext">(((TxValidityLowerBound BabbageEra,
   TxValidityUpperBound BabbageEra)
  -&gt; Identity
       (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (TxValidityLowerBound BabbageEra,
    TxValidityUpperBound BabbageEra)
-&gt; StateT ConstraintProcessingState (Except MkTxError) ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">(TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466746"><span class="hs-identifier hs-var">cTxTR</span></a></span><span>
</span><span id="line-649"></span><span>
</span><span id="line-650"></span><span class="hs-comment">-- | Turn a 'TxConstraints' value into an unbalanced transaction that satisfies</span><span>
</span><span id="line-651"></span><span class="hs-comment">--   the constraints. To use this in a contract, see</span><span>
</span><span id="line-652"></span><span class="hs-comment">--   'Plutus.Contract.submitTxConstraints'</span><span>
</span><span id="line-653"></span><span class="hs-comment">--   and related functions.</span><span>
</span><span id="line-654"></span><span id="local-6989586621679466743"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkTx"><span class="hs-identifier hs-type">mkTx</span></a></span><span>
</span><span id="line-655"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-656"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-657"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-658"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span>
</span><span id="line-660"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466743"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span></span><span>
</span><span id="line-663"></span><span id="mkTx"><span class="annot"><span class="annottext">mkTx :: Params
-&gt; ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Either MkTxError UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#mkTx"><span class="hs-identifier hs-var hs-var">mkTx</span></a></span></span><span> </span><span id="local-6989586621679466742"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466742"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679466741"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466741"><span class="hs-identifier hs-var">lookups</span></a></span></span><span> </span><span id="local-6989586621679466740"><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466740"><span class="hs-identifier hs-var">txc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params
-&gt; [SomeLookupsAndConstraints] -&gt; Either MkTxError UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#mkSomeTx"><span class="hs-identifier hs-var">mkSomeTx</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466742"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; SomeLookupsAndConstraints
forall a.
(FromData (DatumType a), ToData (DatumType a),
 ToData (RedeemerType a)) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; SomeLookupsAndConstraints
</span><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-var">SomeLookupsAndConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466741"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466740"><span class="hs-identifier hs-var">txc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-664"></span><span>
</span><span id="line-665"></span><span id="local-6989586621679467507"><span id="local-6989586621679467508"><span id="local-6989586621679467509"><span id="local-6989586621679467510"><span id="local-6989586621679467511"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-type">throwLeft</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="#local-6989586621679467511"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="#local-6989586621679467509"><span class="hs-identifier hs-type">err</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467510"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679467508"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467509"><span class="hs-identifier hs-type">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467508"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467507"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467510"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467507"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span></span><span>
</span><span id="line-666"></span><span id="throwLeft"><span class="annot"><span class="annottext">throwLeft :: (b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var hs-var">throwLeft</span></a></span></span><span> </span><span id="local-6989586621679466739"><span class="annot"><span class="annottext">b -&gt; err
</span><a href="#local-6989586621679466739"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; m r) -&gt; (r -&gt; m r) -&gt; Either b r -&gt; m r
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">err -&gt; m r
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(err -&gt; m r) -&gt; (b -&gt; err) -&gt; b -&gt; m r
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; err
</span><a href="#local-6989586621679466739"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">r -&gt; m r
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-667"></span><span>
</span><span id="line-668"></span><span class="hs-comment">-- | Modify the 'UnbalancedTx' so that it satisfies the constraints, if</span><span>
</span><span id="line-669"></span><span class="hs-comment">--   possible. Fails if a hash is missing from the lookups, or if an output</span><span>
</span><span id="line-670"></span><span class="hs-comment">--   of the wrong type is spent.</span><span>
</span><span id="line-671"></span><span id="local-6989586621679467534"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#processConstraint"><span class="hs-identifier hs-type">processConstraint</span></a></span><span>
</span><span id="line-672"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span>
</span><span id="line-673"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467534"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-674"></span><span id="processConstraint"><span class="annot"><span class="annottext">processConstraint :: TxConstraint
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processConstraint"><span class="hs-identifier hs-var hs-var">processConstraint</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-675"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTxWithHash"><span class="hs-identifier hs-type">MustIncludeDatumInTxWithHash</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- always succeeds</span><span>
</span><span id="line-676"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTx"><span class="hs-identifier hs-type">MustIncludeDatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- always succeeds</span><span>
</span><span id="line-677"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendPubKeyOutput"><span class="hs-identifier hs-type">MustSpendPubKeyOutput</span></a></span><span> </span><span id="local-6989586621679466735"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466735"><span class="hs-identifier hs-var">txo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-678"></span><span>        </span><span id="local-6989586621679466734"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466734"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall a.
TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-var">lookupTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466735"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-679"></span><span>        </span><span id="local-6989586621679466733"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466733"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  Value
-&gt; (Value
    -&gt; ReaderT
         (ScriptLookups a)
         (StateT ConstraintProcessingState (Except MkTxError))
         Value)
-&gt; Maybe Value
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefWrongType"><span class="hs-identifier hs-var">TxOutRefWrongType</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466735"><span class="hs-identifier hs-var">txo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Value
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Value
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      Value)
-&gt; Maybe Value
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-680"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">APrism
  DecoratedTxOut
  DecoratedTxOut
  (PubKeyHash, Maybe StakingCredential, Value,
   Maybe (DatumHash, DatumFromQuery), Maybe (Versioned Script))
  (PubKeyHash, Maybe StakingCredential, Value,
   Maybe (DatumHash, DatumFromQuery), Maybe (Versioned Script))
-&gt; DecoratedTxOut -&gt; Bool
forall s t a b. APrism s t a b -&gt; s -&gt; Bool
</span><span class="hs-identifier hs-var">is</span></span><span> </span><span class="annot"><span class="annottext">APrism
  DecoratedTxOut
  DecoratedTxOut
  (PubKeyHash, Maybe StakingCredential, Value,
   Maybe (DatumHash, DatumFromQuery), Maybe (Versioned Script))
  (PubKeyHash, Maybe StakingCredential, Value,
   Maybe (DatumHash, DatumFromQuery), Maybe (Versioned Script))
Prism'
  DecoratedTxOut
  (PubKeyHash, Maybe StakingCredential, Value,
   Maybe (DatumHash, DatumFromQuery), Maybe (Versioned Script))
</span><span class="hs-identifier hs-var">Tx._PublicKeyDecoratedTxOut</span></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466734"><span class="hs-identifier hs-var">txout</span></a></span><span>
</span><span id="line-681"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Maybe Value
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Maybe Value) -&gt; Value -&gt; Maybe Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466734"><span class="hs-identifier hs-var">txout</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; Getting Value DecoratedTxOut Value -&gt; Value
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting Value DecoratedTxOut Value
Lens' DecoratedTxOut Value
</span><span class="hs-identifier hs-var">Tx.decoratedTxOutValue</span></span><span>
</span><span id="line-682"></span><span>        </span><span id="local-6989586621679466729"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466729"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466735"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-683"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
 -&gt; Identity
      [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txIns"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="annot"><span class="annottext">(([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
  -&gt; Identity
       [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466729"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn BabbageEra
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">C.BuildTxWith</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn -&gt; Witness WitCtxTxIn BabbageEra
forall witctx era. KeyWitnessInCtx witctx -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">C.KeyWitness</span></span><span> </span><span class="annot"><span class="annottext">KeyWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">C.KeyWitnessForSpending</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-684"></span><span>        </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Value
</span><span class="hs-identifier hs-var">C.fromCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466733"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-685"></span><span>
</span><span id="line-686"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustBeSignedBy"><span class="hs-identifier hs-type">MustBeSignedBy</span></a></span><span> </span><span id="local-6989586621679466724"><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679466724"><span class="hs-identifier hs-var">pk</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>        </span><span id="local-6989586621679466723"><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679466723"><span class="hs-identifier hs-var">ekw</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>  </span><span class="annot"><span class="annottext">(ToCardanoError
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Hash PaymentKey))
-&gt; (Hash PaymentKey
    -&gt; ReaderT
         (ScriptLookups a)
         (StateT ConstraintProcessingState (Except MkTxError))
         (Hash PaymentKey))
-&gt; Either ToCardanoError (Hash PaymentKey)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Hash PaymentKey)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Hash PaymentKey)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Hash PaymentKey))
-&gt; (ToCardanoError -&gt; MkTxError)
-&gt; ToCardanoError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Hash PaymentKey)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Hash PaymentKey)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (Hash PaymentKey)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Hash PaymentKey))
-&gt; Either ToCardanoError (Hash PaymentKey)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Hash PaymentKey)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; Either ToCardanoError (Hash PaymentKey)
</span><span class="hs-identifier hs-var">C.toCardanoPaymentKeyHash</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679466724"><span class="hs-identifier hs-var">pk</span></a></span><span>
</span><span id="line-688"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ((Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ((Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; (Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx (Set (Hash PaymentKey))
</span><a href="Ledger.Tx.Constraints.OffChain.html#txExtraKeyWits"><span class="hs-identifier hs-var">txExtraKeyWits</span></a></span><span> </span><span class="annot"><span class="annottext">((Set (Hash PaymentKey) -&gt; Identity (Set (Hash PaymentKey)))
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; Set (Hash PaymentKey)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey -&gt; Set (Hash PaymentKey)
forall a. a -&gt; Set a
</span><span class="hs-identifier hs-var">Set.singleton</span></span><span> </span><span class="annot"><span class="annottext">Hash PaymentKey
</span><a href="#local-6989586621679466723"><span class="hs-identifier hs-var">ekw</span></a></span><span>
</span><span id="line-689"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span id="local-6989586621679466721"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466721"><span class="hs-identifier hs-var">txo</span></a></span></span><span> </span><span id="local-6989586621679466720"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466720"><span class="hs-identifier hs-var">redeemer</span></a></span></span><span> </span><span id="local-6989586621679466719"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466719"><span class="hs-identifier hs-var">mref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-690"></span><span>        </span><span id="local-6989586621679466718"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466718"><span class="hs-identifier hs-var">txout</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall a.
TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-var">lookupTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466721"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-691"></span><span>        </span><span id="local-6989586621679466717"><span class="annot"><span class="annottext">WitnessHeader
</span><a href="#local-6989586621679466717"><span class="hs-identifier hs-var">mkWitness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466719"><span class="hs-identifier hs-var">mref</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-692"></span><span>          </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679466716"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466716"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-693"></span><span>            </span><span id="local-6989586621679466715"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466715"><span class="hs-identifier hs-var">refTxOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall a.
TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-var">lookupTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466716"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-694"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466715"><span class="hs-identifier hs-var">refTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; Getting
     (Maybe (Versioned Script))
     DecoratedTxOut
     (Maybe (Versioned Script))
-&gt; Maybe (Versioned Script)
forall s a. s -&gt; Getting a s a -&gt; a
</span><span class="hs-operator hs-var">^.</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (Versioned Script))
  DecoratedTxOut
  (Maybe (Versioned Script))
Lens' DecoratedTxOut (Maybe (Versioned Script))
</span><span class="hs-identifier hs-var">Tx.decoratedTxOutReferenceScript</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-695"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">Script
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679466714"><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679466714"><span class="hs-identifier hs-var">lang</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-696"></span><span>                    </span><span id="local-6989586621679466713"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466713"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466716"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-697"></span><span>                    </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Identity [TxIn])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx [TxIn]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference"><span class="hs-identifier hs-var">txInsReference</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxIn] -&gt; Identity [TxIn])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [TxIn]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466713"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-698"></span><span>                    </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError WitnessHeader
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      WitnessHeader)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned TxOutRef -&gt; Either ToCardanoError WitnessHeader
</span><span class="hs-identifier hs-var">C.toCardanoTxInReferenceWitnessHeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; Language -&gt; Versioned TxOutRef
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466716"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">Language
</span><a href="#local-6989586621679466714"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-699"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNoReferenceScript"><span class="hs-identifier hs-var">TxOutRefNoReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466716"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-700"></span><span>          </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-701"></span><span>            </span><span id="local-6989586621679466711"><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466711"><span class="hs-identifier hs-var">mscriptTXO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Maybe (Versioned Validator))
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DecoratedTxOut -&gt; m (Maybe (Versioned Validator))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier hs-var">resolveScriptTxOutValidator</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466718"><span class="hs-identifier hs-var">txout</span></a></span><span>
</span><span id="line-702"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466711"><span class="hs-identifier hs-var">mscriptTXO</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-703"></span><span>                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679466710"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466710"><span class="hs-identifier hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-704"></span><span>                    </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError WitnessHeader
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      WitnessHeader)
-&gt; Either ToCardanoError WitnessHeader
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Script -&gt; Either ToCardanoError WitnessHeader
</span><span class="hs-identifier hs-var">C.toCardanoTxInScriptWitnessHeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Validator -&gt; Script
</span><span class="hs-identifier hs-var hs-var">getValidator</span></span><span> </span><span class="annot"><span class="annottext">(Validator -&gt; Script) -&gt; Versioned Validator -&gt; Versioned Script
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466710"><span class="hs-identifier hs-var">validator</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-705"></span><span>                </span><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     WitnessHeader
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefWrongType"><span class="hs-identifier hs-var">TxOutRefWrongType</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466721"><span class="hs-identifier hs-var">txo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>        </span><span id="local-6989586621679466709"><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
</span><a href="#local-6989586621679466709"><span class="hs-identifier hs-var">mscriptTXO</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Maybe (DatumWithOrigin, Value))
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DecoratedTxOut -&gt; m (Maybe (DatumWithOrigin, Value))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier hs-var">resolveScriptTxOutDatumAndValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466718"><span class="hs-identifier hs-var">txout</span></a></span><span>
</span><span id="line-707"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
</span><a href="#local-6989586621679466709"><span class="hs-identifier hs-var">mscriptTXO</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-708"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466708"><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466708"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466707"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466707"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-709"></span><span>                </span><span id="local-6989586621679466706"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466706"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466721"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-710"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466705"><span class="annot"><span class="annottext">witness :: Witness WitCtxTxIn BabbageEra
</span><a href="#local-6989586621679466705"><span class="hs-identifier hs-var hs-var">witness</span></a></span></span><span>
</span><span id="line-711"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
-&gt; ScriptWitness WitCtxTxIn BabbageEra
-&gt; Witness WitCtxTxIn BabbageEra
forall witctx era.
ScriptWitnessInCtx witctx
-&gt; ScriptWitness witctx era -&gt; Witness witctx era
</span><span class="hs-identifier hs-var">C.ScriptWitness</span></span><span> </span><span class="annot"><span class="annottext">ScriptWitnessInCtx WitCtxTxIn
</span><span class="hs-identifier hs-var">C.ScriptWitnessForSpending</span></span><span> </span><span class="annot"><span class="annottext">(ScriptWitness WitCtxTxIn BabbageEra
 -&gt; Witness WitCtxTxIn BabbageEra)
-&gt; ScriptWitness WitCtxTxIn BabbageEra
-&gt; Witness WitCtxTxIn BabbageEra
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-712"></span><span>                            </span><span class="annot"><span class="annottext">WitnessHeader
</span><a href="#local-6989586621679466717"><span class="hs-identifier hs-var">mkWitness</span></a></span><span>
</span><span id="line-713"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Datum -&gt; ScriptDatum WitCtxTxIn
</span><span class="hs-identifier hs-var">C.toCardanoDatumWitness</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; ScriptDatum WitCtxTxIn)
-&gt; Maybe Datum -&gt; ScriptDatum WitCtxTxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin -&gt; Maybe Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#datumWitness"><span class="hs-identifier hs-var">datumWitness</span></a></span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466708"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-714"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; ScriptData
</span><span class="hs-identifier hs-var">C.toCardanoScriptData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Redeemer -&gt; BuiltinData
</span><span class="hs-identifier hs-var hs-var">getRedeemer</span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466720"><span class="hs-identifier hs-var">redeemer</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span>                            </span><span class="annot"><span class="annottext">ExecutionUnits
</span><span class="hs-identifier hs-var">C.zeroExecutionUnits</span></span><span>
</span><span id="line-716"></span><span>
</span><span id="line-717"></span><span>                </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
     -&gt; Identity
          [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
    -&gt; Identity
         [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
 -&gt; Identity
      [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txIns"><span class="hs-identifier hs-var">txIns</span></a></span><span> </span><span class="annot"><span class="annottext">(([(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
  -&gt; Identity
       [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [(TxIn, BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra))]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466706"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn BabbageEra
-&gt; BuildTxWith BuildTx (Witness WitCtxTxIn BabbageEra)
forall a. a -&gt; BuildTxWith BuildTx a
</span><span class="hs-identifier hs-var">C.BuildTxWith</span></span><span> </span><span class="annot"><span class="annottext">Witness WitCtxTxIn BabbageEra
</span><a href="#local-6989586621679466705"><span class="hs-identifier hs-var">witness</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>                </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466707"><span class="hs-identifier hs-var">value</span></a></span><span>
</span><span id="line-720"></span><span>
</span><span id="line-721"></span><span>            </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefWrongType"><span class="hs-identifier hs-var">TxOutRefWrongType</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466721"><span class="hs-identifier hs-var">txo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span>
</span><span id="line-723"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustUseOutputAsCollateral"><span class="hs-identifier hs-type">MustUseOutputAsCollateral</span></a></span><span> </span><span id="local-6989586621679466703"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466703"><span class="hs-identifier hs-var">txo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-724"></span><span>        </span><span id="local-6989586621679466702"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466702"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466703"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-725"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Identity [TxIn])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx [TxIn]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsCollateral"><span class="hs-identifier hs-var">txInsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxIn] -&gt; Identity [TxIn])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [TxIn]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466702"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustReferenceOutput"><span class="hs-identifier hs-type">MustReferenceOutput</span></a></span><span> </span><span id="local-6989586621679466700"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466700"><span class="hs-identifier hs-var">txo</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-728"></span><span>        </span><span id="local-6989586621679466699"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466699"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466700"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-729"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Identity [TxIn])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx [TxIn]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference"><span class="hs-identifier hs-var">txInsReference</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxIn] -&gt; Identity [TxIn])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [TxIn]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466699"><span class="hs-identifier hs-var">txIn</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustMintValue"><span class="hs-identifier hs-type">MustMintValue</span></a></span><span> </span><span id="local-6989586621679466697"><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466697"><span class="hs-identifier hs-var">mpsHash</span></a></span></span><span> </span><span id="local-6989586621679466696"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466696"><span class="hs-identifier hs-var">red</span></a></span></span><span> </span><span id="local-6989586621679466695"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679466695"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621679466694"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466694"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621679466693"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466693"><span class="hs-identifier hs-var">mref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-732"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466692"><span class="annot"><span class="annottext">value :: Integer -&gt; Value
</span><a href="#local-6989586621679466692"><span class="hs-identifier hs-var hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Integer -&gt; Value
</span><span class="hs-identifier hs-var">Value.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">Value.mpsSymbol</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466697"><span class="hs-identifier hs-var">mpsHash</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679466695"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-733"></span><span>
</span><span id="line-734"></span><span>        </span><span class="hs-comment">-- If i is negative we are burning tokens. The tokens burned must</span><span>
</span><span id="line-735"></span><span>        </span><span class="hs-comment">-- be provided as an input. So we add the value burnt to</span><span>
</span><span id="line-736"></span><span>        </span><span class="hs-comment">-- 'valueSpentInputs'. If i is positive then new tokens are created</span><span>
</span><span id="line-737"></span><span>        </span><span class="hs-comment">-- which must be added to 'valueSpentOutputs'.</span><span>
</span><span id="line-738"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466694"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-operator hs-var">&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-739"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="#local-6989586621679466692"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">negate</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466694"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-740"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentOutputs"><span class="hs-identifier hs-var">valueSpentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="#local-6989586621679466692"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466694"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span>        </span><span id="local-6989586621679466688"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466688"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError Value
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError Value
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      Value)
-&gt; Either ToCardanoError Value
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">C.toCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; Either ToCardanoError Value)
-&gt; Value -&gt; Either ToCardanoError Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><a href="#local-6989586621679466692"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466694"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-743"></span><span>        </span><span id="local-6989586621679466686"><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679466686"><span class="hs-identifier hs-var">pId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError PolicyId
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     PolicyId
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError PolicyId
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      PolicyId)
-&gt; Either ToCardanoError PolicyId
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     PolicyId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; Either ToCardanoError PolicyId
</span><span class="hs-identifier hs-var">toCardanoPolicyId</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466697"><span class="hs-identifier hs-var">mpsHash</span></a></span><span>
</span><span id="line-744"></span><span>        </span><span id="local-6989586621679466685"><span class="annot"><span class="annottext">ScriptWitness WitCtxMint BabbageEra
</span><a href="#local-6989586621679466685"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466693"><span class="hs-identifier hs-var">mref</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-745"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679466684"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466684"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>                </span><span id="local-6989586621679466683"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466683"><span class="hs-identifier hs-var">refTxOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall a.
TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-var">lookupTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466684"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-747"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466683"><span class="hs-identifier hs-var">refTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; Getting
     (First (Maybe (Versioned Script)))
     DecoratedTxOut
     (Maybe (Versioned Script))
-&gt; Maybe (Maybe (Versioned Script))
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">Getting
  (First (Maybe (Versioned Script)))
  DecoratedTxOut
  (Maybe (Versioned Script))
Lens' DecoratedTxOut (Maybe (Versioned Script))
</span><span class="hs-identifier hs-var">decoratedTxOutReferenceScript</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-748"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-749"></span><span>                      </span><span id="local-6989586621679466681"><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466681"><span class="hs-identifier hs-var">txIn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError TxIn
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      TxIn)
-&gt; Either ToCardanoError TxIn
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     TxIn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Either ToCardanoError TxIn
</span><span class="hs-identifier hs-var">C.toCardanoTxIn</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466684"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-750"></span><span>                      </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([TxIn] -&gt; Identity [TxIn])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([TxIn] -&gt; Identity [TxIn])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxIn] -&gt; Identity [TxIn])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx [TxIn]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txInsReference"><span class="hs-identifier hs-var">txInsReference</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxIn] -&gt; Identity [TxIn])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [TxIn]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TxIn
</span><a href="#local-6989586621679466681"><span class="hs-identifier hs-var">txIn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>                      </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ScriptWitness WitCtxMint BabbageEra)
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span>
</span><span id="line-752"></span><span>                        </span><span class="annot"><span class="annottext">(Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (ScriptWitness WitCtxMint BabbageEra))
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ScriptWitness WitCtxMint BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
-&gt; Maybe (Versioned TxOutRef)
-&gt; Maybe (Versioned MintingPolicy)
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
</span><span class="hs-identifier hs-var">toCardanoMintWitness</span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466696"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxOutRef -&gt; Language -&gt; Versioned TxOutRef)
-&gt; Language -&gt; TxOutRef -&gt; Versioned TxOutRef
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Language -&gt; Versioned TxOutRef
forall script. script -&gt; Language -&gt; Versioned script
</span><span class="hs-identifier hs-var">Tx.Versioned</span></span><span> </span><span class="annot"><span class="annottext">Language
</span><span class="hs-identifier hs-var">PlutusV2</span></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Versioned TxOutRef)
-&gt; Maybe TxOutRef -&gt; Maybe (Versioned TxOutRef)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466693"><span class="hs-identifier hs-var">mref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned MintingPolicy)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-753"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (Maybe (Versioned Script))
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ScriptWitness WitCtxMint BabbageEra)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNoReferenceScript"><span class="hs-identifier hs-var">TxOutRefNoReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466684"><span class="hs-identifier hs-var">ref</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>            </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-755"></span><span>                </span><span id="local-6989586621679466680"><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679466680"><span class="hs-identifier hs-var">mintingPolicyScript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned MintingPolicy)
forall a.
MintingPolicyHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned MintingPolicy)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupMintingPolicy"><span class="hs-identifier hs-var">lookupMintingPolicy</span></a></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466697"><span class="hs-identifier hs-var">mpsHash</span></a></span><span>
</span><span id="line-756"></span><span>                </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ScriptWitness WitCtxMint BabbageEra)
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span>
</span><span id="line-757"></span><span>                  </span><span class="annot"><span class="annottext">(Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (ScriptWitness WitCtxMint BabbageEra))
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ScriptWitness WitCtxMint BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
-&gt; Maybe (Versioned TxOutRef)
-&gt; Maybe (Versioned MintingPolicy)
-&gt; Either ToCardanoError (ScriptWitness WitCtxMint BabbageEra)
</span><span class="hs-identifier hs-var">toCardanoMintWitness</span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466696"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned TxOutRef)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned MintingPolicy -&gt; Maybe (Versioned MintingPolicy)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned MintingPolicy
</span><a href="#local-6989586621679466680"><span class="hs-identifier hs-var">mintingPolicyScript</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-758"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
     -&gt; Identity
          (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
    -&gt; Identity
         (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
     -&gt; Identity
          (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
    -&gt; Identity
         (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
 -&gt; Identity
      (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
</span><a href="Ledger.Tx.Constraints.OffChain.html#txMintValue"><span class="hs-identifier hs-var">txMintValue</span></a></span><span> </span><span class="annot"><span class="annottext">(((Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
  -&gt; Identity
       (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra)))
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (Value, Map PolicyId (ScriptWitness WitCtxMint BabbageEra))
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466688"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PolicyId
-&gt; ScriptWitness WitCtxMint BabbageEra
-&gt; Map PolicyId (ScriptWitness WitCtxMint BabbageEra)
forall k a. k -&gt; a -&gt; Map k a
</span><span class="hs-identifier hs-var">Map.singleton</span></span><span> </span><span class="annot"><span class="annottext">PolicyId
</span><a href="#local-6989586621679466686"><span class="hs-identifier hs-var">pId</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptWitness WitCtxMint BabbageEra
</span><a href="#local-6989586621679466685"><span class="hs-identifier hs-var">witness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-759"></span><span>
</span><span id="line-760"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustPayToAddress"><span class="hs-identifier hs-type">MustPayToAddress</span></a></span><span> </span><span id="local-6989586621679466678"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679466678"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679466677"><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum)
</span><a href="#local-6989586621679466677"><span class="hs-identifier hs-var">md</span></a></span></span><span> </span><span id="local-6989586621679466676"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466676"><span class="hs-identifier hs-var">refScriptHashM</span></a></span></span><span> </span><span id="local-6989586621679466675"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466675"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-761"></span><span>        </span><span id="local-6989586621679466674"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679466674"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting NetworkId ConstraintProcessingState NetworkId
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     NetworkId
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Params -&gt; Const NetworkId Params)
-&gt; ConstraintProcessingState
-&gt; Const NetworkId ConstraintProcessingState
Lens' ConstraintProcessingState Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#paramsL"><span class="hs-identifier hs-var">paramsL</span></a></span><span> </span><span class="annot"><span class="annottext">((Params -&gt; Const NetworkId Params)
 -&gt; ConstraintProcessingState
 -&gt; Const NetworkId ConstraintProcessingState)
-&gt; ((NetworkId -&gt; Const NetworkId NetworkId)
    -&gt; Params -&gt; Const NetworkId Params)
-&gt; Getting NetworkId ConstraintProcessingState NetworkId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(NetworkId -&gt; Const NetworkId NetworkId)
-&gt; Params -&gt; Const NetworkId Params
Lens' Params NetworkId
</span><span class="hs-identifier hs-var">networkIdL</span></span><span class="hs-special">)</span><span>
</span><span id="line-762"></span><span>        </span><span id="local-6989586621679466672"><span class="annot"><span class="annottext">ReferenceScript BabbageEra
</span><a href="#local-6989586621679466672"><span class="hs-identifier hs-var">refScript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ReferenceScript BabbageEra)
forall a.
Maybe ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ReferenceScript BabbageEra)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScriptAsReferenceScript"><span class="hs-identifier hs-var">lookupScriptAsReferenceScript</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466676"><span class="hs-identifier hs-var">refScriptHashM</span></a></span><span>
</span><span id="line-763"></span><span>        </span><span id="local-6989586621679466671"><span class="annot"><span class="annottext">TxOut CtxTx BabbageEra
</span><a href="#local-6989586621679466671"><span class="hs-identifier hs-var">out</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either ToCardanoError (TxOut CtxTx BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (TxOut CtxTx BabbageEra)
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (TxOut CtxTx BabbageEra)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (TxOut CtxTx BabbageEra))
-&gt; Either ToCardanoError (TxOut CtxTx BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (TxOut CtxTx BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">AddressInEra BabbageEra
-&gt; TxOutValue BabbageEra
-&gt; TxOutDatum CtxTx BabbageEra
-&gt; ReferenceScript BabbageEra
-&gt; TxOut CtxTx BabbageEra
forall ctx era.
AddressInEra era
-&gt; TxOutValue era
-&gt; TxOutDatum ctx era
-&gt; ReferenceScript era
-&gt; TxOut ctx era
</span><span class="hs-identifier hs-var">C.TxOut</span></span><span>
</span><span id="line-764"></span><span>            </span><span class="annot"><span class="annottext">(AddressInEra BabbageEra
 -&gt; TxOutValue BabbageEra
 -&gt; TxOutDatum CtxTx BabbageEra
 -&gt; ReferenceScript BabbageEra
 -&gt; TxOut CtxTx BabbageEra)
-&gt; Either ToCardanoError (AddressInEra BabbageEra)
-&gt; Either
     ToCardanoError
     (TxOutValue BabbageEra
      -&gt; TxOutDatum CtxTx BabbageEra
      -&gt; ReferenceScript BabbageEra
      -&gt; TxOut CtxTx BabbageEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Address -&gt; Either ToCardanoError (AddressInEra BabbageEra)
</span><span class="hs-identifier hs-var">C.toCardanoAddressInEra</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679466674"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679466678"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-765"></span><span>            </span><span class="annot"><span class="annottext">Either
  ToCardanoError
  (TxOutValue BabbageEra
   -&gt; TxOutDatum CtxTx BabbageEra
   -&gt; ReferenceScript BabbageEra
   -&gt; TxOut CtxTx BabbageEra)
-&gt; Either ToCardanoError (TxOutValue BabbageEra)
-&gt; Either
     ToCardanoError
     (TxOutDatum CtxTx BabbageEra
      -&gt; ReferenceScript BabbageEra -&gt; TxOut CtxTx BabbageEra)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Value -&gt; TxOutValue BabbageEra)
-&gt; Either ToCardanoError Value
-&gt; Either ToCardanoError (TxOutValue BabbageEra)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxOutValue BabbageEra
</span><span class="hs-identifier hs-var">C.toCardanoTxOutValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value -&gt; Either ToCardanoError Value
</span><span class="hs-identifier hs-var">C.toCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466675"><span class="hs-identifier hs-var">vl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-766"></span><span>            </span><span class="annot"><span class="annottext">Either
  ToCardanoError
  (TxOutDatum CtxTx BabbageEra
   -&gt; ReferenceScript BabbageEra -&gt; TxOut CtxTx BabbageEra)
-&gt; Either ToCardanoError (TxOutDatum CtxTx BabbageEra)
-&gt; Either
     ToCardanoError
     (ReferenceScript BabbageEra -&gt; TxOut CtxTx BabbageEra)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx BabbageEra
-&gt; Either ToCardanoError (TxOutDatum CtxTx BabbageEra)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum) -&gt; TxOutDatum CtxTx BabbageEra
</span><a href="Ledger.Tx.Constraints.OffChain.html#toTxOutDatum"><span class="hs-identifier hs-var">toTxOutDatum</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum)
</span><a href="#local-6989586621679466677"><span class="hs-identifier hs-var">md</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>            </span><span class="annot"><span class="annottext">Either
  ToCardanoError
  (ReferenceScript BabbageEra -&gt; TxOut CtxTx BabbageEra)
-&gt; Either ToCardanoError (ReferenceScript BabbageEra)
-&gt; Either ToCardanoError (TxOut CtxTx BabbageEra)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript BabbageEra
-&gt; Either ToCardanoError (ReferenceScript BabbageEra)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ReferenceScript BabbageEra
</span><a href="#local-6989586621679466672"><span class="hs-identifier hs-var">refScript</span></a></span><span>
</span><span id="line-768"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (([TxOut] -&gt; Identity [TxOut])
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ([TxOut] -&gt; Identity [TxOut])
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (([TxOut] -&gt; Identity [TxOut])
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ([TxOut] -&gt; Identity [TxOut])
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; Identity [TxOut])
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens' CardanoBuildTx [TxOut]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxOut] -&gt; Identity [TxOut])
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; [TxOut]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx BabbageEra -&gt; TxOut
</span><span class="hs-identifier hs-var">Tx.TxOut</span></span><span> </span><span class="annot"><span class="annottext">TxOut CtxTx BabbageEra
</span><a href="#local-6989586621679466671"><span class="hs-identifier hs-var">out</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-769"></span><span>
</span><span id="line-770"></span><span>        </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentOutputs"><span class="hs-identifier hs-var">valueSpentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#provided"><span class="hs-identifier hs-var">provided</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466675"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-771"></span><span>
</span><span id="line-772"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendAtLeast"><span class="hs-identifier hs-type">MustSpendAtLeast</span></a></span><span> </span><span id="local-6989586621679466664"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466664"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentInputs"><span class="hs-identifier hs-var">valueSpentInputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#required"><span class="hs-identifier hs-var">required</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466664"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-773"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustProduceAtLeast"><span class="hs-identifier hs-type">MustProduceAtLeast</span></a></span><span> </span><span id="local-6989586621679466662"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466662"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ValueSpentBalances -&gt; Identity ValueSpentBalances)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#valueSpentOutputs"><span class="hs-identifier hs-var">valueSpentOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">((ValueSpentBalances -&gt; Identity ValueSpentBalances)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ValueSpentBalances
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; ValueSpentBalances
</span><a href="Ledger.Tx.Constraints.OffChain.html#required"><span class="hs-identifier hs-var">required</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466662"><span class="hs-identifier hs-var">vl</span></a></span><span>
</span><span id="line-774"></span><span>
</span><span id="line-775"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSatisfyAnyOf"><span class="hs-identifier hs-type">MustSatisfyAnyOf</span></a></span><span> </span><span id="local-6989586621679466660"><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466660"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-776"></span><span>        </span><span id="local-6989586621679466659"><span class="annot"><span class="annottext">ConstraintProcessingState
</span><a href="#local-6989586621679466659"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ConstraintProcessingState
forall s (m :: * -&gt; *). MonadState s m =&gt; m s
</span><span class="hs-identifier hs-var">get</span></span><span>
</span><span id="line-777"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466658"><span class="annot"><span class="annottext">tryNext :: [[TxConstraint]]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="#local-6989586621679466658"><span class="hs-identifier hs-var hs-var">tryNext</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-778"></span><span>                </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#CannotSatisfyAny"><span class="hs-identifier hs-var">CannotSatisfyAny</span></a></span><span>
</span><span id="line-779"></span><span>            </span><span class="annot"><a href="#local-6989586621679466658"><span class="hs-identifier hs-var">tryNext</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466657"><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466657"><span class="hs-identifier hs-var">hs</span></a></span></span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-glyph hs-type">:</span></a></span><span id="local-6989586621679466656"><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466656"><span class="hs-identifier hs-var">qs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-780"></span><span>                </span><span class="annot"><span class="annottext">(TxConstraint
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      ())
-&gt; [TxConstraint]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Foldable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse_</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraint
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a.
TxConstraint
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#processConstraint"><span class="hs-identifier hs-var">processConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466657"><span class="hs-identifier hs-var">hs</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
-&gt; (MkTxError
    -&gt; ReaderT
         (ScriptLookups a)
         (StateT ConstraintProcessingState (Except MkTxError))
         ())
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall e (m :: * -&gt; *) a.
MonadError e m =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><span class="hs-operator hs-var">`catchError`</span></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
-&gt; MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConstraintProcessingState
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *). MonadState s m =&gt; s -&gt; m ()
</span><span class="hs-identifier hs-var">put</span></span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState
</span><a href="#local-6989586621679466659"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  ()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[[TxConstraint]]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="#local-6989586621679466658"><span class="hs-identifier hs-var">tryNext</span></a></span><span> </span><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466656"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>        </span><span class="annot"><span class="annottext">[[TxConstraint]]
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
</span><a href="#local-6989586621679466658"><span class="hs-identifier hs-var">tryNext</span></a></span><span> </span><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466660"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustValidateInTimeRange"><span class="hs-identifier hs-type">MustValidateInTimeRange</span></a></span><span> </span><span id="local-6989586621679466654"><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466654"><span class="hs-identifier hs-var">timeRange</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-784"></span><span>        </span><span id="local-6989586621679466653"><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679466653"><span class="hs-identifier hs-var">slotConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ConstraintProcessingState -&gt; SlotConfig)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     SlotConfig
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Params -&gt; SlotConfig
</span><span class="hs-identifier hs-var hs-var">pSlotConfig</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; SlotConfig)
-&gt; (ConstraintProcessingState -&gt; Params)
-&gt; ConstraintProcessingState
-&gt; SlotConfig
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsParams"><span class="hs-identifier hs-var hs-var">cpsParams</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-785"></span><span>        </span><span id="local-6989586621679466652"><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621679466652"><span class="hs-identifier hs-var">unbTx</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Getting UnbalancedTx ConstraintProcessingState UnbalancedTx
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     UnbalancedTx
forall s (m :: * -&gt; *) a. MonadState s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">use</span></span><span> </span><span class="annot"><span class="annottext">Getting UnbalancedTx ConstraintProcessingState UnbalancedTx
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span>
</span><span id="line-786"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466651"><span class="annot"><span class="annottext">currentValRange :: Maybe
  (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466651"><span class="hs-identifier hs-var hs-var">currentValRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
</span><a href="#local-6989586621679466652"><span class="hs-identifier hs-var">unbTx</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx
-&gt; Getting
     (First
        (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
     UnbalancedTx
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; Maybe
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx
 -&gt; Const
      (First
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
      CardanoBuildTx)
-&gt; UnbalancedTx
-&gt; Const
     (First
        (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
     UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx
  -&gt; Const
       (First
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
       CardanoBuildTx)
 -&gt; UnbalancedTx
 -&gt; Const
      (First
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
      UnbalancedTx)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; Const
          (First
             (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
    -&gt; CardanoBuildTx
    -&gt; Const
         (First
            (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
         CardanoBuildTx)
-&gt; Getting
     (First
        (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
     UnbalancedTx
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; Const
      (First
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
      (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; CardanoBuildTx
-&gt; Const
     (First
        (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
     CardanoBuildTx
Lens'
  CardanoBuildTx
  (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier hs-var">txValidityRange</span></a></span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466650"><span class="annot"><span class="annottext">currentTimeRange :: POSIXTimeRange
</span><a href="#local-6989586621679466650"><span class="hs-identifier hs-var hs-var">currentTimeRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; POSIXTimeRange)
-&gt; Maybe
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; POSIXTimeRange
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
forall a. BoundedMeetSemiLattice a =&gt; a
</span><span class="hs-identifier hs-var">top</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SlotConfig -&gt; SlotRange -&gt; POSIXTimeRange
</span><span class="hs-identifier hs-var">slotRangeToPOSIXTimeRange</span></span><span> </span><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679466653"><span class="hs-identifier hs-var">slotConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(SlotRange -&gt; POSIXTimeRange)
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; SlotRange)
-&gt; (TxValidityLowerBound BabbageEra,
    TxValidityUpperBound BabbageEra)
-&gt; POSIXTimeRange
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; SlotRange
forall era.
(TxValidityLowerBound era, TxValidityUpperBound era) -&gt; SlotRange
</span><span class="hs-identifier hs-var">C.fromCardanoValidityRange</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe
  (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466651"><span class="hs-identifier hs-var">currentValRange</span></a></span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466648"><span class="annot"><span class="annottext">newRange :: SlotRange
</span><a href="#local-6989586621679466648"><span class="hs-identifier hs-var hs-var">newRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SlotConfig -&gt; POSIXTimeRange -&gt; SlotRange
</span><span class="hs-identifier hs-var">posixTimeRangeToContainedSlotRange</span></span><span> </span><span class="annot"><span class="annottext">SlotConfig
</span><a href="#local-6989586621679466653"><span class="hs-identifier hs-var">slotConfig</span></a></span><span> </span><span class="annot"><span class="annottext">(POSIXTimeRange -&gt; SlotRange) -&gt; POSIXTimeRange -&gt; SlotRange
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621679466650"><span class="hs-identifier hs-var">currentTimeRange</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; POSIXTimeRange -&gt; POSIXTimeRange
forall a. MeetSemiLattice a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">/\</span></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; POSIXTimeRange
forall a. ValidityInterval a -&gt; Interval a
</span><a href="Ledger.Tx.Constraints.ValidityInterval.html#toPlutusInterval"><span class="hs-identifier hs-var">toPlutusInterval</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466654"><span class="hs-identifier hs-var">timeRange</span></a></span><span>
</span><span id="line-789"></span><span>        </span><span id="local-6989586621679466647"><span class="annot"><span class="annottext">(TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466647"><span class="hs-identifier hs-var">cTxTR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ToCardanoError -&gt; MkTxError)
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall s (m :: * -&gt; *) err b r.
(MonadState s m, MonadError err m) =&gt;
(b -&gt; err) -&gt; Either b r -&gt; m r
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwLeft"><span class="hs-identifier hs-var">throwLeft</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either
   ToCardanoError
   (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SlotRange
-&gt; Either
     ToCardanoError
     (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><span class="hs-identifier hs-var">C.toCardanoValidityRange</span></span><span> </span><span class="annot"><span class="annottext">SlotRange
</span><a href="#local-6989586621679466648"><span class="hs-identifier hs-var">newRange</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; Identity
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; Identity
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; Identity CardanoBuildTx)
 -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (((TxValidityLowerBound BabbageEra,
      TxValidityUpperBound BabbageEra)
     -&gt; Identity
          (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
    -&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx)
-&gt; ((TxValidityLowerBound BabbageEra,
     TxValidityUpperBound BabbageEra)
    -&gt; Identity
         (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; UnbalancedTx
-&gt; Identity UnbalancedTx
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
 -&gt; Identity
      (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
-&gt; CardanoBuildTx -&gt; Identity CardanoBuildTx
Lens'
  CardanoBuildTx
  (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="Ledger.Tx.Constraints.OffChain.html#txValidityRange"><span class="hs-identifier hs-var">txValidityRange</span></a></span><span> </span><span class="annot"><span class="annottext">(((TxValidityLowerBound BabbageEra,
   TxValidityUpperBound BabbageEra)
  -&gt; Identity
       (TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra))
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; (TxValidityLowerBound BabbageEra,
    TxValidityUpperBound BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     ()
forall s (m :: * -&gt; *) a b.
MonadState s m =&gt;
ASetter s s a b -&gt; b -&gt; m ()
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">(TxValidityLowerBound BabbageEra, TxValidityUpperBound BabbageEra)
</span><a href="#local-6989586621679466647"><span class="hs-identifier hs-var">cTxTR</span></a></span><span>
</span><span id="line-791"></span><span>
</span><span id="line-792"></span><span class="hs-comment">-- | Add a typed input, checking the type of the output it spends. Return the value</span><span>
</span><span id="line-793"></span><span class="hs-comment">--   of the spent output.</span><span>
</span><span id="line-794"></span><span id="local-6989586621679467554"><span id="local-6989586621679467555"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#addOwnInput"><span class="hs-identifier hs-type">addOwnInput</span></a></span><span>
</span><span id="line-795"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467554"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-796"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467554"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-797"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-800"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier hs-type">ScriptInputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467555"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467554"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span></span></span><span>
</span><span id="line-803"></span><span id="addOwnInput"><span class="annot"><span class="annottext">addOwnInput :: ScriptInputConstraint (RedeemerType a) -&gt; m TxConstraint
</span><a href="Ledger.Tx.Constraints.OffChain.html#addOwnInput"><span class="hs-identifier hs-var hs-var">addOwnInput</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier hs-type">ScriptInputConstraint</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466645"><span class="annot"><span class="annottext">RedeemerType a
icRedeemer :: forall a. ScriptInputConstraint a -&gt; a
icRedeemer :: RedeemerType a
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#icRedeemer"><span class="hs-identifier hs-var hs-var">icRedeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466643"><span class="annot"><span class="annottext">TxOutRef
icTxOutRef :: forall a. ScriptInputConstraint a -&gt; TxOutRef
icTxOutRef :: TxOutRef
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#icTxOutRef"><span class="hs-identifier hs-var hs-var">icTxOutRef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466641"><span class="annot"><span class="annottext">Maybe TxOutRef
icReferenceTxOutRef :: forall a. ScriptInputConstraint a -&gt; Maybe TxOutRef
icReferenceTxOutRef :: Maybe TxOutRef
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#icReferenceTxOutRef"><span class="hs-identifier hs-var hs-var">icReferenceTxOutRef</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-804"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466639"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
slTxOutputs :: Map TxOutRef DecoratedTxOut
slTxOutputs :: forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466639"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466638"><span class="annot"><span class="annottext">Maybe (TypedValidator a)
slTypedValidator :: Maybe (TypedValidator a)
slTypedValidator :: forall a. ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="#local-6989586621679466638"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ScriptLookups a)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-805"></span><span>    </span><span id="local-6989586621679466637"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679466637"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (TypedValidator a)
-&gt; (TypedValidator a -&gt; m (TypedValidator a))
-&gt; Maybe (TypedValidator a)
-&gt; m (TypedValidator a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkTxError -&gt; m (TypedValidator a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TypedValidatorMissing"><span class="hs-identifier hs-var">TypedValidatorMissing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; m (TypedValidator a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypedValidator a)
</span><a href="#local-6989586621679466638"><span class="hs-identifier hs-var">slTypedValidator</span></a></span><span>
</span><span id="line-806"></span><span>    </span><span id="local-6989586621679466636"><span class="annot"><span class="annottext">TypedScriptTxOutRef a
</span><a href="#local-6989586621679466636"><span class="hs-identifier hs-var">typedOutRef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-807"></span><span>      </span><span class="annot"><span class="annottext">(ConnectionError -&gt; m (TypedScriptTxOutRef a))
-&gt; (TypedScriptTxOutRef a -&gt; m (TypedScriptTxOutRef a))
-&gt; Either ConnectionError (TypedScriptTxOutRef a)
-&gt; m (TypedScriptTxOutRef a)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">either</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkTxError -&gt; m (TypedScriptTxOutRef a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m (TypedScriptTxOutRef a))
-&gt; (ConnectionError -&gt; MkTxError)
-&gt; ConnectionError
-&gt; m (TypedScriptTxOutRef a)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConnectionError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TypeCheckFailed"><span class="hs-identifier hs-var">TypeCheckFailed</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypedScriptTxOutRef a -&gt; m (TypedScriptTxOutRef a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span>
</span><span id="line-808"></span><span>      </span><span class="annot"><span class="annottext">(Either ConnectionError (TypedScriptTxOutRef a)
 -&gt; m (TypedScriptTxOutRef a))
-&gt; Either ConnectionError (TypedScriptTxOutRef a)
-&gt; m (TypedScriptTxOutRef a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Except ConnectionError a -&gt; Either ConnectionError a
forall e a. Except e a -&gt; Either e a
</span><span class="hs-identifier hs-var">runExcept</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Typed.ConnectionError</span></span><span>
</span><span id="line-809"></span><span>      </span><span class="annot"><span class="annottext">(Except ConnectionError (TypedScriptTxOutRef a)
 -&gt; Either ConnectionError (TypedScriptTxOutRef a))
-&gt; Except ConnectionError (TypedScriptTxOutRef a)
-&gt; Either ConnectionError (TypedScriptTxOutRef a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-810"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621679466635"><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679466635"><span class="hs-identifier hs-var">txOut</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466634"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466634"><span class="hs-identifier hs-var">datum</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExceptT ConnectionError Identity (TxOut, Datum)
-&gt; ((TxOut, Datum)
    -&gt; ExceptT ConnectionError Identity (TxOut, Datum))
-&gt; Maybe (TxOut, Datum)
-&gt; ExceptT ConnectionError Identity (TxOut, Datum)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConnectionError -&gt; ExceptT ConnectionError Identity (TxOut, Datum)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(ConnectionError
 -&gt; ExceptT ConnectionError Identity (TxOut, Datum))
-&gt; ConnectionError
-&gt; ExceptT ConnectionError Identity (TxOut, Datum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; ConnectionError
</span><span class="hs-identifier hs-var">UnknownRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466643"><span class="hs-identifier hs-var">icTxOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TxOut, Datum) -&gt; ExceptT ConnectionError Identity (TxOut, Datum)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (TxOut, Datum)
 -&gt; ExceptT ConnectionError Identity (TxOut, Datum))
-&gt; Maybe (TxOut, Datum)
-&gt; ExceptT ConnectionError Identity (TxOut, Datum)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-811"></span><span>                                </span><span id="local-6989586621679466633"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466633"><span class="hs-identifier hs-var">ciTxOut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Map TxOutRef DecoratedTxOut -&gt; Maybe DecoratedTxOut
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Map.lookup</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466643"><span class="hs-identifier hs-var">icTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466639"><span class="hs-identifier hs-var">slTxOutputs</span></a></span><span>
</span><span id="line-812"></span><span>                                </span><span id="local-6989586621679466631"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466631"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466633"><span class="hs-identifier hs-var">ciTxOut</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; Getting (First Datum) DecoratedTxOut Datum -&gt; Maybe Datum
forall s a. s -&gt; Getting (First a) s a -&gt; Maybe a
</span><span class="hs-operator hs-var">^?</span></span><span> </span><span class="annot"><span class="annottext">((DatumHash, DatumFromQuery)
 -&gt; Const (First Datum) (DatumHash, DatumFromQuery))
-&gt; DecoratedTxOut -&gt; Const (First Datum) DecoratedTxOut
Traversal' DecoratedTxOut (DatumHash, DatumFromQuery)
</span><span class="hs-identifier hs-var">Tx.decoratedTxOutDatum</span></span><span> </span><span class="annot"><span class="annottext">(((DatumHash, DatumFromQuery)
  -&gt; Const (First Datum) (DatumHash, DatumFromQuery))
 -&gt; DecoratedTxOut -&gt; Const (First Datum) DecoratedTxOut)
-&gt; ((Datum -&gt; Const (First Datum) Datum)
    -&gt; (DatumHash, DatumFromQuery)
    -&gt; Const (First Datum) (DatumHash, DatumFromQuery))
-&gt; Getting (First Datum) DecoratedTxOut Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(DatumFromQuery -&gt; Const (First Datum) DatumFromQuery)
-&gt; (DatumHash, DatumFromQuery)
-&gt; Const (First Datum) (DatumHash, DatumFromQuery)
forall s t a b. Field2 s t a b =&gt; Lens s t a b
</span><span class="hs-identifier hs-var">_2</span></span><span> </span><span class="annot"><span class="annottext">((DatumFromQuery -&gt; Const (First Datum) DatumFromQuery)
 -&gt; (DatumHash, DatumFromQuery)
 -&gt; Const (First Datum) (DatumHash, DatumFromQuery))
-&gt; ((Datum -&gt; Const (First Datum) Datum)
    -&gt; DatumFromQuery -&gt; Const (First Datum) DatumFromQuery)
-&gt; (Datum -&gt; Const (First Datum) Datum)
-&gt; (DatumHash, DatumFromQuery)
-&gt; Const (First Datum) (DatumHash, DatumFromQuery)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; Const (First Datum) Datum)
-&gt; DatumFromQuery -&gt; Const (First Datum) DatumFromQuery
Traversal' DatumFromQuery Datum
</span><span class="hs-identifier hs-var">Tx.datumInDatumFromQuery</span></span><span>
</span><span id="line-813"></span><span>                                </span><span class="annot"><span class="annottext">(TxOut, Datum) -&gt; Maybe (TxOut, Datum)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; TxOut
</span><span class="hs-identifier hs-var">Tx.toTxInfoTxOut</span></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466633"><span class="hs-identifier hs-var">ciTxOut</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466631"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-814"></span><span>          </span><span class="annot"><span class="annottext">TypedValidator a
-&gt; TxOutRef
-&gt; TxOut
-&gt; Datum
-&gt; Except ConnectionError (TypedScriptTxOutRef a)
forall out (m :: * -&gt; *).
(FromData (DatumType out), ToData (DatumType out),
 MonadError ConnectionError m) =&gt;
TypedValidator out
-&gt; TxOutRef -&gt; TxOut -&gt; Datum -&gt; m (TypedScriptTxOutRef out)
</span><span class="hs-identifier hs-var">Typed.typeScriptTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679466637"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466643"><span class="hs-identifier hs-var">icTxOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><a href="#local-6989586621679466635"><span class="hs-identifier hs-var">txOut</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466634"><span class="hs-identifier hs-var">datum</span></a></span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466625"><span class="annot"><span class="annottext">red :: Redeemer
</span><a href="#local-6989586621679466625"><span class="hs-identifier hs-var hs-var">red</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><span class="hs-identifier hs-var">Redeemer</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RedeemerType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">RedeemerType a
</span><a href="#local-6989586621679466645"><span class="hs-identifier hs-var">icRedeemer</span></a></span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><span class="annottext">TxConstraint -&gt; m TxConstraint
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; m TxConstraint) -&gt; TxConstraint -&gt; m TxConstraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; Maybe TxOutRef -&gt; TxConstraint
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-var">MustSpendScriptOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedScriptTxOutRef a -&gt; TxOutRef
forall a. TypedScriptTxOutRef a -&gt; TxOutRef
</span><span class="hs-identifier hs-var hs-var">Typed.tyTxOutRefRef</span></span><span> </span><span class="annot"><span class="annottext">TypedScriptTxOutRef a
</span><a href="#local-6989586621679466636"><span class="hs-identifier hs-var">typedOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466625"><span class="hs-identifier hs-var">red</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466641"><span class="hs-identifier hs-var">icReferenceTxOutRef</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span class="hs-comment">-- | Convert a @ScriptOutputConstraint@ into a @TxConstraint@.</span><span>
</span><span id="line-819"></span><span id="local-6989586621679467551"><span id="local-6989586621679467552"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#addOwnOutput"><span class="hs-identifier hs-type">addOwnOutput</span></a></span><span>
</span><span id="line-820"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467552"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467551"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-821"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467551"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-822"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467552"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-823"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-824"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier hs-type">ScriptOutputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679467552"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-825"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467551"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span></span></span><span>
</span><span id="line-826"></span><span id="addOwnOutput"><span class="annot"><span class="annottext">addOwnOutput :: ScriptOutputConstraint (DatumType a) -&gt; m TxConstraint
</span><a href="Ledger.Tx.Constraints.OffChain.html#addOwnOutput"><span class="hs-identifier hs-var hs-var">addOwnOutput</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier hs-type">ScriptOutputConstraint</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466622"><span class="annot"><span class="annottext">TxOutDatum (DatumType a)
ocDatum :: forall a. ScriptOutputConstraint a -&gt; TxOutDatum a
ocDatum :: TxOutDatum (DatumType a)
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#ocDatum"><span class="hs-identifier hs-var hs-var">ocDatum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466620"><span class="annot"><span class="annottext">Value
ocValue :: forall a. ScriptOutputConstraint a -&gt; Value
ocValue :: Value
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#ocValue"><span class="hs-identifier hs-var hs-var">ocValue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466618"><span class="annot"><span class="annottext">Maybe ScriptHash
ocReferenceScriptHash :: forall a. ScriptOutputConstraint a -&gt; Maybe ScriptHash
ocReferenceScriptHash :: Maybe ScriptHash
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#ocReferenceScriptHash"><span class="hs-identifier hs-var hs-var">ocReferenceScriptHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-827"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466616"><span class="annot"><span class="annottext">Maybe (TypedValidator a)
slTypedValidator :: Maybe (TypedValidator a)
slTypedValidator :: forall a. ScriptLookups a -&gt; Maybe (TypedValidator a)
</span><a href="#local-6989586621679466616"><span class="hs-identifier hs-var hs-var">slTypedValidator</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ScriptLookups a)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-828"></span><span>    </span><span id="local-6989586621679466615"><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679466615"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (TypedValidator a)
-&gt; (TypedValidator a -&gt; m (TypedValidator a))
-&gt; Maybe (TypedValidator a)
-&gt; m (TypedValidator a)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MkTxError -&gt; m (TypedValidator a)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TypedValidatorMissing"><span class="hs-identifier hs-var">TypedValidatorMissing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TypedValidator a -&gt; m (TypedValidator a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TypedValidator a)
</span><a href="#local-6989586621679466616"><span class="hs-identifier hs-var">slTypedValidator</span></a></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466614"><span class="annot"><span class="annottext">dsV :: TxOutDatum Datum
</span><a href="#local-6989586621679466614"><span class="hs-identifier hs-var hs-var">dsV</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DatumType a -&gt; Datum)
-&gt; TxOutDatum (DatumType a) -&gt; TxOutDatum Datum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum)
-&gt; (DatumType a -&gt; BuiltinData) -&gt; DatumType a -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DatumType a -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">toBuiltinData</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatum (DatumType a)
</span><a href="#local-6989586621679466622"><span class="hs-identifier hs-var">ocDatum</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span class="annot"><span class="annottext">TxConstraint -&gt; m TxConstraint
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; m TxConstraint) -&gt; TxConstraint -&gt; m TxConstraint
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Address
-&gt; Maybe (TxOutDatum Datum)
-&gt; Maybe ScriptHash
-&gt; Value
-&gt; TxConstraint
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#MustPayToAddress"><span class="hs-identifier hs-var">MustPayToAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator a -&gt; Address
forall a. TypedValidator a -&gt; Address
</span><span class="hs-identifier hs-var">validatorAddress</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator a
</span><a href="#local-6989586621679466615"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum Datum -&gt; Maybe (TxOutDatum Datum)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum Datum
</span><a href="#local-6989586621679466614"><span class="hs-identifier hs-var">dsV</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466618"><span class="hs-identifier hs-var">ocReferenceScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466620"><span class="hs-identifier hs-var">ocValue</span></a></span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span id="local-6989586621679467361"><span id="local-6989586621679467362"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupDatum"><span class="hs-identifier hs-type">lookupDatum</span></a></span><span>
</span><span id="line-833"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467362"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467361"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-834"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467361"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-835"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DatumHash</span></span><span>
</span><span id="line-837"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467361"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span></span></span><span>
</span><span id="line-838"></span><span id="lookupDatum"><span class="annot"><span class="annottext">lookupDatum :: DatumHash -&gt; m Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupDatum"><span class="hs-identifier hs-var hs-var">lookupDatum</span></a></span></span><span> </span><span id="local-6989586621679466612"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466612"><span class="hs-identifier hs-var">dvh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-839"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466611"><span class="annot"><span class="annottext">err :: m Datum
</span><a href="#local-6989586621679466611"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m Datum
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumHash -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#DatumNotFound"><span class="hs-identifier hs-var">DatumNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466612"><span class="hs-identifier hs-var">dvh</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-840"></span><span>    </span><span class="annot"><span class="annottext">(ScriptLookups a -&gt; Map DatumHash Datum) -&gt; m (Map DatumHash Datum)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map DatumHash Datum
forall a. ScriptLookups a -&gt; Map DatumHash Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherData"><span class="hs-identifier hs-var hs-var">slOtherData</span></a></span><span> </span><span class="annot"><span class="annottext">m (Map DatumHash Datum)
-&gt; (Map DatumHash Datum -&gt; m Datum) -&gt; m Datum
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m Datum -&gt; (Datum -&gt; m Datum) -&gt; Maybe Datum -&gt; m Datum
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">m Datum
</span><a href="#local-6989586621679466611"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; m Datum
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Datum -&gt; m Datum)
-&gt; (Map DatumHash Datum -&gt; Maybe Datum)
-&gt; Map DatumHash Datum
-&gt; m Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting (Maybe Datum) (Map DatumHash Datum) (Maybe Datum)
-&gt; Map DatumHash Datum -&gt; Maybe Datum
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index (Map DatumHash Datum)
-&gt; Lens'
     (Map DatumHash Datum) (Maybe (IxValue (Map DatumHash Datum)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map DatumHash Datum)
DatumHash
</span><a href="#local-6989586621679466612"><span class="hs-identifier hs-var">dvh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span id="local-6989586621679467364"><span id="local-6989586621679467365"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupValidator"><span class="hs-identifier hs-type">lookupValidator</span></a></span><span>
</span><span id="line-843"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467365"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467364"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-844"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467364"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-845"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidatorHash</span></span><span>
</span><span id="line-847"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467364"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-848"></span><span id="lookupValidator"><span class="annot"><span class="annottext">lookupValidator :: ValidatorHash -&gt; m (Versioned Validator)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupValidator"><span class="hs-identifier hs-var hs-var">lookupValidator</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ValidatorHash</span></span><span> </span><span id="local-6989586621679466607"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679466607"><span class="hs-identifier hs-var">vh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Script -&gt; Validator) -&gt; Versioned Script -&gt; Versioned Validator
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Script -&gt; Validator
</span><span class="hs-identifier hs-var">Validator</span></span><span> </span><span class="annot"><span class="annottext">(Versioned Script -&gt; Versioned Validator)
-&gt; m (Versioned Script) -&gt; m (Versioned Validator)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash -&gt; m (Versioned Script)
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
ScriptHash -&gt; m (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier hs-var">lookupScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ScriptHash
</span><span class="hs-identifier hs-var">ScriptHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679466607"><span class="hs-identifier hs-var">vh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span id="local-6989586621679467375"><span id="local-6989586621679467376"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier hs-type">lookupScript</span></a></span><span>
</span><span id="line-851"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467376"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467375"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-852"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467375"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-853"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptHash</span></span><span>
</span><span id="line-855"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467375"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Script</span></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-856"></span><span id="lookupScript"><span class="annot"><span class="annottext">lookupScript :: ScriptHash -&gt; m (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier hs-var hs-var">lookupScript</span></a></span></span><span> </span><span id="local-6989586621679466606"><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679466606"><span class="hs-identifier hs-var">sh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-857"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466605"><span class="annot"><span class="annottext">err :: m (Versioned Script)
</span><a href="#local-6989586621679466605"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m (Versioned Script)
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptHash -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ScriptHashNotFound"><span class="hs-identifier hs-var">ScriptHashNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
</span><a href="#local-6989586621679466606"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-858"></span><span>    </span><span class="annot"><span class="annottext">(ScriptLookups a -&gt; Map ScriptHash (Versioned Script))
-&gt; m (Map ScriptHash (Versioned Script))
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
forall a. ScriptLookups a -&gt; Map ScriptHash (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#slOtherScripts"><span class="hs-identifier hs-var hs-var">slOtherScripts</span></a></span><span> </span><span class="annot"><span class="annottext">m (Map ScriptHash (Versioned Script))
-&gt; (Map ScriptHash (Versioned Script) -&gt; m (Versioned Script))
-&gt; m (Versioned Script)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">m (Versioned Script)
-&gt; (Versioned Script -&gt; m (Versioned Script))
-&gt; Maybe (Versioned Script)
-&gt; m (Versioned Script)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">m (Versioned Script)
</span><a href="#local-6989586621679466605"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Script -&gt; m (Versioned Script)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Versioned Script) -&gt; m (Versioned Script))
-&gt; (Map ScriptHash (Versioned Script) -&gt; Maybe (Versioned Script))
-&gt; Map ScriptHash (Versioned Script)
-&gt; m (Versioned Script)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe (Versioned Script))
  (Map ScriptHash (Versioned Script))
  (Maybe (Versioned Script))
-&gt; Map ScriptHash (Versioned Script) -&gt; Maybe (Versioned Script)
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index (Map ScriptHash (Versioned Script))
-&gt; Lens'
     (Map ScriptHash (Versioned Script))
     (Maybe (IxValue (Map ScriptHash (Versioned Script))))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map ScriptHash (Versioned Script))
ScriptHash
</span><a href="#local-6989586621679466606"><span class="hs-identifier hs-var">sh</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>
</span><span id="line-860"></span><span id="local-6989586621679467460"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-type">lookupTxOutRef</span></a></span><span>
</span><span id="line-861"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx.TxOutRef</span></span><span>
</span><span id="line-862"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467460"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Tx.DecoratedTxOut</span></span></span><span>
</span><span id="line-863"></span><span id="lookupTxOutRef"><span class="annot"><span class="annottext">lookupTxOutRef :: TxOutRef
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupTxOutRef"><span class="hs-identifier hs-var hs-var">lookupTxOutRef</span></a></span></span><span> </span><span id="local-6989586621679466604"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466604"><span class="hs-identifier hs-var">outRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-864"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466603"><span class="annot"><span class="annottext">err :: ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  DecoratedTxOut
</span><a href="#local-6989586621679466603"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkTxError
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#TxOutRefNotFound"><span class="hs-identifier hs-var">TxOutRefNotFound</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466604"><span class="hs-identifier hs-var">outRef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-865"></span><span>    </span><span class="annot"><span class="annottext">(ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Map TxOutRef DecoratedTxOut)
forall r (m :: * -&gt; *) a. MonadReader r m =&gt; (r -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">asks</span></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="Ledger.Tx.Constraints.OffChain.html#slTxOutputs"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  (Map TxOutRef DecoratedTxOut)
-&gt; (Map TxOutRef DecoratedTxOut
    -&gt; ReaderT
         (ScriptLookups a)
         (StateT ConstraintProcessingState (Except MkTxError))
         DecoratedTxOut)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  DecoratedTxOut
-&gt; (DecoratedTxOut
    -&gt; ReaderT
         (ScriptLookups a)
         (StateT ConstraintProcessingState (Except MkTxError))
         DecoratedTxOut)
-&gt; Maybe DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ReaderT
  (ScriptLookups a)
  (StateT ConstraintProcessingState (Except MkTxError))
  DecoratedTxOut
</span><a href="#local-6989586621679466603"><span class="hs-identifier hs-var">err</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe DecoratedTxOut
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      DecoratedTxOut)
-&gt; (Map TxOutRef DecoratedTxOut -&gt; Maybe DecoratedTxOut)
-&gt; Map TxOutRef DecoratedTxOut
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     DecoratedTxOut
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Getting
  (Maybe DecoratedTxOut)
  (Map TxOutRef DecoratedTxOut)
  (Maybe DecoratedTxOut)
-&gt; Map TxOutRef DecoratedTxOut -&gt; Maybe DecoratedTxOut
forall s (m :: * -&gt; *) a. MonadReader s m =&gt; Getting a s a -&gt; m a
</span><span class="hs-identifier hs-var">view</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Index (Map TxOutRef DecoratedTxOut)
-&gt; Lens'
     (Map TxOutRef DecoratedTxOut)
     (Maybe (IxValue (Map TxOutRef DecoratedTxOut)))
forall m. At m =&gt; Index m -&gt; Lens' m (Maybe (IxValue m))
</span><span class="hs-identifier hs-var">at</span></span><span> </span><span class="annot"><span class="annottext">Index (Map TxOutRef DecoratedTxOut)
TxOutRef
</span><a href="#local-6989586621679466604"><span class="hs-identifier hs-var">outRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span id="local-6989586621679467438"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupMintingPolicy"><span class="hs-identifier hs-type">lookupMintingPolicy</span></a></span><span>
</span><span id="line-868"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicyHash</span></span><span>
</span><span id="line-869"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467438"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicy</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-870"></span><span id="lookupMintingPolicy"><span class="annot"><span class="annottext">lookupMintingPolicy :: MintingPolicyHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned MintingPolicy)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupMintingPolicy"><span class="hs-identifier hs-var hs-var">lookupMintingPolicy</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">MintingPolicyHash</span></span><span> </span><span id="local-6989586621679466602"><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679466602"><span class="hs-identifier hs-var">mph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Script -&gt; MintingPolicy)
-&gt; Versioned Script -&gt; Versioned MintingPolicy
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Script -&gt; MintingPolicy
</span><span class="hs-identifier hs-var">MintingPolicy</span></span><span> </span><span class="annot"><span class="annottext">(Versioned Script -&gt; Versioned MintingPolicy)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned Script)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned MintingPolicy)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned Script)
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
ScriptHash -&gt; m (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier hs-var">lookupScript</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinByteString -&gt; ScriptHash
</span><span class="hs-identifier hs-var">ScriptHash</span></span><span> </span><span class="annot"><span class="annottext">BuiltinByteString
</span><a href="#local-6989586621679466602"><span class="hs-identifier hs-var">mph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-871"></span><span>
</span><span id="line-872"></span><span id="local-6989586621679467430"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#lookupScriptAsReferenceScript"><span class="hs-identifier hs-type">lookupScriptAsReferenceScript</span></a></span><span>
</span><span id="line-873"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptHash</span></span><span>
</span><span id="line-874"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReaderT</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467430"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateT</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Except</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">C.ReferenceScript</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-875"></span><span id="lookupScriptAsReferenceScript"><span class="annot"><span class="annottext">lookupScriptAsReferenceScript :: Maybe ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ReferenceScript BabbageEra)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScriptAsReferenceScript"><span class="hs-identifier hs-var hs-var">lookupScriptAsReferenceScript</span></a></span></span><span> </span><span id="local-6989586621679466601"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466601"><span class="hs-identifier hs-var">msh</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-876"></span><span>    </span><span id="local-6989586621679466600"><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679466600"><span class="hs-identifier hs-var">mscript</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ScriptHash
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (Versioned Script))
-&gt; Maybe ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Maybe (Versioned Script))
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptHash
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (Versioned Script)
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
ScriptHash -&gt; m (Versioned Script)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupScript"><span class="hs-identifier hs-var">lookupScript</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466601"><span class="hs-identifier hs-var">msh</span></a></span><span>
</span><span id="line-877"></span><span>    </span><span class="annot"><span class="annottext">Either ToCardanoError (ReferenceScript BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ReferenceScript BabbageEra)
forall (m :: * -&gt; *) a.
MonadError MkTxError m =&gt;
Either ToCardanoError a -&gt; m a
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwToCardanoError"><span class="hs-identifier hs-var">throwToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError (ReferenceScript BabbageEra)
 -&gt; ReaderT
      (ScriptLookups a)
      (StateT ConstraintProcessingState (Except MkTxError))
      (ReferenceScript BabbageEra))
-&gt; Either ToCardanoError (ReferenceScript BabbageEra)
-&gt; ReaderT
     (ScriptLookups a)
     (StateT ConstraintProcessingState (Except MkTxError))
     (ReferenceScript BabbageEra)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
-&gt; Either ToCardanoError (ReferenceScript BabbageEra)
</span><span class="hs-identifier hs-var">C.toCardanoReferenceScript</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Script)
</span><a href="#local-6989586621679466600"><span class="hs-identifier hs-var">mscript</span></a></span><span>
</span><span id="line-878"></span><span>
</span><span id="line-879"></span><span id="local-6989586621679467518"><span id="local-6989586621679467519"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOut"><span class="hs-identifier hs-type">resolveScriptTxOut</span></a></span><span>
</span><span id="line-880"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467519"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467518"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-881"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467518"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-882"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecoratedTxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467518"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWithOrigin"><span class="hs-identifier hs-type">DatumWithOrigin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-884"></span><span id="resolveScriptTxOut"><span class="annot"><span class="annottext">resolveScriptTxOut :: DecoratedTxOut
-&gt; m (Maybe (Versioned Validator, DatumWithOrigin, Value))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOut"><span class="hs-identifier hs-var hs-var">resolveScriptTxOut</span></a></span></span><span> </span><span id="local-6989586621679466597"><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466597"><span class="hs-identifier hs-var">txo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-885"></span><span>    </span><span id="local-6989586621679466596"><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466596"><span class="hs-identifier hs-var">mv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; m (Maybe (Versioned Validator))
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DecoratedTxOut -&gt; m (Maybe (Versioned Validator))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier hs-var">resolveScriptTxOutValidator</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466597"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-886"></span><span>    </span><span id="local-6989586621679466595"><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
</span><a href="#local-6989586621679466595"><span class="hs-identifier hs-var">mdv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; m (Maybe (DatumWithOrigin, Value))
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DecoratedTxOut -&gt; m (Maybe (DatumWithOrigin, Value))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier hs-var">resolveScriptTxOutDatumAndValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><a href="#local-6989586621679466597"><span class="hs-identifier hs-var">txo</span></a></span><span>
</span><span id="line-887"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Versioned Validator, DatumWithOrigin, Value)
-&gt; m (Maybe (Versioned Validator, DatumWithOrigin, Value))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Versioned Validator, DatumWithOrigin, Value)
 -&gt; m (Maybe (Versioned Validator, DatumWithOrigin, Value)))
-&gt; Maybe (Versioned Validator, DatumWithOrigin, Value)
-&gt; m (Maybe (Versioned Validator, DatumWithOrigin, Value))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679466594"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466594"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466593"><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466593"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466592"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466592"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466594"><span class="hs-identifier hs-var">v</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466593"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466592"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Versioned Validator
 -&gt; (DatumWithOrigin, Value)
 -&gt; (Versioned Validator, DatumWithOrigin, Value))
-&gt; Maybe (Versioned Validator)
-&gt; Maybe
     ((DatumWithOrigin, Value)
      -&gt; (Versioned Validator, DatumWithOrigin, Value))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466596"><span class="hs-identifier hs-var">mv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe
  ((DatumWithOrigin, Value)
   -&gt; (Versioned Validator, DatumWithOrigin, Value))
-&gt; Maybe (DatumWithOrigin, Value)
-&gt; Maybe (Versioned Validator, DatumWithOrigin, Value)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
</span><a href="#local-6989586621679466595"><span class="hs-identifier hs-var">mdv</span></a></span><span>
</span><span id="line-888"></span><span>
</span><span id="line-889"></span><span id="local-6989586621679467447"><span id="local-6989586621679467448"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier hs-type">resolveScriptTxOutValidator</span></a></span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467448"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467447"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-891"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467447"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-892"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-893"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecoratedTxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Versioned</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-894"></span><span id="resolveScriptTxOutValidator"><span class="annot"><span class="annottext">resolveScriptTxOutValidator :: DecoratedTxOut -&gt; m (Maybe (Versioned Validator))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier hs-var hs-var">resolveScriptTxOutValidator</span></a></span></span><span>
</span><span id="line-895"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Tx.ScriptDecoratedTxOut</span></span><span>
</span><span id="line-896"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_decoratedTxOutValidator :: DecoratedTxOut -&gt; Maybe (Versioned Validator)
</span><span class="hs-identifier hs-var">Tx._decoratedTxOutValidator</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679466589"><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466589"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-897"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">_decoratedTxOutValidatorHash :: DecoratedTxOut -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">Tx._decoratedTxOutValidatorHash</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621679466587"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466587"><span class="hs-identifier hs-var">vh</span></a></span></span><span>
</span><span id="line-898"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-899"></span><span>    </span><span class="hs-comment">-- first check in the 'DecoratedTxOut' for the validator, then</span><span>
</span><span id="line-900"></span><span>    </span><span class="hs-comment">-- look for it in the 'slOtherScripts' map.</span><span>
</span><span id="line-901"></span><span>    </span><span id="local-6989586621679466586"><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466586"><span class="hs-identifier hs-var">validator</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (Versioned Validator)
-&gt; (Versioned Validator -&gt; m (Versioned Validator))
-&gt; Maybe (Versioned Validator)
-&gt; m (Versioned Validator)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ValidatorHash -&gt; m (Versioned Validator)
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
ValidatorHash -&gt; m (Versioned Validator)
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupValidator"><span class="hs-identifier hs-var">lookupValidator</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466587"><span class="hs-identifier hs-var">vh</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Versioned Validator -&gt; m (Versioned Validator)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator)
</span><a href="#local-6989586621679466589"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><span class="annottext">Maybe (Versioned Validator) -&gt; m (Maybe (Versioned Validator))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Versioned Validator) -&gt; m (Maybe (Versioned Validator)))
-&gt; Maybe (Versioned Validator) -&gt; m (Maybe (Versioned Validator))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Validator -&gt; Maybe (Versioned Validator)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Versioned Validator
</span><a href="#local-6989586621679466586"><span class="hs-identifier hs-var">validator</span></a></span><span>
</span><span id="line-903"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutValidator"><span class="hs-identifier hs-var">resolveScriptTxOutValidator</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator) -&gt; m (Maybe (Versioned Validator))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Versioned Validator)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span id="local-6989586621679467445"><span id="local-6989586621679467446"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier hs-type">resolveScriptTxOutDatumAndValue</span></a></span><span>
</span><span id="line-906"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467446"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679467445"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-907"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467445"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-909"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DecoratedTxOut</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467445"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#DatumWithOrigin"><span class="hs-identifier hs-type">DatumWithOrigin</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-910"></span><span id="resolveScriptTxOutDatumAndValue"><span class="annot"><span class="annottext">resolveScriptTxOutDatumAndValue :: DecoratedTxOut -&gt; m (Maybe (DatumWithOrigin, Value))
</span><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier hs-var hs-var">resolveScriptTxOutDatumAndValue</span></a></span></span><span>
</span><span id="line-911"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Tx.ScriptDecoratedTxOut</span></span><span>
</span><span id="line-912"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">_decoratedTxOutScriptDatum :: DecoratedTxOut -&gt; (DatumHash, DatumFromQuery)
</span><span class="hs-identifier hs-var">Tx._decoratedTxOutScriptDatum</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679466584"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466584"><span class="hs-identifier hs-var">dh</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466583"><span class="annot"><span class="annottext">DatumFromQuery
</span><a href="#local-6989586621679466583"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>            </span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466582"><span class="annot"><span class="annottext">Value
_decoratedTxOutValue :: DecoratedTxOut -&gt; Value
_decoratedTxOutValue :: Value
</span><span class="hs-identifier hs-var hs-var">Tx._decoratedTxOutValue</span></span></span><span>
</span><span id="line-914"></span><span>            </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span>    </span><span class="hs-comment">-- first check in the 'DecoratedTxOut' for the datum, then</span><span>
</span><span id="line-917"></span><span>    </span><span class="hs-comment">-- look for it in the 'slOtherData' map.</span><span>
</span><span id="line-918"></span><span>    </span><span id="local-6989586621679466580"><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466580"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DatumFromQuery
</span><a href="#local-6989586621679466583"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-919"></span><span>        </span><span class="annot"><span class="annottext">DatumFromQuery
</span><span class="hs-identifier hs-var">Tx.DatumUnknown</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; DatumWithOrigin
</span><a href="Ledger.Tx.Constraints.OffChain.html#DatumInTx"><span class="hs-identifier hs-var">DatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">(Datum -&gt; DatumWithOrigin) -&gt; m Datum -&gt; m DatumWithOrigin
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; m Datum
forall a (m :: * -&gt; *).
(MonadReader (ScriptLookups a) m, MonadError MkTxError m) =&gt;
DatumHash -&gt; m Datum
</span><a href="Ledger.Tx.Constraints.OffChain.html#lookupDatum"><span class="hs-identifier hs-var">lookupDatum</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466584"><span class="hs-identifier hs-var">dh</span></a></span><span>
</span><span id="line-920"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Tx.DatumInBody</span></span><span> </span><span id="local-6989586621679466577"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466577"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin -&gt; m DatumWithOrigin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumWithOrigin
</span><a href="Ledger.Tx.Constraints.OffChain.html#DatumInTx"><span class="hs-identifier hs-var">DatumInTx</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466577"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-921"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Tx.DatumInline</span></span><span> </span><span id="local-6989586621679466575"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466575"><span class="hs-identifier hs-var">datum</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DatumWithOrigin -&gt; m DatumWithOrigin
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Datum -&gt; DatumWithOrigin
</span><a href="Ledger.Tx.Constraints.OffChain.html#DatumInline"><span class="hs-identifier hs-var">DatumInline</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466575"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>    </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
-&gt; m (Maybe (DatumWithOrigin, Value))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (DatumWithOrigin, Value)
 -&gt; m (Maybe (DatumWithOrigin, Value)))
-&gt; Maybe (DatumWithOrigin, Value)
-&gt; m (Maybe (DatumWithOrigin, Value))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(DatumWithOrigin, Value) -&gt; Maybe (DatumWithOrigin, Value)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DatumWithOrigin
</span><a href="#local-6989586621679466580"><span class="hs-identifier hs-var">datum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value
</span><span class="hs-identifier hs-var">C.fromCardanoValue</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466582"><span class="hs-identifier hs-var">_decoratedTxOutValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#resolveScriptTxOutDatumAndValue"><span class="hs-identifier hs-var">resolveScriptTxOutDatumAndValue</span></a></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
-&gt; m (Maybe (DatumWithOrigin, Value))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (DatumWithOrigin, Value)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span id="local-6989586621679467368"><span id="local-6989586621679467369"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#throwToCardanoError"><span class="hs-identifier hs-type">throwToCardanoError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.ToCardanoError</span></span><span> </span><span class="annot"><a href="#local-6989586621679467368"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679467369"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679467368"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-926"></span><span id="throwToCardanoError"><span class="annot"><span class="annottext">throwToCardanoError :: Either ToCardanoError a -&gt; m a
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwToCardanoError"><span class="hs-identifier hs-var hs-var">throwToCardanoError</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621679466574"><span class="annot"><span class="annottext">ToCardanoError
</span><a href="#local-6989586621679466574"><span class="hs-identifier hs-var">err</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MkTxError -&gt; m a
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span> </span><span class="annot"><span class="annottext">(MkTxError -&gt; m a) -&gt; MkTxError -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError -&gt; MkTxError
</span><a href="Ledger.Tx.Constraints.OffChain.html#ToCardanoError"><span class="hs-identifier hs-var">ToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">ToCardanoError
</span><a href="#local-6989586621679466574"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-927"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#throwToCardanoError"><span class="hs-identifier hs-var">throwToCardanoError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621679466573"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679466573"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679466573"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#toTxOutDatum"><span class="hs-identifier hs-type">toTxOutDatum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatum"><span class="hs-identifier hs-type">TxOutDatum</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Datum</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.TxOutDatum</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.CtxTx</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">C.BabbageEra</span></span><span>
</span><span id="line-930"></span><span id="toTxOutDatum"><span class="annot"><span class="annottext">toTxOutDatum :: Maybe (TxOutDatum Datum) -&gt; TxOutDatum CtxTx BabbageEra
</span><a href="Ledger.Tx.Constraints.OffChain.html#toTxOutDatum"><span class="hs-identifier hs-var hs-var">toTxOutDatum</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-931"></span><span>    </span><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxOutDatum CtxTx BabbageEra
</span><span class="hs-identifier hs-var">C.toCardanoTxOutNoDatum</span></span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumHash"><span class="hs-identifier hs-type">TxOutDatumHash</span></a></span><span> </span><span id="local-6989586621679466570"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466570"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx BabbageEra
forall ctx. Datum -&gt; TxOutDatum ctx BabbageEra
</span><span class="hs-identifier hs-var">C.toCardanoTxOutDatumHashFromDatum</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466570"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-933"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInTx"><span class="hs-identifier hs-type">TxOutDatumInTx</span></a></span><span> </span><span id="local-6989586621679466567"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466567"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx BabbageEra
</span><span class="hs-identifier hs-var">C.toCardanoTxOutDatumInTx</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466567"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-934"></span><span>    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInline"><span class="hs-identifier hs-type">TxOutDatumInline</span></a></span><span> </span><span id="local-6989586621679466564"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466564"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; TxOutDatum CtxTx BabbageEra
</span><span class="hs-identifier hs-var">C.toCardanoTxOutDatumInline</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466564"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-935"></span><span>
</span><span id="line-936"></span><span class="hs-comment">-- | Turn a 'TxConstraints' value into an unbalanced transaction that satisfies</span><span>
</span><span id="line-937"></span><span class="hs-comment">--   the constraints. To use this in a contract, see</span><span>
</span><span id="line-938"></span><span class="hs-comment">--   'Plutus.Contract.submitTxConstraints'</span><span>
</span><span id="line-939"></span><span class="hs-comment">--   and related functions.</span><span>
</span><span id="line-940"></span><span id="local-6989586621679466562"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#mkTxWithParams"><span class="hs-identifier hs-type">mkTxWithParams</span></a></span><span>
</span><span id="line-941"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FromData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-945"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Params</span></span><span>
</span><span id="line-946"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-947"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">RedeemerType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">DatumType</span></span><span> </span><span class="annot"><a href="#local-6989586621679466562"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span></span><span>
</span><span id="line-949"></span><span id="mkTxWithParams"><span class="annot"><span class="annottext">mkTxWithParams :: Params
-&gt; ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Either MkTxError UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#mkTxWithParams"><span class="hs-identifier hs-var hs-var">mkTxWithParams</span></a></span></span><span> </span><span id="local-6989586621679466561"><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466561"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span id="local-6989586621679466560"><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466560"><span class="hs-identifier hs-var">lookups</span></a></span></span><span> </span><span id="local-6989586621679466559"><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466559"><span class="hs-identifier hs-var">txc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Params
-&gt; [SomeLookupsAndConstraints] -&gt; Either MkTxError UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#mkSomeTx"><span class="hs-identifier hs-var">mkSomeTx</span></a></span><span> </span><span class="annot"><span class="annottext">Params
</span><a href="#local-6989586621679466561"><span class="hs-identifier hs-var">params</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; SomeLookupsAndConstraints
forall a.
(FromData (DatumType a), ToData (DatumType a),
 ToData (RedeemerType a)) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; SomeLookupsAndConstraints
</span><a href="Ledger.Tx.Constraints.OffChain.html#SomeLookupsAndConstraints"><span class="hs-identifier hs-var">SomeLookupsAndConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptLookups a
</span><a href="#local-6989586621679466560"><span class="hs-identifier hs-var">lookups</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints (RedeemerType a) (DatumType a)
</span><a href="#local-6989586621679466559"><span class="hs-identifier hs-var">txc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-950"></span><span>
</span><span id="line-951"></span><span class="hs-comment">-- | Each transaction output should contain a minimum amount of Ada (this is a</span><span>
</span><span id="line-952"></span><span class="hs-comment">-- restriction on the real Cardano network).</span><span>
</span><span id="line-953"></span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#adjustUnbalancedTx"><span class="hs-identifier hs-type">adjustUnbalancedTx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PParams</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">C.Lovelace</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#UnbalancedTx"><span class="hs-identifier hs-type">UnbalancedTx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span id="adjustUnbalancedTx"><span class="annot"><span class="annottext">adjustUnbalancedTx :: PParams -&gt; UnbalancedTx -&gt; ([Lovelace], UnbalancedTx)
</span><a href="Ledger.Tx.Constraints.OffChain.html#adjustUnbalancedTx"><span class="hs-identifier hs-var hs-var">adjustUnbalancedTx</span></a></span></span><span> </span><span id="local-6989586621679466558"><span class="annot"><span class="annottext">PParams
</span><a href="#local-6989586621679466558"><span class="hs-identifier hs-var">params</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CardanoBuildTx -&gt; ([Lovelace], CardanoBuildTx))
-&gt; UnbalancedTx -&gt; ([Lovelace], UnbalancedTx)
Traversal' UnbalancedTx CardanoBuildTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#tx"><span class="hs-identifier hs-var">tx</span></a></span><span> </span><span class="annot"><span class="annottext">((CardanoBuildTx -&gt; ([Lovelace], CardanoBuildTx))
 -&gt; UnbalancedTx -&gt; ([Lovelace], UnbalancedTx))
-&gt; ((TxOut -&gt; ([Lovelace], TxOut))
    -&gt; CardanoBuildTx -&gt; ([Lovelace], CardanoBuildTx))
-&gt; (TxOut -&gt; ([Lovelace], TxOut))
-&gt; UnbalancedTx
-&gt; ([Lovelace], UnbalancedTx)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([TxOut] -&gt; ([Lovelace], [TxOut]))
-&gt; CardanoBuildTx -&gt; ([Lovelace], CardanoBuildTx)
Lens' CardanoBuildTx [TxOut]
</span><a href="Ledger.Tx.Constraints.OffChain.html#txOuts"><span class="hs-identifier hs-var">txOuts</span></a></span><span> </span><span class="annot"><span class="annottext">(([TxOut] -&gt; ([Lovelace], [TxOut]))
 -&gt; CardanoBuildTx -&gt; ([Lovelace], CardanoBuildTx))
-&gt; ((TxOut -&gt; ([Lovelace], TxOut))
    -&gt; [TxOut] -&gt; ([Lovelace], [TxOut]))
-&gt; (TxOut -&gt; ([Lovelace], TxOut))
-&gt; CardanoBuildTx
-&gt; ([Lovelace], CardanoBuildTx)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; ([Lovelace], TxOut)) -&gt; [TxOut] -&gt; ([Lovelace], [TxOut])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">((TxOut -&gt; ([Lovelace], TxOut))
 -&gt; UnbalancedTx -&gt; ([Lovelace], UnbalancedTx))
-&gt; (TxOut -&gt; ([Lovelace], TxOut))
-&gt; UnbalancedTx
-&gt; ([Lovelace], UnbalancedTx)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PParams -&gt; TxOut -&gt; ([Lovelace], TxOut)
</span><span class="hs-identifier hs-var">adjustTxOut</span></span><span> </span><span class="annot"><span class="annottext">PParams
</span><a href="#local-6989586621679466558"><span class="hs-identifier hs-var">params</span></a></span><span>
</span><span id="line-955"></span><span>
</span><span id="line-956"></span><span id="local-6989586621679466556"><span id="local-6989586621679466557"><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#updateUtxoIndex"><span class="hs-identifier hs-type">updateUtxoIndex</span></a></span><span>
</span><span id="line-957"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466557"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679466556"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-958"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadState</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ConstraintProcessingState"><span class="hs-identifier hs-type">ConstraintProcessingState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466556"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-959"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MonadError</span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#MkTxError"><span class="hs-identifier hs-type">MkTxError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466556"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-960"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-961"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679466556"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-962"></span><span id="updateUtxoIndex"><span class="annot"><span class="annottext">updateUtxoIndex :: m ()
</span><a href="Ledger.Tx.Constraints.OffChain.html#updateUtxoIndex"><span class="hs-identifier hs-var hs-var">updateUtxoIndex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-963"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.OffChain.html#ScriptLookups"><span class="hs-identifier hs-type">ScriptLookups</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466555"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
slTxOutputs :: Map TxOutRef DecoratedTxOut
slTxOutputs :: forall a. ScriptLookups a -&gt; Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466555"><span class="hs-identifier hs-var hs-var">slTxOutputs</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (ScriptLookups a)
forall r (m :: * -&gt; *). MonadReader r m =&gt; m r
</span><span class="hs-identifier hs-var">ask</span></span><span>
</span><span id="line-964"></span><span>    </span><span id="local-6989586621679466554"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679466554"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ConstraintProcessingState -&gt; NetworkId) -&gt; m NetworkId
forall s (m :: * -&gt; *) a. MonadState s m =&gt; (s -&gt; a) -&gt; m a
</span><span class="hs-identifier hs-var">gets</span></span><span> </span><span class="annot"><span class="annottext">((ConstraintProcessingState -&gt; NetworkId) -&gt; m NetworkId)
-&gt; (ConstraintProcessingState -&gt; NetworkId) -&gt; m NetworkId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Params -&gt; NetworkId
</span><span class="hs-identifier hs-var hs-var">pNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; NetworkId)
-&gt; (ConstraintProcessingState -&gt; Params)
-&gt; ConstraintProcessingState
-&gt; NetworkId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConstraintProcessingState -&gt; Params
</span><a href="Ledger.Tx.Constraints.OffChain.html#cpsParams"><span class="hs-identifier hs-var hs-var">cpsParams</span></a></span><span>
</span><span id="line-965"></span><span>    </span><span id="local-6989586621679466552"><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679466552"><span class="hs-identifier hs-var">slUtxos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either ToCardanoError UtxoIndex -&gt; m UtxoIndex
forall (m :: * -&gt; *) a.
MonadError MkTxError m =&gt;
Either ToCardanoError a -&gt; m a
</span><a href="Ledger.Tx.Constraints.OffChain.html#throwToCardanoError"><span class="hs-identifier hs-var">throwToCardanoError</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ToCardanoError UtxoIndex -&gt; m UtxoIndex)
-&gt; Either ToCardanoError UtxoIndex -&gt; m UtxoIndex
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NetworkId
-&gt; Map TxOutRef DecoratedTxOut -&gt; Either ToCardanoError UtxoIndex
</span><span class="hs-identifier hs-var">Tx.fromDecoratedIndex</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621679466554"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621679466555"><span class="hs-identifier hs-var">slTxOutputs</span></a></span><span>
</span><span id="line-966"></span><span>    </span><span class="annot"><span class="annottext">(UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState
Lens' ConstraintProcessingState UnbalancedTx
</span><a href="Ledger.Tx.Constraints.OffChain.html#unbalancedTx"><span class="hs-identifier hs-var">unbalancedTx</span></a></span><span> </span><span class="annot"><span class="annottext">((UnbalancedTx -&gt; Identity UnbalancedTx)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; ((UtxoIndex -&gt; Identity UtxoIndex)
    -&gt; UnbalancedTx -&gt; Identity UnbalancedTx)
-&gt; (UtxoIndex -&gt; Identity UtxoIndex)
-&gt; ConstraintProcessingState
-&gt; Identity ConstraintProcessingState
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(UtxoIndex -&gt; Identity UtxoIndex)
-&gt; UnbalancedTx -&gt; Identity UnbalancedTx
Lens' UnbalancedTx UtxoIndex
</span><a href="Ledger.Tx.Constraints.OffChain.html#utxoIndex"><span class="hs-identifier hs-var">utxoIndex</span></a></span><span> </span><span class="annot"><span class="annottext">((UtxoIndex -&gt; Identity UtxoIndex)
 -&gt; ConstraintProcessingState -&gt; Identity ConstraintProcessingState)
-&gt; UtxoIndex -&gt; m ()
forall s (m :: * -&gt; *) a.
(MonadState s m, Semigroup a) =&gt;
ASetter' s a -&gt; a -&gt; m ()
</span><span class="hs-operator hs-var">&lt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UtxoIndex
</span><a href="#local-6989586621679466552"><span class="hs-identifier hs-var">slUtxos</span></a></span><span>
</span><span id="line-967"></span></pre></body></html>