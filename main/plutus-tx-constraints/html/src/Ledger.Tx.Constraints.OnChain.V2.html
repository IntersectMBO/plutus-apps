<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts   #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds     #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns     #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude  #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns       #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-simplifiable-class-constraints #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-specialise #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-omit-interface-pragmas #-}</span><span>
</span><span id="line-12"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ledger.Tx.Constraints.OnChain.V2</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkScriptContext"><span class="hs-identifier">checkScriptContext</span></a></span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnInputConstraint"><span class="hs-identifier">checkOwnInputConstraint</span></a></span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnOutputConstraint"><span class="hs-identifier">checkOwnOutputConstraint</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PaymentPubKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unPaymentPubKeyHash</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Credential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Credential</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptCredential</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html"><span class="hs-identifier">Ledger.Tx.Constraints.TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier">ScriptInputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier">ScriptInputConstraint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#icRedeemer"><span class="hs-identifier">icRedeemer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#icReferenceTxOutRef"><span class="hs-identifier">icReferenceTxOutRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#icTxOutRef"><span class="hs-identifier">icTxOutRef</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier">ScriptOutputConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier">ScriptOutputConstraint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ocDatum"><span class="hs-identifier">ocDatum</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ocReferenceScriptHash"><span class="hs-identifier">ocReferenceScriptHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ocValue"><span class="hs-identifier">ocValue</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier">TxConstraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustBeSignedBy"><span class="hs-identifier">MustBeSignedBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTx"><span class="hs-identifier">MustIncludeDatumInTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTxWithHash"><span class="hs-identifier">MustIncludeDatumInTxWithHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustMintValue"><span class="hs-identifier">MustMintValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustPayToAddress"><span class="hs-identifier">MustPayToAddress</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustProduceAtLeast"><span class="hs-identifier">MustProduceAtLeast</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustReferenceOutput"><span class="hs-identifier">MustReferenceOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSatisfyAnyOf"><span class="hs-identifier">MustSatisfyAnyOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendAtLeast"><span class="hs-identifier">MustSpendAtLeast</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendPubKeyOutput"><span class="hs-identifier">MustSpendPubKeyOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier">MustSpendScriptOutput</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustUseOutputAsCollateral"><span class="hs-identifier">MustUseOutputAsCollateral</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustValidateInTimeRange"><span class="hs-identifier">MustValidateInTimeRange</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFun"><span class="hs-identifier">TxConstraintFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutputWithMatchingDatumAndValue"><span class="hs-identifier">MustSpendScriptOutputWithMatchingDatumAndValue</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFuns"><span class="hs-identifier">TxConstraintFuns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFuns"><span class="hs-identifier">TxConstraintFuns</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier">TxConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier">TxConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#txConstraintFuns"><span class="hs-identifier">txConstraintFuns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#txConstraints"><span class="hs-identifier">txConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#txOwnInputs"><span class="hs-identifier">txOwnInputs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#txOwnOutputs"><span class="hs-identifier">txOwnOutputs</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>                                            </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatum"><span class="hs-identifier">TxOutDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumHash"><span class="hs-identifier">TxOutDatumHash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInTx"><span class="hs-identifier">TxOutDatumInTx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInline"><span class="hs-identifier">TxOutDatumInline</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.ValidityInterval.html"><span class="hs-identifier">Ledger.Tx.Constraints.ValidityInterval</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.ValidityInterval.html#toPlutusInterval"><span class="hs-identifier">toPlutusInterval</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V2.Contexts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptContext</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptContext</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">scriptContextTxInfo</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ScriptPurpose</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Spending</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>                                        </span><span class="annot"><span class="hs-identifier">TxInInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxInInfo</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInInfoOutRef</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInInfoResolved</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>                                        </span><span class="annot"><span class="hs-identifier">TxInfo</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">txInfoData</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInfoInputs</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInfoMint</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInfoRedeemers</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txInfoValidRange</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>                                        </span><span class="annot"><span class="hs-identifier">TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxOut</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txOutAddress</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">txOutDatum</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">findOwnInput</span></span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V2.Contexts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PV2</span></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Interval</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">contains</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V1.Ledger.Value</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">leq</span></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V2.Ledger.Tx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">OutputDatum</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">NoOutputDatum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OutputDatum</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">OutputDatumHash</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ToData</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">toBuiltinData</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.AssocMap</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">AMap</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Prelude</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">Bool</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">False</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier">True</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Eq</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-operator">(==)</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Just</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">all</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">any</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">elem</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fmap</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">maybe</span></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>                         </span><span class="annot"><span class="hs-identifier">traceIfFalse</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">($)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(&amp;&amp;)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.)</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator">(&gt;&gt;)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span>
</span><span id="line-43"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkScriptContext"><span class="hs-pragma hs-type">checkScriptContext</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- | Does the 'ScriptContext' satisfy the constraints?</span><span>
</span><span id="line-45"></span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkScriptContext"><span class="hs-identifier hs-type">checkScriptContext</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679466204"><span class="annot"><a href="#local-6989586621679466204"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679466203"><span class="annot"><a href="#local-6989586621679466203"><span class="hs-identifier hs-type">o</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="annot"><a href="#local-6989586621679466204"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="annot"><a href="#local-6989586621679466203"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466204"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466203"><span class="hs-identifier hs-type">o</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-46"></span><span id="checkScriptContext"><span class="annot"><span class="annottext">checkScriptContext :: TxConstraints i o -&gt; ScriptContext -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkScriptContext"><span class="hs-identifier hs-var hs-var">checkScriptContext</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraints"><span class="hs-identifier hs-type">TxConstraints</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466202"><span class="annot"><span class="annottext">[TxConstraint]
txConstraints :: [TxConstraint]
txConstraints :: forall i o. TxConstraints i o -&gt; [TxConstraint]
</span><a href="#local-6989586621679466202"><span class="hs-identifier hs-var hs-var">txConstraints</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">txConstraintFuns :: forall i o. TxConstraints i o -&gt; TxConstraintFuns
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#txConstraintFuns"><span class="hs-identifier hs-var">txConstraintFuns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFuns"><span class="hs-identifier hs-type">TxConstraintFuns</span></a></span><span> </span><span id="local-6989586621679466201"><span class="annot"><span class="annottext">[TxConstraintFun]
</span><a href="#local-6989586621679466201"><span class="hs-identifier hs-var">txCnsFuns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466200"><span class="annot"><span class="annottext">[ScriptInputConstraint i]
txOwnInputs :: [ScriptInputConstraint i]
txOwnInputs :: forall i o. TxConstraints i o -&gt; [ScriptInputConstraint i]
</span><a href="#local-6989586621679466200"><span class="hs-identifier hs-var hs-var">txOwnInputs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466199"><span class="annot"><span class="annottext">[ScriptOutputConstraint o]
txOwnOutputs :: [ScriptOutputConstraint o]
txOwnOutputs :: forall i o. TxConstraints i o -&gt; [ScriptOutputConstraint o]
</span><a href="#local-6989586621679466199"><span class="hs-identifier hs-var hs-var">txOwnOutputs</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621679466198"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466198"><span class="hs-identifier hs-var">ptx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-47"></span><span>    </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L!&quot;</span></span><span> </span><span class="hs-comment">-- &quot;checkScriptContext failed&quot;</span><span>
</span><span id="line-48"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxConstraint -&gt; Bool) -&gt; [TxConstraint] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; TxConstraint -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-var">checkTxConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466198"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxConstraint]
</span><a href="#local-6989586621679466202"><span class="hs-identifier hs-var">txConstraints</span></a></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxConstraintFun -&gt; Bool) -&gt; [TxConstraintFun] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; TxConstraintFun -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraintFun"><span class="hs-identifier hs-var">checkTxConstraintFun</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466198"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxConstraintFun]
</span><a href="#local-6989586621679466201"><span class="hs-identifier hs-var">txCnsFuns</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ScriptInputConstraint i -&gt; Bool)
-&gt; [ScriptInputConstraint i] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; ScriptInputConstraint i -&gt; Bool
forall i.
ToData i =&gt;
ScriptContext -&gt; ScriptInputConstraint i -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnInputConstraint"><span class="hs-identifier hs-var">checkOwnInputConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466198"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ScriptInputConstraint i]
</span><a href="#local-6989586621679466200"><span class="hs-identifier hs-var">txOwnInputs</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ScriptOutputConstraint o -&gt; Bool)
-&gt; [ScriptOutputConstraint o] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; ScriptOutputConstraint o -&gt; Bool
forall o.
ToData o =&gt;
ScriptContext -&gt; ScriptOutputConstraint o -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnOutputConstraint"><span class="hs-identifier hs-var">checkOwnOutputConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466198"><span class="hs-identifier hs-var">ptx</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ScriptOutputConstraint o]
</span><a href="#local-6989586621679466199"><span class="hs-identifier hs-var">txOwnOutputs</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnInputConstraint"><span class="hs-pragma hs-type">checkOwnInputConstraint</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-54"></span><span id="local-6989586621679466332"><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnInputConstraint"><span class="hs-identifier hs-type">checkOwnInputConstraint</span></a></span><span>
</span><span id="line-55"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="annot"><a href="#local-6989586621679466332"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-56"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier hs-type">ScriptInputConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466332"><span class="hs-identifier hs-type">i</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-59"></span><span id="checkOwnInputConstraint"><span class="annot"><span class="annottext">checkOwnInputConstraint :: ScriptContext -&gt; ScriptInputConstraint i -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnInputConstraint"><span class="hs-identifier hs-var hs-var">checkOwnInputConstraint</span></a></span></span><span> </span><span id="local-6989586621679466195"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466195"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptInputConstraint"><span class="hs-identifier hs-type">ScriptInputConstraint</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466194"><span class="annot"><span class="annottext">TxOutRef
icTxOutRef :: TxOutRef
icTxOutRef :: forall a. ScriptInputConstraint a -&gt; TxOutRef
</span><a href="#local-6989586621679466194"><span class="hs-identifier hs-var hs-var">icTxOutRef</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466193"><span class="annot"><span class="annottext">i
icRedeemer :: i
icRedeemer :: forall a. ScriptInputConstraint a -&gt; a
</span><a href="#local-6989586621679466193"><span class="hs-identifier hs-var hs-var">icRedeemer</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466192"><span class="annot"><span class="annottext">Maybe TxOutRef
icReferenceTxOutRef :: Maybe TxOutRef
icReferenceTxOutRef :: forall a. ScriptInputConstraint a -&gt; Maybe TxOutRef
</span><a href="#local-6989586621679466192"><span class="hs-identifier hs-var hs-var">icReferenceTxOutRef</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L0&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Input constraint&quot;</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ScriptContext -&gt; TxConstraint -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-var">checkTxConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466195"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; Redeemer -&gt; Maybe TxOutRef -&gt; TxConstraint
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-var">MustSpendScriptOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466194"><span class="hs-identifier hs-var">icTxOutRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Redeemer
</span><span class="hs-identifier hs-var">Ledger.Redeemer</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Redeemer) -&gt; BuiltinData -&gt; Redeemer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">i -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">toBuiltinData</span></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679466193"><span class="hs-identifier hs-var">icRedeemer</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466192"><span class="hs-identifier hs-var">icReferenceTxOutRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnOutputConstraint"><span class="hs-pragma hs-type">checkOwnOutputConstraint</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-64"></span><span id="local-6989586621679466330"><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnOutputConstraint"><span class="hs-identifier hs-type">checkOwnOutputConstraint</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ToData</span></span><span> </span><span class="annot"><a href="#local-6989586621679466330"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier hs-type">ScriptOutputConstraint</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679466330"><span class="hs-identifier hs-type">o</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span></span><span>
</span><span id="line-69"></span><span id="checkOwnOutputConstraint"><span class="annot"><span class="annottext">checkOwnOutputConstraint :: ScriptContext -&gt; ScriptOutputConstraint o -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkOwnOutputConstraint"><span class="hs-identifier hs-var hs-var">checkOwnOutputConstraint</span></a></span></span><span> </span><span id="local-6989586621679466190"><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466190"><span class="hs-identifier hs-var">ctx</span></a></span></span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#ScriptOutputConstraint"><span class="hs-identifier hs-type">ScriptOutputConstraint</span></a></span><span class="hs-special">{</span><span id="local-6989586621679466189"><span class="annot"><span class="annottext">TxOutDatum o
ocDatum :: TxOutDatum o
ocDatum :: forall a. ScriptOutputConstraint a -&gt; TxOutDatum a
</span><a href="#local-6989586621679466189"><span class="hs-identifier hs-var hs-var">ocDatum</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466188"><span class="annot"><span class="annottext">Value
ocValue :: Value
ocValue :: forall a. ScriptOutputConstraint a -&gt; Value
</span><a href="#local-6989586621679466188"><span class="hs-identifier hs-var hs-var">ocValue</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679466187"><span class="annot"><span class="annottext">Maybe ScriptHash
ocReferenceScriptHash :: Maybe ScriptHash
ocReferenceScriptHash :: forall a. ScriptOutputConstraint a -&gt; Maybe ScriptHash
</span><a href="#local-6989586621679466187"><span class="hs-identifier hs-var hs-var">ocReferenceScriptHash</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466186"><span class="annot"><span class="annottext">d :: TxOutDatum Datum
</span><a href="#local-6989586621679466186"><span class="hs-identifier hs-var hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(o -&gt; Datum) -&gt; TxOutDatum o -&gt; TxOutDatum Datum
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuiltinData -&gt; Datum
</span><span class="hs-identifier hs-var">Ledger.Datum</span></span><span> </span><span class="annot"><span class="annottext">(BuiltinData -&gt; Datum) -&gt; (o -&gt; BuiltinData) -&gt; o -&gt; Datum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">o -&gt; BuiltinData
forall a. ToData a =&gt; a -&gt; BuiltinData
</span><span class="hs-identifier hs-var">toBuiltinData</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxOutDatum o
</span><a href="#local-6989586621679466189"><span class="hs-identifier hs-var">ocDatum</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L1&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Output constraint&quot;</span><span>
</span><span id="line-72"></span><span>    </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (TxInInfo -&gt; Bool) -&gt; Maybe TxInInfo -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="hs-identifier hs-type">TxInInfo</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txInInfoResolved :: TxInInfo -&gt; TxOut
</span><span class="hs-identifier hs-var">txInInfoResolved</span></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span id="local-6989586621679466184"><span class="annot"><span class="annottext">Address
txOutAddress :: Address
txOutAddress :: TxOut -&gt; Address
</span><a href="#local-6989586621679466184"><span class="hs-identifier hs-var hs-var">txOutAddress</span></a></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-73"></span><span>                        </span><span class="annot"><span class="annottext">ScriptContext -&gt; TxConstraint -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-var">checkTxConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466190"><span class="hs-identifier hs-var">ctx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Address
-&gt; Maybe (TxOutDatum Datum)
-&gt; Maybe ScriptHash
-&gt; Value
-&gt; TxConstraint
</span><a href="Ledger.Tx.Constraints.TxConstraints.html#MustPayToAddress"><span class="hs-identifier hs-var">MustPayToAddress</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679466184"><span class="hs-identifier hs-var">txOutAddress</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum Datum -&gt; Maybe (TxOutDatum Datum)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum Datum
</span><a href="#local-6989586621679466186"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466187"><span class="hs-identifier hs-var">ocReferenceScriptHash</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466188"><span class="hs-identifier hs-var">ocValue</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">findOwnInput</span></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466190"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-pragma hs-type">checkTxConstraint</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-77"></span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-type">checkTxConstraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraint"><span class="hs-identifier hs-type">TxConstraint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-78"></span><span id="checkTxConstraint"><span class="annot"><span class="annottext">checkTxConstraint :: ScriptContext -&gt; TxConstraint -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-var hs-var">checkTxConstraint</span></a></span></span><span> </span><span id="local-6989586621679466183"><span class="annot"><span class="annottext">ctx :: ScriptContext
</span><a href="#local-6989586621679466183"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span class="hs-special">{</span><span id="local-6989586621679466182"><span class="annot"><span class="annottext">TxInfo
scriptContextTxInfo :: TxInfo
scriptContextTxInfo :: ScriptContext -&gt; TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var hs-var">scriptContextTxInfo</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTx"><span class="hs-identifier hs-type">MustIncludeDatumInTx</span></a></span><span> </span><span id="local-6989586621679466181"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466181"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L2&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Missing datum&quot;</span><span>
</span><span id="line-81"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466181"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; [Datum] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">Map DatumHash Datum -&gt; [Datum]
forall k v. Map k v -&gt; [v]
</span><span class="hs-identifier hs-var">AMap.elems</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; Map DatumHash Datum
</span><span class="hs-identifier hs-var hs-var">txInfoData</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustValidateInTimeRange"><span class="hs-identifier hs-type">MustValidateInTimeRange</span></a></span><span> </span><span id="local-6989586621679466179"><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466179"><span class="hs-identifier hs-var">interval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L3&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Wrong validation interval&quot;</span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; Interval POSIXTime
forall a. ValidityInterval a -&gt; Interval a
</span><a href="Ledger.Tx.Constraints.ValidityInterval.html#toPlutusInterval"><span class="hs-identifier hs-var">toPlutusInterval</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime
</span><a href="#local-6989586621679466179"><span class="hs-identifier hs-var">interval</span></a></span><span> </span><span class="annot"><span class="annottext">Interval POSIXTime -&gt; Interval POSIXTime -&gt; Bool
forall a. Ord a =&gt; Interval a -&gt; Interval a -&gt; Bool
</span><span class="hs-operator hs-var">`contains`</span></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Interval POSIXTime
</span><span class="hs-identifier hs-var hs-var">txInfoValidRange</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustBeSignedBy"><span class="hs-identifier hs-type">MustBeSignedBy</span></a></span><span> </span><span id="local-6989586621679466178"><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679466178"><span class="hs-identifier hs-var">pkh</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-86"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L4&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Missing signature&quot;</span><span>
</span><span id="line-87"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; PubKeyHash -&gt; Bool
</span><span class="hs-operator hs-var">`PV2.txSignedBy`</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; PubKeyHash
</span><span class="hs-identifier hs-var hs-var">unPaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621679466178"><span class="hs-identifier hs-var">pkh</span></a></span><span>
</span><span id="line-88"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendAtLeast"><span class="hs-identifier hs-type">MustSpendAtLeast</span></a></span><span> </span><span id="local-6989586621679466176"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466176"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-89"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L5&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Spent value not OK&quot;</span><span>
</span><span id="line-90"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466176"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`leq`</span></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Value
</span><span class="hs-identifier hs-var">PV2.valueSpent</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-91"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustProduceAtLeast"><span class="hs-identifier hs-type">MustProduceAtLeast</span></a></span><span> </span><span id="local-6989586621679466174"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466174"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-92"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L6&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Produced value not OK&quot;</span><span>
</span><span id="line-93"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466174"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`leq`</span></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Value
</span><span class="hs-identifier hs-var">PV2.valueProduced</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendPubKeyOutput"><span class="hs-identifier hs-type">MustSpendPubKeyOutput</span></a></span><span> </span><span id="local-6989586621679466172"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466172"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-95"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466171"><span class="annot"><span class="annottext">isNoOutputDatum :: OutputDatum -&gt; Bool
</span><a href="#local-6989586621679466171"><span class="hs-identifier hs-var hs-var">isNoOutputDatum</span></a></span></span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">NoOutputDatum</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-96"></span><span>            </span><span class="annot"><a href="#local-6989586621679466171"><span class="hs-identifier hs-var">isNoOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-97"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-98"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L7&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Public key output not spent&quot;</span><span>
</span><span id="line-99"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (TxInInfo -&gt; Bool) -&gt; Maybe TxInInfo -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDatum -&gt; Bool
</span><a href="#local-6989586621679466171"><span class="hs-identifier hs-var">isNoOutputDatum</span></a></span><span> </span><span class="annot"><span class="annottext">(OutputDatum -&gt; Bool)
-&gt; (TxInInfo -&gt; OutputDatum) -&gt; TxInInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxOut -&gt; OutputDatum
</span><span class="hs-identifier hs-var hs-var">txOutDatum</span></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; OutputDatum)
-&gt; (TxInInfo -&gt; TxOut) -&gt; TxInInfo -&gt; OutputDatum
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxInInfo -&gt; TxOut
</span><span class="hs-identifier hs-var hs-var">txInInfoResolved</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxInfo -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">PV2.findTxInByTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466172"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutput"><span class="hs-identifier hs-type">MustSpendScriptOutput</span></a></span><span> </span><span id="local-6989586621679466169"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466169"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span id="local-6989586621679466168"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466168"><span class="hs-identifier hs-var">rdmr</span></a></span></span><span> </span><span id="local-6989586621679466167"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466167"><span class="hs-identifier hs-var">mRefTxOutRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-101"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L8&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Script output not spent&quot;</span><span>
</span><span id="line-102"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Maybe Redeemer
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466168"><span class="hs-identifier hs-var">rdmr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Redeemer -&gt; Maybe Redeemer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose -&gt; Map ScriptPurpose Redeemer -&gt; Maybe Redeemer
forall k v. Eq k =&gt; k -&gt; Map k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">AMap.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; ScriptPurpose
</span><span class="hs-identifier hs-var">Spending</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466169"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; Map ScriptPurpose Redeemer
</span><span class="hs-identifier hs-var hs-var">txInfoRedeemers</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe TxInInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxInfo -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">PV2.findTxInByTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466169"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-104"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (TxOutRef -&gt; Bool) -&gt; Maybe TxOutRef -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679466165"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466165"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TxInInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxInfo -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">PV2.findTxRefInByTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466165"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466167"><span class="hs-identifier hs-var">mRefTxOutRef</span></a></span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustMintValue"><span class="hs-identifier hs-type">MustMintValue</span></a></span><span> </span><span id="local-6989586621679466163"><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466163"><span class="hs-identifier hs-var">mps</span></a></span></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621679466162"><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679466162"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span id="local-6989586621679466161"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466161"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span id="local-6989586621679466160"><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466160"><span class="hs-identifier hs-var">mRefTxOutRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-106"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;L9&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Value minted not OK&quot;</span><span>
</span><span id="line-107"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; CurrencySymbol -&gt; TokenName -&gt; Integer
</span><span class="hs-identifier hs-var">Value.valueOf</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; Value
</span><span class="hs-identifier hs-var hs-var">txInfoMint</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">Value.mpsSymbol</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621679466163"><span class="hs-identifier hs-var">mps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621679466162"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679466161"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-108"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; (TxOutRef -&gt; Bool) -&gt; Maybe TxOutRef -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679466157"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466157"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TxInInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxInfo -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">PV2.findTxRefInByTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466157"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TxOutRef
</span><a href="#local-6989586621679466160"><span class="hs-identifier hs-var">mRefTxOutRef</span></a></span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustPayToAddress"><span class="hs-identifier hs-type">MustPayToAddress</span></a></span><span> </span><span id="local-6989586621679466156"><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679466156"><span class="hs-identifier hs-var">addr</span></a></span></span><span> </span><span id="local-6989586621679466155"><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum)
</span><a href="#local-6989586621679466155"><span class="hs-identifier hs-var">mdv</span></a></span></span><span> </span><span id="local-6989586621679466154"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466154"><span class="hs-identifier hs-var">_refScript</span></a></span></span><span> </span><span id="local-6989586621679466153"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466153"><span class="hs-identifier hs-var">vl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466152"><span class="annot"><span class="annottext">outs :: [TxOut]
</span><a href="#local-6989586621679466152"><span class="hs-identifier hs-var hs-var">outs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; [TxOut]
</span><span class="hs-identifier hs-var hs-var">PV2.txInfoOutputs</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-111"></span><span>            </span><span id="local-6989586621679466150"><span class="annot"><span class="annottext">hsh :: Datum -&gt; Maybe DatumHash
</span><a href="#local-6989586621679466150"><span class="hs-identifier hs-var hs-var">hsh</span></a></span></span><span> </span><span id="local-6989586621679466149"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466149"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; TxInfo -&gt; Maybe DatumHash
</span><span class="hs-identifier hs-var">PV2.findDatumHash</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466149"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-112"></span><span>            </span><span id="local-6989586621679466147"><span class="annot"><span class="annottext">checkOutput :: TxOutDatum Datum -&gt; TxOut -&gt; Bool
</span><a href="#local-6989586621679466147"><span class="hs-identifier hs-var hs-var">checkOutput</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumHash"><span class="hs-identifier hs-type">TxOutDatumHash</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txOutDatum :: TxOut -&gt; OutputDatum
</span><span class="hs-identifier hs-var">txOutDatum</span></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">OutputDatumHash</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><span class="hs-identifier">_</span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-113"></span><span>                </span><span class="hs-comment">-- The datum is not added in the tx body with so we can't verify</span><span>
</span><span id="line-114"></span><span>                </span><span class="hs-comment">-- that the tx output's datum hash is the correct one w.r.t the</span><span>
</span><span id="line-115"></span><span>                </span><span class="hs-comment">-- provide datum.</span><span>
</span><span id="line-116"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-117"></span><span>            </span><span class="annot"><a href="#local-6989586621679466147"><span class="hs-identifier hs-var">checkOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInTx"><span class="hs-identifier hs-type">TxOutDatumInTx</span></a></span><span> </span><span id="local-6989586621679466146"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466146"><span class="hs-identifier hs-var">dv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txOutDatum :: TxOut -&gt; OutputDatum
</span><span class="hs-identifier hs-var">txOutDatum</span></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">OutputDatumHash</span></span><span> </span><span id="local-6989586621679466145"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466145"><span class="hs-identifier hs-var">dh</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>                </span><span class="annot"><span class="annottext">Datum -&gt; Maybe DatumHash
</span><a href="#local-6989586621679466150"><span class="hs-identifier hs-var">hsh</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466146"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DatumHash -&gt; Maybe DatumHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; Maybe DatumHash
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466145"><span class="hs-identifier hs-var">dh</span></a></span><span>
</span><span id="line-119"></span><span>            </span><span class="annot"><a href="#local-6989586621679466147"><span class="hs-identifier hs-var">checkOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxOutDatumInline"><span class="hs-identifier hs-type">TxOutDatumInline</span></a></span><span> </span><span id="local-6989586621679466144"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466144"><span class="hs-identifier hs-var">dv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">txOutDatum :: TxOut -&gt; OutputDatum
</span><span class="hs-identifier hs-var">txOutDatum</span></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">OutputDatum</span></span><span> </span><span id="local-6989586621679466143"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466143"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>                </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466144"><span class="hs-identifier hs-var">dv</span></a></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Datum -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466143"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-121"></span><span>            </span><span class="annot"><a href="#local-6989586621679466147"><span class="hs-identifier hs-var">checkOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum Datum
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-122"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;La&quot;</span></span><span> </span><span class="hs-comment">-- &quot;MustPayToAddress&quot;</span><span>
</span><span id="line-124"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466153"><span class="hs-identifier hs-var">vl</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`leq`</span></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; Address -&gt; Value
</span><span class="hs-identifier hs-var">PV2.valuePaidTo</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Address
</span><a href="#local-6989586621679466156"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (TxOutDatum Datum -&gt; Bool) -&gt; Maybe (TxOutDatum Datum) -&gt; Bool
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679466141"><span class="annot"><span class="annottext">TxOutDatum Datum
</span><a href="#local-6989586621679466141"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Bool) -&gt; [TxOut] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutDatum Datum -&gt; TxOut -&gt; Bool
</span><a href="#local-6989586621679466147"><span class="hs-identifier hs-var">checkOutput</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutDatum Datum
</span><a href="#local-6989586621679466141"><span class="hs-identifier hs-var">dv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TxOut]
</span><a href="#local-6989586621679466152"><span class="hs-identifier hs-var">outs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (TxOutDatum Datum)
</span><a href="#local-6989586621679466155"><span class="hs-identifier hs-var">mdv</span></a></span><span>
</span><span id="line-126"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustIncludeDatumInTxWithHash"><span class="hs-identifier hs-type">MustIncludeDatumInTxWithHash</span></a></span><span> </span><span id="local-6989586621679466140"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466140"><span class="hs-identifier hs-var">dvh</span></a></span></span><span> </span><span id="local-6989586621679466139"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466139"><span class="hs-identifier hs-var">dv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;Lc&quot;</span></span><span> </span><span class="hs-comment">-- &quot;missing datum&quot;</span><span>
</span><span id="line-128"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; TxInfo -&gt; Maybe Datum
</span><span class="hs-identifier hs-var">PV2.findDatum</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466140"><span class="hs-identifier hs-var">dvh</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Datum -&gt; Maybe Datum -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Maybe Datum
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466139"><span class="hs-identifier hs-var">dv</span></a></span><span>
</span><span id="line-129"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSatisfyAnyOf"><span class="hs-identifier hs-type">MustSatisfyAnyOf</span></a></span><span> </span><span id="local-6989586621679466137"><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466137"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-130"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;Ld&quot;</span></span><span> </span><span class="hs-comment">-- &quot;MustSatisfyAnyOf&quot;</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([TxConstraint] -&gt; Bool) -&gt; [[TxConstraint]] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TxConstraint -&gt; Bool) -&gt; [TxConstraint] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">all</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; TxConstraint -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraint"><span class="hs-identifier hs-var">checkTxConstraint</span></a></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621679466183"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[TxConstraint]]
</span><a href="#local-6989586621679466137"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-132"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustUseOutputAsCollateral"><span class="hs-identifier hs-type">MustUseOutputAsCollateral</span></a></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-133"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">True</span></a></span><span> </span><span class="hs-comment">-- TxInfo does not have the collateral inputs</span><span>
</span><span id="line-134"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustReferenceOutput"><span class="hs-identifier hs-type">MustReferenceOutput</span></a></span><span> </span><span id="local-6989586621679466136"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466136"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-135"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;Lf&quot;</span></span><span> </span><span class="hs-comment">-- &quot;Output not referenced&quot;</span><span>
</span><span id="line-136"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe TxInInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; TxInfo -&gt; Maybe TxInInfo
</span><span class="hs-identifier hs-var">PV2.findTxRefInByTxOutRef</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466136"><span class="hs-identifier hs-var">txOutRef</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466182"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraintFun"><span class="hs-pragma hs-type">checkTxConstraintFun</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-139"></span><span class="annot"><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraintFun"><span class="hs-identifier hs-type">checkTxConstraintFun</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#TxConstraintFun"><span class="hs-identifier hs-type">TxConstraintFun</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-140"></span><span id="checkTxConstraintFun"><span class="annot"><span class="annottext">checkTxConstraintFun :: ScriptContext -&gt; TxConstraintFun -&gt; Bool
</span><a href="Ledger.Tx.Constraints.OnChain.V2.html#checkTxConstraintFun"><span class="hs-identifier hs-var hs-var">checkTxConstraintFun</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ScriptContext</span></span><span class="hs-special">{</span><span id="local-6989586621679466135"><span class="annot"><span class="annottext">TxInfo
scriptContextTxInfo :: TxInfo
scriptContextTxInfo :: ScriptContext -&gt; TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var hs-var">scriptContextTxInfo</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="Ledger.Tx.Constraints.TxConstraints.html#MustSpendScriptOutputWithMatchingDatumAndValue"><span class="hs-identifier hs-type">MustSpendScriptOutputWithMatchingDatumAndValue</span></a></span><span> </span><span id="local-6989586621679466134"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466134"><span class="hs-identifier hs-var">vh</span></a></span></span><span> </span><span id="local-6989586621679466133"><span class="annot"><span class="annottext">Datum -&gt; Bool
</span><a href="#local-6989586621679466133"><span class="hs-identifier hs-var">datumPred</span></a></span></span><span> </span><span id="local-6989586621679466132"><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="#local-6989586621679466132"><span class="hs-identifier hs-var">valuePred</span></a></span></span><span> </span><span id="local-6989586621679466131"><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466131"><span class="hs-identifier hs-var">rdmr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679466130"><span class="annot"><span class="annottext">findDatum :: OutputDatum -&gt; Maybe Datum
</span><a href="#local-6989586621679466130"><span class="hs-identifier hs-var hs-var">findDatum</span></a></span></span><span> </span><span class="annot"><span class="annottext">OutputDatum
</span><span class="hs-identifier hs-var">NoOutputDatum</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Datum
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-143"></span><span>            </span><span class="annot"><a href="#local-6989586621679466130"><span class="hs-identifier hs-var">findDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OutputDatumHash</span></span><span> </span><span id="local-6989586621679466129"><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466129"><span class="hs-identifier hs-var">dh</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DatumHash -&gt; TxInfo -&gt; Maybe Datum
</span><span class="hs-identifier hs-var">PV2.findDatum</span></span><span> </span><span class="annot"><span class="annottext">DatumHash
</span><a href="#local-6989586621679466129"><span class="hs-identifier hs-var">dh</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span>
</span><span id="line-144"></span><span>            </span><span class="annot"><a href="#local-6989586621679466130"><span class="hs-identifier hs-var">findDatum</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">OutputDatum</span></span><span> </span><span id="local-6989586621679466128"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466128"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Datum -&gt; TxInfo -&gt; Maybe DatumHash
</span><span class="hs-identifier hs-var">PV2.findDatumHash</span></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466128"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe DatumHash -&gt; Maybe Datum -&gt; Maybe Datum
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Maybe Datum
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466128"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-145"></span><span>            </span><span id="local-6989586621679466127"><span class="annot"><span class="annottext">txOutIsMatch :: TxOut -&gt; Bool
</span><a href="#local-6989586621679466127"><span class="hs-identifier hs-var hs-var">txOutIsMatch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxOut</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Ledger.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">ScriptCredential</span></span><span> </span><span id="local-6989586621679466125"><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466125"><span class="hs-identifier hs-var">vh'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe StakingCredential
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679466124"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466124"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OutputDatum -&gt; Maybe Datum
</span><a href="#local-6989586621679466130"><span class="hs-identifier hs-var">findDatum</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679466123"><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466123"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679466122"><span class="annot"><span class="annottext">Maybe ScriptHash
</span><a href="#local-6989586621679466122"><span class="hs-identifier hs-var">_refScript</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-146"></span><span>                </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466134"><span class="hs-identifier hs-var">vh</span></a></span><span> </span><span class="annot"><span class="annottext">ValidatorHash -&gt; ValidatorHash -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ValidatorHash
</span><a href="#local-6989586621679466125"><span class="hs-identifier hs-var">vh'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Bool
</span><a href="#local-6989586621679466132"><span class="hs-identifier hs-var">valuePred</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621679466124"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Datum -&gt; Bool
</span><a href="#local-6989586621679466133"><span class="hs-identifier hs-var">datumPred</span></a></span><span> </span><span class="annot"><span class="annottext">Datum
</span><a href="#local-6989586621679466123"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span class="annot"><a href="#local-6989586621679466127"><span class="hs-identifier hs-var">txOutIsMatch</span></a></span><span> </span><span class="annot"><span class="annottext">TxOut
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span id="local-6989586621679466121"><span class="annot"><span class="annottext">rdmrIsMatch :: TxOutRef -&gt; Bool
</span><a href="#local-6989586621679466121"><span class="hs-identifier hs-var hs-var">rdmrIsMatch</span></a></span></span><span> </span><span id="local-6989586621679466120"><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466120"><span class="hs-identifier hs-var">txOutRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Redeemer -&gt; Maybe Redeemer
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Redeemer
</span><a href="#local-6989586621679466131"><span class="hs-identifier hs-var">rdmr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Redeemer -&gt; Maybe Redeemer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ScriptPurpose -&gt; Map ScriptPurpose Redeemer -&gt; Maybe Redeemer
forall k v. Eq k =&gt; k -&gt; Map k v -&gt; Maybe v
</span><span class="hs-identifier hs-var">AMap.lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; ScriptPurpose
</span><span class="hs-identifier hs-var">Spending</span></span><span> </span><span class="annot"><span class="annottext">TxOutRef
</span><a href="#local-6989586621679466120"><span class="hs-identifier hs-var">txOutRef</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; Map ScriptPurpose Redeemer
</span><span class="hs-identifier hs-var hs-var">txInfoRedeemers</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-150"></span><span>        </span><span class="annot"><span class="annottext">BuiltinString -&gt; Bool -&gt; Bool
</span><span class="hs-identifier hs-var">traceIfFalse</span></span><span> </span><span class="annot"><span class="annottext">BuiltinString
</span><span class="hs-string">&quot;Le&quot;</span></span><span> </span><span class="hs-comment">-- &quot;MustSpendScriptOutputWithMatchingDatumAndValue&quot;</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(TxInInfo -&gt; Bool) -&gt; [TxInInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOut -&gt; Bool
</span><a href="#local-6989586621679466127"><span class="hs-identifier hs-var">txOutIsMatch</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOut -&gt; Bool) -&gt; (TxInInfo -&gt; TxOut) -&gt; TxInInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxInInfo -&gt; TxOut
</span><span class="hs-identifier hs-var hs-var">txInInfoResolved</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; [TxInInfo]
</span><span class="hs-identifier hs-var hs-var">txInfoInputs</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(TxInInfo -&gt; Bool) -&gt; [TxInInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxOutRef -&gt; Bool
</span><a href="#local-6989586621679466121"><span class="hs-identifier hs-var">rdmrIsMatch</span></a></span><span> </span><span class="annot"><span class="annottext">(TxOutRef -&gt; Bool) -&gt; (TxInInfo -&gt; TxOutRef) -&gt; TxInInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">TxInInfo -&gt; TxOutRef
</span><span class="hs-identifier hs-var hs-var">txInInfoOutRef</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxInfo -&gt; [TxInInfo]
</span><span class="hs-identifier hs-var hs-var">txInfoInputs</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621679466135"><span class="hs-identifier hs-var">scriptContextTxInfo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span></pre></body></html>