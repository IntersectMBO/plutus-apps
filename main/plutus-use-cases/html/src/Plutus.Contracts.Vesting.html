<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE ConstraintKinds    #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DataKinds          #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric      #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts   #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns     #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude  #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings  #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell    #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications   #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies       #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators      #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-ignore-interface-pragmas #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-specialise #-}</span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Contracts.Vesting</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><span class="hs-comment">-- $vesting</span></span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier">VestingParams</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingSchema"><span class="hs-identifier">VestingSchema</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier">VestingTranche</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingError"><span class="hs-identifier">VestingError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#AsVestingError"><span class="hs-identifier">AsVestingError</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-identifier">totalAmount</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#vestingContract"><span class="hs-identifier">vestingContract</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#validate"><span class="hs-identifier">validate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#vestingScript"><span class="hs-identifier">vestingScript</span></a></span><span>
</span><span id="line-27"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">when</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Semigroup</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Cardano.Node.Emulator.Internal.Node</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">pNetworkId</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">testnet</span></span><span class="hs-special">)</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">CardanoAddress</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">POSIXTime</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">POSIXTimeRange</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">PaymentPubKeyHash</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">unPaymentPubKeyHash</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>               </span><span class="annot"><span class="hs-identifier">decoratedTxOutPlutusValue</span></span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Interval</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxConstraints</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mustBeSignedBy</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mustPayToTheScriptWithDatumInTx</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">mustValidateInTimeRange</span></span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Constraints</span></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints.ValidityInterval</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">ValidityInterval</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Typed.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ValidatorTypes</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Typed.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scripts</span></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V2.Typed.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V2.Ledger.Api</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">ScriptContext</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TxInfo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Validator</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.V2.Ledger.Contexts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">fold</span></span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span>
</span><span id="line-54"></span><span>
</span><span id="line-55"></span><span class="hs-comment">{- |
    A simple vesting scheme. Money is locked by a contract and may only be
    retrieved after some time has passed.

    This is our first example of a contract that covers multiple transactions,
    with a contract state that changes over time.

    In our vesting scheme the money will be released in two _tranches_ (parts):
    A smaller part will be available after an initial number of time has
    passed, and the entire amount will be released at the end. The owner of the
    vesting scheme does not have to take out all the money at once: They can
    take out any amount up to the total that has been released so far. The
    remaining funds stay locked and can be retrieved later.

    Let's start with the data types.

-}</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="hs-keyword">type</span><span> </span><span id="VestingSchema"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingSchema"><span class="hs-identifier hs-var">VestingSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-74"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Endpoint</span></span><span> </span><span class="annot"><span class="hs-string">&quot;vest funds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">.\/</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Endpoint</span></span><span> </span><span class="annot"><span class="hs-string">&quot;retrieve funds&quot;</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-76"></span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="Vesting"><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-var">Vesting</span></a></span></span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ValidatorTypes</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-type">Vesting</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="RedeemerType"><span class="annot"><span class="hs-identifier hs-var">RedeemerType</span></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-type">Vesting</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">instance</span><span> </span><span id="DatumType"><span class="annot"><span class="hs-identifier hs-var">DatumType</span></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-type">Vesting</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span class="hs-comment">-- | Tranche of a vesting scheme.</span><span>
</span><span id="line-84"></span><span id="local-6989586621680928322"><span id="local-6989586621680928323"></span></span><span class="hs-keyword">data</span><span> </span><span id="VestingTranche"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-var">VestingTranche</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VestingTranche"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-var">VestingTranche</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-85"></span><span>    </span><span id="vestingTrancheDate"><span class="annot"><span class="annottext">VestingTranche -&gt; POSIXTime
</span><a href="Plutus.Contracts.Vesting.html#vestingTrancheDate"><span class="hs-identifier hs-var hs-var">vestingTrancheDate</span></a></span></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span id="vestingTrancheAmount"><span class="annot"><span class="annottext">VestingTranche -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#vestingTrancheAmount"><span class="hs-identifier hs-var hs-var">vestingTrancheAmount</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-87"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="annottext">(forall x. VestingTranche -&gt; Rep VestingTranche x)
-&gt; (forall x. Rep VestingTranche x -&gt; VestingTranche)
-&gt; Generic VestingTranche
forall x. Rep VestingTranche x -&gt; VestingTranche
forall x. VestingTranche -&gt; Rep VestingTranche x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep VestingTranche x -&gt; VestingTranche
$cfrom :: forall x. VestingTranche -&gt; Rep VestingTranche x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span id="local-6989586621680928312"><span id="local-6989586621680928314"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">VestingTranche</span></span></span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | A vesting scheme consisting of two tranches. Each tranche defines a date</span><span>
</span><span id="line-92"></span><span class="hs-comment">--   (POSIX time) after which an additional amount can be spent.</span><span>
</span><span id="line-93"></span><span id="local-6989586621680928306"><span id="local-6989586621680928307"></span></span><span class="hs-keyword">data</span><span> </span><span id="VestingParams"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-var">VestingParams</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="VestingParams"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-var">VestingParams</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-94"></span><span>    </span><span id="vestingTranche1"><span class="annot"><span class="annottext">VestingParams -&gt; VestingTranche
</span><a href="Plutus.Contracts.Vesting.html#vestingTranche1"><span class="hs-identifier hs-var hs-var">vestingTranche1</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>    </span><span id="vestingTranche2"><span class="annot"><span class="annottext">VestingParams -&gt; VestingTranche
</span><a href="Plutus.Contracts.Vesting.html#vestingTranche2"><span class="hs-identifier hs-var hs-var">vestingTranche2</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>    </span><span id="vestingOwner"><span class="annot"><span class="annottext">VestingParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.Vesting.html#vestingOwner"><span class="hs-identifier hs-var hs-var">vestingOwner</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKeyHash</span></span><span>
</span><span id="line-97"></span><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="annottext">(forall x. VestingParams -&gt; Rep VestingParams x)
-&gt; (forall x. Rep VestingParams x -&gt; VestingParams)
-&gt; Generic VestingParams
forall x. Rep VestingParams x -&gt; VestingParams
forall x. VestingParams -&gt; Rep VestingParams x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep VestingParams x -&gt; VestingParams
$cfrom :: forall x. VestingParams -&gt; Rep VestingParams x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span>
</span><span id="line-98"></span><span>
</span><span id="line-99"></span><span id="local-6989586621680928296"><span id="local-6989586621680928298"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">VestingParams</span></span></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-pragma hs-type">totalAmount</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-102"></span><span class="hs-comment">-- | The total amount vested</span><span>
</span><span id="line-103"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-identifier hs-type">totalAmount</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-104"></span><span id="totalAmount"><span class="annot"><span class="annottext">totalAmount :: VestingParams -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-identifier hs-var hs-var">totalAmount</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680928295"><span class="annot"><span class="annottext">VestingTranche
vestingTranche1 :: VestingTranche
vestingTranche1 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928295"><span class="hs-identifier hs-var hs-var">vestingTranche1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680928294"><span class="annot"><span class="annottext">VestingTranche
vestingTranche2 :: VestingTranche
vestingTranche2 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928294"><span class="hs-identifier hs-var hs-var">vestingTranche2</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">VestingTranche -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#vestingTrancheAmount"><span class="hs-identifier hs-var hs-var">vestingTrancheAmount</span></a></span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928295"><span class="hs-identifier hs-var">vestingTranche1</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">VestingTranche -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#vestingTrancheAmount"><span class="hs-identifier hs-var hs-var">vestingTrancheAmount</span></a></span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928294"><span class="hs-identifier hs-var">vestingTranche2</span></a></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#availableFrom"><span class="hs-pragma hs-type">availableFrom</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- | The amount guaranteed to be available from a given tranche in a given time range.</span><span>
</span><span id="line-109"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#availableFrom"><span class="hs-identifier hs-type">availableFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTimeRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-110"></span><span id="availableFrom"><span class="annot"><span class="annottext">availableFrom :: VestingTranche -&gt; POSIXTimeRange -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#availableFrom"><span class="hs-identifier hs-var hs-var">availableFrom</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span> </span><span id="local-6989586621680928291"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928291"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span id="local-6989586621680928290"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928290"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621680928289"><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928289"><span class="hs-identifier hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-111"></span><span>    </span><span class="hs-comment">-- The valid range is an open-ended range starting from the tranche vesting date</span><span>
</span><span id="line-112"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680928288"><span class="annot"><span class="annottext">validRange :: POSIXTimeRange
</span><a href="#local-6989586621680928288"><span class="hs-identifier hs-var hs-var">validRange</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTimeRange
forall a. a -&gt; Interval a
</span><span class="hs-identifier hs-var">Interval.from</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928291"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-113"></span><span>    </span><span class="hs-comment">-- If the valid range completely contains the argument range (meaning in particular</span><span>
</span><span id="line-114"></span><span>    </span><span class="hs-comment">-- that the start time of the argument range is after the tranche vesting date), then</span><span>
</span><span id="line-115"></span><span>    </span><span class="hs-comment">-- the money in the tranche is available, otherwise nothing is available.</span><span>
</span><span id="line-116"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928288"><span class="hs-identifier hs-var">validRange</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange -&gt; POSIXTimeRange -&gt; Bool
forall a. Ord a =&gt; Interval a -&gt; Interval a -&gt; Bool
</span><span class="hs-operator hs-var">`Interval.contains`</span></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928289"><span class="hs-identifier hs-var">range</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928290"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Value
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span>
</span><span id="line-117"></span><span>
</span><span id="line-118"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#availableAt"><span class="hs-identifier hs-type">availableAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTime</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-119"></span><span id="availableAt"><span class="annot"><span class="annottext">availableAt :: VestingParams -&gt; POSIXTime -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#availableAt"><span class="hs-identifier hs-var hs-var">availableAt</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680928283"><span class="annot"><span class="annottext">VestingTranche
vestingTranche1 :: VestingTranche
vestingTranche1 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928283"><span class="hs-identifier hs-var hs-var">vestingTranche1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928282"><span class="annot"><span class="annottext">VestingTranche
vestingTranche2 :: VestingTranche
vestingTranche2 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928282"><span class="hs-identifier hs-var hs-var">vestingTranche2</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680928281"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928281"><span class="hs-identifier hs-var">time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680928280"><span class="annot"><span class="annottext">f :: VestingTranche -&gt; Value
</span><a href="#local-6989586621680928280"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span class="hs-special">{</span><span id="local-6989586621680928279"><span class="annot"><span class="annottext">POSIXTime
vestingTrancheDate :: POSIXTime
vestingTrancheDate :: VestingTranche -&gt; POSIXTime
</span><a href="#local-6989586621680928279"><span class="hs-identifier hs-var hs-var">vestingTrancheDate</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928278"><span class="annot"><span class="annottext">Value
vestingTrancheAmount :: Value
vestingTrancheAmount :: VestingTranche -&gt; Value
</span><a href="#local-6989586621680928278"><span class="hs-identifier hs-var hs-var">vestingTrancheAmount</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-121"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928281"><span class="hs-identifier hs-var">time</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; POSIXTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928279"><span class="hs-identifier hs-var">vestingTrancheDate</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928278"><span class="hs-identifier hs-var">vestingTrancheAmount</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(VestingTranche -&gt; Value) -&gt; [VestingTranche] -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">VestingTranche -&gt; Value
</span><a href="#local-6989586621680928280"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928283"><span class="hs-identifier hs-var">vestingTranche1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928282"><span class="hs-identifier hs-var">vestingTranche2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#remainingFrom"><span class="hs-pragma hs-type">remainingFrom</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-125"></span><span class="hs-comment">-- | The amount that has not been released from this tranche yet</span><span>
</span><span id="line-126"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#remainingFrom"><span class="hs-identifier hs-type">remainingFrom</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">POSIXTimeRange</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-127"></span><span id="remainingFrom"><span class="annot"><span class="annottext">remainingFrom :: VestingTranche -&gt; POSIXTimeRange -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#remainingFrom"><span class="hs-identifier hs-var hs-var">remainingFrom</span></a></span></span><span> </span><span id="local-6989586621680928273"><span class="annot"><span class="annottext">t :: VestingTranche
</span><a href="#local-6989586621680928273"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingTranche"><span class="hs-identifier hs-type">VestingTranche</span></a></span><span class="hs-special">{</span><span id="local-6989586621680928272"><span class="annot"><span class="annottext">Value
vestingTrancheAmount :: Value
vestingTrancheAmount :: VestingTranche -&gt; Value
</span><a href="#local-6989586621680928272"><span class="hs-identifier hs-var hs-var">vestingTrancheAmount</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680928271"><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928271"><span class="hs-identifier hs-var">range</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-128"></span><span>    </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928272"><span class="hs-identifier hs-var">vestingTrancheAmount</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">VestingTranche -&gt; POSIXTimeRange -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#availableFrom"><span class="hs-identifier hs-var">availableFrom</span></a></span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928273"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928271"><span class="hs-identifier hs-var">range</span></a></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-pragma">{-# INLINABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#validate"><span class="hs-pragma hs-type">validate</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-131"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#validate"><span class="hs-identifier hs-type">validate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.ScriptContext</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-132"></span><span id="validate"><span class="annot"><span class="annottext">validate :: VestingParams -&gt; () -&gt; () -&gt; ScriptContext -&gt; Bool
</span><a href="Plutus.Contracts.Vesting.html#validate"><span class="hs-identifier hs-var hs-var">validate</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span class="hs-special">{</span><span id="local-6989586621680928269"><span class="annot"><span class="annottext">VestingTranche
vestingTranche1 :: VestingTranche
vestingTranche1 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928269"><span class="hs-identifier hs-var hs-var">vestingTranche1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928268"><span class="annot"><span class="annottext">VestingTranche
vestingTranche2 :: VestingTranche
vestingTranche2 :: VestingParams -&gt; VestingTranche
</span><a href="#local-6989586621680928268"><span class="hs-identifier hs-var hs-var">vestingTranche2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928267"><span class="annot"><span class="annottext">PaymentPubKeyHash
vestingOwner :: PaymentPubKeyHash
vestingOwner :: VestingParams -&gt; PaymentPubKeyHash
</span><a href="#local-6989586621680928267"><span class="hs-identifier hs-var hs-var">vestingOwner</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span id="local-6989586621680928266"><span class="annot"><span class="annottext">ctx :: ScriptContext
</span><a href="#local-6989586621680928266"><span class="hs-identifier hs-var">ctx</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">V2.ScriptContext</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scriptContextTxInfo :: ScriptContext -&gt; TxInfo
</span><span class="hs-identifier hs-var">scriptContextTxInfo</span></span><span class="hs-glyph">=</span><span id="local-6989586621680928263"><span class="annot"><span class="annottext">txInfo :: TxInfo
</span><a href="#local-6989586621680928263"><span class="hs-identifier hs-var">txInfo</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">TxInfo</span></span><span class="hs-special">{</span><span id="local-6989586621680928261"><span class="annot"><span class="annottext">POSIXTimeRange
txInfoValidRange :: TxInfo -&gt; POSIXTimeRange
txInfoValidRange :: POSIXTimeRange
</span><span class="hs-identifier hs-var hs-var">txInfoValidRange</span></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-134"></span><span>        </span><span id="local-6989586621680928259"><span class="annot"><span class="annottext">remainingActual :: Value
</span><a href="#local-6989586621680928259"><span class="hs-identifier hs-var hs-var">remainingActual</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; ValidatorHash -&gt; Value
</span><span class="hs-identifier hs-var">V2.valueLockedBy</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680928263"><span class="hs-identifier hs-var">txInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ScriptContext -&gt; ValidatorHash
</span><span class="hs-identifier hs-var">V2.ownHash</span></span><span> </span><span class="annot"><span class="annottext">ScriptContext
</span><a href="#local-6989586621680928266"><span class="hs-identifier hs-var">ctx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>        </span><span id="local-6989586621680928256"><span class="annot"><span class="annottext">remainingExpected :: Value
</span><a href="#local-6989586621680928256"><span class="hs-identifier hs-var hs-var">remainingExpected</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>            </span><span class="annot"><span class="annottext">VestingTranche -&gt; POSIXTimeRange -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#remainingFrom"><span class="hs-identifier hs-var">remainingFrom</span></a></span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928269"><span class="hs-identifier hs-var">vestingTranche1</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928261"><span class="hs-identifier hs-var">txInfoValidRange</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">VestingTranche -&gt; POSIXTimeRange -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#remainingFrom"><span class="hs-identifier hs-var">remainingFrom</span></a></span><span> </span><span class="annot"><span class="annottext">VestingTranche
</span><a href="#local-6989586621680928268"><span class="hs-identifier hs-var">vestingTranche2</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTimeRange
</span><a href="#local-6989586621680928261"><span class="hs-identifier hs-var">txInfoValidRange</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928259"><span class="hs-identifier hs-var">remainingActual</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`Value.geq`</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928256"><span class="hs-identifier hs-var">remainingExpected</span></a></span><span>
</span><span id="line-141"></span><span>            </span><span class="hs-comment">-- The policy encoded in this contract</span><span>
</span><span id="line-142"></span><span>            </span><span class="hs-comment">-- is &quot;vestingOwner can do with the funds what they want&quot; (as opposed</span><span>
</span><span id="line-143"></span><span>            </span><span class="hs-comment">-- to &quot;the funds must be paid to vestingOwner&quot;). This is enforcey by</span><span>
</span><span id="line-144"></span><span>            </span><span class="hs-comment">-- the following condition:</span><span>
</span><span id="line-145"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TxInfo -&gt; PubKeyHash -&gt; Bool
</span><span class="hs-identifier hs-var">V2.txSignedBy</span></span><span> </span><span class="annot"><span class="annottext">TxInfo
</span><a href="#local-6989586621680928263"><span class="hs-identifier hs-var">txInfo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; PubKeyHash
</span><span class="hs-identifier hs-var hs-var">unPaymentPubKeyHash</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash
</span><a href="#local-6989586621680928267"><span class="hs-identifier hs-var">vestingOwner</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>            </span><span class="hs-comment">-- That way the recipient of the funds can pay them to whatever address they</span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-comment">-- please, potentially saving one transaction.</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#vestingScript"><span class="hs-identifier hs-type">vestingScript</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Validator</span></span><span>
</span><span id="line-150"></span><span id="vestingScript"><span class="annot"><span class="annottext">vestingScript :: VestingParams -&gt; Validator
</span><a href="Plutus.Contracts.Vesting.html#vestingScript"><span class="hs-identifier hs-var hs-var">vestingScript</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator Vesting -&gt; Validator
forall a. TypedValidator a -&gt; Validator
</span><span class="hs-identifier hs-var">Scripts.validatorScript</span></span><span> </span><span class="annot"><span class="annottext">(TypedValidator Vesting -&gt; Validator)
-&gt; (VestingParams -&gt; TypedValidator Vesting)
-&gt; VestingParams
-&gt; Validator
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; TypedValidator Vesting
</span><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-type">typedValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.TypedValidator</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-type">Vesting</span></a></span><span>
</span><span id="line-153"></span><span id="typedValidator"><span class="annot"><span class="annottext">typedValidator :: VestingParams -&gt; TypedValidator Vesting
</span><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-var hs-var">typedValidator</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompiledCode (VestingParams -&gt; ValidatorType Vesting)
-&gt; CompiledCode (ValidatorType Vesting -&gt; UntypedValidator)
-&gt; VestingParams
-&gt; TypedValidator Vesting
forall a param.
Lift DefaultUni param =&gt;
CompiledCode (param -&gt; ValidatorType a)
-&gt; CompiledCode (ValidatorType a -&gt; UntypedValidator)
-&gt; param
-&gt; TypedValidator a
</span><span class="hs-identifier hs-var">V2.mkTypedValidatorParam</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Vesting"><span class="hs-identifier hs-type">Vesting</span></a></span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><span class="hs-identifier hs-type">PlutusTx.compile</span></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">validate</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span>    </span><span class="hs-special">$$(</span><span class="annot"><span class="hs-identifier hs-type">PlutusTx.compile</span></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">wrap</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-157"></span><span>        </span><span id="local-6989586621680928245"><span class="annot"><span class="annottext">wrap :: (() -&gt; () -&gt; ScriptContext -&gt; Bool) -&gt; UntypedValidator
</span><a href="#local-6989586621680928245"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; () -&gt; ScriptContext -&gt; Bool) -&gt; UntypedValidator
forall sc d r.
(IsScriptContext sc, UnsafeFromData d, UnsafeFromData r) =&gt;
(d -&gt; r -&gt; sc -&gt; Bool) -&gt; UntypedValidator
</span><span class="hs-identifier hs-var">Scripts.mkUntypedValidator</span></span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#contractAddress"><span class="hs-identifier hs-type">contractAddress</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CardanoAddress</span></span><span>
</span><span id="line-160"></span><span id="contractAddress"><span class="annot"><span class="annottext">contractAddress :: VestingParams -&gt; CardanoAddress
</span><a href="Plutus.Contracts.Vesting.html#contractAddress"><span class="hs-identifier hs-var hs-var">contractAddress</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; TypedValidator Vesting -&gt; CardanoAddress
forall a. NetworkId -&gt; TypedValidator a -&gt; CardanoAddress
</span><span class="hs-identifier hs-var">Scripts.validatorCardanoAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><span class="hs-identifier hs-var">testnet</span></span><span> </span><span class="annot"><span class="annottext">(TypedValidator Vesting -&gt; CardanoAddress)
-&gt; (VestingParams -&gt; TypedValidator Vesting)
-&gt; VestingParams
-&gt; CardanoAddress
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; TypedValidator Vesting
</span><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span id="local-6989586621680928240"><span id="local-6989586621680928241"></span></span><span class="hs-keyword">data</span><span> </span><span id="VestingError"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingError"><span class="hs-identifier hs-var">VestingError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-163"></span><span>    </span><span id="VContractError"><span class="annot"><a href="Plutus.Contracts.Vesting.html#VContractError"><span class="hs-identifier hs-var">VContractError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContractError</span></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="InsufficientFundsError"><span class="annot"><a href="Plutus.Contracts.Vesting.html#InsufficientFundsError"><span class="hs-identifier hs-var">InsufficientFundsError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680928234"><span id="local-6989586621680928236"><span class="annot"><span class="annottext">VestingError -&gt; VestingError -&gt; Bool
(VestingError -&gt; VestingError -&gt; Bool)
-&gt; (VestingError -&gt; VestingError -&gt; Bool) -&gt; Eq VestingError
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: VestingError -&gt; VestingError -&gt; Bool
$c/= :: VestingError -&gt; VestingError -&gt; Bool
== :: VestingError -&gt; VestingError -&gt; Bool
$c== :: VestingError -&gt; VestingError -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928227"><span id="local-6989586621680928229"><span id="local-6989586621680928231"><span class="annot"><span class="annottext">Int -&gt; VestingError -&gt; ShowS
[VestingError] -&gt; ShowS
VestingError -&gt; String
(Int -&gt; VestingError -&gt; ShowS)
-&gt; (VestingError -&gt; String)
-&gt; ([VestingError] -&gt; ShowS)
-&gt; Show VestingError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [VestingError] -&gt; ShowS
$cshowList :: [VestingError] -&gt; ShowS
show :: VestingError -&gt; String
$cshow :: VestingError -&gt; String
showsPrec :: Int -&gt; VestingError -&gt; ShowS
$cshowsPrec :: Int -&gt; VestingError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. VestingError -&gt; Rep VestingError x)
-&gt; (forall x. Rep VestingError x -&gt; VestingError)
-&gt; Generic VestingError
forall x. Rep VestingError x -&gt; VestingError
forall x. VestingError -&gt; Rep VestingError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep VestingError x -&gt; VestingError
$cfrom :: forall x. VestingError -&gt; Rep VestingError x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680928216"><span id="local-6989586621680928218"><span id="local-6989586621680928220"><span id="local-6989586621680928222"><span class="annot"><span class="annottext">[VestingError] -&gt; Encoding
[VestingError] -&gt; Value
VestingError -&gt; Encoding
VestingError -&gt; Value
(VestingError -&gt; Value)
-&gt; (VestingError -&gt; Encoding)
-&gt; ([VestingError] -&gt; Value)
-&gt; ([VestingError] -&gt; Encoding)
-&gt; ToJSON VestingError
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [VestingError] -&gt; Encoding
$ctoEncodingList :: [VestingError] -&gt; Encoding
toJSONList :: [VestingError] -&gt; Value
$ctoJSONList :: [VestingError] -&gt; Value
toEncoding :: VestingError -&gt; Encoding
$ctoEncoding :: VestingError -&gt; Encoding
toJSON :: VestingError -&gt; Value
$ctoJSON :: VestingError -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680928211"><span id="local-6989586621680928213"><span class="annot"><span class="annottext">Value -&gt; Parser [VestingError]
Value -&gt; Parser VestingError
(Value -&gt; Parser VestingError)
-&gt; (Value -&gt; Parser [VestingError]) -&gt; FromJSON VestingError
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [VestingError]
$cparseJSONList :: Value -&gt; Parser [VestingError]
parseJSON :: Value -&gt; Parser VestingError
$cparseJSON :: Value -&gt; Parser VestingError
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span id="_InsufficientFundsError"><span id="_VContractError"><span id="_VestingError"><span id="local-6989586621680928202"><span id="local-6989586621680928204"><span id="local-6989586621680928206"><span id="local-6989586621680928208"><span id="local-6989586621680928209"><span id="AsVestingError"><span id="local-6989586621680928495"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">VestingError</span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680928181"><span id="local-6989586621680928183"><span id="local-6989586621680928185"><span id="local-6989586621680928187"><span id="local-6989586621680928189"><span id="local-6989586621680928191"><span id="local-6989586621680928193"><span id="local-6989586621680928195"><span class="annot"><span class="hs-identifier hs-type">AsContractError</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingError"><span class="hs-identifier hs-type">VestingError</span></a></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-171"></span><span>    </span><span id="local-6989586621680928179"><span class="annot"><span class="annottext">_ContractError :: p ContractError (f ContractError)
-&gt; p VestingError (f VestingError)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">_ContractError</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError)
-&gt; p VestingError (f VestingError)
forall r. AsVestingError r =&gt; Prism' r ContractError
</span><a href="Plutus.Contracts.Vesting.html#_VContractError"><span class="hs-identifier hs-var">_VContractError</span></a></span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#vestingContract"><span class="hs-identifier hs-type">vestingContract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Contract</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingSchema"><span class="hs-identifier hs-type">VestingSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingError"><span class="hs-identifier hs-type">VestingError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span id="vestingContract"><span class="annot"><span class="annottext">vestingContract :: VestingParams -&gt; Contract () VestingSchema VestingError ()
</span><a href="Plutus.Contracts.Vesting.html#vestingContract"><span class="hs-identifier hs-var hs-var">vestingContract</span></a></span></span><span> </span><span id="local-6989586621680928177"><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928177"><span class="hs-identifier hs-var">vesting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Promise
   ()
   ('R
      '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
         &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
   VestingError
   ()]
-&gt; Contract
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall w (s :: Row *) e a. [Promise w s e a] -&gt; Contract w s e a
</span><span class="hs-identifier hs-var">selectList</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
</span><a href="#local-6989586621680928175"><span class="hs-identifier hs-var">vest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
</span><a href="#local-6989586621680928174"><span class="hs-identifier hs-var">retrieve</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-175"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-176"></span><span>    </span><span id="local-6989586621680928175"><span class="annot"><span class="annottext">vest :: Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
</span><a href="#local-6989586621680928175"><span class="hs-identifier hs-var hs-var">vest</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;vest funds&quot; a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><span class="hs-identifier hs-var">endpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;vest funds&quot;</span></span><span> </span><span class="annot"><span class="annottext">((()
  -&gt; Contract
       ()
       ('R
          '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
             &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
       VestingError
       ())
 -&gt; Promise
      ()
      ('R
         '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
            &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
      VestingError
      ())
-&gt; (()
    -&gt; Contract
         ()
         ('R
            '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
               &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
         VestingError
         ())
-&gt; Promise
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">VestingParams
-&gt; Contract
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall e w (s :: Row *).
AsVestingError e =&gt;
VestingParams -&gt; Contract w s e ()
</span><a href="Plutus.Contracts.Vesting.html#vestFundsC"><span class="hs-identifier hs-var">vestFundsC</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928177"><span class="hs-identifier hs-var">vesting</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621680928174"><span class="annot"><span class="annottext">retrieve :: Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
</span><a href="#local-6989586621680928174"><span class="hs-identifier hs-var hs-var">retrieve</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;retrieve funds&quot; a s, AsContractError e,
 FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><span class="hs-identifier hs-var">endpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;retrieve funds&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Value
  -&gt; Contract
       ()
       ('R
          '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
             &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
       VestingError
       ())
 -&gt; Promise
      ()
      ('R
         '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
            &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
      VestingError
      ())
-&gt; (Value
    -&gt; Contract
         ()
         ('R
            '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
               &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
         VestingError
         ())
-&gt; Promise
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680928170"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928170"><span class="hs-identifier hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>        </span><span id="local-6989586621680928169"><span class="annot"><span class="annottext">Liveness
</span><a href="#local-6989586621680928169"><span class="hs-identifier hs-var">liveness</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VestingParams
-&gt; Value
-&gt; Contract
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     Liveness
forall e w (s :: Row *).
AsVestingError e =&gt;
VestingParams -&gt; Value -&gt; Contract w s e Liveness
</span><a href="Plutus.Contracts.Vesting.html#retrieveFundsC"><span class="hs-identifier hs-var">retrieveFundsC</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928177"><span class="hs-identifier hs-var">vesting</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928170"><span class="hs-identifier hs-var">payment</span></a></span><span>
</span><span id="line-179"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Liveness
</span><a href="#local-6989586621680928169"><span class="hs-identifier hs-var">liveness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-180"></span><span>            </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Alive"><span class="hs-identifier hs-var">Alive</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
-&gt; Contract
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall w (s :: Row *) e a. Promise w s e a -&gt; Contract w s e a
</span><span class="hs-identifier hs-var hs-var">awaitPromise</span></span><span> </span><span class="annot"><span class="annottext">Promise
  ()
  ('R
     '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
        &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
  VestingError
  ()
</span><a href="#local-6989586621680928174"><span class="hs-identifier hs-var">retrieve</span></a></span><span>
</span><span id="line-181"></span><span>            </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Dead"><span class="hs-identifier hs-var">Dead</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">()
-&gt; Contract
     ()
     ('R
        '[ &quot;retrieve funds&quot; ':-&gt; (EndpointValue Value, ActiveEndpoint),
           &quot;vest funds&quot; ':-&gt; (EndpointValue (), ActiveEndpoint)])
     VestingError
     ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>
</span><span id="line-183"></span><span class="annot"><a href="Plutus.Contracts.Vesting.html#payIntoContract"><span class="hs-identifier hs-type">payIntoContract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxConstraints</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span id="payIntoContract"><span class="annot"><span class="annottext">payIntoContract :: Value -&gt; TxConstraints () ()
</span><a href="Plutus.Contracts.Vesting.html#payIntoContract"><span class="hs-identifier hs-var hs-var">payIntoContract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; Value -&gt; TxConstraints () ()
forall o i. o -&gt; Value -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">mustPayToTheScriptWithDatumInTx</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span id="local-6989586621680928432"><span id="local-6989586621680928433"><span id="local-6989586621680928434"><span class="annot"><a href="Plutus.Contracts.Vesting.html#vestFundsC"><span class="hs-identifier hs-type">vestFundsC</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#AsVestingError"><span class="hs-identifier hs-type">AsVestingError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928434"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-188"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Contract</span></span><span> </span><span class="annot"><a href="#local-6989586621680928433"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928432"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928434"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-191"></span><span id="vestFundsC"><span class="annot"><span class="annottext">vestFundsC :: VestingParams -&gt; Contract w s e ()
</span><a href="Plutus.Contracts.Vesting.html#vestFundsC"><span class="hs-identifier hs-var hs-var">vestFundsC</span></a></span></span><span> </span><span id="local-6989586621680928162"><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928162"><span class="hs-identifier hs-var">vesting</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VestingError -&gt; e)
-&gt; Contract w s VestingError () -&gt; Contract w s e ()
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><span class="hs-identifier hs-var">mapError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AReview e VestingError -&gt; VestingError -&gt; e
forall b (m :: * -&gt; *) t. MonadReader b m =&gt; AReview t b -&gt; m t
</span><span class="hs-identifier hs-var">review</span></span><span> </span><span class="annot"><span class="annottext">AReview e VestingError
forall r. AsVestingError r =&gt; Prism' r VestingError
</span><a href="Plutus.Contracts.Vesting.html#_VestingError"><span class="hs-identifier hs-var">_VestingError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s VestingError () -&gt; Contract w s e ())
-&gt; Contract w s VestingError () -&gt; Contract w s e ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680928159"><span class="annot"><span class="annottext">tx :: TxConstraints () ()
</span><a href="#local-6989586621680928159"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints () ()
</span><a href="Plutus.Contracts.Vesting.html#payIntoContract"><span class="hs-identifier hs-var">payIntoContract</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VestingParams -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-identifier hs-var">totalAmount</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928162"><span class="hs-identifier hs-var">vesting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Vesting
-&gt; TxConstraints (RedeemerType Vesting) (DatumType Vesting)
-&gt; Contract w s VestingError UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><span class="hs-identifier hs-var">mkTxConstraints</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator Vesting -&gt; ScriptLookups Vesting
forall a. TypedValidator a -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></span><span> </span><span class="annot"><span class="annottext">(TypedValidator Vesting -&gt; ScriptLookups Vesting)
-&gt; TypedValidator Vesting -&gt; ScriptLookups Vesting
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; TypedValidator Vesting
</span><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928162"><span class="hs-identifier hs-var">vesting</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints () ()
TxConstraints (RedeemerType Vesting) (DatumType Vesting)
</span><a href="#local-6989586621680928159"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-194"></span><span>      </span><span class="annot"><span class="annottext">Contract w s VestingError UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s VestingError UnbalancedTx)
-&gt; Contract w s VestingError UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s VestingError UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><span class="hs-identifier hs-var">adjustUnbalancedTx</span></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s VestingError ())
-&gt; Contract w s VestingError ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError CardanoTx -&gt; Contract w s VestingError ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract w s VestingError CardanoTx
 -&gt; Contract w s VestingError ())
-&gt; (UnbalancedTx -&gt; Contract w s VestingError CardanoTx)
-&gt; UnbalancedTx
-&gt; Contract w s VestingError ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s VestingError CardanoTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e CardanoTx
</span><span class="hs-identifier hs-var">submitUnbalancedTx</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">data</span><span> </span><span id="Liveness"><span class="annot"><a href="Plutus.Contracts.Vesting.html#Liveness"><span class="hs-identifier hs-var">Liveness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Alive"><span class="annot"><a href="Plutus.Contracts.Vesting.html#Alive"><span class="hs-identifier hs-var">Alive</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Dead"><span class="annot"><a href="Plutus.Contracts.Vesting.html#Dead"><span class="hs-identifier hs-var">Dead</span></a></span></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621680928428"><span id="local-6989586621680928429"><span id="local-6989586621680928430"><span class="annot"><a href="Plutus.Contracts.Vesting.html#retrieveFundsC"><span class="hs-identifier hs-type">retrieveFundsC</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#AsVestingError"><span class="hs-identifier hs-type">AsVestingError</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928430"><span class="hs-identifier hs-type">e</span></a></span><span>
</span><span id="line-200"></span><span>       </span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#VestingParams"><span class="hs-identifier hs-type">VestingParams</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Contract</span></span><span> </span><span class="annot"><a href="#local-6989586621680928429"><span class="hs-identifier hs-type">w</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928428"><span class="hs-identifier hs-type">s</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680928430"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Vesting.html#Liveness"><span class="hs-identifier hs-type">Liveness</span></a></span></span></span></span><span>
</span><span id="line-204"></span><span id="retrieveFundsC"><span class="annot"><span class="annottext">retrieveFundsC :: VestingParams -&gt; Value -&gt; Contract w s e Liveness
</span><a href="Plutus.Contracts.Vesting.html#retrieveFundsC"><span class="hs-identifier hs-var hs-var">retrieveFundsC</span></a></span></span><span> </span><span id="local-6989586621680928154"><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928154"><span class="hs-identifier hs-var">vesting</span></a></span></span><span> </span><span id="local-6989586621680928153"><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928153"><span class="hs-identifier hs-var">payment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VestingError -&gt; e)
-&gt; Contract w s VestingError Liveness -&gt; Contract w s e Liveness
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><span class="hs-identifier hs-var">mapError</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AReview e VestingError -&gt; VestingError -&gt; e
forall b (m :: * -&gt; *) t. MonadReader b m =&gt; AReview t b -&gt; m t
</span><span class="hs-identifier hs-var">review</span></span><span> </span><span class="annot"><span class="annottext">AReview e VestingError
forall r. AsVestingError r =&gt; Prism' r VestingError
</span><a href="Plutus.Contracts.Vesting.html#_VestingError"><span class="hs-identifier hs-var">_VestingError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Contract w s VestingError Liveness -&gt; Contract w s e Liveness)
-&gt; Contract w s VestingError Liveness -&gt; Contract w s e Liveness
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>    </span><span id="local-6989586621680928152"><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680928152"><span class="hs-identifier hs-var">networkId</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Params -&gt; NetworkId
</span><span class="hs-identifier hs-var hs-var">pNetworkId</span></span><span> </span><span class="annot"><span class="annottext">(Params -&gt; NetworkId)
-&gt; Contract w s VestingError Params
-&gt; Contract w s VestingError NetworkId
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError Params
forall w (s :: Row *) e. AsContractError e =&gt; Contract w s e Params
</span><span class="hs-identifier hs-var">getParams</span></span><span>
</span><span id="line-206"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680928149"><span class="annot"><span class="annottext">inst :: TypedValidator Vesting
</span><a href="#local-6989586621680928149"><span class="hs-identifier hs-var hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; TypedValidator Vesting
</span><a href="Plutus.Contracts.Vesting.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928154"><span class="hs-identifier hs-var">vesting</span></a></span><span>
</span><span id="line-207"></span><span>        </span><span id="local-6989586621680928148"><span class="annot"><span class="annottext">addr :: CardanoAddress
</span><a href="#local-6989586621680928148"><span class="hs-identifier hs-var hs-var">addr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NetworkId -&gt; TypedValidator Vesting -&gt; CardanoAddress
forall a. NetworkId -&gt; TypedValidator a -&gt; CardanoAddress
</span><span class="hs-identifier hs-var">Scripts.validatorCardanoAddress</span></span><span> </span><span class="annot"><span class="annottext">NetworkId
</span><a href="#local-6989586621680928152"><span class="hs-identifier hs-var">networkId</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator Vesting
</span><a href="#local-6989586621680928149"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621680928147"><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928147"><span class="hs-identifier hs-var">now</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(POSIXTime, POSIXTime) -&gt; POSIXTime
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((POSIXTime, POSIXTime) -&gt; POSIXTime)
-&gt; Contract w s VestingError (POSIXTime, POSIXTime)
-&gt; Contract w s VestingError POSIXTime
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError (POSIXTime, POSIXTime)
forall w (s :: Row *) e.
AsContractError e =&gt;
Contract w s e (POSIXTime, POSIXTime)
</span><span class="hs-identifier hs-var">currentNodeClientTimeRange</span></span><span>
</span><span id="line-209"></span><span>    </span><span id="local-6989586621680928144"><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680928144"><span class="hs-identifier hs-var">unspentOutputs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CardanoAddress
-&gt; Contract w s VestingError (Map TxOutRef DecoratedTxOut)
forall w (s :: Row *) e.
AsContractError e =&gt;
CardanoAddress -&gt; Contract w s e (Map TxOutRef DecoratedTxOut)
</span><span class="hs-identifier hs-var">utxosAt</span></span><span> </span><span class="annot"><span class="annottext">CardanoAddress
</span><a href="#local-6989586621680928148"><span class="hs-identifier hs-var">addr</span></a></span><span>
</span><span id="line-210"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-211"></span><span>        </span><span id="local-6989586621680928142"><span class="annot"><span class="annottext">currentlyLocked :: Value
</span><a href="#local-6989586621680928142"><span class="hs-identifier hs-var hs-var">currentlyLocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DecoratedTxOut -&gt; Value) -&gt; [DecoratedTxOut] -&gt; Value
forall (t :: * -&gt; *) m a.
(Foldable t, Monoid m) =&gt;
(a -&gt; m) -&gt; t a -&gt; m
</span><span class="hs-identifier hs-var">foldMap</span></span><span> </span><span class="annot"><span class="annottext">DecoratedTxOut -&gt; Value
</span><span class="hs-identifier hs-var">decoratedTxOutPlutusValue</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; [DecoratedTxOut]
forall k a. Map k a -&gt; [a]
</span><span class="hs-identifier hs-var">Map.elems</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680928144"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span>        </span><span id="local-6989586621680928140"><span class="annot"><span class="annottext">remainingValue :: Value
</span><a href="#local-6989586621680928140"><span class="hs-identifier hs-var hs-var">remainingValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928142"><span class="hs-identifier hs-var">currentlyLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928153"><span class="hs-identifier hs-var">payment</span></a></span><span>
</span><span id="line-213"></span><span>        </span><span id="local-6989586621680928139"><span class="annot"><span class="annottext">mustRemainLocked :: Value
</span><a href="#local-6989586621680928139"><span class="hs-identifier hs-var hs-var">mustRemainLocked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#totalAmount"><span class="hs-identifier hs-var">totalAmount</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928154"><span class="hs-identifier hs-var">vesting</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">VestingParams -&gt; POSIXTime -&gt; Value
</span><a href="Plutus.Contracts.Vesting.html#availableAt"><span class="hs-identifier hs-var">availableAt</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928154"><span class="hs-identifier hs-var">vesting</span></a></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928147"><span class="hs-identifier hs-var">now</span></a></span><span>
</span><span id="line-214"></span><span>        </span><span id="local-6989586621680928138"><span class="annot"><span class="annottext">maxPayment :: Value
</span><a href="#local-6989586621680928138"><span class="hs-identifier hs-var hs-var">maxPayment</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928142"><span class="hs-identifier hs-var">currentlyLocked</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928139"><span class="hs-identifier hs-var">mustRemainLocked</span></a></span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Contract w s VestingError () -&gt; Contract w s VestingError ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928140"><span class="hs-identifier hs-var">remainingValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`Value.lt`</span></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928139"><span class="hs-identifier hs-var">mustRemainLocked</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>        </span><span class="annot"><span class="annottext">(Contract w s VestingError () -&gt; Contract w s VestingError ())
-&gt; Contract w s VestingError () -&gt; Contract w s VestingError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">VestingError -&gt; Contract w s VestingError ()
forall e (m :: * -&gt; *) a. MonadError e m =&gt; e -&gt; m a
</span><span class="hs-identifier hs-var">throwError</span></span><span>
</span><span id="line-218"></span><span>        </span><span class="annot"><span class="annottext">(VestingError -&gt; Contract w s VestingError ())
-&gt; VestingError -&gt; Contract w s VestingError ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Value -&gt; VestingError
</span><a href="Plutus.Contracts.Vesting.html#InsufficientFundsError"><span class="hs-identifier hs-var">InsufficientFundsError</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928153"><span class="hs-identifier hs-var">payment</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928138"><span class="hs-identifier hs-var">maxPayment</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928139"><span class="hs-identifier hs-var">mustRemainLocked</span></a></span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680928135"><span class="annot"><span class="annottext">liveness :: Liveness
</span><a href="#local-6989586621680928135"><span class="hs-identifier hs-var hs-var">liveness</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928140"><span class="hs-identifier hs-var">remainingValue</span></a></span><span> </span><span class="annot"><span class="annottext">Value -&gt; Value -&gt; Bool
</span><span class="hs-operator hs-var">`Value.gt`</span></span><span> </span><span class="annot"><span class="annottext">Value
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Alive"><span class="hs-identifier hs-var">Alive</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Dead"><span class="hs-identifier hs-var">Dead</span></a></span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621680928133"><span class="annot"><span class="annottext">remainingOutputs :: TxConstraints () ()
</span><a href="#local-6989586621680928133"><span class="hs-identifier hs-var hs-var">remainingOutputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Liveness
</span><a href="#local-6989586621680928135"><span class="hs-identifier hs-var">liveness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-222"></span><span>                            </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Alive"><span class="hs-identifier hs-var">Alive</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Value -&gt; TxConstraints () ()
</span><a href="Plutus.Contracts.Vesting.html#payIntoContract"><span class="hs-identifier hs-var">payIntoContract</span></a></span><span> </span><span class="annot"><span class="annottext">Value
</span><a href="#local-6989586621680928140"><span class="hs-identifier hs-var">remainingValue</span></a></span><span>
</span><span id="line-223"></span><span>                            </span><span class="annot"><span class="annottext">Liveness
</span><a href="Plutus.Contracts.Vesting.html#Dead"><span class="hs-identifier hs-var">Dead</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TxConstraints () ()
forall a. Monoid a =&gt; a
</span><span class="hs-identifier hs-var">mempty</span></span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621680928132"><span class="annot"><span class="annottext">tx :: TxConstraints () ()
</span><a href="#local-6989586621680928132"><span class="hs-identifier hs-var hs-var">tx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; () -&gt; TxConstraints () ()
forall i o. Map TxOutRef DecoratedTxOut -&gt; i -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Constraints.spendUtxosFromTheScript</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680928144"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>                </span><span class="annot"><span class="annottext">TxConstraints () () -&gt; TxConstraints () () -&gt; TxConstraints () ()
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints () ()
</span><a href="#local-6989586621680928133"><span class="hs-identifier hs-var">remainingOutputs</span></a></span><span>
</span><span id="line-226"></span><span>                </span><span class="annot"><span class="annottext">TxConstraints () () -&gt; TxConstraints () () -&gt; TxConstraints () ()
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints () ()
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">mustValidateInTimeRange</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><span class="hs-identifier hs-var">ValidityInterval.from</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680928147"><span class="hs-identifier hs-var">now</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                </span><span class="annot"><span class="annottext">TxConstraints () () -&gt; TxConstraints () () -&gt; TxConstraints () ()
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PaymentPubKeyHash -&gt; TxConstraints () ()
forall i o. PaymentPubKeyHash -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">mustBeSignedBy</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VestingParams -&gt; PaymentPubKeyHash
</span><a href="Plutus.Contracts.Vesting.html#vestingOwner"><span class="hs-identifier hs-var hs-var">vestingOwner</span></a></span><span> </span><span class="annot"><span class="annottext">VestingParams
</span><a href="#local-6989586621680928154"><span class="hs-identifier hs-var">vesting</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>                </span><span class="hs-comment">-- we don't need to add a pubkey output for 'vestingOwner' here</span><span>
</span><span id="line-229"></span><span>                </span><span class="hs-comment">-- because this will be done by the wallet when it balances the</span><span>
</span><span id="line-230"></span><span>                </span><span class="hs-comment">-- transaction.</span><span>
</span><span id="line-231"></span><span>    </span><span class="annot"><span class="annottext">ScriptLookups Vesting
-&gt; TxConstraints (RedeemerType Vesting) (DatumType Vesting)
-&gt; Contract w s VestingError UnbalancedTx
forall a w (s :: Row *) e.
(ToData (RedeemerType a), FromData (DatumType a),
 ToData (DatumType a), AsContractError e) =&gt;
ScriptLookups a
-&gt; TxConstraints (RedeemerType a) (DatumType a)
-&gt; Contract w s e UnbalancedTx
</span><span class="hs-identifier hs-var">mkTxConstraints</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypedValidator Vesting -&gt; ScriptLookups Vesting
forall a. TypedValidator a -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Constraints.typedValidatorLookups</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator Vesting
</span><a href="#local-6989586621680928149"><span class="hs-identifier hs-var">inst</span></a></span><span>
</span><span id="line-232"></span><span>                  </span><span class="annot"><span class="annottext">ScriptLookups Vesting
-&gt; ScriptLookups Vesting -&gt; ScriptLookups Vesting
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut -&gt; ScriptLookups Vesting
forall a. Map TxOutRef DecoratedTxOut -&gt; ScriptLookups a
</span><span class="hs-identifier hs-var">Constraints.unspentOutputs</span></span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><a href="#local-6989586621680928144"><span class="hs-identifier hs-var">unspentOutputs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TxConstraints () ()
TxConstraints (RedeemerType Vesting) (DatumType Vesting)
</span><a href="#local-6989586621680928132"><span class="hs-identifier hs-var">tx</span></a></span><span>
</span><span id="line-233"></span><span>      </span><span class="annot"><span class="annottext">Contract w s VestingError UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s VestingError UnbalancedTx)
-&gt; Contract w s VestingError UnbalancedTx
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s VestingError UnbalancedTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e UnbalancedTx
</span><span class="hs-identifier hs-var">adjustUnbalancedTx</span></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError UnbalancedTx
-&gt; (UnbalancedTx -&gt; Contract w s VestingError ())
-&gt; Contract w s VestingError ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Contract w s VestingError CardanoTx -&gt; Contract w s VestingError ()
forall (f :: * -&gt; *) a. Functor f =&gt; f a -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">void</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract w s VestingError CardanoTx
 -&gt; Contract w s VestingError ())
-&gt; (UnbalancedTx -&gt; Contract w s VestingError CardanoTx)
-&gt; UnbalancedTx
-&gt; Contract w s VestingError ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">UnbalancedTx -&gt; Contract w s VestingError CardanoTx
forall w (s :: Row *) e.
AsContractError e =&gt;
UnbalancedTx -&gt; Contract w s e CardanoTx
</span><span class="hs-identifier hs-var">submitUnbalancedTx</span></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">Liveness -&gt; Contract w s VestingError Liveness
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Liveness
</span><a href="#local-6989586621680928135"><span class="hs-identifier hs-var">liveness</span></a></span><span>
</span><span id="line-235"></span></pre></body></html>