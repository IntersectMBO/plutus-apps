<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DataKinds         #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass    #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE DeriveGeneric     #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE DerivingVia       #-}</span><span>
</span><span id="line-5"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts  #-}</span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase        #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE MonoLocalBinds    #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns    #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE NoImplicitPrelude #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell   #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE TypeApplications  #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE TypeOperators     #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-name-shadowing #-}</span><span>
</span><span id="line-15"></span><span class="hs-comment">{- Stablecoin backed by a cryptocurrency.

= Concept

The bank keeps a reserve of an underlying base cryptocurrency. The bank
issues and redeems stablecoins and reservecoins.

The stablecoin is pegged to a peg currency, for example USD or BTC. The
exchange rate between the peg currency and the base cryptocurrency is provided
by an oracle.

The holder of a stablecoin has a claim to a variable portion of the reserves
according to the exchange rate

The bank's equity is the bank's reserves minus the bank's liabilities to the
stablecoin holders. The bank's equity is owned by the reservecoin holders.

The bank profits (and its reserve grows) by minting and redeeming the
stablecoins and reservecoins for a fee.

The bank's reserve ratio is the bank's reserves divided by the amount of
stablecoins in circulation. The bank is only allowed to issue and sell
stablecoins and reservecoins if the reserve ratio remains above a minimum
threshold. The minimum threshold aims to ensure that stablecoins remain fully
backed by reserves even if the price of the base currency falls.

= Implementation

The contract is written as a state machine defined in the 'step' function. It
supports two operations: mint a number of stablecoins and mint a number of
reservecoins. Stablecoins and reservecoins can be redeemed by minting a
negative number of them.

An oracle value with the current exchange rate of the base currency has to be
provided with every transition.

The two coins (stablecoin and reservecoin) are Plutus native token whose minting
policy is the forwarding policy for the stablecoin's state machine.

We use the 'Ratio' type for all calculations in the script, using 'round' to
obtain 'Integer' values at the very end.

-}</span><span>
</span><span id="line-58"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Plutus.Contracts.Stablecoin</span><span class="hs-special">(</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier">SC</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier">RC</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier">BC</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier">PC</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier">BankState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier">Stablecoin</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier">Input</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SCAction"><span class="hs-identifier">SCAction</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier">ConversionRate</span></a></span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><span class="hs-comment">-- * State machine client</span></span><span>
</span><span id="line-69"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier">typedValidator</span></a></span><span>
</span><span id="line-70"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#machineClient"><span class="hs-identifier">machineClient</span></a></span><span>
</span><span id="line-71"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#step"><span class="hs-identifier">step</span></a></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Contract using the state machine</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#contract"><span class="hs-identifier">contract</span></a></span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier">StablecoinError</span></a></span><span>
</span><span id="line-75"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinSchema"><span class="hs-identifier">StablecoinSchema</span></a></span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Etc.</span></span><span>
</span><span id="line-77"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#stableCoins"><span class="hs-identifier">stableCoins</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#reserveCoins"><span class="hs-identifier">reserveCoins</span></a></span><span>
</span><span id="line-79"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier">checkValidState</span></a></span><span>
</span><span id="line-80"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Lens</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">makeClassyPrisms</span></span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Control.Monad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">forever</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">guard</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">FromJSON</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ToJSON</span></span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Data.Functor.Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Identity</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">GHC.Generics</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Address</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">PaymentPubKey</span></span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Scripts</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">MintingPolicyHash</span></span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">TxConstraints</span></span><span class="hs-special">)</span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Constraints</span></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Tx.Constraints.ValidityInterval</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Interval</span></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Ledger.Typed.Scripts</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Scripts</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract</span></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract.Oracle</span></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract.StateMachine</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AsSMContractError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">SMContractError</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">State</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">StateMachine</span></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>                                     </span><span class="annot"><span class="hs-identifier">StateMachineClient</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Void</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Contract.StateMachine</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">SM</span></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Ada</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Ada</span></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.V2.Typed.Scripts</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">V2</span></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">AssetClass</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TokenName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Plutus.Script.Utils.Value</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Value</span></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx</span></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Prelude</span></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">PlutusTx.Ratio</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">R</span></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier">Prelude</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Haskell</span></span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- | Conversion rate from peg currency (eg. USD) to base currency (eg. Ada)</span><span>
</span><span id="line-108"></span><span class="hs-keyword">type</span><span> </span><span id="ConversionRate"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-var">ConversionRate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-comment">-- Amounts of stablecoins and reservecoins (used for bookkeeping)</span><span>
</span><span id="line-111"></span><span class="hs-comment">-- SC, RC and BC are values that can be represented on-chain with the 'Value'</span><span>
</span><span id="line-112"></span><span class="hs-comment">-- type. PC is a currency such as USD that exists outside the chain, so we</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- will never have a 'Value' containing PC.</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- | An amount of stablecoins</span><span>
</span><span id="line-116"></span><span id="local-6989586621680920623"><span id="local-6989586621680920624"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="SC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-var">SC</span></a></span></span><span> </span><span id="local-6989586621680920870"><span class="annot"><a href="#local-6989586621680920870"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="SC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-var">SC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unSC"><span class="annot"><span class="annottext">SC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unSC"><span class="hs-identifier hs-var hs-var">unSC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680920870"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-117"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920607"><span id="local-6989586621680920609"><span id="local-6989586621680920611"><span id="local-6989586621680920613"><span id="local-6989586621680920615"><span id="local-6989586621680920617"><span id="local-6989586621680920619"><span class="annot"><span class="annottext">Integer -&gt; SC a
SC a -&gt; SC a
SC a -&gt; SC a -&gt; SC a
(SC a -&gt; SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a)
-&gt; (Integer -&gt; SC a)
-&gt; Num (SC a)
forall a. Num a =&gt; Integer -&gt; SC a
forall a. Num a =&gt; SC a -&gt; SC a
forall a. Num a =&gt; SC a -&gt; SC a -&gt; SC a
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; SC a
$cfromInteger :: forall a. Num a =&gt; Integer -&gt; SC a
signum :: SC a -&gt; SC a
$csignum :: forall a. Num a =&gt; SC a -&gt; SC a
abs :: SC a -&gt; SC a
$cabs :: forall a. Num a =&gt; SC a -&gt; SC a
negate :: SC a -&gt; SC a
$cnegate :: forall a. Num a =&gt; SC a -&gt; SC a
* :: SC a -&gt; SC a -&gt; SC a
$c* :: forall a. Num a =&gt; SC a -&gt; SC a -&gt; SC a
- :: SC a -&gt; SC a -&gt; SC a
$c- :: forall a. Num a =&gt; SC a -&gt; SC a -&gt; SC a
+ :: SC a -&gt; SC a -&gt; SC a
$c+ :: forall a. Num a =&gt; SC a -&gt; SC a -&gt; SC a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Num</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920604"><span class="annot"><span class="annottext">SC a -&gt; SC a -&gt; Bool
(SC a -&gt; SC a -&gt; Bool) -&gt; Eq (SC a)
forall a. Eq a =&gt; SC a -&gt; SC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; Eq a
== :: SC a -&gt; SC a -&gt; Bool
$c== :: forall a. Eq a =&gt; SC a -&gt; SC a -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Eq</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920588"><span id="local-6989586621680920590"><span id="local-6989586621680920592"><span id="local-6989586621680920594"><span id="local-6989586621680920596"><span id="local-6989586621680920598"><span id="local-6989586621680920600"><span class="annot"><span class="annottext">Eq (SC a)
Eq (SC a)
-&gt; (SC a -&gt; SC a -&gt; Ordering)
-&gt; (SC a -&gt; SC a -&gt; Bool)
-&gt; (SC a -&gt; SC a -&gt; Bool)
-&gt; (SC a -&gt; SC a -&gt; Bool)
-&gt; (SC a -&gt; SC a -&gt; Bool)
-&gt; (SC a -&gt; SC a -&gt; SC a)
-&gt; (SC a -&gt; SC a -&gt; SC a)
-&gt; Ord (SC a)
SC a -&gt; SC a -&gt; Bool
SC a -&gt; SC a -&gt; Ordering
SC a -&gt; SC a -&gt; SC a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (SC a)
forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Bool
forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Ordering
forall a. Ord a =&gt; SC a -&gt; SC a -&gt; SC a
min :: SC a -&gt; SC a -&gt; SC a
$cmin :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; SC a
max :: SC a -&gt; SC a -&gt; SC a
$cmax :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; SC a
&gt;= :: SC a -&gt; SC a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Bool
&gt; :: SC a -&gt; SC a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Bool
&lt;= :: SC a -&gt; SC a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Bool
&lt; :: SC a -&gt; SC a -&gt; Bool
$c&lt; :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Bool
compare :: SC a -&gt; SC a -&gt; Ordering
$ccompare :: forall a. Ord a =&gt; SC a -&gt; SC a -&gt; Ordering
$cp1Ord :: forall a. Ord a =&gt; Eq (SC a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920584"><span class="annot"><span class="annottext">AdditiveMonoid (SC a)
AdditiveMonoid (SC a)
-&gt; (SC a -&gt; SC a -&gt; SC a) -&gt; AdditiveGroup (SC a)
SC a -&gt; SC a -&gt; SC a
forall a. AdditiveGroup a =&gt; AdditiveMonoid (SC a)
forall a. AdditiveGroup a =&gt; SC a -&gt; SC a -&gt; SC a
forall a. AdditiveMonoid a -&gt; (a -&gt; a -&gt; a) -&gt; AdditiveGroup a
- :: SC a -&gt; SC a -&gt; SC a
$c- :: forall a. AdditiveGroup a =&gt; SC a -&gt; SC a -&gt; SC a
$cp1AdditiveGroup :: forall a. AdditiveGroup a =&gt; AdditiveMonoid (SC a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveGroup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920580"><span class="annot"><span class="annottext">AdditiveSemigroup (SC a)
SC a
AdditiveSemigroup (SC a) -&gt; SC a -&gt; AdditiveMonoid (SC a)
forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (SC a)
forall a. AdditiveMonoid a =&gt; SC a
forall a. AdditiveSemigroup a -&gt; a -&gt; AdditiveMonoid a
zero :: SC a
$czero :: forall a. AdditiveMonoid a =&gt; SC a
$cp1AdditiveMonoid :: forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (SC a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveMonoid</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920577"><span class="annot"><span class="annottext">SC a -&gt; SC a -&gt; SC a
(SC a -&gt; SC a -&gt; SC a) -&gt; AdditiveSemigroup (SC a)
forall a. AdditiveSemigroup a =&gt; SC a -&gt; SC a -&gt; SC a
forall a. (a -&gt; a -&gt; a) -&gt; AdditiveSemigroup a
+ :: SC a -&gt; SC a -&gt; SC a
$c+ :: forall a. AdditiveSemigroup a =&gt; SC a -&gt; SC a -&gt; SC a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">AdditiveSemigroup</span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920574"><span class="annot"><span class="annottext">SC a -&gt; SC a -&gt; SC a
(SC a -&gt; SC a -&gt; SC a) -&gt; MultiplicativeSemigroup (SC a)
forall a. MultiplicativeSemigroup a =&gt; SC a -&gt; SC a -&gt; SC a
forall a. (a -&gt; a -&gt; a) -&gt; MultiplicativeSemigroup a
* :: SC a -&gt; SC a -&gt; SC a
$c* :: forall a. MultiplicativeSemigroup a =&gt; SC a -&gt; SC a -&gt; SC a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">MultiplicativeSemigroup</span></span></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SC a -&gt; Rep (SC a) x)
-&gt; (forall x. Rep (SC a) x -&gt; SC a) -&gt; Generic (SC a)
forall x. Rep (SC a) x -&gt; SC a
forall x. SC a -&gt; Rep (SC a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (SC a) x -&gt; SC a
forall a x. SC a -&gt; Rep (SC a) x
$cto :: forall a x. Rep (SC a) x -&gt; SC a
$cfrom :: forall a x. SC a -&gt; Rep (SC a) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920566"><span id="local-6989586621680920568"><span class="annot"><span class="annottext">SC a -&gt; SC a -&gt; Bool
(SC a -&gt; SC a -&gt; Bool) -&gt; (SC a -&gt; SC a -&gt; Bool) -&gt; Eq (SC a)
forall a. Eq a =&gt; SC a -&gt; SC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SC a -&gt; SC a -&gt; Bool
$c/= :: forall a. Eq a =&gt; SC a -&gt; SC a -&gt; Bool
== :: SC a -&gt; SC a -&gt; Bool
$c== :: forall a. Eq a =&gt; SC a -&gt; SC a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920559"><span id="local-6989586621680920561"><span id="local-6989586621680920563"><span class="annot"><span class="annottext">Int -&gt; SC a -&gt; ShowS
[SC a] -&gt; ShowS
SC a -&gt; String
(Int -&gt; SC a -&gt; ShowS)
-&gt; (SC a -&gt; String) -&gt; ([SC a] -&gt; ShowS) -&gt; Show (SC a)
forall a. Show a =&gt; Int -&gt; SC a -&gt; ShowS
forall a. Show a =&gt; [SC a] -&gt; ShowS
forall a. Show a =&gt; SC a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SC a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [SC a] -&gt; ShowS
show :: SC a -&gt; String
$cshow :: forall a. Show a =&gt; SC a -&gt; String
showsPrec :: Int -&gt; SC a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; SC a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920550"><span id="local-6989586621680920552"><span id="local-6989586621680920554"><span id="local-6989586621680920556"><span class="annot"><span class="annottext">[SC a] -&gt; Encoding
[SC a] -&gt; Value
SC a -&gt; Encoding
SC a -&gt; Value
(SC a -&gt; Value)
-&gt; (SC a -&gt; Encoding)
-&gt; ([SC a] -&gt; Value)
-&gt; ([SC a] -&gt; Encoding)
-&gt; ToJSON (SC a)
forall a. ToJSON a =&gt; [SC a] -&gt; Encoding
forall a. ToJSON a =&gt; [SC a] -&gt; Value
forall a. ToJSON a =&gt; SC a -&gt; Encoding
forall a. ToJSON a =&gt; SC a -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [SC a] -&gt; Encoding
$ctoEncodingList :: forall a. ToJSON a =&gt; [SC a] -&gt; Encoding
toJSONList :: [SC a] -&gt; Value
$ctoJSONList :: forall a. ToJSON a =&gt; [SC a] -&gt; Value
toEncoding :: SC a -&gt; Encoding
$ctoEncoding :: forall a. ToJSON a =&gt; SC a -&gt; Encoding
toJSON :: SC a -&gt; Value
$ctoJSON :: forall a. ToJSON a =&gt; SC a -&gt; Value
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920545"><span id="local-6989586621680920547"><span class="annot"><span class="annottext">Value -&gt; Parser [SC a]
Value -&gt; Parser (SC a)
(Value -&gt; Parser (SC a))
-&gt; (Value -&gt; Parser [SC a]) -&gt; FromJSON (SC a)
forall a. FromJSON a =&gt; Value -&gt; Parser [SC a]
forall a. FromJSON a =&gt; Value -&gt; Parser (SC a)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [SC a]
$cparseJSONList :: forall a. FromJSON a =&gt; Value -&gt; Parser [SC a]
parseJSON :: Value -&gt; Parser (SC a)
$cparseJSON :: forall a. FromJSON a =&gt; Value -&gt; Parser (SC a)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680920542"><span class="annot"><span class="annottext">(a -&gt; b) -&gt; SC a -&gt; SC b
(forall a b. (a -&gt; b) -&gt; SC a -&gt; SC b) -&gt; Functor SC
forall a b. (a -&gt; b) -&gt; SC a -&gt; SC b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b) -&gt; Functor f
fmap :: (a -&gt; b) -&gt; SC a -&gt; SC b
$cfmap :: forall a b. (a -&gt; b) -&gt; SC a -&gt; SC b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">Functor</span></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span class="hs-comment">-- | An amount of reservecoins</span><span>
</span><span id="line-123"></span><span id="local-6989586621680920539"><span id="local-6989586621680920540"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="RC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-var">RC</span></a></span></span><span> </span><span id="local-6989586621680920867"><span class="annot"><a href="#local-6989586621680920867"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="RC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-var">RC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unRC"><span class="annot"><span class="annottext">RC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unRC"><span class="hs-identifier hs-var hs-var">unRC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680920867"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920523"><span id="local-6989586621680920525"><span id="local-6989586621680920527"><span id="local-6989586621680920529"><span id="local-6989586621680920531"><span id="local-6989586621680920533"><span id="local-6989586621680920535"><span class="annot"><span class="annottext">Integer -&gt; RC a
RC a -&gt; RC a
RC a -&gt; RC a -&gt; RC a
(RC a -&gt; RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a)
-&gt; (Integer -&gt; RC a)
-&gt; Num (RC a)
forall a. Num a =&gt; Integer -&gt; RC a
forall a. Num a =&gt; RC a -&gt; RC a
forall a. Num a =&gt; RC a -&gt; RC a -&gt; RC a
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; RC a
$cfromInteger :: forall a. Num a =&gt; Integer -&gt; RC a
signum :: RC a -&gt; RC a
$csignum :: forall a. Num a =&gt; RC a -&gt; RC a
abs :: RC a -&gt; RC a
$cabs :: forall a. Num a =&gt; RC a -&gt; RC a
negate :: RC a -&gt; RC a
$cnegate :: forall a. Num a =&gt; RC a -&gt; RC a
* :: RC a -&gt; RC a -&gt; RC a
$c* :: forall a. Num a =&gt; RC a -&gt; RC a -&gt; RC a
- :: RC a -&gt; RC a -&gt; RC a
$c- :: forall a. Num a =&gt; RC a -&gt; RC a -&gt; RC a
+ :: RC a -&gt; RC a -&gt; RC a
$c+ :: forall a. Num a =&gt; RC a -&gt; RC a -&gt; RC a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Num</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920521"><span class="annot"><span class="annottext">RC a -&gt; RC a -&gt; Bool
(RC a -&gt; RC a -&gt; Bool) -&gt; Eq (RC a)
forall a. Eq a =&gt; RC a -&gt; RC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; Eq a
== :: RC a -&gt; RC a -&gt; Bool
$c== :: forall a. Eq a =&gt; RC a -&gt; RC a -&gt; Bool
</span><a href="#local-6989586621680920521"><span class="hs-identifier hs-var hs-var hs-var hs-var">Eq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920506"><span id="local-6989586621680920508"><span id="local-6989586621680920510"><span id="local-6989586621680920512"><span id="local-6989586621680920514"><span id="local-6989586621680920516"><span id="local-6989586621680920518"><span class="annot"><span class="annottext">Eq (RC a)
Eq (RC a)
-&gt; (RC a -&gt; RC a -&gt; Ordering)
-&gt; (RC a -&gt; RC a -&gt; Bool)
-&gt; (RC a -&gt; RC a -&gt; Bool)
-&gt; (RC a -&gt; RC a -&gt; Bool)
-&gt; (RC a -&gt; RC a -&gt; Bool)
-&gt; (RC a -&gt; RC a -&gt; RC a)
-&gt; (RC a -&gt; RC a -&gt; RC a)
-&gt; Ord (RC a)
RC a -&gt; RC a -&gt; Bool
RC a -&gt; RC a -&gt; Ordering
RC a -&gt; RC a -&gt; RC a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (RC a)
forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Bool
forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Ordering
forall a. Ord a =&gt; RC a -&gt; RC a -&gt; RC a
min :: RC a -&gt; RC a -&gt; RC a
$cmin :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; RC a
max :: RC a -&gt; RC a -&gt; RC a
$cmax :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; RC a
&gt;= :: RC a -&gt; RC a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Bool
&gt; :: RC a -&gt; RC a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Bool
&lt;= :: RC a -&gt; RC a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Bool
&lt; :: RC a -&gt; RC a -&gt; Bool
$c&lt; :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Bool
compare :: RC a -&gt; RC a -&gt; Ordering
$ccompare :: forall a. Ord a =&gt; RC a -&gt; RC a -&gt; Ordering
$cp1Ord :: forall a. Ord a =&gt; Eq (RC a)
</span><a href="#local-6989586621680920506"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920503"><span class="annot"><span class="annottext">AdditiveMonoid (RC a)
AdditiveMonoid (RC a)
-&gt; (RC a -&gt; RC a -&gt; RC a) -&gt; AdditiveGroup (RC a)
RC a -&gt; RC a -&gt; RC a
forall a. AdditiveGroup a =&gt; AdditiveMonoid (RC a)
forall a. AdditiveGroup a =&gt; RC a -&gt; RC a -&gt; RC a
forall a. AdditiveMonoid a -&gt; (a -&gt; a -&gt; a) -&gt; AdditiveGroup a
- :: RC a -&gt; RC a -&gt; RC a
$c- :: forall a. AdditiveGroup a =&gt; RC a -&gt; RC a -&gt; RC a
$cp1AdditiveGroup :: forall a. AdditiveGroup a =&gt; AdditiveMonoid (RC a)
</span><a href="#local-6989586621680920503"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveGroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920500"><span class="annot"><span class="annottext">AdditiveSemigroup (RC a)
RC a
AdditiveSemigroup (RC a) -&gt; RC a -&gt; AdditiveMonoid (RC a)
forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (RC a)
forall a. AdditiveMonoid a =&gt; RC a
forall a. AdditiveSemigroup a -&gt; a -&gt; AdditiveMonoid a
zero :: RC a
$czero :: forall a. AdditiveMonoid a =&gt; RC a
$cp1AdditiveMonoid :: forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (RC a)
</span><a href="#local-6989586621680920500"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveMonoid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920498"><span class="annot"><span class="annottext">RC a -&gt; RC a -&gt; RC a
(RC a -&gt; RC a -&gt; RC a) -&gt; AdditiveSemigroup (RC a)
forall a. AdditiveSemigroup a =&gt; RC a -&gt; RC a -&gt; RC a
forall a. (a -&gt; a -&gt; a) -&gt; AdditiveSemigroup a
+ :: RC a -&gt; RC a -&gt; RC a
$c+ :: forall a. AdditiveSemigroup a =&gt; RC a -&gt; RC a -&gt; RC a
</span><a href="#local-6989586621680920498"><span class="hs-identifier hs-var hs-var hs-var hs-var">AdditiveSemigroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920496"><span class="annot"><span class="annottext">RC a -&gt; RC a -&gt; RC a
(RC a -&gt; RC a -&gt; RC a) -&gt; MultiplicativeSemigroup (RC a)
forall a. MultiplicativeSemigroup a =&gt; RC a -&gt; RC a -&gt; RC a
forall a. (a -&gt; a -&gt; a) -&gt; MultiplicativeSemigroup a
* :: RC a -&gt; RC a -&gt; RC a
$c* :: forall a. MultiplicativeSemigroup a =&gt; RC a -&gt; RC a -&gt; RC a
</span><a href="#local-6989586621680920496"><span class="hs-identifier hs-var hs-var hs-var hs-var">MultiplicativeSemigroup</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. RC a -&gt; Rep (RC a) x)
-&gt; (forall x. Rep (RC a) x -&gt; RC a) -&gt; Generic (RC a)
forall x. Rep (RC a) x -&gt; RC a
forall x. RC a -&gt; Rep (RC a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (RC a) x -&gt; RC a
forall a x. RC a -&gt; Rep (RC a) x
$cto :: forall a x. Rep (RC a) x -&gt; RC a
$cfrom :: forall a x. RC a -&gt; Rep (RC a) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920490"><span id="local-6989586621680920492"><span class="annot"><span class="annottext">RC a -&gt; RC a -&gt; Bool
(RC a -&gt; RC a -&gt; Bool) -&gt; (RC a -&gt; RC a -&gt; Bool) -&gt; Eq (RC a)
forall a. Eq a =&gt; RC a -&gt; RC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: RC a -&gt; RC a -&gt; Bool
$c/= :: forall a. Eq a =&gt; RC a -&gt; RC a -&gt; Bool
== :: RC a -&gt; RC a -&gt; Bool
$c== :: forall a. Eq a =&gt; RC a -&gt; RC a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920484"><span id="local-6989586621680920486"><span id="local-6989586621680920488"><span class="annot"><span class="annottext">Int -&gt; RC a -&gt; ShowS
[RC a] -&gt; ShowS
RC a -&gt; String
(Int -&gt; RC a -&gt; ShowS)
-&gt; (RC a -&gt; String) -&gt; ([RC a] -&gt; ShowS) -&gt; Show (RC a)
forall a. Show a =&gt; Int -&gt; RC a -&gt; ShowS
forall a. Show a =&gt; [RC a] -&gt; ShowS
forall a. Show a =&gt; RC a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [RC a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [RC a] -&gt; ShowS
show :: RC a -&gt; String
$cshow :: forall a. Show a =&gt; RC a -&gt; String
showsPrec :: Int -&gt; RC a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; RC a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920476"><span id="local-6989586621680920478"><span id="local-6989586621680920480"><span id="local-6989586621680920482"><span class="annot"><span class="annottext">[RC a] -&gt; Encoding
[RC a] -&gt; Value
RC a -&gt; Encoding
RC a -&gt; Value
(RC a -&gt; Value)
-&gt; (RC a -&gt; Encoding)
-&gt; ([RC a] -&gt; Value)
-&gt; ([RC a] -&gt; Encoding)
-&gt; ToJSON (RC a)
forall a. ToJSON a =&gt; [RC a] -&gt; Encoding
forall a. ToJSON a =&gt; [RC a] -&gt; Value
forall a. ToJSON a =&gt; RC a -&gt; Encoding
forall a. ToJSON a =&gt; RC a -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [RC a] -&gt; Encoding
$ctoEncodingList :: forall a. ToJSON a =&gt; [RC a] -&gt; Encoding
toJSONList :: [RC a] -&gt; Value
$ctoJSONList :: forall a. ToJSON a =&gt; [RC a] -&gt; Value
toEncoding :: RC a -&gt; Encoding
$ctoEncoding :: forall a. ToJSON a =&gt; RC a -&gt; Encoding
toJSON :: RC a -&gt; Value
$ctoJSON :: forall a. ToJSON a =&gt; RC a -&gt; Value
</span><a href="#local-6989586621680920476"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920472"><span id="local-6989586621680920474"><span class="annot"><span class="annottext">Value -&gt; Parser [RC a]
Value -&gt; Parser (RC a)
(Value -&gt; Parser (RC a))
-&gt; (Value -&gt; Parser [RC a]) -&gt; FromJSON (RC a)
forall a. FromJSON a =&gt; Value -&gt; Parser [RC a]
forall a. FromJSON a =&gt; Value -&gt; Parser (RC a)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [RC a]
$cparseJSONList :: forall a. FromJSON a =&gt; Value -&gt; Parser [RC a]
parseJSON :: Value -&gt; Parser (RC a)
$cparseJSON :: forall a. FromJSON a =&gt; Value -&gt; Parser (RC a)
</span><a href="#local-6989586621680920472"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680920470"><span class="annot"><span class="annottext">(a -&gt; b) -&gt; RC a -&gt; RC b
(forall a b. (a -&gt; b) -&gt; RC a -&gt; RC b) -&gt; Functor RC
forall a b. (a -&gt; b) -&gt; RC a -&gt; RC b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b) -&gt; Functor f
fmap :: (a -&gt; b) -&gt; RC a -&gt; RC b
$cfmap :: forall a b. (a -&gt; b) -&gt; RC a -&gt; RC b
</span><a href="#local-6989586621680920470"><span class="hs-identifier hs-var hs-var hs-var hs-var">Functor</span></a></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span>
</span><span id="line-128"></span><span>
</span><span id="line-129"></span><span class="hs-comment">-- | An amount of base currency coins (eg. Ada or some native currency)</span><span>
</span><span id="line-130"></span><span id="local-6989586621680920468"><span id="local-6989586621680920469"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="BC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span></span><span> </span><span id="local-6989586621680920915"><span class="annot"><a href="#local-6989586621680920915"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="BC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unBC"><span class="annot"><span class="annottext">BC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unBC"><span class="hs-identifier hs-var hs-var">unBC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680920915"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920452"><span id="local-6989586621680920454"><span id="local-6989586621680920456"><span id="local-6989586621680920458"><span id="local-6989586621680920460"><span id="local-6989586621680920462"><span id="local-6989586621680920464"><span class="annot"><span class="annottext">Integer -&gt; BC a
BC a -&gt; BC a
BC a -&gt; BC a -&gt; BC a
(BC a -&gt; BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a)
-&gt; (Integer -&gt; BC a)
-&gt; Num (BC a)
forall a. Num a =&gt; Integer -&gt; BC a
forall a. Num a =&gt; BC a -&gt; BC a
forall a. Num a =&gt; BC a -&gt; BC a -&gt; BC a
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; BC a
$cfromInteger :: forall a. Num a =&gt; Integer -&gt; BC a
signum :: BC a -&gt; BC a
$csignum :: forall a. Num a =&gt; BC a -&gt; BC a
abs :: BC a -&gt; BC a
$cabs :: forall a. Num a =&gt; BC a -&gt; BC a
negate :: BC a -&gt; BC a
$cnegate :: forall a. Num a =&gt; BC a -&gt; BC a
* :: BC a -&gt; BC a -&gt; BC a
$c* :: forall a. Num a =&gt; BC a -&gt; BC a -&gt; BC a
- :: BC a -&gt; BC a -&gt; BC a
$c- :: forall a. Num a =&gt; BC a -&gt; BC a -&gt; BC a
+ :: BC a -&gt; BC a -&gt; BC a
$c+ :: forall a. Num a =&gt; BC a -&gt; BC a -&gt; BC a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Num</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920450"><span class="annot"><span class="annottext">BC a -&gt; BC a -&gt; Bool
(BC a -&gt; BC a -&gt; Bool) -&gt; Eq (BC a)
forall a. Eq a =&gt; BC a -&gt; BC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; Eq a
== :: BC a -&gt; BC a -&gt; Bool
$c== :: forall a. Eq a =&gt; BC a -&gt; BC a -&gt; Bool
</span><a href="#local-6989586621680920450"><span class="hs-identifier hs-var hs-var hs-var hs-var">Eq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920435"><span id="local-6989586621680920437"><span id="local-6989586621680920439"><span id="local-6989586621680920441"><span id="local-6989586621680920443"><span id="local-6989586621680920445"><span id="local-6989586621680920447"><span class="annot"><span class="annottext">Eq (BC a)
Eq (BC a)
-&gt; (BC a -&gt; BC a -&gt; Ordering)
-&gt; (BC a -&gt; BC a -&gt; Bool)
-&gt; (BC a -&gt; BC a -&gt; Bool)
-&gt; (BC a -&gt; BC a -&gt; Bool)
-&gt; (BC a -&gt; BC a -&gt; Bool)
-&gt; (BC a -&gt; BC a -&gt; BC a)
-&gt; (BC a -&gt; BC a -&gt; BC a)
-&gt; Ord (BC a)
BC a -&gt; BC a -&gt; Bool
BC a -&gt; BC a -&gt; Ordering
BC a -&gt; BC a -&gt; BC a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (BC a)
forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Bool
forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Ordering
forall a. Ord a =&gt; BC a -&gt; BC a -&gt; BC a
min :: BC a -&gt; BC a -&gt; BC a
$cmin :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; BC a
max :: BC a -&gt; BC a -&gt; BC a
$cmax :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; BC a
&gt;= :: BC a -&gt; BC a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Bool
&gt; :: BC a -&gt; BC a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Bool
&lt;= :: BC a -&gt; BC a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Bool
&lt; :: BC a -&gt; BC a -&gt; Bool
$c&lt; :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Bool
compare :: BC a -&gt; BC a -&gt; Ordering
$ccompare :: forall a. Ord a =&gt; BC a -&gt; BC a -&gt; Ordering
$cp1Ord :: forall a. Ord a =&gt; Eq (BC a)
</span><a href="#local-6989586621680920435"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920432"><span class="annot"><span class="annottext">AdditiveMonoid (BC a)
AdditiveMonoid (BC a)
-&gt; (BC a -&gt; BC a -&gt; BC a) -&gt; AdditiveGroup (BC a)
BC a -&gt; BC a -&gt; BC a
forall a. AdditiveGroup a =&gt; AdditiveMonoid (BC a)
forall a. AdditiveGroup a =&gt; BC a -&gt; BC a -&gt; BC a
forall a. AdditiveMonoid a -&gt; (a -&gt; a -&gt; a) -&gt; AdditiveGroup a
- :: BC a -&gt; BC a -&gt; BC a
$c- :: forall a. AdditiveGroup a =&gt; BC a -&gt; BC a -&gt; BC a
$cp1AdditiveGroup :: forall a. AdditiveGroup a =&gt; AdditiveMonoid (BC a)
</span><a href="#local-6989586621680920432"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveGroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920429"><span class="annot"><span class="annottext">AdditiveSemigroup (BC a)
BC a
AdditiveSemigroup (BC a) -&gt; BC a -&gt; AdditiveMonoid (BC a)
forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (BC a)
forall a. AdditiveMonoid a =&gt; BC a
forall a. AdditiveSemigroup a -&gt; a -&gt; AdditiveMonoid a
zero :: BC a
$czero :: forall a. AdditiveMonoid a =&gt; BC a
$cp1AdditiveMonoid :: forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (BC a)
</span><a href="#local-6989586621680920429"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveMonoid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920427"><span class="annot"><span class="annottext">BC a -&gt; BC a -&gt; BC a
(BC a -&gt; BC a -&gt; BC a) -&gt; AdditiveSemigroup (BC a)
forall a. AdditiveSemigroup a =&gt; BC a -&gt; BC a -&gt; BC a
forall a. (a -&gt; a -&gt; a) -&gt; AdditiveSemigroup a
+ :: BC a -&gt; BC a -&gt; BC a
$c+ :: forall a. AdditiveSemigroup a =&gt; BC a -&gt; BC a -&gt; BC a
</span><a href="#local-6989586621680920427"><span class="hs-identifier hs-var hs-var hs-var hs-var">AdditiveSemigroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920425"><span class="annot"><span class="annottext">BC a -&gt; BC a -&gt; BC a
(BC a -&gt; BC a -&gt; BC a) -&gt; MultiplicativeSemigroup (BC a)
forall a. MultiplicativeSemigroup a =&gt; BC a -&gt; BC a -&gt; BC a
forall a. (a -&gt; a -&gt; a) -&gt; MultiplicativeSemigroup a
* :: BC a -&gt; BC a -&gt; BC a
$c* :: forall a. MultiplicativeSemigroup a =&gt; BC a -&gt; BC a -&gt; BC a
</span><a href="#local-6989586621680920425"><span class="hs-identifier hs-var hs-var hs-var hs-var">MultiplicativeSemigroup</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. BC a -&gt; Rep (BC a) x)
-&gt; (forall x. Rep (BC a) x -&gt; BC a) -&gt; Generic (BC a)
forall x. Rep (BC a) x -&gt; BC a
forall x. BC a -&gt; Rep (BC a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (BC a) x -&gt; BC a
forall a x. BC a -&gt; Rep (BC a) x
$cto :: forall a x. Rep (BC a) x -&gt; BC a
$cfrom :: forall a x. BC a -&gt; Rep (BC a) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920419"><span id="local-6989586621680920421"><span class="annot"><span class="annottext">BC a -&gt; BC a -&gt; Bool
(BC a -&gt; BC a -&gt; Bool) -&gt; (BC a -&gt; BC a -&gt; Bool) -&gt; Eq (BC a)
forall a. Eq a =&gt; BC a -&gt; BC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: BC a -&gt; BC a -&gt; Bool
$c/= :: forall a. Eq a =&gt; BC a -&gt; BC a -&gt; Bool
== :: BC a -&gt; BC a -&gt; Bool
$c== :: forall a. Eq a =&gt; BC a -&gt; BC a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920413"><span id="local-6989586621680920415"><span id="local-6989586621680920417"><span class="annot"><span class="annottext">Int -&gt; BC a -&gt; ShowS
[BC a] -&gt; ShowS
BC a -&gt; String
(Int -&gt; BC a -&gt; ShowS)
-&gt; (BC a -&gt; String) -&gt; ([BC a] -&gt; ShowS) -&gt; Show (BC a)
forall a. Show a =&gt; Int -&gt; BC a -&gt; ShowS
forall a. Show a =&gt; [BC a] -&gt; ShowS
forall a. Show a =&gt; BC a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [BC a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [BC a] -&gt; ShowS
show :: BC a -&gt; String
$cshow :: forall a. Show a =&gt; BC a -&gt; String
showsPrec :: Int -&gt; BC a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; BC a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920405"><span id="local-6989586621680920407"><span id="local-6989586621680920409"><span id="local-6989586621680920411"><span class="annot"><span class="annottext">[BC a] -&gt; Encoding
[BC a] -&gt; Value
BC a -&gt; Encoding
BC a -&gt; Value
(BC a -&gt; Value)
-&gt; (BC a -&gt; Encoding)
-&gt; ([BC a] -&gt; Value)
-&gt; ([BC a] -&gt; Encoding)
-&gt; ToJSON (BC a)
forall a. ToJSON a =&gt; [BC a] -&gt; Encoding
forall a. ToJSON a =&gt; [BC a] -&gt; Value
forall a. ToJSON a =&gt; BC a -&gt; Encoding
forall a. ToJSON a =&gt; BC a -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [BC a] -&gt; Encoding
$ctoEncodingList :: forall a. ToJSON a =&gt; [BC a] -&gt; Encoding
toJSONList :: [BC a] -&gt; Value
$ctoJSONList :: forall a. ToJSON a =&gt; [BC a] -&gt; Value
toEncoding :: BC a -&gt; Encoding
$ctoEncoding :: forall a. ToJSON a =&gt; BC a -&gt; Encoding
toJSON :: BC a -&gt; Value
$ctoJSON :: forall a. ToJSON a =&gt; BC a -&gt; Value
</span><a href="#local-6989586621680920405"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920401"><span id="local-6989586621680920403"><span class="annot"><span class="annottext">Value -&gt; Parser [BC a]
Value -&gt; Parser (BC a)
(Value -&gt; Parser (BC a))
-&gt; (Value -&gt; Parser [BC a]) -&gt; FromJSON (BC a)
forall a. FromJSON a =&gt; Value -&gt; Parser [BC a]
forall a. FromJSON a =&gt; Value -&gt; Parser (BC a)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [BC a]
$cparseJSONList :: forall a. FromJSON a =&gt; Value -&gt; Parser [BC a]
parseJSON :: Value -&gt; Parser (BC a)
$cparseJSON :: forall a. FromJSON a =&gt; Value -&gt; Parser (BC a)
</span><a href="#local-6989586621680920401"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680920399"><span class="annot"><span class="annottext">(a -&gt; b) -&gt; BC a -&gt; BC b
(forall a b. (a -&gt; b) -&gt; BC a -&gt; BC b) -&gt; Functor BC
forall a b. (a -&gt; b) -&gt; BC a -&gt; BC b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b) -&gt; Functor f
fmap :: (a -&gt; b) -&gt; BC a -&gt; BC b
$cfmap :: forall a b. (a -&gt; b) -&gt; BC a -&gt; BC b
</span><a href="#local-6989586621680920399"><span class="hs-identifier hs-var hs-var hs-var hs-var">Functor</span></a></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span class="hs-comment">-- | An amount of peg currency (eg. USD)</span><span>
</span><span id="line-137"></span><span id="local-6989586621680920397"><span id="local-6989586621680920398"></span></span><span class="hs-keyword">newtype</span><span> </span><span id="PC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span></span><span> </span><span id="local-6989586621680920912"><span class="annot"><a href="#local-6989586621680920912"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="PC"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="unPC"><span class="annot"><span class="annottext">PC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unPC"><span class="hs-identifier hs-var hs-var">unPC</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621680920912"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-138"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">newtype</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920381"><span id="local-6989586621680920383"><span id="local-6989586621680920385"><span id="local-6989586621680920387"><span id="local-6989586621680920389"><span id="local-6989586621680920391"><span id="local-6989586621680920393"><span class="annot"><span class="annottext">Integer -&gt; PC a
PC a -&gt; PC a
PC a -&gt; PC a -&gt; PC a
(PC a -&gt; PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a)
-&gt; (Integer -&gt; PC a)
-&gt; Num (PC a)
forall a. Num a =&gt; Integer -&gt; PC a
forall a. Num a =&gt; PC a -&gt; PC a
forall a. Num a =&gt; PC a -&gt; PC a -&gt; PC a
forall a.
(a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (a -&gt; a)
-&gt; (Integer -&gt; a)
-&gt; Num a
fromInteger :: Integer -&gt; PC a
$cfromInteger :: forall a. Num a =&gt; Integer -&gt; PC a
signum :: PC a -&gt; PC a
$csignum :: forall a. Num a =&gt; PC a -&gt; PC a
abs :: PC a -&gt; PC a
$cabs :: forall a. Num a =&gt; PC a -&gt; PC a
negate :: PC a -&gt; PC a
$cnegate :: forall a. Num a =&gt; PC a -&gt; PC a
* :: PC a -&gt; PC a -&gt; PC a
$c* :: forall a. Num a =&gt; PC a -&gt; PC a -&gt; PC a
- :: PC a -&gt; PC a -&gt; PC a
$c- :: forall a. Num a =&gt; PC a -&gt; PC a -&gt; PC a
+ :: PC a -&gt; PC a -&gt; PC a
$c+ :: forall a. Num a =&gt; PC a -&gt; PC a -&gt; PC a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Num</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920379"><span class="annot"><span class="annottext">PC a -&gt; PC a -&gt; Bool
(PC a -&gt; PC a -&gt; Bool) -&gt; Eq (PC a)
forall a. Eq a =&gt; PC a -&gt; PC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; Eq a
== :: PC a -&gt; PC a -&gt; Bool
$c== :: forall a. Eq a =&gt; PC a -&gt; PC a -&gt; Bool
</span><a href="#local-6989586621680920379"><span class="hs-identifier hs-var hs-var hs-var hs-var">Eq</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920364"><span id="local-6989586621680920366"><span id="local-6989586621680920368"><span id="local-6989586621680920370"><span id="local-6989586621680920372"><span id="local-6989586621680920374"><span id="local-6989586621680920376"><span class="annot"><span class="annottext">Eq (PC a)
Eq (PC a)
-&gt; (PC a -&gt; PC a -&gt; Ordering)
-&gt; (PC a -&gt; PC a -&gt; Bool)
-&gt; (PC a -&gt; PC a -&gt; Bool)
-&gt; (PC a -&gt; PC a -&gt; Bool)
-&gt; (PC a -&gt; PC a -&gt; Bool)
-&gt; (PC a -&gt; PC a -&gt; PC a)
-&gt; (PC a -&gt; PC a -&gt; PC a)
-&gt; Ord (PC a)
PC a -&gt; PC a -&gt; Bool
PC a -&gt; PC a -&gt; Ordering
PC a -&gt; PC a -&gt; PC a
forall a.
Eq a
-&gt; (a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
forall a. Ord a =&gt; Eq (PC a)
forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Bool
forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Ordering
forall a. Ord a =&gt; PC a -&gt; PC a -&gt; PC a
min :: PC a -&gt; PC a -&gt; PC a
$cmin :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; PC a
max :: PC a -&gt; PC a -&gt; PC a
$cmax :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; PC a
&gt;= :: PC a -&gt; PC a -&gt; Bool
$c&gt;= :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Bool
&gt; :: PC a -&gt; PC a -&gt; Bool
$c&gt; :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Bool
&lt;= :: PC a -&gt; PC a -&gt; Bool
$c&lt;= :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Bool
&lt; :: PC a -&gt; PC a -&gt; Bool
$c&lt; :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Bool
compare :: PC a -&gt; PC a -&gt; Ordering
$ccompare :: forall a. Ord a =&gt; PC a -&gt; PC a -&gt; Ordering
$cp1Ord :: forall a. Ord a =&gt; Eq (PC a)
</span><a href="#local-6989586621680920364"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></a></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920361"><span class="annot"><span class="annottext">AdditiveMonoid (PC a)
AdditiveMonoid (PC a)
-&gt; (PC a -&gt; PC a -&gt; PC a) -&gt; AdditiveGroup (PC a)
PC a -&gt; PC a -&gt; PC a
forall a. AdditiveGroup a =&gt; AdditiveMonoid (PC a)
forall a. AdditiveGroup a =&gt; PC a -&gt; PC a -&gt; PC a
forall a. AdditiveMonoid a -&gt; (a -&gt; a -&gt; a) -&gt; AdditiveGroup a
- :: PC a -&gt; PC a -&gt; PC a
$c- :: forall a. AdditiveGroup a =&gt; PC a -&gt; PC a -&gt; PC a
$cp1AdditiveGroup :: forall a. AdditiveGroup a =&gt; AdditiveMonoid (PC a)
</span><a href="#local-6989586621680920361"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveGroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920358"><span class="annot"><span class="annottext">AdditiveSemigroup (PC a)
PC a
AdditiveSemigroup (PC a) -&gt; PC a -&gt; AdditiveMonoid (PC a)
forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (PC a)
forall a. AdditiveMonoid a =&gt; PC a
forall a. AdditiveSemigroup a -&gt; a -&gt; AdditiveMonoid a
zero :: PC a
$czero :: forall a. AdditiveMonoid a =&gt; PC a
$cp1AdditiveMonoid :: forall a. AdditiveMonoid a =&gt; AdditiveSemigroup (PC a)
</span><a href="#local-6989586621680920358"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var">AdditiveMonoid</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920356"><span class="annot"><span class="annottext">PC a -&gt; PC a -&gt; PC a
(PC a -&gt; PC a -&gt; PC a) -&gt; AdditiveSemigroup (PC a)
forall a. AdditiveSemigroup a =&gt; PC a -&gt; PC a -&gt; PC a
forall a. (a -&gt; a -&gt; a) -&gt; AdditiveSemigroup a
+ :: PC a -&gt; PC a -&gt; PC a
$c+ :: forall a. AdditiveSemigroup a =&gt; PC a -&gt; PC a -&gt; PC a
</span><a href="#local-6989586621680920356"><span class="hs-identifier hs-var hs-var hs-var hs-var">AdditiveSemigroup</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920354"><span class="annot"><span class="annottext">PC a -&gt; PC a -&gt; PC a
(PC a -&gt; PC a -&gt; PC a) -&gt; MultiplicativeSemigroup (PC a)
forall a. MultiplicativeSemigroup a =&gt; PC a -&gt; PC a -&gt; PC a
forall a. (a -&gt; a -&gt; a) -&gt; MultiplicativeSemigroup a
* :: PC a -&gt; PC a -&gt; PC a
$c* :: forall a. MultiplicativeSemigroup a =&gt; PC a -&gt; PC a -&gt; PC a
</span><a href="#local-6989586621680920354"><span class="hs-identifier hs-var hs-var hs-var hs-var">MultiplicativeSemigroup</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. PC a -&gt; Rep (PC a) x)
-&gt; (forall x. Rep (PC a) x -&gt; PC a) -&gt; Generic (PC a)
forall x. Rep (PC a) x -&gt; PC a
forall x. PC a -&gt; Rep (PC a) x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
forall a x. Rep (PC a) x -&gt; PC a
forall a x. PC a -&gt; Rep (PC a) x
$cto :: forall a x. Rep (PC a) x -&gt; PC a
$cfrom :: forall a x. PC a -&gt; Rep (PC a) x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920348"><span id="local-6989586621680920350"><span class="annot"><span class="annottext">PC a -&gt; PC a -&gt; Bool
(PC a -&gt; PC a -&gt; Bool) -&gt; (PC a -&gt; PC a -&gt; Bool) -&gt; Eq (PC a)
forall a. Eq a =&gt; PC a -&gt; PC a -&gt; Bool
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: PC a -&gt; PC a -&gt; Bool
$c/= :: forall a. Eq a =&gt; PC a -&gt; PC a -&gt; Bool
== :: PC a -&gt; PC a -&gt; Bool
$c== :: forall a. Eq a =&gt; PC a -&gt; PC a -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920342"><span id="local-6989586621680920344"><span id="local-6989586621680920346"><span class="annot"><span class="annottext">Int -&gt; PC a -&gt; ShowS
[PC a] -&gt; ShowS
PC a -&gt; String
(Int -&gt; PC a -&gt; ShowS)
-&gt; (PC a -&gt; String) -&gt; ([PC a] -&gt; ShowS) -&gt; Show (PC a)
forall a. Show a =&gt; Int -&gt; PC a -&gt; ShowS
forall a. Show a =&gt; [PC a] -&gt; ShowS
forall a. Show a =&gt; PC a -&gt; String
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [PC a] -&gt; ShowS
$cshowList :: forall a. Show a =&gt; [PC a] -&gt; ShowS
show :: PC a -&gt; String
$cshow :: forall a. Show a =&gt; PC a -&gt; String
showsPrec :: Int -&gt; PC a -&gt; ShowS
$cshowsPrec :: forall a. Show a =&gt; Int -&gt; PC a -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-140"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920334"><span id="local-6989586621680920336"><span id="local-6989586621680920338"><span id="local-6989586621680920340"><span class="annot"><span class="annottext">[PC a] -&gt; Encoding
[PC a] -&gt; Value
PC a -&gt; Encoding
PC a -&gt; Value
(PC a -&gt; Value)
-&gt; (PC a -&gt; Encoding)
-&gt; ([PC a] -&gt; Value)
-&gt; ([PC a] -&gt; Encoding)
-&gt; ToJSON (PC a)
forall a. ToJSON a =&gt; [PC a] -&gt; Encoding
forall a. ToJSON a =&gt; [PC a] -&gt; Value
forall a. ToJSON a =&gt; PC a -&gt; Encoding
forall a. ToJSON a =&gt; PC a -&gt; Value
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [PC a] -&gt; Encoding
$ctoEncodingList :: forall a. ToJSON a =&gt; [PC a] -&gt; Encoding
toJSONList :: [PC a] -&gt; Value
$ctoJSONList :: forall a. ToJSON a =&gt; [PC a] -&gt; Value
toEncoding :: PC a -&gt; Encoding
$ctoEncoding :: forall a. ToJSON a =&gt; PC a -&gt; Encoding
toJSON :: PC a -&gt; Value
$ctoJSON :: forall a. ToJSON a =&gt; PC a -&gt; Value
</span><a href="#local-6989586621680920334"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920330"><span id="local-6989586621680920332"><span class="annot"><span class="annottext">Value -&gt; Parser [PC a]
Value -&gt; Parser (PC a)
(Value -&gt; Parser (PC a))
-&gt; (Value -&gt; Parser [PC a]) -&gt; FromJSON (PC a)
forall a. FromJSON a =&gt; Value -&gt; Parser [PC a]
forall a. FromJSON a =&gt; Value -&gt; Parser (PC a)
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [PC a]
$cparseJSONList :: forall a. FromJSON a =&gt; Value -&gt; Parser [PC a]
parseJSON :: Value -&gt; Parser (PC a)
$cparseJSON :: forall a. FromJSON a =&gt; Value -&gt; Parser (PC a)
</span><a href="#local-6989586621680920330"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span id="local-6989586621680920328"><span class="annot"><span class="annottext">(a -&gt; b) -&gt; PC a -&gt; PC b
(forall a b. (a -&gt; b) -&gt; PC a -&gt; PC b) -&gt; Functor PC
forall a b. (a -&gt; b) -&gt; PC a -&gt; PC b
forall (f :: * -&gt; *).
(forall a b. (a -&gt; b) -&gt; f a -&gt; f b) -&gt; Functor f
fmap :: (a -&gt; b) -&gt; PC a -&gt; PC b
$cfmap :: forall a b. (a -&gt; b) -&gt; PC a -&gt; PC b
</span><a href="#local-6989586621680920328"><span class="hs-identifier hs-var hs-var hs-var hs-var">Functor</span></a></span></span><span> </span><span class="hs-keyword">via</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Identity</span></a></span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span class="hs-comment">-- | The bank's state</span><span>
</span><span id="line-144"></span><span id="local-6989586621680920326"><span id="local-6989586621680920327"></span></span><span class="hs-keyword">data</span><span> </span><span id="BankState"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-var">BankState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-145"></span><span>    </span><span id="BankState"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-var">BankState</span></a></span></span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="bsReserves"><span class="annot"><span class="annottext">BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var hs-var">bsReserves</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-comment">-- ^ Value of the bank's reserves in base currency</span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="bsStablecoins"><span class="annot"><span class="annottext">BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var hs-var">bsStablecoins</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-comment">-- ^ Amount of stablecoins in circulation</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="bsReservecoins"><span class="annot"><span class="annottext">BankState -&gt; RC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReservecoins"><span class="hs-identifier hs-var hs-var">bsReservecoins</span></a></span></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-type">RC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-comment">-- ^ Amount of reservecoins currently in circulation</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="bsMintingPolicyScript"><span class="annot"><span class="annottext">BankState -&gt; MintingPolicyHash
</span><a href="Plutus.Contracts.Stablecoin.html#bsMintingPolicyScript"><span class="hs-identifier hs-var hs-var">bsMintingPolicyScript</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">MintingPolicyHash</span></span><span> </span><span class="hs-comment">-- ^ Hash of the minting policy that forwards all checks to the state machine. (This has to be in this type, rather than in 'Stablecoin', to avoid a circular dependency on the script's hash)</span><span>
</span><span id="line-150"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-151"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. BankState -&gt; Rep BankState x)
-&gt; (forall x. Rep BankState x -&gt; BankState) -&gt; Generic BankState
forall x. Rep BankState x -&gt; BankState
forall x. BankState -&gt; Rep BankState x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep BankState x -&gt; BankState
$cfrom :: forall x. BankState -&gt; Rep BankState x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920315"><span id="local-6989586621680920317"><span class="annot"><span class="annottext">BankState -&gt; BankState -&gt; Bool
(BankState -&gt; BankState -&gt; Bool)
-&gt; (BankState -&gt; BankState -&gt; Bool) -&gt; Eq BankState
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: BankState -&gt; BankState -&gt; Bool
$c/= :: BankState -&gt; BankState -&gt; Bool
== :: BankState -&gt; BankState -&gt; Bool
$c== :: BankState -&gt; BankState -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920309"><span id="local-6989586621680920311"><span id="local-6989586621680920313"><span class="annot"><span class="annottext">Int -&gt; BankState -&gt; ShowS
[BankState] -&gt; ShowS
BankState -&gt; String
(Int -&gt; BankState -&gt; ShowS)
-&gt; (BankState -&gt; String)
-&gt; ([BankState] -&gt; ShowS)
-&gt; Show BankState
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [BankState] -&gt; ShowS
$cshowList :: [BankState] -&gt; ShowS
show :: BankState -&gt; String
$cshow :: BankState -&gt; String
showsPrec :: Int -&gt; BankState -&gt; ShowS
$cshowsPrec :: Int -&gt; BankState -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920301"><span id="local-6989586621680920303"><span id="local-6989586621680920305"><span id="local-6989586621680920307"><span class="annot"><span class="annottext">[BankState] -&gt; Encoding
[BankState] -&gt; Value
BankState -&gt; Encoding
BankState -&gt; Value
(BankState -&gt; Value)
-&gt; (BankState -&gt; Encoding)
-&gt; ([BankState] -&gt; Value)
-&gt; ([BankState] -&gt; Encoding)
-&gt; ToJSON BankState
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [BankState] -&gt; Encoding
$ctoEncodingList :: [BankState] -&gt; Encoding
toJSONList :: [BankState] -&gt; Value
$ctoJSONList :: [BankState] -&gt; Value
toEncoding :: BankState -&gt; Encoding
$ctoEncoding :: BankState -&gt; Encoding
toJSON :: BankState -&gt; Value
$ctoJSON :: BankState -&gt; Value
</span><a href="#local-6989586621680920301"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920297"><span id="local-6989586621680920299"><span class="annot"><span class="annottext">Value -&gt; Parser [BankState]
Value -&gt; Parser BankState
(Value -&gt; Parser BankState)
-&gt; (Value -&gt; Parser [BankState]) -&gt; FromJSON BankState
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [BankState]
$cparseJSONList :: Value -&gt; Parser [BankState]
parseJSON :: Value -&gt; Parser BankState
$cparseJSON :: Value -&gt; Parser BankState
</span><a href="#local-6989586621680920297"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="hs-comment">-- | Initialise the 'BankState' with zero deposits.</span><span>
</span><span id="line-155"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#initialState"><span class="hs-identifier hs-type">initialState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateMachineClient</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span>
</span><span id="line-156"></span><span id="initialState"><span class="annot"><span class="annottext">initialState :: StateMachineClient BankState Input -&gt; BankState
</span><a href="Plutus.Contracts.Stablecoin.html#initialState"><span class="hs-identifier hs-var hs-var">initialState</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateMachineClient</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">scInstance :: forall s i. StateMachineClient s i -&gt; StateMachineInstance s i
</span><span class="hs-identifier hs-var">scInstance</span></span><span class="hs-glyph">=</span><span class="annot"><span class="hs-identifier hs-type">SM.StateMachineInstance</span></span><span class="hs-special">{</span><span id="local-6989586621680920292"><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input)
typedValidator :: forall s i.
StateMachineInstance s i -&gt; TypedValidator (StateMachine s i)
typedValidator :: TypedValidator (StateMachine BankState Input)
</span><span class="hs-identifier hs-var hs-var">SM.typedValidator</span></span></span><span class="hs-special">}</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-157"></span><span>    </span><span class="annot"><span class="annottext">BankState :: BC Integer
-&gt; SC Integer -&gt; RC Integer -&gt; MintingPolicyHash -&gt; BankState
</span><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bsReserves :: BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BC Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-159"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bsStablecoins :: SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SC Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-160"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bsReservecoins :: RC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReservecoins"><span class="hs-identifier hs-var">bsReservecoins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RC Integer
</span><span class="hs-number">0</span></span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bsMintingPolicyScript :: MintingPolicyHash
</span><a href="Plutus.Contracts.Stablecoin.html#bsMintingPolicyScript"><span class="hs-identifier hs-var">bsMintingPolicyScript</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input) -&gt; MintingPolicyHash
forall a. TypedValidator a -&gt; MintingPolicyHash
</span><span class="hs-identifier hs-var">V2.forwardingMintingPolicyHash</span></span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input)
</span><a href="#local-6989586621680920292"><span class="hs-identifier hs-var">typedValidator</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-163"></span><span>
</span><span id="line-164"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-pragma hs-type">convert</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- | Convert peg currency units to base currency units using the</span><span>
</span><span id="line-166"></span><span class="hs-comment">--   observed conversion rate</span><span>
</span><span id="line-167"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-type">convert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-type">PC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-168"></span><span id="convert"><span class="annot"><span class="annottext">convert :: ConversionRate -&gt; PC ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-var hs-var">convert</span></a></span></span><span> </span><span id="local-6989586621680920288"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920288"><span class="hs-identifier hs-var">rate</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-type">PC</span></a></span><span> </span><span id="local-6989586621680920287"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920287"><span class="hs-identifier hs-var">pc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-169"></span><span>    </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920288"><span class="hs-identifier hs-var">rate</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920287"><span class="hs-identifier hs-var">pc</span></a></span><span>
</span><span id="line-170"></span><span>
</span><span id="line-171"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-pragma hs-type">liabilities</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- | The bank's liabilities (total value of stablecoins in base currency)</span><span>
</span><span id="line-173"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-identifier hs-type">liabilities</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-174"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span>
</span><span id="line-175"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span>
</span><span id="line-176"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-177"></span><span id="liabilities"><span class="annot"><span class="annottext">liabilities :: BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-identifier hs-var hs-var">liabilities</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsReserves :: BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920283"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920283"><span class="hs-identifier hs-var">reserves</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">bsStablecoins :: BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span id="local-6989586621680920282"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920282"><span class="hs-identifier hs-var">stablecoins</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920281"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920281"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920280"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920280"><span class="hs-identifier hs-var">stableCoinLiabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920281"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate
forall a. a -&gt; PC a
</span><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; PC ConversionRate)
-&gt; ConversionRate -&gt; PC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920282"><span class="hs-identifier hs-var">stablecoins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920283"><span class="hs-identifier hs-var">reserves</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920280"><span class="hs-identifier hs-var">stableCoinLiabilities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#equity"><span class="hs-pragma hs-type">equity</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-182"></span><span class="hs-comment">-- | The bank's equity (what's left of the reserves after subtracting</span><span>
</span><span id="line-183"></span><span class="hs-comment">--   liabilities).</span><span>
</span><span id="line-184"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#equity"><span class="hs-identifier hs-type">equity</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-185"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-188"></span><span id="equity"><span class="annot"><span class="annottext">equity :: BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#equity"><span class="hs-identifier hs-var hs-var">equity</span></a></span></span><span> </span><span id="local-6989586621680920276"><span class="annot"><span class="annottext">r :: BankState
</span><a href="#local-6989586621680920276"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsReserves :: BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920275"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920275"><span class="hs-identifier hs-var">reserves</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920274"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920274"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920273"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920273"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-identifier hs-var">liabilities</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920276"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920274"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920275"><span class="hs-identifier hs-var">reserves</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. AdditiveGroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-glyph hs-var">-</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920273"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="hs-comment">-- | Stablecoin parameters.</span><span>
</span><span id="line-193"></span><span id="local-6989586621680920270"><span id="local-6989586621680920271"></span></span><span class="hs-keyword">data</span><span> </span><span id="Stablecoin"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-var">Stablecoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-194"></span><span>    </span><span id="Stablecoin"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-var">Stablecoin</span></a></span></span><span>
</span><span id="line-195"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="scOracle"><span class="annot"><span class="annottext">Stablecoin -&gt; PaymentPubKey
</span><a href="Plutus.Contracts.Stablecoin.html#scOracle"><span class="hs-identifier hs-var hs-var">scOracle</span></a></span></span><span>                  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">PaymentPubKey</span></span><span> </span><span class="hs-comment">-- ^ Public key of the oracle that provides exchange rates</span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scFee"><span class="annot"><span class="annottext">Stablecoin -&gt; ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#scFee"><span class="hs-identifier hs-var hs-var">scFee</span></a></span></span><span>                     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-comment">-- ^ Fee charged by bank for transactions. Calculated as a fraction of the total transaction volume in base currency.</span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scMinReserveRatio"><span class="annot"><span class="annottext">Stablecoin -&gt; ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#scMinReserveRatio"><span class="hs-identifier hs-var hs-var">scMinReserveRatio</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-comment">-- ^ The minimum ratio of reserves to liabilities</span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scMaxReserveRatio"><span class="annot"><span class="annottext">Stablecoin -&gt; ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#scMaxReserveRatio"><span class="hs-identifier hs-var hs-var">scMaxReserveRatio</span></a></span></span><span>         </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span> </span><span class="hs-comment">-- ^ The maximum ratio of reserves to liabilities</span><span>
</span><span id="line-199"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scReservecoinDefaultPrice"><span class="annot"><span class="annottext">Stablecoin -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#scReservecoinDefaultPrice"><span class="hs-identifier hs-var hs-var">scReservecoinDefaultPrice</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-comment">-- ^ The price of a single reservecoin if no reservecoins have been issued</span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scBaseCurrency"><span class="annot"><span class="annottext">Stablecoin -&gt; AssetClass
</span><a href="Plutus.Contracts.Stablecoin.html#scBaseCurrency"><span class="hs-identifier hs-var hs-var">scBaseCurrency</span></a></span></span><span>            </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">AssetClass</span></span><span> </span><span class="hs-comment">-- ^ The asset class of the base currency. Value of this currency will be locked by the stablecoin state machine instance</span><span>
</span><span id="line-201"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scStablecoinTokenName"><span class="annot"><span class="annottext">Stablecoin -&gt; TokenName
</span><a href="Plutus.Contracts.Stablecoin.html#scStablecoinTokenName"><span class="hs-identifier hs-var hs-var">scStablecoinTokenName</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TokenName</span></span><span> </span><span class="hs-comment">-- ^ 'TokenName' of the stablecoin</span><span>
</span><span id="line-202"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="scReservecoinTokenName"><span class="annot"><span class="annottext">Stablecoin -&gt; TokenName
</span><a href="Plutus.Contracts.Stablecoin.html#scReservecoinTokenName"><span class="hs-identifier hs-var hs-var">scReservecoinTokenName</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TokenName</span></span><span> </span><span class="hs-comment">-- ^ 'TokenName' of the reservecoin</span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-204"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. Stablecoin -&gt; Rep Stablecoin x)
-&gt; (forall x. Rep Stablecoin x -&gt; Stablecoin) -&gt; Generic Stablecoin
forall x. Rep Stablecoin x -&gt; Stablecoin
forall x. Stablecoin -&gt; Rep Stablecoin x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Stablecoin x -&gt; Stablecoin
$cfrom :: forall x. Stablecoin -&gt; Rep Stablecoin x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920255"><span id="local-6989586621680920257"><span class="annot"><span class="annottext">Stablecoin -&gt; Stablecoin -&gt; Bool
(Stablecoin -&gt; Stablecoin -&gt; Bool)
-&gt; (Stablecoin -&gt; Stablecoin -&gt; Bool) -&gt; Eq Stablecoin
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Stablecoin -&gt; Stablecoin -&gt; Bool
$c/= :: Stablecoin -&gt; Stablecoin -&gt; Bool
== :: Stablecoin -&gt; Stablecoin -&gt; Bool
$c== :: Stablecoin -&gt; Stablecoin -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920249"><span id="local-6989586621680920251"><span id="local-6989586621680920253"><span class="annot"><span class="annottext">Int -&gt; Stablecoin -&gt; ShowS
[Stablecoin] -&gt; ShowS
Stablecoin -&gt; String
(Int -&gt; Stablecoin -&gt; ShowS)
-&gt; (Stablecoin -&gt; String)
-&gt; ([Stablecoin] -&gt; ShowS)
-&gt; Show Stablecoin
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Stablecoin] -&gt; ShowS
$cshowList :: [Stablecoin] -&gt; ShowS
show :: Stablecoin -&gt; String
$cshow :: Stablecoin -&gt; String
showsPrec :: Int -&gt; Stablecoin -&gt; ShowS
$cshowsPrec :: Int -&gt; Stablecoin -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920241"><span id="local-6989586621680920243"><span id="local-6989586621680920245"><span id="local-6989586621680920247"><span class="annot"><span class="annottext">[Stablecoin] -&gt; Encoding
[Stablecoin] -&gt; Value
Stablecoin -&gt; Encoding
Stablecoin -&gt; Value
(Stablecoin -&gt; Value)
-&gt; (Stablecoin -&gt; Encoding)
-&gt; ([Stablecoin] -&gt; Value)
-&gt; ([Stablecoin] -&gt; Encoding)
-&gt; ToJSON Stablecoin
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [Stablecoin] -&gt; Encoding
$ctoEncodingList :: [Stablecoin] -&gt; Encoding
toJSONList :: [Stablecoin] -&gt; Value
$ctoJSONList :: [Stablecoin] -&gt; Value
toEncoding :: Stablecoin -&gt; Encoding
$ctoEncoding :: Stablecoin -&gt; Encoding
toJSON :: Stablecoin -&gt; Value
$ctoJSON :: Stablecoin -&gt; Value
</span><a href="#local-6989586621680920241"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920237"><span id="local-6989586621680920239"><span class="annot"><span class="annottext">Value -&gt; Parser [Stablecoin]
Value -&gt; Parser Stablecoin
(Value -&gt; Parser Stablecoin)
-&gt; (Value -&gt; Parser [Stablecoin]) -&gt; FromJSON Stablecoin
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [Stablecoin]
$cparseJSONList :: Value -&gt; Parser [Stablecoin]
parseJSON :: Value -&gt; Parser Stablecoin
$cparseJSON :: Value -&gt; Parser Stablecoin
</span><a href="#local-6989586621680920237"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#minReserve"><span class="hs-pragma hs-type">minReserve</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Minimum number of base currency coins held by the bank.</span><span>
</span><span id="line-209"></span><span class="hs-comment">--   Returns 'Nothing' if no stablecoins have been minted.</span><span>
</span><span id="line-210"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#minReserve"><span class="hs-identifier hs-type">minReserve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span id="minReserve"><span class="annot"><span class="annottext">minReserve :: Stablecoin
-&gt; ConversionRate -&gt; BankState -&gt; Maybe (BC ConversionRate)
</span><a href="Plutus.Contracts.Stablecoin.html#minReserve"><span class="hs-identifier hs-var hs-var">minReserve</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920235"><span class="annot"><span class="annottext">ConversionRate
scMinReserveRatio :: ConversionRate
scMinReserveRatio :: Stablecoin -&gt; ConversionRate
</span><a href="#local-6989586621680920235"><span class="hs-identifier hs-var hs-var">scMinReserveRatio</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920234"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920234"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsStablecoins :: BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span id="local-6989586621680920233"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920233"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-212"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920233"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (BC ConversionRate)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-213"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-214"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920230"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920230"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920234"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate
forall a. a -&gt; PC a
</span><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; PC ConversionRate)
-&gt; ConversionRate -&gt; PC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920233"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; Maybe (BC ConversionRate)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(BC ConversionRate -&gt; Maybe (BC ConversionRate))
-&gt; BC ConversionRate -&gt; Maybe (BC ConversionRate)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920235"><span class="hs-identifier hs-var">scMinReserveRatio</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920230"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Maximum number of base currency coins held by the bank.</span><span>
</span><span id="line-218"></span><span class="hs-comment">--   Returns 'Nothing' if no stablecoins have been minted.</span><span>
</span><span id="line-219"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#maxReserve"><span class="hs-pragma hs-type">maxReserve</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-220"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#maxReserve"><span class="hs-identifier hs-type">maxReserve</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span class="hs-special">)</span><span>
</span><span id="line-221"></span><span id="maxReserve"><span class="annot"><span class="annottext">maxReserve :: Stablecoin
-&gt; ConversionRate -&gt; BankState -&gt; Maybe (BC ConversionRate)
</span><a href="Plutus.Contracts.Stablecoin.html#maxReserve"><span class="hs-identifier hs-var hs-var">maxReserve</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920228"><span class="annot"><span class="annottext">ConversionRate
scMaxReserveRatio :: ConversionRate
scMaxReserveRatio :: Stablecoin -&gt; ConversionRate
</span><a href="#local-6989586621680920228"><span class="hs-identifier hs-var hs-var">scMaxReserveRatio</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920227"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920227"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsStablecoins :: BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span id="local-6989586621680920226"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920226"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-222"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920226"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (BC ConversionRate)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-223"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-224"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920225"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920225"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920227"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate
forall a. a -&gt; PC a
</span><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; PC ConversionRate)
-&gt; ConversionRate -&gt; PC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920226"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span>        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; Maybe (BC ConversionRate)
forall a. a -&gt; Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(BC ConversionRate -&gt; Maybe (BC ConversionRate))
-&gt; BC ConversionRate -&gt; Maybe (BC ConversionRate)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920228"><span class="hs-identifier hs-var">scMaxReserveRatio</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920225"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#reservecoinNominalPrice"><span class="hs-pragma hs-type">reservecoinNominalPrice</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Price of a single reservecoin in base currency</span><span>
</span><span id="line-229"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#reservecoinNominalPrice"><span class="hs-identifier hs-type">reservecoinNominalPrice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-230"></span><span id="reservecoinNominalPrice"><span class="annot"><span class="annottext">reservecoinNominalPrice :: Stablecoin -&gt; BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#reservecoinNominalPrice"><span class="hs-identifier hs-var hs-var">reservecoinNominalPrice</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920223"><span class="annot"><span class="annottext">BC Integer
scReservecoinDefaultPrice :: BC Integer
scReservecoinDefaultPrice :: Stablecoin -&gt; BC Integer
</span><a href="#local-6989586621680920223"><span class="hs-identifier hs-var hs-var">scReservecoinDefaultPrice</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920222"><span class="annot"><span class="annottext">bankState :: BankState
</span><a href="#local-6989586621680920222"><span class="hs-identifier hs-var">bankState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsReservecoins :: BankState -&gt; RC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReservecoins"><span class="hs-identifier hs-var">bsReservecoins</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-type">RC</span></a></span><span> </span><span id="local-6989586621680920221"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920221"><span class="hs-identifier hs-var">rc</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920220"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920220"><span class="hs-identifier hs-var">cr</span></a></span></span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920221"><span class="hs-identifier hs-var">rc</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920218"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#equity"><span class="hs-identifier hs-var">equity</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920222"><span class="hs-identifier hs-var">bankState</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920220"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920218"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate
</span><span class="hs-identifier hs-var">R.recip</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920221"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; ConversionRate) -&gt; BC Integer -&gt; BC ConversionRate
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">BC Integer
</span><a href="#local-6989586621680920223"><span class="hs-identifier hs-var">scReservecoinDefaultPrice</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#stablecoinNominalPrice"><span class="hs-pragma hs-type">stablecoinNominalPrice</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-235"></span><span class="hs-comment">-- | Price of a single stablecoin in base currency. If the banks' liabilities</span><span>
</span><span id="line-236"></span><span class="hs-comment">--   exceed its reserves then 'stablecoinNominalPrice' is zero.</span><span>
</span><span id="line-237"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#stablecoinNominalPrice"><span class="hs-identifier hs-type">stablecoinNominalPrice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-238"></span><span id="stablecoinNominalPrice"><span class="annot"><span class="annottext">stablecoinNominalPrice :: BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinNominalPrice"><span class="hs-identifier hs-var hs-var">stablecoinNominalPrice</span></a></span></span><span> </span><span id="local-6989586621680920214"><span class="annot"><span class="annottext">bankState :: BankState
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">bankState</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsStablecoins :: BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span id="local-6989586621680920213"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920212"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">cr</span></a></span></span><span>
</span><span id="line-239"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920213"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Integer
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920211"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-240"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate -&gt; ConversionRate
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920211"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920210"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-241"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-242"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920211"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920211"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#convert"><span class="hs-identifier hs-var">convert</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; PC ConversionRate
forall a. a -&gt; PC a
</span><a href="Plutus.Contracts.Stablecoin.html#PC"><span class="hs-identifier hs-var">PC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; PC ConversionRate)
-&gt; ConversionRate -&gt; PC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>        </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920210"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920210"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-identifier hs-var">liabilities</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920214"><span class="hs-identifier hs-var">bankState</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920212"><span class="hs-identifier hs-var">cr</span></a></span><span>
</span><span id="line-244"></span><span>
</span><span id="line-245"></span><span class="hs-comment">-- | Action that can be performed on the stablecoin contract.</span><span>
</span><span id="line-246"></span><span id="local-6989586621680920208"><span id="local-6989586621680920209"></span></span><span class="hs-keyword">data</span><span> </span><span id="SCAction"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SCAction"><span class="hs-identifier hs-var">SCAction</span></a></span></span><span>
</span><span id="line-247"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="MintStablecoin"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintStablecoin"><span class="hs-identifier hs-var">MintStablecoin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Create a number stablecoins, depositing the matching amount of base currency</span><span>
</span><span id="line-248"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MintReserveCoin"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintReserveCoin"><span class="hs-identifier hs-var">MintReserveCoin</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-type">RC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Create a number of reservecoins, depositing the matching amount of base currency</span><span>
</span><span id="line-249"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. SCAction -&gt; Rep SCAction x)
-&gt; (forall x. Rep SCAction x -&gt; SCAction) -&gt; Generic SCAction
forall x. Rep SCAction x -&gt; SCAction
forall x. SCAction -&gt; Rep SCAction x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep SCAction x -&gt; SCAction
$cfrom :: forall x. SCAction -&gt; Rep SCAction x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920200"><span id="local-6989586621680920202"><span class="annot"><span class="annottext">SCAction -&gt; SCAction -&gt; Bool
(SCAction -&gt; SCAction -&gt; Bool)
-&gt; (SCAction -&gt; SCAction -&gt; Bool) -&gt; Eq SCAction
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: SCAction -&gt; SCAction -&gt; Bool
$c/= :: SCAction -&gt; SCAction -&gt; Bool
== :: SCAction -&gt; SCAction -&gt; Bool
$c== :: SCAction -&gt; SCAction -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920194"><span id="local-6989586621680920196"><span id="local-6989586621680920198"><span class="annot"><span class="annottext">Int -&gt; SCAction -&gt; ShowS
[SCAction] -&gt; ShowS
SCAction -&gt; String
(Int -&gt; SCAction -&gt; ShowS)
-&gt; (SCAction -&gt; String) -&gt; ([SCAction] -&gt; ShowS) -&gt; Show SCAction
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [SCAction] -&gt; ShowS
$cshowList :: [SCAction] -&gt; ShowS
show :: SCAction -&gt; String
$cshow :: SCAction -&gt; String
showsPrec :: Int -&gt; SCAction -&gt; ShowS
$cshowsPrec :: Int -&gt; SCAction -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920186"><span id="local-6989586621680920188"><span id="local-6989586621680920190"><span id="local-6989586621680920192"><span class="annot"><span class="annottext">[SCAction] -&gt; Encoding
[SCAction] -&gt; Value
SCAction -&gt; Encoding
SCAction -&gt; Value
(SCAction -&gt; Value)
-&gt; (SCAction -&gt; Encoding)
-&gt; ([SCAction] -&gt; Value)
-&gt; ([SCAction] -&gt; Encoding)
-&gt; ToJSON SCAction
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [SCAction] -&gt; Encoding
$ctoEncodingList :: [SCAction] -&gt; Encoding
toJSONList :: [SCAction] -&gt; Value
$ctoJSONList :: [SCAction] -&gt; Value
toEncoding :: SCAction -&gt; Encoding
$ctoEncoding :: SCAction -&gt; Encoding
toJSON :: SCAction -&gt; Value
$ctoJSON :: SCAction -&gt; Value
</span><a href="#local-6989586621680920186"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920182"><span id="local-6989586621680920184"><span class="annot"><span class="annottext">Value -&gt; Parser [SCAction]
Value -&gt; Parser SCAction
(Value -&gt; Parser SCAction)
-&gt; (Value -&gt; Parser [SCAction]) -&gt; FromJSON SCAction
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [SCAction]
$cparseJSONList :: Value -&gt; Parser [SCAction]
parseJSON :: Value -&gt; Parser SCAction
$cparseJSON :: Value -&gt; Parser SCAction
</span><a href="#local-6989586621680920182"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#calcFees"><span class="hs-pragma hs-type">calcFees</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | Calculate transaction fees (paid in base currency to the bank) as a</span><span>
</span><span id="line-254"></span><span class="hs-comment">--   fraction of the transaction's volume</span><span>
</span><span id="line-255"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#calcFees"><span class="hs-identifier hs-type">calcFees</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SCAction"><span class="hs-identifier hs-type">SCAction</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>
</span><span id="line-256"></span><span id="calcFees"><span class="annot"><span class="annottext">calcFees :: Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; SCAction -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#calcFees"><span class="hs-identifier hs-var hs-var">calcFees</span></a></span></span><span> </span><span id="local-6989586621680920180"><span class="annot"><span class="annottext">sc :: Stablecoin
</span><a href="#local-6989586621680920180"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920179"><span class="annot"><span class="annottext">ConversionRate
scFee :: ConversionRate
scFee :: Stablecoin -&gt; ConversionRate
</span><a href="#local-6989586621680920179"><span class="hs-identifier hs-var hs-var">scFee</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920178"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920178"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680920177"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920177"><span class="hs-identifier hs-var">conversionRate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintStablecoin"><span class="hs-identifier hs-type">MintStablecoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span id="local-6989586621680920176"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920176"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-258"></span><span>        </span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinNominalPrice"><span class="hs-identifier hs-var">stablecoinNominalPrice</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920178"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920177"><span class="hs-identifier hs-var">conversionRate</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920179"><span class="hs-identifier hs-var">scFee</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate
forall n. (Ord n, AdditiveGroup n) =&gt; n -&gt; n
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; ConversionRate)
-&gt; ConversionRate -&gt; ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920176"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>    </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintReserveCoin"><span class="hs-identifier hs-type">MintReserveCoin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-type">RC</span></a></span><span> </span><span id="local-6989586621680920174"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920174"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">Stablecoin -&gt; BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#reservecoinNominalPrice"><span class="hs-identifier hs-var">reservecoinNominalPrice</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920180"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920178"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920177"><span class="hs-identifier hs-var">conversionRate</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920179"><span class="hs-identifier hs-var">scFee</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; ConversionRate
forall n. (Ord n, AdditiveGroup n) =&gt; n -&gt; n
</span><span class="hs-identifier hs-var">abs</span></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; ConversionRate)
-&gt; ConversionRate -&gt; ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920174"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-261"></span><span>
</span><span id="line-262"></span><span class="hs-comment">-- | Input to the stablecoin state machine</span><span>
</span><span id="line-263"></span><span id="local-6989586621680920172"><span id="local-6989586621680920173"></span></span><span class="hs-keyword">data</span><span> </span><span id="Input"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>    </span><span id="Input"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-var">Input</span></a></span></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-special">{</span><span> </span><span id="inpSCAction"><span class="annot"><span class="annottext">Input -&gt; SCAction
</span><a href="Plutus.Contracts.Stablecoin.html#inpSCAction"><span class="hs-identifier hs-var hs-var">inpSCAction</span></a></span></span><span>       </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SCAction"><span class="hs-identifier hs-type">SCAction</span></a></span><span> </span><span class="hs-comment">-- ^ The action to be performed</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-special">,</span><span> </span><span id="inpConversionRate"><span class="annot"><span class="annottext">Input -&gt; SignedMessage (Observation ConversionRate)
</span><a href="Plutus.Contracts.Stablecoin.html#inpConversionRate"><span class="hs-identifier hs-var hs-var">inpConversionRate</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SignedMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Observation</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Exchange rate between base currency and peg currency</span><span>
</span><span id="line-267"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-268"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall x. Input -&gt; Rep Input x)
-&gt; (forall x. Rep Input x -&gt; Input) -&gt; Generic Input
forall x. Rep Input x -&gt; Input
forall x. Input -&gt; Rep Input x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep Input x -&gt; Input
$cfrom :: forall x. Input -&gt; Rep Input x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920163"><span id="local-6989586621680920165"><span class="annot"><span class="annottext">Input -&gt; Input -&gt; Bool
(Input -&gt; Input -&gt; Bool) -&gt; (Input -&gt; Input -&gt; Bool) -&gt; Eq Input
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
/= :: Input -&gt; Input -&gt; Bool
$c/= :: Input -&gt; Input -&gt; Bool
== :: Input -&gt; Input -&gt; Bool
$c== :: Input -&gt; Input -&gt; Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Eq</span></a></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920157"><span id="local-6989586621680920159"><span id="local-6989586621680920161"><span class="annot"><span class="annottext">Int -&gt; Input -&gt; ShowS
[Input] -&gt; ShowS
Input -&gt; String
(Int -&gt; Input -&gt; ShowS)
-&gt; (Input -&gt; String) -&gt; ([Input] -&gt; ShowS) -&gt; Show Input
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [Input] -&gt; ShowS
$cshowList :: [Input] -&gt; ShowS
show :: Input -&gt; String
$cshow :: Input -&gt; String
showsPrec :: Int -&gt; Input -&gt; ShowS
$cshowsPrec :: Int -&gt; Input -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920149"><span id="local-6989586621680920151"><span id="local-6989586621680920153"><span id="local-6989586621680920155"><span class="annot"><span class="annottext">[Input] -&gt; Encoding
[Input] -&gt; Value
Input -&gt; Encoding
Input -&gt; Value
(Input -&gt; Value)
-&gt; (Input -&gt; Encoding)
-&gt; ([Input] -&gt; Value)
-&gt; ([Input] -&gt; Encoding)
-&gt; ToJSON Input
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [Input] -&gt; Encoding
$ctoEncodingList :: [Input] -&gt; Encoding
toJSONList :: [Input] -&gt; Value
$ctoJSONList :: [Input] -&gt; Value
toEncoding :: Input -&gt; Encoding
$ctoEncoding :: Input -&gt; Encoding
toJSON :: Input -&gt; Value
$ctoJSON :: Input -&gt; Value
</span><a href="#local-6989586621680920149"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920145"><span id="local-6989586621680920147"><span class="annot"><span class="annottext">Value -&gt; Parser [Input]
Value -&gt; Parser Input
(Value -&gt; Parser Input)
-&gt; (Value -&gt; Parser [Input]) -&gt; FromJSON Input
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [Input]
$cparseJSONList :: Value -&gt; Parser [Input]
parseJSON :: Value -&gt; Parser Input
$cparseJSON :: Value -&gt; Parser Input
</span><a href="#local-6989586621680920145"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#bankReservesValue"><span class="hs-pragma hs-type">bankReservesValue</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-272"></span><span class="hs-comment">-- | The 'Value' containing the bank's reserve in base currency. This is</span><span>
</span><span id="line-273"></span><span class="hs-comment">--   the 'Value' locked by the state machine output with that state.</span><span>
</span><span id="line-274"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#bankReservesValue"><span class="hs-identifier hs-type">bankReservesValue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-275"></span><span id="bankReservesValue"><span class="annot"><span class="annottext">bankReservesValue :: Stablecoin -&gt; BankState -&gt; Value
</span><a href="Plutus.Contracts.Stablecoin.html#bankReservesValue"><span class="hs-identifier hs-var hs-var">bankReservesValue</span></a></span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920143"><span class="annot"><span class="annottext">AssetClass
scBaseCurrency :: AssetClass
scBaseCurrency :: Stablecoin -&gt; AssetClass
</span><a href="#local-6989586621680920143"><span class="hs-identifier hs-var hs-var">scBaseCurrency</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">bsReserves :: BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span id="local-6989586621680920142"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920142"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><span class="annottext">AssetClass -&gt; Integer -&gt; Value
</span><span class="hs-identifier hs-var">Value.assetClassValue</span></span><span> </span><span class="annot"><span class="annottext">AssetClass
</span><a href="#local-6989586621680920143"><span class="hs-identifier hs-var">scBaseCurrency</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621680920142"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#transition"><span class="hs-pragma hs-type">transition</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-279"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#transition"><span class="hs-identifier hs-type">transition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxConstraints</span></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Void</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-280"></span><span id="transition"><span class="annot"><span class="annottext">transition :: Stablecoin
-&gt; State BankState
-&gt; Input
-&gt; Maybe (TxConstraints Void Void, State BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#transition"><span class="hs-identifier hs-var hs-var">transition</span></a></span></span><span> </span><span id="local-6989586621680920139"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920139"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">State</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateData :: forall s. State s -&gt; s
</span><span class="hs-identifier hs-var">stateData</span></span><span class="hs-glyph">=</span><span id="local-6989586621680920136"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920136"><span class="hs-identifier hs-var">oldState</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920135"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680920135"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920134"><span class="annot"><span class="annottext">toSmState :: BankState -&gt; State BankState
</span><a href="#local-6989586621680920134"><span class="hs-identifier hs-var hs-var">toSmState</span></a></span></span><span> </span><span id="local-6989586621680920133"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920133"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">State :: forall s. s -&gt; Value -&gt; State s
</span><span class="hs-identifier hs-type">State</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">stateData :: BankState
</span><span class="hs-identifier hs-var">stateData</span></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920133"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">stateValue :: Value
</span><span class="hs-identifier hs-var">stateValue</span></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">Stablecoin -&gt; BankState -&gt; Value
</span><a href="Plutus.Contracts.Stablecoin.html#bankReservesValue"><span class="hs-identifier hs-var">bankReservesValue</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920139"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920133"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">((TxConstraints Void Void, BankState)
 -&gt; (TxConstraints Void Void, State BankState))
-&gt; Maybe (TxConstraints Void Void, BankState)
-&gt; Maybe (TxConstraints Void Void, State BankState)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621680920131"><span class="annot"><span class="annottext">TxConstraints Void Void
</span><a href="#local-6989586621680920131"><span class="hs-identifier hs-var">constraints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920130"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920130"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints Void Void
</span><a href="#local-6989586621680920131"><span class="hs-identifier hs-var">constraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; State BankState
</span><a href="#local-6989586621680920134"><span class="hs-identifier hs-var">toSmState</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920130"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints Void Void, BankState)
forall i o.
Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#step"><span class="hs-identifier hs-var">step</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920139"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920136"><span class="hs-identifier hs-var">oldState</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680920135"><span class="hs-identifier hs-var">input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>
</span><span id="line-284"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#applyInput"><span class="hs-pragma hs-type">applyInput</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-285"></span><span class="hs-comment">-- | Given a stablecoin definition, current state and input, compute the</span><span>
</span><span id="line-286"></span><span class="hs-comment">--   new state and tx constraints, without checking whether the new state</span><span>
</span><span id="line-287"></span><span class="hs-comment">--   is valid.</span><span>
</span><span id="line-288"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#applyInput"><span class="hs-identifier hs-type">applyInput</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680920128"><span class="annot"><a href="#local-6989586621680920128"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680920127"><span class="annot"><a href="#local-6989586621680920127"><span class="hs-identifier hs-type">o</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxConstraints</span></span><span> </span><span class="annot"><a href="#local-6989586621680920128"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680920127"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span id="applyInput"><span class="annot"><span class="annottext">applyInput :: Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#applyInput"><span class="hs-identifier hs-var hs-var">applyInput</span></a></span></span><span> </span><span id="local-6989586621680920126"><span class="annot"><span class="annottext">sc :: Stablecoin
</span><a href="#local-6989586621680920126"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920125"><span class="annot"><span class="annottext">PaymentPubKey
scOracle :: PaymentPubKey
scOracle :: Stablecoin -&gt; PaymentPubKey
</span><a href="#local-6989586621680920125"><span class="hs-identifier hs-var hs-var">scOracle</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920124"><span class="annot"><span class="annottext">TokenName
scStablecoinTokenName :: TokenName
scStablecoinTokenName :: Stablecoin -&gt; TokenName
</span><a href="#local-6989586621680920124"><span class="hs-identifier hs-var hs-var">scStablecoinTokenName</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621680920123"><span class="annot"><span class="annottext">TokenName
scReservecoinTokenName :: TokenName
scReservecoinTokenName :: Stablecoin -&gt; TokenName
</span><a href="#local-6989586621680920123"><span class="hs-identifier hs-var hs-var">scReservecoinTokenName</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920122"><span class="annot"><span class="annottext">bs :: BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920121"><span class="annot"><span class="annottext">MintingPolicyHash
bsMintingPolicyScript :: MintingPolicyHash
bsMintingPolicyScript :: BankState -&gt; MintingPolicyHash
</span><a href="#local-6989586621680920121"><span class="hs-identifier hs-var hs-var">bsMintingPolicyScript</span></a></span></span><span class="hs-special">}</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920120"><span class="annot"><span class="annottext">SCAction
inpSCAction :: SCAction
inpSCAction :: Input -&gt; SCAction
</span><a href="#local-6989586621680920120"><span class="hs-identifier hs-var hs-var">inpSCAction</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920119"><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
inpConversionRate :: SignedMessage (Observation ConversionRate)
inpConversionRate :: Input -&gt; SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680920119"><span class="hs-identifier hs-var hs-var">inpConversionRate</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-290"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Observation</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">obsValue :: forall a. Observation a -&gt; a
</span><span class="hs-identifier hs-var">obsValue</span></span><span class="hs-glyph">=</span><span id="local-6989586621680920116"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920116"><span class="hs-identifier hs-var">rate</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920115"><span class="annot"><span class="annottext">POSIXTime
obsTime :: forall a. Observation a -&gt; POSIXTime
obsTime :: POSIXTime
</span><span class="hs-identifier hs-var hs-var">obsTime</span></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920113"><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920113"><span class="hs-identifier hs-var">constraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SignedMessageCheckError
 -&gt; Maybe (Observation ConversionRate, TxConstraints i o))
-&gt; ((Observation ConversionRate, TxConstraints i o)
    -&gt; Maybe (Observation ConversionRate, TxConstraints i o))
-&gt; Either
     SignedMessageCheckError
     (Observation ConversionRate, TxConstraints i o)
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Observation ConversionRate, TxConstraints i o)
-&gt; SignedMessageCheckError
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Observation ConversionRate, TxConstraints i o)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Observation ConversionRate, TxConstraints i o)
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKey
-&gt; SignedMessage (Observation ConversionRate)
-&gt; Either
     SignedMessageCheckError
     (Observation ConversionRate, TxConstraints i o)
forall a i o.
FromData a =&gt;
PaymentPubKey
-&gt; SignedMessage a
-&gt; Either SignedMessageCheckError (a, TxConstraints i o)
</span><span class="hs-identifier hs-var">verifySignedMessageConstraints</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKey
</span><a href="#local-6989586621680920125"><span class="hs-identifier hs-var">scOracle</span></a></span><span> </span><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680920119"><span class="hs-identifier hs-var">inpConversionRate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920108"><span class="annot"><span class="annottext">fees :: BC ConversionRate
</span><a href="#local-6989586621680920108"><span class="hs-identifier hs-var hs-var">fees</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; SCAction -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#calcFees"><span class="hs-identifier hs-var">calcFees</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920126"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920116"><span class="hs-identifier hs-var">rate</span></a></span><span> </span><span class="annot"><span class="annottext">SCAction
</span><a href="#local-6989586621680920120"><span class="hs-identifier hs-var">inpSCAction</span></a></span><span>
</span><span id="line-292"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621680920107"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920107"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920106"><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920106"><span class="hs-identifier hs-var">newConstraints</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SCAction
</span><a href="#local-6989586621680920120"><span class="hs-identifier hs-var">inpSCAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-293"></span><span>            </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintStablecoin"><span class="hs-identifier hs-type">MintStablecoin</span></a></span><span> </span><span id="local-6989586621680920105"><span class="annot"><span class="annottext">SC Integer
</span><a href="#local-6989586621680920105"><span class="hs-identifier hs-var">sc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-294"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920104"><span class="annot"><span class="annottext">scValue :: BC ConversionRate
</span><a href="#local-6989586621680920104"><span class="hs-identifier hs-var hs-var">scValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinNominalPrice"><span class="hs-identifier hs-var">stablecoinNominalPrice</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920116"><span class="hs-identifier hs-var">rate</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; ConversionRate) -&gt; Integer -&gt; ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SC Integer -&gt; Integer
forall a. SC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unSC"><span class="hs-identifier hs-var hs-var">unSC</span></a></span><span> </span><span class="annot"><span class="annottext">SC Integer
</span><a href="#local-6989586621680920105"><span class="hs-identifier hs-var">sc'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-295"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-296"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bsStablecoins :: SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; SC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsStablecoins"><span class="hs-identifier hs-var hs-var">bsStablecoins</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">SC Integer -&gt; SC Integer -&gt; SC Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">SC Integer
</span><a href="#local-6989586621680920105"><span class="hs-identifier hs-var">sc'</span></a></span><span>
</span><span id="line-297"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bsReserves :: BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var hs-var">bsReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">BC Integer -&gt; BC Integer -&gt; BC Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; Integer) -&gt; BC ConversionRate -&gt; BC Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; Integer
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920108"><span class="hs-identifier hs-var">fees</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920104"><span class="hs-identifier hs-var">scValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; TokenName -&gt; Integer -&gt; TxConstraints i o
forall i o.
MintingPolicyHash -&gt; TokenName -&gt; Integer -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Constraints.mustMintCurrency</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621680920121"><span class="hs-identifier hs-var">bsMintingPolicyScript</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621680920124"><span class="hs-identifier hs-var">scStablecoinTokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SC Integer -&gt; Integer
forall a. SC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unSC"><span class="hs-identifier hs-var hs-var">unSC</span></a></span><span> </span><span class="annot"><span class="annottext">SC Integer
</span><a href="#local-6989586621680920105"><span class="hs-identifier hs-var">sc'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>            </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MintReserveCoin"><span class="hs-identifier hs-type">MintReserveCoin</span></a></span><span> </span><span id="local-6989586621680920100"><span class="annot"><span class="annottext">RC Integer
</span><a href="#local-6989586621680920100"><span class="hs-identifier hs-var">rc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920099"><span class="annot"><span class="annottext">rcValue :: BC ConversionRate
</span><a href="#local-6989586621680920099"><span class="hs-identifier hs-var hs-var">rcValue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#reservecoinNominalPrice"><span class="hs-identifier hs-var">reservecoinNominalPrice</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920126"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920116"><span class="hs-identifier hs-var">rate</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. MultiplicativeSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">*</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConversionRate -&gt; BC ConversionRate
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; BC ConversionRate)
-&gt; ConversionRate -&gt; BC ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; ConversionRate) -&gt; Integer -&gt; ConversionRate
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">RC Integer -&gt; Integer
forall a. RC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unRC"><span class="hs-identifier hs-var hs-var">unRC</span></a></span><span> </span><span class="annot"><span class="annottext">RC Integer
</span><a href="#local-6989586621680920100"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-301"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-302"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">bsReservecoins :: RC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReservecoins"><span class="hs-identifier hs-var">bsReservecoins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; RC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReservecoins"><span class="hs-identifier hs-var hs-var">bsReservecoins</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">RC Integer -&gt; RC Integer -&gt; RC Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">RC Integer
</span><a href="#local-6989586621680920100"><span class="hs-identifier hs-var">rc</span></a></span><span>
</span><span id="line-303"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">bsReserves :: BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var">bsReserves</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; BC Integer
</span><a href="Plutus.Contracts.Stablecoin.html#bsReserves"><span class="hs-identifier hs-var hs-var">bsReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920122"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">BC Integer -&gt; BC Integer -&gt; BC Integer
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">(ConversionRate -&gt; Integer) -&gt; BC ConversionRate -&gt; BC Integer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ConversionRate -&gt; Integer
</span><span class="hs-identifier hs-var">round</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920108"><span class="hs-identifier hs-var">fees</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; BC ConversionRate
forall a. AdditiveSemigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920099"><span class="hs-identifier hs-var">rcValue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-304"></span><span>                </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; TokenName -&gt; Integer -&gt; TxConstraints i o
forall i o.
MintingPolicyHash -&gt; TokenName -&gt; Integer -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Constraints.mustMintCurrency</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621680920121"><span class="hs-identifier hs-var">bsMintingPolicyScript</span></a></span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621680920123"><span class="hs-identifier hs-var">scReservecoinTokenName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RC Integer -&gt; Integer
forall a. RC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unRC"><span class="hs-identifier hs-var hs-var">unRC</span></a></span><span> </span><span class="annot"><span class="annottext">RC Integer
</span><a href="#local-6989586621680920100"><span class="hs-identifier hs-var">rc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920098"><span class="annot"><span class="annottext">dateConstraints :: TxConstraints i o
</span><a href="#local-6989586621680920098"><span class="hs-identifier hs-var hs-var">dateConstraints</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ValidityInterval POSIXTime -&gt; TxConstraints i o
forall i o. ValidityInterval POSIXTime -&gt; TxConstraints i o
</span><span class="hs-identifier hs-var">Constraints.mustValidateInTimeRange</span></span><span> </span><span class="annot"><span class="annottext">(ValidityInterval POSIXTime -&gt; TxConstraints i o)
-&gt; ValidityInterval POSIXTime -&gt; TxConstraints i o
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime -&gt; ValidityInterval POSIXTime
forall a. a -&gt; ValidityInterval a
</span><span class="hs-identifier hs-var">Interval.from</span></span><span> </span><span class="annot"><span class="annottext">POSIXTime
</span><a href="#local-6989586621680920115"><span class="hs-identifier hs-var">obsTime</span></a></span><span>
</span><span id="line-306"></span><span>    </span><span class="annot"><span class="annottext">(TxConstraints i o, BankState)
-&gt; Maybe (TxConstraints i o, BankState)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920113"><span class="hs-identifier hs-var">constraints</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints i o -&gt; TxConstraints i o -&gt; TxConstraints i o
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920106"><span class="hs-identifier hs-var">newConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TxConstraints i o -&gt; TxConstraints i o -&gt; TxConstraints i o
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920098"><span class="hs-identifier hs-var">dateConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920107"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>
</span><span id="line-308"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#step"><span class="hs-pragma hs-type">step</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-309"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#step"><span class="hs-identifier hs-type">step</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621680920890"><span class="annot"><a href="#local-6989586621680920890"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621680920889"><span class="annot"><a href="#local-6989586621680920889"><span class="hs-identifier hs-type">o</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TxConstraints</span></span><span> </span><span class="annot"><a href="#local-6989586621680920890"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680920889"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span id="step"><span class="annot"><span class="annottext">step :: Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#step"><span class="hs-identifier hs-var hs-var">step</span></a></span></span><span> </span><span id="local-6989586621680920094"><span class="annot"><span class="annottext">sc :: Stablecoin
</span><a href="#local-6989586621680920094"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920093"><span class="annot"><span class="annottext">PaymentPubKey
scOracle :: PaymentPubKey
scOracle :: Stablecoin -&gt; PaymentPubKey
</span><a href="#local-6989586621680920093"><span class="hs-identifier hs-var hs-var">scOracle</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920092"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920092"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680920091"><span class="annot"><span class="annottext">i :: Input
</span><a href="#local-6989586621680920091"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920090"><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
inpConversionRate :: SignedMessage (Observation ConversionRate)
inpConversionRate :: Input -&gt; SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680920090"><span class="hs-identifier hs-var hs-var">inpConversionRate</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621680920089"><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920089"><span class="hs-identifier hs-var">constraints</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920088"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920088"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
forall i o.
Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#applyInput"><span class="hs-identifier hs-var">applyInput</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920094"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920092"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680920091"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-312"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Observation</span></span><span class="hs-special">{</span><span class="annot"><span class="annottext">obsValue :: forall a. Observation a -&gt; a
</span><span class="hs-identifier hs-var">obsValue</span></span><span class="hs-glyph">=</span><span id="local-6989586621680920087"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920087"><span class="hs-identifier hs-var">rate</span></a></span></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TxConstraints i o
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">TxConstraints</span></span><span> </span><span class="annot"><a href="#local-6989586621680920890"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621680920889"><span class="hs-identifier hs-type">o</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SignedMessageCheckError
 -&gt; Maybe (Observation ConversionRate, TxConstraints i o))
-&gt; ((Observation ConversionRate, TxConstraints i o)
    -&gt; Maybe (Observation ConversionRate, TxConstraints i o))
-&gt; Either
     SignedMessageCheckError
     (Observation ConversionRate, TxConstraints i o)
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall a c b. (a -&gt; c) -&gt; (b -&gt; c) -&gt; Either a b -&gt; c
</span><span class="hs-identifier hs-var">either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (Observation ConversionRate, TxConstraints i o)
-&gt; SignedMessageCheckError
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall a b. a -&gt; b -&gt; a
</span><span class="hs-identifier hs-var">const</span></span><span> </span><span class="annot"><span class="annottext">Maybe (Observation ConversionRate, TxConstraints i o)
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Observation ConversionRate, TxConstraints i o)
-&gt; Maybe (Observation ConversionRate, TxConstraints i o)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PaymentPubKey
-&gt; SignedMessage (Observation ConversionRate)
-&gt; Either
     SignedMessageCheckError
     (Observation ConversionRate, TxConstraints i o)
forall a i o.
FromData a =&gt;
PaymentPubKey
-&gt; SignedMessage a
-&gt; Either SignedMessageCheckError (a, TxConstraints i o)
</span><span class="hs-identifier hs-var">verifySignedMessageConstraints</span></span><span> </span><span class="annot"><span class="annottext">PaymentPubKey
</span><a href="#local-6989586621680920093"><span class="hs-identifier hs-var">scOracle</span></a></span><span> </span><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680920090"><span class="hs-identifier hs-var">inpConversionRate</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-313"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; Maybe ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">guard</span></a></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Maybe ()) -&gt; Bool -&gt; Maybe ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; BankState -&gt; ConversionRate -&gt; Bool
</span><a href="Plutus.Contracts.Stablecoin.html#isValidState"><span class="hs-identifier hs-var">isValidState</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920094"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920088"><span class="hs-identifier hs-var">newState</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920087"><span class="hs-identifier hs-var">rate</span></a></span><span>
</span><span id="line-314"></span><span>    </span><span class="annot"><span class="annottext">(TxConstraints i o, BankState)
-&gt; Maybe (TxConstraints i o, BankState)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints i o
</span><a href="#local-6989586621680920089"><span class="hs-identifier hs-var">constraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920088"><span class="hs-identifier hs-var">newState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-315"></span><span>
</span><span id="line-316"></span><span class="hs-comment">-- | A 'Value' with the given number of reservecoins</span><span>
</span><span id="line-317"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#reserveCoins"><span class="hs-identifier hs-type">reserveCoins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-type">RC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-318"></span><span id="reserveCoins"><span class="annot"><span class="annottext">reserveCoins :: Stablecoin -&gt; RC Integer -&gt; Value
</span><a href="Plutus.Contracts.Stablecoin.html#reserveCoins"><span class="hs-identifier hs-var hs-var">reserveCoins</span></a></span></span><span> </span><span id="local-6989586621680920085"><span class="annot"><span class="annottext">sc :: Stablecoin
</span><a href="#local-6989586621680920085"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920084"><span class="annot"><span class="annottext">TokenName
scReservecoinTokenName :: TokenName
scReservecoinTokenName :: Stablecoin -&gt; TokenName
</span><a href="#local-6989586621680920084"><span class="hs-identifier hs-var hs-var">scReservecoinTokenName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920083"><span class="annot"><span class="annottext">sym :: MintingPolicyHash
</span><a href="#local-6989586621680920083"><span class="hs-identifier hs-var hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input) -&gt; MintingPolicyHash
forall a. TypedValidator a -&gt; MintingPolicyHash
</span><span class="hs-identifier hs-var">V2.forwardingMintingPolicyHash</span></span><span> </span><span class="annot"><span class="annottext">(TypedValidator (StateMachine BankState Input)
 -&gt; MintingPolicyHash)
-&gt; TypedValidator (StateMachine BankState Input)
-&gt; MintingPolicyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; TypedValidator (StateMachine BankState Input)
</span><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920085"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-320"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Integer -&gt; Value
</span><span class="hs-identifier hs-var">Value.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">Value.mpsSymbol</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621680920083"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621680920084"><span class="hs-identifier hs-var">scReservecoinTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value)
-&gt; (RC Integer -&gt; Integer) -&gt; RC Integer -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">RC Integer -&gt; Integer
forall a. RC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unRC"><span class="hs-identifier hs-var hs-var">unRC</span></a></span><span>
</span><span id="line-321"></span><span>
</span><span id="line-322"></span><span class="hs-comment">-- | A 'Value' with the given number of stablecoins</span><span>
</span><span id="line-323"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#stableCoins"><span class="hs-identifier hs-type">stableCoins</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-type">SC</span></a></span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/integer-gmp-1.0.3.0/src"><span class="hs-identifier hs-type">Integer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Value</span></span><span>
</span><span id="line-324"></span><span id="stableCoins"><span class="annot"><span class="annottext">stableCoins :: Stablecoin -&gt; SC Integer -&gt; Value
</span><a href="Plutus.Contracts.Stablecoin.html#stableCoins"><span class="hs-identifier hs-var hs-var">stableCoins</span></a></span></span><span> </span><span id="local-6989586621680920079"><span class="annot"><span class="annottext">sc :: Stablecoin
</span><a href="#local-6989586621680920079"><span class="hs-identifier hs-var">sc</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920078"><span class="annot"><span class="annottext">TokenName
scStablecoinTokenName :: TokenName
scStablecoinTokenName :: Stablecoin -&gt; TokenName
</span><a href="#local-6989586621680920078"><span class="hs-identifier hs-var hs-var">scStablecoinTokenName</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920077"><span class="annot"><span class="annottext">sym :: MintingPolicyHash
</span><a href="#local-6989586621680920077"><span class="hs-identifier hs-var hs-var">sym</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input) -&gt; MintingPolicyHash
forall a. TypedValidator a -&gt; MintingPolicyHash
</span><span class="hs-identifier hs-var">V2.forwardingMintingPolicyHash</span></span><span> </span><span class="annot"><span class="annottext">(TypedValidator (StateMachine BankState Input)
 -&gt; MintingPolicyHash)
-&gt; TypedValidator (StateMachine BankState Input)
-&gt; MintingPolicyHash
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; TypedValidator (StateMachine BankState Input)
</span><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920079"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-326"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CurrencySymbol -&gt; TokenName -&gt; Integer -&gt; Value
</span><span class="hs-identifier hs-var">Value.singleton</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MintingPolicyHash -&gt; CurrencySymbol
</span><span class="hs-identifier hs-var">Value.mpsSymbol</span></span><span> </span><span class="annot"><span class="annottext">MintingPolicyHash
</span><a href="#local-6989586621680920077"><span class="hs-identifier hs-var">sym</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TokenName
</span><a href="#local-6989586621680920078"><span class="hs-identifier hs-var">scStablecoinTokenName</span></a></span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; Value)
-&gt; (SC Integer -&gt; Integer) -&gt; SC Integer -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">SC Integer -&gt; Integer
forall a. SC a -&gt; a
</span><a href="Plutus.Contracts.Stablecoin.html#unSC"><span class="hs-identifier hs-var hs-var">unSC</span></a></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#isValidState"><span class="hs-pragma hs-type">isValidState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-329"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#isValidState"><span class="hs-identifier hs-type">isValidState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-type">Bool</span></a></span><span>
</span><span id="line-330"></span><span id="isValidState"><span class="annot"><span class="annottext">isValidState :: Stablecoin -&gt; BankState -&gt; ConversionRate -&gt; Bool
</span><a href="Plutus.Contracts.Stablecoin.html#isValidState"><span class="hs-identifier hs-var hs-var">isValidState</span></a></span></span><span> </span><span id="local-6989586621680920076"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920076"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621680920075"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920075"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span id="local-6989586621680920074"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920074"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either InvalidStateReason () -&gt; Bool
forall a b. Either a b -&gt; Bool
</span><span class="hs-identifier hs-var">isRight</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; Either InvalidStateReason ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier hs-var">checkValidState</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920076"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920075"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920074"><span class="hs-identifier hs-var">cr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-pragma">{-# INLINEABLE</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-pragma hs-type">checkValidState</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-333"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier hs-type">checkValidState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#ConversionRate"><span class="hs-identifier hs-type">ConversionRate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#InvalidStateReason"><span class="hs-identifier hs-type">InvalidStateReason</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span id="checkValidState"><span class="annot"><span class="annottext">checkValidState :: Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; Either InvalidStateReason ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier hs-var hs-var">checkValidState</span></a></span></span><span> </span><span id="local-6989586621680920072"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920072"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621680920071"><span class="annot"><span class="annottext">bs :: BankState
</span><a href="#local-6989586621680920071"><span class="hs-identifier hs-var">bs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span class="hs-special">{</span><span id="local-6989586621680920070"><span class="annot"><span class="annottext">RC Integer
bsReservecoins :: RC Integer
bsReservecoins :: BankState -&gt; RC Integer
</span><a href="#local-6989586621680920070"><span class="hs-identifier hs-var hs-var">bsReservecoins</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920069"><span class="annot"><span class="annottext">BC Integer
bsReserves :: BC Integer
bsReserves :: BankState -&gt; BC Integer
</span><a href="#local-6989586621680920069"><span class="hs-identifier hs-var hs-var">bsReserves</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920068"><span class="annot"><span class="annottext">SC Integer
bsStablecoins :: SC Integer
bsStablecoins :: BankState -&gt; SC Integer
</span><a href="#local-6989586621680920068"><span class="hs-identifier hs-var hs-var">bsStablecoins</span></a></span></span><span class="hs-special">}</span><span> </span><span id="local-6989586621680920067"><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920067"><span class="hs-identifier hs-var">cr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-335"></span><span>    </span><span class="hs-comment">-- TODO: Do we need a validation type in the state machine lib?</span><span>
</span><span id="line-336"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RC Integer
</span><a href="#local-6989586621680920070"><span class="hs-identifier hs-var">bsReservecoins</span></a></span><span> </span><span class="annot"><span class="annottext">RC Integer -&gt; RC Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; RC Integer
forall a. a -&gt; RC a
</span><a href="Plutus.Contracts.Stablecoin.html#RC"><span class="hs-identifier hs-var">RC</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#NegativeReserveCoins"><span class="hs-identifier hs-var">NegativeReserveCoins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BC Integer
</span><a href="#local-6989586621680920069"><span class="hs-identifier hs-var">bsReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC Integer -&gt; BC Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; BC Integer
forall a. a -&gt; BC a
</span><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-var">BC</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#NegativeReserves"><span class="hs-identifier hs-var">NegativeReserves</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SC Integer
</span><a href="#local-6989586621680920068"><span class="hs-identifier hs-var">bsStablecoins</span></a></span><span> </span><span class="annot"><span class="annottext">SC Integer -&gt; SC Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; SC Integer
forall a. a -&gt; SC a
</span><a href="Plutus.Contracts.Stablecoin.html#SC"><span class="hs-identifier hs-var">SC</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#NegativeStablecoins"><span class="hs-identifier hs-var">NegativeStablecoins</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-339"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#liabilities"><span class="hs-identifier hs-var">liabilities</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920071"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920067"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#NegativeLiabilities"><span class="hs-identifier hs-var">NegativeLiabilities</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-340"></span><span>    </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BankState -&gt; ConversionRate -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#equity"><span class="hs-identifier hs-var">equity</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920071"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920067"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
forall a. AdditiveMonoid a =&gt; a
</span><span class="hs-identifier hs-var">zero</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#NegativeEquity"><span class="hs-identifier hs-var">NegativeEquity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>
</span><span id="line-342"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920059"><span class="annot"><span class="annottext">actualReserves :: BC ConversionRate
</span><a href="#local-6989586621680920059"><span class="hs-identifier hs-var hs-var">actualReserves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Integer -&gt; ConversionRate) -&gt; BC Integer -&gt; BC ConversionRate
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">Integer -&gt; ConversionRate
</span><span class="hs-identifier hs-var">fromInteger</span></span><span> </span><span class="annot"><span class="annottext">BC Integer
</span><a href="#local-6989586621680920069"><span class="hs-identifier hs-var">bsReserves</span></a></span><span>
</span><span id="line-343"></span><span>        </span><span id="local-6989586621680920058"><span class="annot"><span class="annottext">allowedReserves :: Maybe (BC ConversionRate, BC ConversionRate)
</span><a href="#local-6989586621680920058"><span class="hs-identifier hs-var hs-var">allowedReserves</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(BC ConversionRate
 -&gt; BC ConversionRate -&gt; (BC ConversionRate, BC ConversionRate))
-&gt; Maybe (BC ConversionRate)
-&gt; Maybe
     (BC ConversionRate -&gt; (BC ConversionRate, BC ConversionRate))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; ConversionRate -&gt; BankState -&gt; Maybe (BC ConversionRate)
</span><a href="Plutus.Contracts.Stablecoin.html#minReserve"><span class="hs-identifier hs-var">minReserve</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920072"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920067"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920071"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (BC ConversionRate -&gt; (BC ConversionRate, BC ConversionRate))
-&gt; Maybe (BC ConversionRate)
-&gt; Maybe (BC ConversionRate, BC ConversionRate)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;*&gt;</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; ConversionRate -&gt; BankState -&gt; Maybe (BC ConversionRate)
</span><a href="Plutus.Contracts.Stablecoin.html#maxReserve"><span class="hs-identifier hs-var">maxReserve</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920072"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680920067"><span class="hs-identifier hs-var">cr</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680920071"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-344"></span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (BC ConversionRate, BC ConversionRate)
</span><a href="#local-6989586621680920058"><span class="hs-identifier hs-var">allowedReserves</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920055"><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920055"><span class="hs-identifier hs-var">minReserves</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680920054"><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920054"><span class="hs-identifier hs-var">maxReserves</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-347"></span><span>            </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920059"><span class="hs-identifier hs-var">actualReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920055"><span class="hs-identifier hs-var">minReserves</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(InvalidStateReason -&gt; Either InvalidStateReason ())
-&gt; InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#MinReserves"><span class="hs-identifier hs-var">MinReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920055"><span class="hs-identifier hs-var">minReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920059"><span class="hs-identifier hs-var">actualReserves</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-348"></span><span>            </span><span class="annot"><span class="annottext">Bool
-&gt; Either InvalidStateReason () -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920059"><span class="hs-identifier hs-var">actualReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920054"><span class="hs-identifier hs-var">maxReserves</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. a -&gt; Either a b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(InvalidStateReason -&gt; Either InvalidStateReason ())
-&gt; InvalidStateReason -&gt; Either InvalidStateReason ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate -&gt; BC ConversionRate -&gt; InvalidStateReason
</span><a href="Plutus.Contracts.Stablecoin.html#MaxReserves"><span class="hs-identifier hs-var">MaxReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920054"><span class="hs-identifier hs-var">maxReserves</span></a></span><span> </span><span class="annot"><span class="annottext">BC ConversionRate
</span><a href="#local-6989586621680920059"><span class="hs-identifier hs-var">actualReserves</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-349"></span><span>        </span><span class="annot"><span class="annottext">Maybe (BC ConversionRate, BC ConversionRate)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Either InvalidStateReason ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span class="hs-keyword">data</span><span> </span><span id="InvalidStateReason"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#InvalidStateReason"><span class="hs-identifier hs-var">InvalidStateReason</span></a></span></span><span>
</span><span id="line-352"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="NegativeReserveCoins"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#NegativeReserveCoins"><span class="hs-identifier hs-var">NegativeReserveCoins</span></a></span></span><span>
</span><span id="line-353"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NegativeReserves"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#NegativeReserves"><span class="hs-identifier hs-var">NegativeReserves</span></a></span></span><span>
</span><span id="line-354"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NegativeStablecoins"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#NegativeStablecoins"><span class="hs-identifier hs-var">NegativeStablecoins</span></a></span></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MinReserves"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MinReserves"><span class="hs-identifier hs-var">MinReserves</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="allowed"><span class="annot"><span class="annottext">InvalidStateReason -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#allowed"><span class="hs-identifier hs-var hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span class="hs-special">,</span><span> </span><span id="actual"><span class="annot"><span class="annottext">InvalidStateReason -&gt; BC ConversionRate
</span><a href="Plutus.Contracts.Stablecoin.html#actual"><span class="hs-identifier hs-var hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-356"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="MaxReserves"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#MaxReserves"><span class="hs-identifier hs-var">MaxReserves</span></a></span></span><span> </span><span class="hs-special">{</span><span> </span><span id="allowed"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#allowed"><span class="hs-identifier hs-var">allowed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span class="hs-special">,</span><span> </span><span id="actual"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#actual"><span class="hs-identifier hs-var">actual</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BC"><span class="hs-identifier hs-type">BC</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Rational</span></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-357"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NegativeLiabilities"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#NegativeLiabilities"><span class="hs-identifier hs-var">NegativeLiabilities</span></a></span></span><span>
</span><span id="line-358"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="NegativeEquity"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#NegativeEquity"><span class="hs-identifier hs-var">NegativeEquity</span></a></span></span><span>
</span><span id="line-359"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920043"><span id="local-6989586621680920045"><span id="local-6989586621680920047"><span class="annot"><span class="annottext">Int -&gt; InvalidStateReason -&gt; ShowS
[InvalidStateReason] -&gt; ShowS
InvalidStateReason -&gt; String
(Int -&gt; InvalidStateReason -&gt; ShowS)
-&gt; (InvalidStateReason -&gt; String)
-&gt; ([InvalidStateReason] -&gt; ShowS)
-&gt; Show InvalidStateReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [InvalidStateReason] -&gt; ShowS
$cshowList :: [InvalidStateReason] -&gt; ShowS
show :: InvalidStateReason -&gt; String
$cshow :: InvalidStateReason -&gt; String
showsPrec :: Int -&gt; InvalidStateReason -&gt; ShowS
$cshowsPrec :: Int -&gt; InvalidStateReason -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-360"></span><span>
</span><span id="line-361"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#stablecoinStateMachine"><span class="hs-identifier hs-type">stablecoinStateMachine</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateMachine</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span>
</span><span id="line-362"></span><span id="stablecoinStateMachine"><span class="annot"><span class="annottext">stablecoinStateMachine :: Stablecoin -&gt; StateMachine BankState Input
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinStateMachine"><span class="hs-identifier hs-var hs-var">stablecoinStateMachine</span></a></span></span><span> </span><span id="local-6989586621680920041"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920041"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ThreadToken
-&gt; (State BankState
    -&gt; Input -&gt; Maybe (TxConstraints Void Void, State BankState))
-&gt; (BankState -&gt; Bool)
-&gt; StateMachine BankState Input
forall s i.
Maybe ThreadToken
-&gt; (State s -&gt; i -&gt; Maybe (TxConstraints Void Void, State s))
-&gt; (s -&gt; Bool)
-&gt; StateMachine s i
</span><span class="hs-identifier hs-var">SM.mkStateMachine</span></span><span> </span><span class="annot"><span class="annottext">Maybe ThreadToken
forall a. Maybe a
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stablecoin
-&gt; State BankState
-&gt; Input
-&gt; Maybe (TxConstraints Void Void, State BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#transition"><span class="hs-identifier hs-var">transition</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920041"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">BankState -&gt; Bool
forall p. p -&gt; Bool
</span><a href="#local-6989586621680920039"><span class="hs-identifier hs-var">isFinal</span></a></span><span>
</span><span id="line-363"></span><span>    </span><span class="hs-comment">-- the state machine never stops (OK for the prototype but we probably need</span><span>
</span><span id="line-364"></span><span>    </span><span class="hs-comment">-- to add a final state to the real thing)</span><span>
</span><span id="line-365"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621680920039"><span class="annot"><span class="annottext">isFinal :: p -&gt; Bool
</span><a href="#local-6989586621680920039"><span class="hs-identifier hs-var hs-var">isFinal</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../../../ghc/html/libraries/ghc-prim-0.6.1/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-366"></span><span>
</span><span id="line-367"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier hs-type">typedValidator</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">V2.TypedValidator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateMachine</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span id="typedValidator"><span class="annot"><span class="annottext">typedValidator :: Stablecoin -&gt; TypedValidator (StateMachine BankState Input)
</span><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier hs-var hs-var">typedValidator</span></a></span></span><span> </span><span id="local-6989586621680920038"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920038"><span class="hs-identifier hs-var">stablecoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-369"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920037"><span class="annot"><span class="annottext">val :: CompiledCodeIn
  DefaultUni DefaultFun (BankState -&gt; Input -&gt; ScriptContext -&gt; Bool)
</span><a href="#local-6989586621680920037"><span class="hs-identifier hs-var hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">$$(</span><span class="annot"><span class="hs-identifier hs-type">PlutusTx.compile</span></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">validator</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompiledCode
  (Stablecoin -&gt; BankState -&gt; Input -&gt; ScriptContext -&gt; Bool)
-&gt; CompiledCodeIn DefaultUni DefaultFun Stablecoin
-&gt; CompiledCodeIn
     DefaultUni DefaultFun (BankState -&gt; Input -&gt; ScriptContext -&gt; Bool)
forall (uni :: * -&gt; *) fun a b.
(Closed uni, Everywhere uni Flat, Flat fun,
 Everywhere uni PrettyConst, GShow uni, Pretty fun) =&gt;
CompiledCodeIn uni fun (a -&gt; b)
-&gt; CompiledCodeIn uni fun a -&gt; CompiledCodeIn uni fun b
</span><span class="hs-operator hs-var">`PlutusTx.applyCode`</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; CompiledCodeIn DefaultUni DefaultFun Stablecoin
forall (uni :: * -&gt; *) a fun.
(Lift uni a, Throwable uni fun, Typecheckable uni fun) =&gt;
a -&gt; CompiledCodeIn uni fun a
</span><span class="hs-identifier hs-var">PlutusTx.liftCode</span></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920038"><span class="hs-identifier hs-var">stablecoin</span></a></span><span>
</span><span id="line-370"></span><span>        </span><span id="local-6989586621680920036"><span class="annot"><span class="annottext">validator :: Stablecoin -&gt; ValidatorType (StateMachine BankState Input)
</span><a href="#local-6989586621680920036"><span class="hs-identifier hs-var hs-var">validator</span></a></span></span><span> </span><span id="local-6989586621680920030"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920030"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">StateMachine BankState Input
-&gt; ValidatorType (StateMachine BankState Input)
forall s i.
ToData s =&gt;
StateMachine s i -&gt; ValidatorType (StateMachine s i)
</span><span class="hs-identifier hs-var">SM.mkValidator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stablecoin -&gt; StateMachine BankState Input
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinStateMachine"><span class="hs-identifier hs-var">stablecoinStateMachine</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920030"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>        </span><span id="local-6989586621680920028"><span class="annot"><span class="annottext">wrap :: (BankState -&gt; Input -&gt; ScriptContext -&gt; Bool) -&gt; UntypedValidator
</span><a href="#local-6989586621680920028"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnsafeFromData BankState, UnsafeFromData Input) =&gt;
(BankState -&gt; Input -&gt; ScriptContext -&gt; Bool) -&gt; UntypedValidator
forall sc d r.
(IsScriptContext sc, UnsafeFromData d, UnsafeFromData r) =&gt;
(d -&gt; r -&gt; sc -&gt; Bool) -&gt; UntypedValidator
</span><span class="hs-identifier hs-var">Scripts.mkUntypedValidator</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Scripts.ScriptContextV2</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span>
</span><span id="line-372"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">CompiledCode (ValidatorType (StateMachine BankState Input))
-&gt; CompiledCode
     (ValidatorType (StateMachine BankState Input) -&gt; UntypedValidator)
-&gt; TypedValidator (StateMachine BankState Input)
forall a.
CompiledCode (ValidatorType a)
-&gt; CompiledCode (ValidatorType a -&gt; UntypedValidator)
-&gt; TypedValidator a
</span><span class="hs-identifier hs-var">V2.mkTypedValidator</span></span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateMachine</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CompiledCode (ValidatorType (StateMachine BankState Input))
CompiledCodeIn
  DefaultUni DefaultFun (BankState -&gt; Input -&gt; ScriptContext -&gt; Bool)
</span><a href="#local-6989586621680920037"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="hs-special">$$(</span><span class="annot"><span class="hs-identifier hs-type">PlutusTx.compile</span></span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-identifier">wrap</span><span> </span><span class="hs-special">||]</span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#machineClient"><span class="hs-identifier hs-type">machineClient</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-375"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">V2.TypedValidator</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">StateMachine</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateMachineClient</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span>
</span><span id="line-378"></span><span id="machineClient"><span class="annot"><span class="annottext">machineClient :: TypedValidator (StateMachine BankState Input)
-&gt; Stablecoin -&gt; StateMachineClient BankState Input
</span><a href="Plutus.Contracts.Stablecoin.html#machineClient"><span class="hs-identifier hs-var hs-var">machineClient</span></a></span></span><span> </span><span id="local-6989586621680920024"><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input)
</span><a href="#local-6989586621680920024"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span id="local-6989586621680920023"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920023"><span class="hs-identifier hs-var">stablecoin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680920022"><span class="annot"><span class="annottext">machine :: StateMachine BankState Input
</span><a href="#local-6989586621680920022"><span class="hs-identifier hs-var hs-var">machine</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Stablecoin -&gt; StateMachine BankState Input
</span><a href="Plutus.Contracts.Stablecoin.html#stablecoinStateMachine"><span class="hs-identifier hs-var">stablecoinStateMachine</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680920023"><span class="hs-identifier hs-var">stablecoin</span></a></span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">StateMachineInstance BankState Input
-&gt; StateMachineClient BankState Input
forall state input.
StateMachineInstance state input -&gt; StateMachineClient state input
</span><span class="hs-identifier hs-var">SM.mkStateMachineClient</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateMachine BankState Input
-&gt; TypedValidator (StateMachine BankState Input)
-&gt; StateMachineInstance BankState Input
forall s i.
StateMachine s i
-&gt; TypedValidator (StateMachine s i) -&gt; StateMachineInstance s i
</span><span class="hs-identifier hs-var">SM.StateMachineInstance</span></span><span> </span><span class="annot"><span class="annottext">StateMachine BankState Input
</span><a href="#local-6989586621680920022"><span class="hs-identifier hs-var">machine</span></a></span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input)
</span><a href="#local-6989586621680920024"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span class="hs-keyword">type</span><span> </span><span id="StablecoinSchema"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinSchema"><span class="hs-identifier hs-var">StablecoinSchema</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-383"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Endpoint</span></span><span> </span><span class="annot"><span class="hs-string">&quot;run step&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span>
</span><span id="line-384"></span><span>        </span><span class="annot"><span class="hs-operator hs-type">.\/</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Endpoint</span></span><span> </span><span class="annot"><span class="hs-string">&quot;initialise&quot;</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span id="local-6989586621680920017"><span id="local-6989586621680920018"></span></span><span class="hs-keyword">data</span><span> </span><span id="StablecoinError"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier hs-var">StablecoinError</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-387"></span><span>    </span><span id="InitialiseEPError"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#InitialiseEPError"><span class="hs-identifier hs-var">InitialiseEPError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContractError</span></span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="StateMachineError"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StateMachineError"><span class="hs-identifier hs-var">StateMachineError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">SMContractError</span></span><span>
</span><span id="line-389"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="RunStepError"><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#RunStepError"><span class="hs-identifier hs-var">RunStepError</span></a></span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ContractError</span></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">stock</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680920008"><span id="local-6989586621680920010"><span id="local-6989586621680920012"><span class="annot"><span class="annottext">Int -&gt; StablecoinError -&gt; ShowS
[StablecoinError] -&gt; ShowS
StablecoinError -&gt; String
(Int -&gt; StablecoinError -&gt; ShowS)
-&gt; (StablecoinError -&gt; String)
-&gt; ([StablecoinError] -&gt; ShowS)
-&gt; Show StablecoinError
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
showList :: [StablecoinError] -&gt; ShowS
$cshowList :: [StablecoinError] -&gt; ShowS
show :: StablecoinError -&gt; String
$cshow :: StablecoinError -&gt; String
showsPrec :: Int -&gt; StablecoinError -&gt; ShowS
$cshowsPrec :: Int -&gt; StablecoinError -&gt; ShowS
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Haskell.Show</span></a></span></span></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(forall x. StablecoinError -&gt; Rep StablecoinError x)
-&gt; (forall x. Rep StablecoinError x -&gt; StablecoinError)
-&gt; Generic StablecoinError
forall x. Rep StablecoinError x -&gt; StablecoinError
forall x. StablecoinError -&gt; Rep StablecoinError x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cto :: forall x. Rep StablecoinError x -&gt; StablecoinError
$cfrom :: forall x. StablecoinError -&gt; Rep StablecoinError x
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var hs-var hs-var hs-var">Generic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="annot"><span class="hs-keyword">anyclass</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680919998"><span id="local-6989586621680920000"><span id="local-6989586621680920002"><span id="local-6989586621680920004"><span class="annot"><span class="annottext">[StablecoinError] -&gt; Encoding
[StablecoinError] -&gt; Value
StablecoinError -&gt; Encoding
StablecoinError -&gt; Value
(StablecoinError -&gt; Value)
-&gt; (StablecoinError -&gt; Encoding)
-&gt; ([StablecoinError] -&gt; Value)
-&gt; ([StablecoinError] -&gt; Encoding)
-&gt; ToJSON StablecoinError
forall a.
(a -&gt; Value)
-&gt; (a -&gt; Encoding)
-&gt; ([a] -&gt; Value)
-&gt; ([a] -&gt; Encoding)
-&gt; ToJSON a
toEncodingList :: [StablecoinError] -&gt; Encoding
$ctoEncodingList :: [StablecoinError] -&gt; Encoding
toJSONList :: [StablecoinError] -&gt; Value
$ctoJSONList :: [StablecoinError] -&gt; Value
toEncoding :: StablecoinError -&gt; Encoding
$ctoEncoding :: StablecoinError -&gt; Encoding
toJSON :: StablecoinError -&gt; Value
$ctoJSON :: StablecoinError -&gt; Value
</span><a href="#local-6989586621680919998"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">ToJSON</span></a></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919994"><span id="local-6989586621680919996"><span class="annot"><span class="annottext">Value -&gt; Parser [StablecoinError]
Value -&gt; Parser StablecoinError
(Value -&gt; Parser StablecoinError)
-&gt; (Value -&gt; Parser [StablecoinError]) -&gt; FromJSON StablecoinError
forall a.
(Value -&gt; Parser a) -&gt; (Value -&gt; Parser [a]) -&gt; FromJSON a
parseJSONList :: Value -&gt; Parser [StablecoinError]
$cparseJSONList :: Value -&gt; Parser [StablecoinError]
parseJSON :: Value -&gt; Parser StablecoinError
$cparseJSON :: Value -&gt; Parser StablecoinError
</span><a href="#local-6989586621680919994"><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">FromJSON</span></a></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-392"></span><span>
</span><span id="line-393"></span><span id="_RunStepError"><span id="_StateMachineError"><span id="_InitialiseEPError"><span id="_StablecoinError"><span id="local-6989586621680919983"><span id="local-6989586621680919985"><span id="local-6989586621680919987"><span id="local-6989586621680919989"><span id="local-6989586621680919991"><span id="local-6989586621680919992"><span id="local-6989586621680919993"><span id="AsStablecoinError"><span id="local-6989586621680920789"><span class="hs-identifier">makeClassyPrisms</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">StablecoinError</span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-394"></span><span>
</span><span id="line-395"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680919961"><span id="local-6989586621680919963"><span id="local-6989586621680919965"><span id="local-6989586621680919967"><span id="local-6989586621680919969"><span id="local-6989586621680919971"><span id="local-6989586621680919973"><span id="local-6989586621680919975"><span class="annot"><span class="hs-identifier hs-type">AsContractError</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier hs-type">StablecoinError</span></a></span></span></span></span></span></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-396"></span><span>    </span><span id="local-6989586621680919959"><span class="annot"><span class="annottext">_ContractError :: p ContractError (f ContractError)
-&gt; p StablecoinError (f StablecoinError)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">_ContractError</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError)
-&gt; p StablecoinError (f StablecoinError)
forall r. AsStablecoinError r =&gt; Prism' r ContractError
</span><a href="Plutus.Contracts.Stablecoin.html#_InitialiseEPError"><span class="hs-identifier hs-var">_InitialiseEPError</span></a></span><span> </span><span class="annot"><span class="annottext">(p ContractError (f ContractError)
 -&gt; p StablecoinError (f StablecoinError))
-&gt; (p ContractError (f ContractError)
    -&gt; p ContractError (f ContractError))
-&gt; p ContractError (f ContractError)
-&gt; p StablecoinError (f StablecoinError)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p ContractError (f ContractError)
-&gt; p ContractError (f ContractError)
forall r. AsContractError r =&gt; Prism' r ContractError
</span><span class="hs-identifier hs-var">_ContractError</span></span><span>
</span><span id="line-397"></span><span>
</span><span id="line-398"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621680919951"><span id="local-6989586621680919953"><span id="local-6989586621680919955"><span class="annot"><span class="hs-identifier hs-type">AsSMContractError</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier hs-type">StablecoinError</span></a></span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-399"></span><span>    </span><span id="local-6989586621680919949"><span class="annot"><span class="annottext">_SMContractError :: p SMContractError (f SMContractError)
-&gt; p StablecoinError (f StablecoinError)
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">_SMContractError</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">p SMContractError (f SMContractError)
-&gt; p StablecoinError (f StablecoinError)
forall r. AsStablecoinError r =&gt; Prism' r SMContractError
</span><a href="Plutus.Contracts.Stablecoin.html#_StateMachineError"><span class="hs-identifier hs-var">_StateMachineError</span></a></span><span> </span><span class="annot"><span class="annottext">(p SMContractError (f SMContractError)
 -&gt; p StablecoinError (f StablecoinError))
-&gt; (p SMContractError (f SMContractError)
    -&gt; p SMContractError (f SMContractError))
-&gt; p SMContractError (f SMContractError)
-&gt; p StablecoinError (f StablecoinError)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">p SMContractError (f SMContractError)
-&gt; p SMContractError (f SMContractError)
forall r. AsSMContractError r =&gt; Prism' r SMContractError
</span><span class="hs-identifier hs-var">SM._SMContractError</span></span><span>
</span><span id="line-400"></span><span>
</span><span id="line-401"></span><span class="hs-comment">-- | A 'Contract' that initialises the state machine and then accepts 'Input'</span><span>
</span><span id="line-402"></span><span class="hs-comment">--   transitions.</span><span>
</span><span id="line-403"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#contract"><span class="hs-identifier hs-type">contract</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Promise</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinSchema"><span class="hs-identifier hs-type">StablecoinSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier hs-type">StablecoinError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span id="contract"><span class="annot"><span class="annottext">contract :: Promise () StablecoinSchema StablecoinError ()
</span><a href="Plutus.Contracts.Stablecoin.html#contract"><span class="hs-identifier hs-var hs-var">contract</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;initialise&quot; a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><span class="hs-identifier hs-var">endpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;initialise&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Stablecoin
  -&gt; Contract
       ()
       ('R
          '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
             &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
       StablecoinError
       ())
 -&gt; Promise
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      ())
-&gt; (Stablecoin
    -&gt; Contract
         ()
         ('R
            '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
               &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
         StablecoinError
         ())
-&gt; Promise
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680919946"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919946"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621680919945"><span class="annot"><span class="annottext">theClient :: StateMachineClient BankState Input
</span><a href="#local-6989586621680919945"><span class="hs-identifier hs-var hs-var">theClient</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypedValidator (StateMachine BankState Input)
-&gt; Stablecoin -&gt; StateMachineClient BankState Input
</span><a href="Plutus.Contracts.Stablecoin.html#machineClient"><span class="hs-identifier hs-var">machineClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Stablecoin -&gt; TypedValidator (StateMachine BankState Input)
</span><a href="Plutus.Contracts.Stablecoin.html#typedValidator"><span class="hs-identifier hs-var">typedValidator</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919946"><span class="hs-identifier hs-var">sc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919946"><span class="hs-identifier hs-var">sc</span></a></span><span>
</span><span id="line-406"></span><span>    </span><span class="annot"><span class="annottext">BankState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
-&gt; BankState
-&gt; Value
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     BankState
forall w e state (schema :: Row *) input.
(FromData state, ToData state, ToData input,
 AsSMContractError e) =&gt;
StateMachineClient state input
-&gt; state -&gt; Value -&gt; Contract w schema e state
</span><span class="hs-identifier hs-var">SM.runInitialise</span></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919945"><span class="hs-identifier hs-var">theClient</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StateMachineClient BankState Input -&gt; BankState
</span><a href="Plutus.Contracts.Stablecoin.html#initialState"><span class="hs-identifier hs-var">initialState</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919945"><span class="hs-identifier hs-var">theClient</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Value
</span><span class="hs-identifier hs-var">Ada.lovelaceValueOf</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>    </span><span class="annot"><span class="annottext">Contract
  ()
  ('R
     '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
        &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
  StablecoinError
  (TransitionResult BankState Input)
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">forever</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   ()
   ('R
      '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
         &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
   StablecoinError
   (TransitionResult BankState Input)
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      ())
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Promise
  ()
  ('R
     '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
        &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
  StablecoinError
  (TransitionResult BankState Input)
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
forall w (s :: Row *) e a. Promise w s e a -&gt; Contract w s e a
</span><span class="hs-identifier hs-var hs-var">awaitPromise</span></span><span> </span><span class="annot"><span class="annottext">(Promise
   ()
   ('R
      '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
         &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
   StablecoinError
   (TransitionResult BankState Input)
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      (TransitionResult BankState Input))
-&gt; Promise
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">forall a w (s :: Row *) e b.
(HasEndpoint &quot;run step&quot; a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
forall (l :: Symbol) a w (s :: Row *) e b.
(HasEndpoint l a s, AsContractError e, FromJSON a) =&gt;
(a -&gt; Contract w s e b) -&gt; Promise w s e b
</span><span class="hs-identifier hs-var">endpoint</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-string">&quot;run step&quot;</span></span><span> </span><span class="annot"><span class="annottext">((Input
  -&gt; Contract
       ()
       ('R
          '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
             &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
       StablecoinError
       (TransitionResult BankState Input))
 -&gt; Promise
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      (TransitionResult BankState Input))
-&gt; (Input
    -&gt; Contract
         ()
         ('R
            '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
               &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
         StablecoinError
         (TransitionResult BankState Input))
-&gt; Promise
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621680919941"><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680919941"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>        </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
-&gt; Stablecoin
-&gt; Input
-&gt; Contract () StablecoinSchema StablecoinError ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkTransition"><span class="hs-identifier hs-var">checkTransition</span></a></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919945"><span class="hs-identifier hs-var">theClient</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919946"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680919941"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-409"></span><span>        </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
-&gt; Input
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (TransitionResult BankState Input)
forall w e state (schema :: Row *) input.
(AsSMContractError e, FromData state, ToData state,
 ToData input) =&gt;
StateMachineClient state input
-&gt; input -&gt; Contract w schema e (TransitionResult state input)
</span><span class="hs-identifier hs-var">SM.runStep</span></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919945"><span class="hs-identifier hs-var">theClient</span></a></span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680919941"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-410"></span><span>
</span><span id="line-411"></span><span class="hs-comment">-- | Apply 'checkValidState' to the states before and after a transition</span><span>
</span><span id="line-412"></span><span class="hs-comment">--   and log a warning if something isn't right.</span><span>
</span><span id="line-413"></span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#checkTransition"><span class="hs-identifier hs-type">checkTransition</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">StateMachineClient</span></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#BankState"><span class="hs-identifier hs-type">BankState</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Stablecoin"><span class="hs-identifier hs-type">Stablecoin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Contract</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinSchema"><span class="hs-identifier hs-type">StablecoinSchema</span></a></span><span> </span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#StablecoinError"><span class="hs-identifier hs-type">StablecoinError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-414"></span><span id="checkTransition"><span class="annot"><span class="annottext">checkTransition :: StateMachineClient BankState Input
-&gt; Stablecoin
-&gt; Input
-&gt; Contract () StablecoinSchema StablecoinError ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkTransition"><span class="hs-identifier hs-var hs-var">checkTransition</span></a></span></span><span> </span><span id="local-6989586621680919938"><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919938"><span class="hs-identifier hs-var">theClient</span></a></span></span><span> </span><span id="local-6989586621680919937"><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919937"><span class="hs-identifier hs-var">sc</span></a></span></span><span> </span><span id="local-6989586621680919936"><span class="annot"><span class="annottext">i :: Input
</span><a href="#local-6989586621680919936"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Plutus.Contracts.Stablecoin.html#Input"><span class="hs-identifier hs-type">Input</span></a></span><span class="hs-special">{</span><span id="local-6989586621680919935"><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
inpConversionRate :: SignedMessage (Observation ConversionRate)
inpConversionRate :: Input -&gt; SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680919935"><span class="hs-identifier hs-var hs-var">inpConversionRate</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-415"></span><span>        </span><span id="local-6989586621680919934"><span class="annot"><span class="annottext">Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut)
</span><a href="#local-6989586621680919934"><span class="hs-identifier hs-var">currentState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SMContractError -&gt; StablecoinError)
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     SMContractError
     (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
forall w (s :: Row *) e e' a.
(e -&gt; e') -&gt; Contract w s e a -&gt; Contract w s e' a
</span><span class="hs-identifier hs-var">mapError</span></span><span> </span><span class="annot"><span class="annottext">SMContractError -&gt; StablecoinError
</span><a href="Plutus.Contracts.Stablecoin.html#StateMachineError"><span class="hs-identifier hs-var">StateMachineError</span></a></span><span> </span><span class="annot"><span class="annottext">(Contract
   ()
   ('R
      '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
         &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
   SMContractError
   (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      (Maybe
         (OnChainState BankState Input, Map TxOutRef DecoratedTxOut)))
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     SMContractError
     (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     SMContractError
     (Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut))
forall e state i w (schema :: Row *).
(AsSMContractError e, FromData state, ToData state) =&gt;
StateMachineClient state i
-&gt; Contract
     w
     schema
     e
     (Maybe (OnChainState state i, Map TxOutRef DecoratedTxOut))
</span><span class="hs-identifier hs-var">SM.getOnChainState</span></span><span> </span><span class="annot"><span class="annottext">StateMachineClient BankState Input
</span><a href="#local-6989586621680919938"><span class="hs-identifier hs-var">theClient</span></a></span><span>
</span><span id="line-416"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
-&gt; Either SignedMessageCheckError (Observation ConversionRate)
forall a.
FromData a =&gt;
SignedMessage a -&gt; Either SignedMessageCheckError a
</span><span class="hs-identifier hs-var">checkHashOffChain</span></span><span> </span><span class="annot"><span class="annottext">SignedMessage (Observation ConversionRate)
</span><a href="#local-6989586621680919935"><span class="hs-identifier hs-var">inpConversionRate</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-417"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Observation</span></span><span class="hs-special">{</span><span id="local-6989586621680919930"><span class="annot"><span class="annottext">ConversionRate
obsValue :: ConversionRate
obsValue :: forall a. Observation a -&gt; a
</span><a href="#local-6989586621680919930"><span class="hs-identifier hs-var hs-var">obsValue</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-418"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut)
</span><a href="#local-6989586621680919934"><span class="hs-identifier hs-var">currentState</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-419"></span><span>                    </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621680919929"><span class="annot"><span class="annottext">OnChainState BankState Input
</span><a href="#local-6989586621680919929"><span class="hs-identifier hs-var">ocs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Map TxOutRef DecoratedTxOut
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-420"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; Either InvalidStateReason ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier hs-var">checkValidState</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919937"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainState BankState Input -&gt; BankState
forall s i. OnChainState s i -&gt; s
</span><span class="hs-identifier hs-var">SM.getStateData</span></span><span> </span><span class="annot"><span class="annottext">OnChainState BankState Input
</span><a href="#local-6989586621680919929"><span class="hs-identifier hs-var">ocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680919930"><span class="hs-identifier hs-var">obsValue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-421"></span><span>                            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Current state OK&quot;</span></span><span>
</span><span id="line-422"></span><span>                            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680919926"><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="#local-6989586621680919926"><span class="hs-identifier hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      ())
-&gt; String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Current state is invalid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.show</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="#local-6989586621680919926"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;. The transition may still be allowed.&quot;</span></span><span>
</span><span id="line-423"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints Any Any, BankState)
forall i o.
Stablecoin
-&gt; BankState -&gt; Input -&gt; Maybe (TxConstraints i o, BankState)
</span><a href="Plutus.Contracts.Stablecoin.html#applyInput"><span class="hs-identifier hs-var">applyInput</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919937"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OnChainState BankState Input -&gt; BankState
forall s i. OnChainState s i -&gt; s
</span><span class="hs-identifier hs-var">SM.getStateData</span></span><span> </span><span class="annot"><span class="annottext">OnChainState BankState Input
</span><a href="#local-6989586621680919929"><span class="hs-identifier hs-var">ocs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Input
</span><a href="#local-6989586621680919936"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-424"></span><span>                            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TxConstraints Any Any
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621680919924"><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680919924"><span class="hs-identifier hs-var">newState</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Stablecoin
-&gt; BankState -&gt; ConversionRate -&gt; Either InvalidStateReason ()
</span><a href="Plutus.Contracts.Stablecoin.html#checkValidState"><span class="hs-identifier hs-var">checkValidState</span></a></span><span> </span><span class="annot"><span class="annottext">Stablecoin
</span><a href="#local-6989586621680919937"><span class="hs-identifier hs-var">sc</span></a></span><span> </span><span class="annot"><span class="annottext">BankState
</span><a href="#local-6989586621680919924"><span class="hs-identifier hs-var">newState</span></a></span><span> </span><span class="annot"><span class="annottext">ConversionRate
</span><a href="#local-6989586621680919930"><span class="hs-identifier hs-var">obsValue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-425"></span><span>                                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logInfo</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;New state OK&quot;</span></span><span>
</span><span id="line-426"></span><span>                                </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680919923"><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="#local-6989586621680919923"><span class="hs-identifier hs-var">w</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logWarn</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      ())
-&gt; String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;New state is invalid: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.show</span></a></span><span> </span><span class="annot"><span class="annottext">InvalidStateReason
</span><a href="#local-6989586621680919923"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;. The transition is not allowed.&quot;</span></span><span>
</span><span id="line-427"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (TxConstraints Any Any, BankState)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logWarn</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;applyInput is Nothing (transition failed)&quot;</span></span><span>
</span><span id="line-428"></span><span>                    </span><span class="annot"><span class="annottext">Maybe (OnChainState BankState Input, Map TxOutRef DecoratedTxOut)
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logWarn</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Haskell.String</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unable to find current state.&quot;</span></span><span>
</span><span id="line-429"></span><span>            </span><span class="annot"><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621680919921"><span class="annot"><span class="annottext">SignedMessageCheckError
</span><a href="#local-6989586621680919921"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a w (s :: Row *) e. ToJSON a =&gt; a -&gt; Contract w s e ()
</span><span class="hs-identifier hs-var">logWarn</span></span><span> </span><span class="annot"><span class="annottext">(String
 -&gt; Contract
      ()
      ('R
         '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
            &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
      StablecoinError
      ())
-&gt; String
-&gt; Contract
     ()
     ('R
        '[ &quot;initialise&quot; ':-&gt; (EndpointValue Stablecoin, ActiveEndpoint),
           &quot;run step&quot; ':-&gt; (EndpointValue Input, ActiveEndpoint)])
     StablecoinError
     ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unable to decode oracle value from datum: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">SignedMessageCheckError -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../../../ghc/html/libraries/base-4.14.3.0/src"><span class="hs-identifier hs-var">Haskell.show</span></a></span><span> </span><span class="annot"><span class="annottext">SignedMessageCheckError
</span><a href="#local-6989586621680919921"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-430"></span><span>
</span><span id="line-431"></span><span id="local-6989586621680919917"><span id="local-6989586621680919919"><span id="local-6989586621680920870"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SC</span></span></span></span><span>
</span><span id="line-432"></span><span id="local-6989586621680919909"><span id="local-6989586621680919911"><span id="local-6989586621680920867"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RC</span></span></span></span><span>
</span><span id="line-433"></span><span id="local-6989586621680919905"><span id="local-6989586621680919907"><span id="local-6989586621680920915"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BC</span></span></span></span><span>
</span><span id="line-434"></span><span id="local-6989586621680919901"><span id="local-6989586621680919903"><span id="local-6989586621680920912"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PC</span></span></span></span><span>
</span><span id="line-435"></span><span id="local-6989586621680919897"><span id="local-6989586621680919899"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BankState</span></span></span><span>
</span><span id="line-436"></span><span id="local-6989586621680919893"><span id="local-6989586621680919895"><span class="hs-identifier">PlutusTx.makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Stablecoin</span></span></span><span>
</span><span id="line-437"></span><span id="local-6989586621680919887"><span id="local-6989586621680919889"><span id="local-6989586621680919891"><span id="local-6989586621680920915"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BC</span></span></span></span></span><span>
</span><span id="line-438"></span><span id="local-6989586621680919875"><span id="local-6989586621680919877"><span id="local-6989586621680919879"><span id="local-6989586621680920870"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SC</span></span></span></span></span><span>
</span><span id="line-439"></span><span id="local-6989586621680919869"><span id="local-6989586621680919871"><span id="local-6989586621680919873"><span id="local-6989586621680920867"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">RC</span></span></span></span></span><span>
</span><span id="line-440"></span><span id="local-6989586621680919863"><span id="local-6989586621680919865"><span id="local-6989586621680919867"><span id="local-6989586621680920912"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">PC</span></span></span></span></span><span>
</span><span id="line-441"></span><span id="local-6989586621680919857"><span id="local-6989586621680919859"><span id="local-6989586621680919861"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BankState</span></span></span></span><span>
</span><span id="line-442"></span><span id="local-6989586621680919851"><span id="local-6989586621680919853"><span id="local-6989586621680919855"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Stablecoin</span></span></span></span><span>
</span><span id="line-443"></span><span id="local-6989586621680919845"><span id="local-6989586621680919847"><span id="local-6989586621680919849"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">SCAction</span></span></span></span><span>
</span><span id="line-444"></span><span id="local-6989586621680919839"><span id="local-6989586621680919841"><span id="local-6989586621680919843"><span class="hs-identifier">PlutusTx.unstableMakeIsData</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">Input</span></span></span></span><span>
</span><span id="line-445"></span></pre></body></html>